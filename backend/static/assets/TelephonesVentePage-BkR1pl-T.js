import{u as F,a as T,j as e,c as j,i as O}from"./index-eSKkSpLM.js";import{r as l}from"./vendor-react-DWtYaMjq.js";import{c as w,R as z,P as V,T as q,aX as K,S as U,aR as H,r as I,$ as X,K as Y,Y as Z}from"./vendor-icons-CUXb3u1C.js";const P={"Grade A":{bg:"bg-emerald-100",text:"text-emerald-700"},"Grade A+":{bg:"bg-emerald-100",text:"text-emerald-700"},"Grade AB":{bg:"bg-lime-100",text:"text-lime-700"},"Grade B":{bg:"bg-yellow-100",text:"text-yellow-700"},"Grade B+":{bg:"bg-yellow-100",text:"text-yellow-700"},"Grade C":{bg:"bg-orange-100",text:"text-orange-700"},Neuf:{bg:"bg-blue-100",text:"text-blue-700"}},J=g=>g==null||g===0?"—":Number(g).toFixed(2).replace(".",",")+" €",Q=l.memo(function({phone:a}){const i=a.grade||(a.type_produit==="neuf"?"Neuf":null),n=i&&P[i]?P[i]:null,u=a.en_stock!==!1&&a.en_stock!==0;return e.jsxs("div",{className:`card overflow-hidden transition-all hover:shadow-md group ${u?"":"opacity-50"}`,children:[e.jsxs("div",{className:"relative h-44 bg-slate-50 flex items-center justify-center overflow-hidden",children:[a.image_url?e.jsx("img",{src:a.image_url,alt:a.modele||"",className:"h-full w-full object-contain p-3 group-hover:scale-105 transition-transform",loading:"lazy",onError:r=>{var N;r.target.style.display="none",(N=r.target.nextElementSibling)==null||N.classList.remove("hidden")}}):null,e.jsx("div",{className:`flex flex-col items-center justify-center text-slate-300 ${a.image_url?"hidden":""}`,children:e.jsx(w,{className:"w-12 h-12 mb-1"})}),n&&e.jsx("span",{className:`absolute top-2 left-2 text-[10px] font-bold px-2 py-0.5 rounded-md ${n.bg} ${n.text}`,children:i==="Neuf"?"NEUF":i.toUpperCase()}),e.jsxs("span",{className:`absolute top-2 right-2 text-[10px] font-semibold px-2 py-0.5 rounded-md flex items-center gap-1
          ${u?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-600"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${u?"bg-emerald-500":"bg-red-400"}`}),u?"En stock":"Rupture"]})]}),e.jsxs("div",{className:"p-3.5",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-slate-400 mb-0.5",children:a.marque}),e.jsx("h3",{className:"text-sm font-bold text-slate-900 leading-tight mb-1 line-clamp-2",children:a.modele}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:[a.stockage,a.couleur].filter(Boolean).join(" · ")}),e.jsx("p",{className:"text-lg font-extrabold text-brand-600",children:J(a.prix_vente)}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-400 mt-1.5",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsxs("span",{className:"text-[11px]",children:["Garantie ",a.garantie_mois||12," mois"]})]})]})]})});function se(){const{user:g}=F(),[a,i]=l.useState(""),[n,u]=l.useState(""),[r,N]=l.useState(""),[o,$]=l.useState(""),[b,E]=l.useState(!0),[d,R]=l.useState("prix_asc"),[x,h]=l.useState(1),[v,k]=l.useState(!1),S=l.useRef(null);l.useEffect(()=>(clearTimeout(S.current),S.current=setTimeout(()=>{u(a),h(1)},300),()=>clearTimeout(S.current)),[a]),l.useEffect(()=>{h(1)},[r,o,b,d]);const{data:p}=T("telVente:stats",async()=>{const[s,t]=await Promise.all([j.getTelephoneStats(),j.getTelephoneMarques()]);return{stats:s,marques:t||[]}},{tags:["telephones"],ttl:3e5}),m=(p==null?void 0:p.stats)??{},M=(p==null?void 0:p.marques)??[],A=l.useMemo(()=>{const s=["telVente:list",`p:${x}`];return n&&s.push(`q:${n}`),r&&s.push(`m:${r}`),o&&s.push(`t:${o}`),b&&s.push("stock"),d&&s.push(`s:${d}`),s.join(":")},[x,n,r,o,b,d]),{data:c,loading:G}=T(A,async()=>{const s={page:x,limit:24};n&&(s.search=n),r&&(s.marque=r),o&&(s.type_produit=o),b&&(s.en_stock=!0),d&&(s.tri=d);const t=await j.getTelephonesCatalogue(s);return t!=null&&t.items?{phones:t.items,totalPages:t.total_pages||1,total:t.total||0}:{phones:[],totalPages:1,total:0}},{tags:["telephones"],ttl:3e5}),C=(c==null?void 0:c.phones)??[],f=(c==null?void 0:c.totalPages)??1,y=(c==null?void 0:c.total)??0,L=async()=>{if(!v){k(!0);try{await j.syncTelephones();let s=0;for(;s<60;){await new Promise(t=>setTimeout(t,5e3)),s++;try{if(!(await j.getSyncStatus()).running)break}catch{break}}h(1),O("telephones")}catch(s){console.error(s)}finally{k(!1)}}};return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 max-w-7xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-brand-600"})," Téléphones en vente"]}),e.jsxs("p",{className:"text-sm text-slate-500 mt-0.5",children:[y," téléphone",y>1?"s":""," disponibles — catalogue LCD-Phone"]})]}),e.jsxs("button",{onClick:L,disabled:v,className:"btn-secondary flex items-center gap-2",children:[e.jsx(z,{className:`w-4 h-4 ${v?"animate-spin":""}`}),v?"Synchronisation...":"Sync LCD-Phone"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 mb-6",children:[e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Total"})]}),e.jsx("p",{className:"text-xl font-bold text-slate-900",children:m.total||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-4 h-4 text-emerald-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"En stock"})]}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:m.en_stock||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Neufs"})]}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:m.neufs||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Reconditionnés"})]}),e.jsx("p",{className:"text-xl font-bold text-amber-600",children:m.reconditionnes||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{className:"w-4 h-4 text-brand-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Marques"})]}),e.jsx("p",{className:"text-xl font-bold text-brand-600",children:m.nb_marques||0})]})]}),e.jsxs("div",{className:"card overflow-hidden mb-6",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-slate-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par marque, modèle...",value:a,onChange:s=>i(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 bg-slate-50/50 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 focus:bg-white transition-all"})]})}),e.jsxs("div",{className:"px-3 sm:px-4 py-2.5 flex items-center gap-2 flex-wrap bg-slate-50/50",children:[e.jsx(H,{className:"w-3.5 h-3.5 text-slate-400 shrink-0"}),e.jsxs("select",{value:r,onChange:s=>N(s.target.value),className:"text-xs border border-slate-200 rounded-md px-2 py-1.5 bg-white text-slate-600",children:[e.jsx("option",{value:"",children:"Toutes marques"}),M.map(s=>{const t=typeof s=="string"?s:s.marque;return e.jsx("option",{value:t,children:t},t)})]}),e.jsxs("select",{value:o,onChange:s=>$(s.target.value),className:"text-xs border border-slate-200 rounded-md px-2 py-1.5 bg-white text-slate-600",children:[e.jsx("option",{value:"",children:"Tous types"}),e.jsx("option",{value:"neuf",children:"Neuf"}),e.jsx("option",{value:"occasion",children:"Occasion"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-slate-600 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>E(s.target.checked),className:"rounded border-slate-300 text-brand-600 focus:ring-brand-500"}),"En stock uniquement"]}),e.jsxs("select",{value:d,onChange:s=>R(s.target.value),className:"text-xs border border-slate-200 rounded-md px-2 py-1.5 bg-white text-slate-600 ml-auto",children:[e.jsx("option",{value:"prix_asc",children:"Prix croissant"}),e.jsx("option",{value:"prix_desc",children:"Prix décroissant"}),e.jsx("option",{value:"marque",children:"Marque A-Z"}),e.jsx("option",{value:"nouveautes",children:"Nouveautés"})]})]})]}),m.derniere_sync&&e.jsxs("p",{className:"text-[11px] text-slate-400 mb-3 px-1",children:["Dernière synchronisation : ",new Date(m.derniere_sync).toLocaleString("fr-FR")]}),G?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx(I,{className:"w-6 h-6 animate-spin text-brand-600"})}):C.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(w,{className:"w-7 h-7 text-slate-300"})}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Aucun téléphone trouvé"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Modifiez vos filtres ou lancez une synchronisation"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3",children:C.map(s=>e.jsx(Q,{phone:s},s.id))}),f>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx("button",{onClick:()=>h(s=>Math.max(1,s-1)),disabled:x<=1,className:"p-2 rounded-lg hover:bg-slate-100 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(X,{className:"w-4 h-4 text-slate-600"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:f},(s,t)=>t+1).filter(s=>s===1||s===f||Math.abs(s-x)<=2).reduce((s,t,_,B)=>(_>0&&t-B[_-1]>1&&s.push("..."),s.push(t),s),[]).map((s,t)=>s==="..."?e.jsx("span",{className:"px-1 text-slate-400",children:"..."},`dots-${t}`):e.jsx("button",{onClick:()=>h(s),className:`w-8 h-8 rounded-lg text-xs font-medium transition-colors ${s===x?"bg-brand-600 text-white":"text-slate-500 hover:bg-slate-100"}`,children:s},s))}),e.jsx("button",{onClick:()=>h(s=>Math.min(f,s+1)),disabled:x>=f,className:"p-2 rounded-lg hover:bg-slate-100 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(Y,{className:"w-4 h-4 text-slate-600"})}),e.jsxs("span",{className:"text-xs text-slate-400 ml-2",children:[y," résultat",y>1?"s":""]})]})]})]})}export{se as default};
