import{j as e,a as V,c as O}from"./index-CFpf0O-_.js";import{r as x}from"./vendor-react-DWtYaMjq.js";import{L as W,l as q,z as F,ap as Y,ax as H,ab as J,ay as X,az as G,e as y,a0 as Q,W as Z,c as ee,ai as te,aA as se,C as ae}from"./vendor-icons-CUXb3u1C.js";import{R as le,L as ne,C as D,X as _,Y as L,T,f as I,g as E,B as re,h as P}from"./vendor-charts-O0jNFQnY.js";const $="#7C3AED",B="#10B981",ie=[{label:"Aujourd'hui",value:"today",gran:"heure"},{label:"Hier",value:"yesterday",gran:"heure"},{label:"Ce mois",value:"month",gran:"jour"},{label:"12 mois",value:"12m",gran:"mois"},{label:"Personnalisé",value:"custom",gran:"jour"}],ce={tickets_ouverts:Z,tickets_periode:Q,clotures:y,ca_encaisse:G,ca_moyen:X,temps_moyen:J,taux_conversion:H,nouveaux_clients:Y},R={violet:{bg:"bg-violet-500/10",text:"text-violet-400",border:"border-violet-500/20"},blue:{bg:"bg-blue-500/10",text:"text-blue-400",border:"border-blue-500/20"},emerald:{bg:"bg-emerald-500/10",text:"text-emerald-400",border:"border-emerald-500/20"},amber:{bg:"bg-amber-500/10",text:"text-amber-400",border:"border-amber-500/20"},cyan:{bg:"bg-cyan-500/10",text:"text-cyan-400",border:"border-cyan-500/20"},pink:{bg:"bg-pink-500/10",text:"text-pink-400",border:"border-pink-500/20"},indigo:{bg:"bg-indigo-500/10",text:"text-indigo-400",border:"border-indigo-500/20"}},oe=["","",""],w="kp_admin_auth";function z(t){return t==null?"0,00 €":Number(t).toLocaleString("fr-FR",{minimumFractionDigits:2})+" €"}function U(t){if(!t&&t!==0)return"—";const a=Math.floor(t),l=Math.round((t-a)*60);return a===0?`${l}min`:`${a}h${l>0?` ${l}min`:""}`}function de(t,a){switch(a){case"euro":return z(t);case"heures":return U(t);case"pct":return`${t}%`;default:return String(t)}}function b(t){return t.toISOString().split("T")[0]}function xe(t,a,l){const n=new Date,i=b(n);switch(t){case"today":return{debut:i,fin:i,granularite:"heure"};case"yesterday":{const o=b(new Date(n-864e5));return{debut:o,fin:o,granularite:"heure"}}case"month":return{debut:i.slice(0,8)+"01",fin:i,granularite:"jour"};case"12m":return{debut:b(new Date(n-365*864e5)),fin:i,granularite:"mois"};case"custom":return{debut:a||i,fin:l||i,granularite:"jour"};default:return{debut:i.slice(0,8)+"01",fin:i,granularite:"jour"}}}function K({active:t,payload:a,label:l}){return!t||!a||!a.length?null:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 shadow-xl text-xs",children:[e.jsx("p",{className:"text-slate-400 mb-1 font-medium",children:l}),a.map((n,i)=>e.jsxs("p",{className:"font-semibold",style:{color:n.color||n.fill||"#fff"},children:[n.name,": ",n.value]},i))]})}function me(){return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"w-8 h-8 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"})})}function j({text:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-slate-500",children:[e.jsx(y,{className:"w-8 h-8 text-slate-600 mb-2"}),e.jsx("p",{className:"text-sm",children:t||"Aucune donnée disponible"})]})}function N({title:t,children:a,className:l=""}){return e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700/50 p-5 ${l}`,children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-4",children:t}),a]})}function ue({trend:t}){if(t==null)return null;const a=t>0,l=t===0,n=l?"text-slate-400 bg-slate-500/10":a?"text-emerald-400 bg-emerald-500/10":"text-red-400 bg-red-500/10",i=l?te:a?se:ae;return e.jsxs("span",{className:`inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-md text-[10px] font-bold ${n}`,children:[e.jsx(i,{className:"w-3 h-3"}),Math.abs(t),"%"]})}function M({pct:t,color:a="bg-violet-500"}){return e.jsx("div",{className:"w-full bg-slate-700/50 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${a}`,style:{width:`${Math.min(t,100)}%`}})})}function he({period:t,setPeriod:a,customStart:l,setCustomStart:n,customEnd:i,setCustomEnd:o}){return e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"flex bg-slate-800 rounded-lg p-0.5 border border-slate-700/50 flex-wrap",children:ie.map(({label:d,value:c})=>e.jsx("button",{onClick:()=>a(c),className:`px-2.5 py-1.5 rounded-md text-[11px] font-medium transition-all whitespace-nowrap ${t===c?"bg-violet-600 text-white shadow-sm":"text-slate-400 hover:text-white"}`,children:d},c))}),t==="custom"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:l,onChange:d=>n(d.target.value),className:"px-2.5 py-1.5 rounded-lg bg-slate-800 border border-slate-700 text-white text-xs focus:outline-none focus:ring-2 focus:ring-violet-500/40"}),e.jsx("span",{className:"text-slate-500 text-xs",children:"→"}),e.jsx("input",{type:"date",value:i,onChange:d=>o(d.target.value),className:"px-2.5 py-1.5 rounded-lg bg-slate-800 border border-slate-700 text-white text-xs focus:outline-none focus:ring-2 focus:ring-violet-500/40"})]})]})}function pe({onLogin:t}){const[a,l]=x.useState(""),[n,i]=x.useState(""),[o,d]=x.useState(""),[c,f]=x.useState(!1),r=async m=>{if(m.preventDefault(),!(!a||!n)){d(""),f(!0);try{if((await O.verifyAdmin(a,n)).success){const h={ts:Date.now()};localStorage.setItem(w,JSON.stringify(h)),localStorage.setItem("klikphone_admin","true"),t(h)}else d("Identifiants incorrects")}catch(p){d(p.message||"Erreur de connexion")}finally{f(!1)}}};return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-sm",children:[e.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700/50 shadow-2xl p-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-14 h-14 rounded-xl bg-violet-600/20 flex items-center justify-center",children:e.jsx(W,{className:"w-7 h-7 text-violet-400"})})}),e.jsx("h1",{className:"text-xl font-display font-bold text-white text-center mb-1",children:"Administration"}),e.jsx("p",{className:"text-sm text-slate-400 text-center mb-8",children:"Accès réservé aux administrateurs"}),e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1.5",children:"Identifiant"}),e.jsx("input",{type:"text",value:a,onChange:m=>l(m.target.value),className:"w-full px-3.5 py-2.5 rounded-lg bg-slate-900 border border-slate-700 text-white text-sm placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500/40 focus:border-violet-500 transition-all",placeholder:"Votre identifiant",autoComplete:"username"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1.5",children:"Mot de passe"}),e.jsx("input",{type:"password",value:n,onChange:m=>i(m.target.value),className:"w-full px-3.5 py-2.5 rounded-lg bg-slate-900 border border-slate-700 text-white text-sm placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500/40 focus:border-violet-500 transition-all",placeholder:"••••••••",autoComplete:"current-password"})]}),o&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg px-3 py-2 text-sm text-red-400 text-center",children:o}),e.jsx("button",{type:"submit",disabled:c||!a||!n,className:"w-full py-2.5 rounded-lg bg-violet-600 hover:bg-violet-500 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm font-semibold shadow-lg shadow-violet-600/25 transition-all",children:c?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"})," Connexion..."]}):"Se connecter"})]})]}),e.jsx("p",{className:"text-center text-xs text-slate-600 mt-6",children:"Klikphone SAV — Administration"})]})})}function be({onLogout:t}){const[a,l]=x.useState("month"),[n,i]=x.useState(b(new Date(Date.now()-30*864e5))),[o,d]=x.useState(b(new Date)),c=x.useMemo(()=>xe(a,n,o),[a,n,o]),f=x.useMemo(()=>`reporting:${c.debut}:${c.fin}:${c.granularite}`,[c]),{data:r,loading:m}=V(f,()=>O.getReporting(c),{tags:["reporting"],ttl:12e4}),p=(r==null?void 0:r.kpis)??[],h=(r==null?void 0:r.affluence)??[],k=(r==null?void 0:r.performance_accueil)??[],S=(r==null?void 0:r.performance_techniciens)??[],A=(r==null?void 0:r.top_pannes)??[],C=(r==null?void 0:r.top_modeles)??[],v=c.granularite;return e.jsxs("div",{className:"min-h-screen bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-slate-900/95 backdrop-blur-sm border-b border-slate-800",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-white tracking-tight",children:"Reporting"}),e.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Vue d'ensemble de la boutique"})]}),e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800 border border-slate-700/50 transition-all",children:[e.jsx(q,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Déconnexion"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-slate-500 shrink-0"}),e.jsx(he,{period:a,setPeriod:l,customStart:n,setCustomStart:i,customEnd:o,setCustomEnd:d})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsx("section",{children:m&&p.length===0?e.jsx(me,{}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-4 gap-3",children:p.map(s=>{const u=ce[s.id]||y,g=R[s.color]||R.violet;return e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700/50 p-4 hover:border-slate-600 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg ${g.bg} flex items-center justify-center`,children:e.jsx(u,{className:`w-4.5 h-4.5 ${g.text}`})}),e.jsx(ue,{trend:s.trend})]}),e.jsx("p",{className:"text-2xl font-bold text-white tracking-tight",children:de(s.value,s.format)}),e.jsx("p",{className:"text-[11px] text-slate-500 mt-1 font-medium",children:s.label})]},s.id)})})}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Affluence"}),e.jsx(N,{title:v==="heure"?"Dépôts par heure":v==="mois"?"Dépôts par mois":"Dépôts par jour",children:h.length?e.jsx(le,{width:"100%",height:320,children:v==="mois"?e.jsxs(ne,{data:h,children:[e.jsx(D,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(_,{dataKey:"label",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"}}),e.jsx(L,{tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},allowDecimals:!1}),e.jsx(T,{content:e.jsx(K,{})}),e.jsx(I,{wrapperStyle:{fontSize:11,color:"#94A3B8"}}),e.jsx(E,{type:"monotone",dataKey:"tickets",name:"Tickets",stroke:$,strokeWidth:2.5,dot:{r:3},activeDot:{r:5}}),e.jsx(E,{type:"monotone",dataKey:"clients",name:"Clients",stroke:B,strokeWidth:2,dot:{r:2},activeDot:{r:4},strokeDasharray:"5 5"})]}):e.jsxs(re,{data:h,children:[e.jsx(D,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(_,{dataKey:"label",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"}}),e.jsx(L,{tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},allowDecimals:!1}),e.jsx(T,{content:e.jsx(K,{})}),e.jsx(I,{wrapperStyle:{fontSize:11,color:"#94A3B8"}}),e.jsx(P,{dataKey:"tickets",name:"Tickets",fill:$,radius:[4,4,0,0],maxBarSize:32}),e.jsx(P,{dataKey:"clients",name:"Clients",fill:B,radius:[4,4,0,0],maxBarSize:32})]})}):e.jsx(j,{text:"Aucune donnée d'affluence"})})]}),k.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Performance Accueil"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:k.map(s=>{const u=s.utilisateur.split(" ").map(g=>g[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700/50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-400",children:u})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-white",children:s.utilisateur}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Accueil"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-white",children:s.tickets_enregistres}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Tickets enregistrés"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold text-blue-400",children:s.clients_uniques}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Clients uniques"})]})]})]},s.utilisateur)})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Performance Techniciens"}),e.jsx(N,{title:"Classement des techniciens",children:S.length?e.jsx("div",{className:"overflow-x-auto -mx-5 px-5",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700",children:[e.jsx("th",{className:"text-left text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2 w-8",children:"#"}),e.jsx("th",{className:"text-left text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Technicien"}),e.jsx("th",{className:"text-center text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Réparations"}),e.jsx("th",{className:"text-center text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Temps moy."}),e.jsx("th",{className:"text-right text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"CA généré"})]})}),e.jsx("tbody",{children:S.map(s=>e.jsxs("tr",{className:"border-b border-slate-700/30 hover:bg-slate-700/20 transition-colors",children:[e.jsx("td",{className:"py-2.5",children:e.jsx("span",{className:"text-base",children:s.rang<=3?oe[s.rang-1]:s.rang})}),e.jsx("td",{className:"py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:(s.couleur||"#7C3AED")+"20"},children:e.jsx("span",{className:"text-xs font-bold",style:{color:s.couleur||"#7C3AED"},children:(s.technicien||"?")[0].toUpperCase()})}),e.jsx("span",{className:"text-sm font-medium text-white",children:s.technicien})]})}),e.jsx("td",{className:"py-2.5 text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-violet-500/20 text-violet-300",children:s.reparations})}),e.jsx("td",{className:"py-2.5 text-center text-sm text-slate-300",children:U(s.temps_moyen_h)}),e.jsx("td",{className:"py-2.5 text-right text-sm font-semibold text-emerald-400",children:z(s.ca_genere)})]},s.technicien))})]})}):e.jsx(j,{text:"Aucune réparation sur la période"})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Analyses"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(N,{title:"Top 10 Pannes",children:A.length?e.jsx("div",{className:"space-y-3",children:A.map((s,u)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-slate-300 truncate max-w-[60%]",children:s.label}),e.jsxs("span",{className:"text-xs font-semibold text-white ml-2",children:[s.count," ",e.jsxs("span",{className:"text-slate-500 font-normal",children:["(",s.pct,"%)"]})]})]}),e.jsx(M,{pct:s.pct,color:"bg-violet-500"})]},u))}):e.jsx(j,{text:"Aucune panne enregistrée"})}),e.jsx(N,{title:"Top 10 Modèles réparés",children:C.length?e.jsx("div",{className:"space-y-3",children:C.map((s,u)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2 truncate max-w-[60%]",children:[e.jsx(ee,{className:"w-3.5 h-3.5 text-slate-500 shrink-0"}),e.jsx("span",{className:"text-xs text-slate-300 truncate",children:s.label})]}),e.jsxs("span",{className:"text-xs font-semibold text-white ml-2",children:[s.count," ",e.jsxs("span",{className:"text-slate-500 font-normal",children:["(",s.pct,"%)"]})]})]}),e.jsx(M,{pct:s.pct,color:"bg-blue-500"})]},u))}):e.jsx(j,{text:"Aucun modèle enregistré"})})]})]}),e.jsx("div",{className:"pt-4 pb-8 text-center",children:e.jsx("p",{className:"text-xs text-slate-600",children:"Klikphone SAV — Reporting"})})]})]})}function ve(){const[t,a]=x.useState(()=>{if(localStorage.getItem("klikphone_admin")==="true")return{ts:Date.now()};try{const l=localStorage.getItem(w);return l?JSON.parse(l):null}catch{return null}});return t?e.jsx(be,{onLogout:()=>{localStorage.removeItem(w),localStorage.removeItem("klikphone_admin"),a(null)}}):e.jsx(pe,{onLogin:l=>a(l)})}export{ve as default};
