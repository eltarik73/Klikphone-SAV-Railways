import{u as Te,c as d,j as e}from"./index-o1hlKjMP.js";import{d as De,r as n}from"./vendor-react-DWtYaMjq.js";import{F as w,J as U,a6 as ne,ab as Ae,az as Ee,S as X,r as I,ag as ie,a2 as re,q as Re,X as S,x as ce,s as qe,aS as Le,aT as Fe,a3 as Pe}from"./vendor-icons-CUXb3u1C.js";const Me=["Brouillon","Envoyé","Accepté","Refusé","Converti"],T={Brouillon:{bg:"#f1f5f9",text:"#475569",border:"#cbd5e1"},Envoyé:{bg:"#eff6ff",text:"#1d4ed8",border:"#93c5fd"},Accepté:{bg:"#ecfdf5",text:"#047857",border:"#6ee7b7"},Refusé:{bg:"#fef2f2",text:"#dc2626",border:"#fca5a5"},Converti:{bg:"#f5f3ff",text:"#7c3aed",border:"#c4b5fd"}},o=D=>D==null?"0,00":Number(D).toFixed(2).replace(".",",");function $e(){var Z,ee,se,te,ae;const{user:D}=Te(),[de]=De(),[$,oe]=n.useState([]),[xe,B]=n.useState(!0),[y,me]=n.useState(""),[_,pe]=n.useState(""),[b,ue]=n.useState(null),[he,h]=n.useState(!1),[C,A]=n.useState(null),[V,z]=n.useState(!1),[i,r]=n.useState(L()),[N,j]=n.useState([{description:"",quantite:1,prix_unitaire:0}]),[v,p]=n.useState(""),[O,E]=n.useState([]),[je,H]=n.useState(!1),[x,u]=n.useState(null),[fe,k]=n.useState(!1),[be,m]=n.useState(!1),R=n.useRef(null),q=n.useRef(null),[a,J]=n.useState(null),[Q,g]=n.useState(!1);function L(){return{client_id:null,client_nom:"",client_prenom:"",client_tel:"",client_email:"",appareil:"",description:"",tva:20,remise:0,notes:"",validite_jours:30}}n.useEffect(()=>{var s;if(de.get("create")==="1"){const t=sessionStorage.getItem("kp_devis_prefill");if(t)try{const l=JSON.parse(t);sessionStorage.removeItem("kp_devis_prefill"),A(null),r(c=>({...L(),appareil:l.appareil||""})),(s=l.lignes)!=null&&s.length&&j(l.lignes.map(c=>({description:c.description||"",quantite:c.quantite||1,prix_unitaire:c.prix_unitaire||0}))),u(null),m(!1),p(""),h(!0)}catch{}else K()}},[]),n.useEffect(()=>{if(clearTimeout(R.current),!v||v.length<2){E([]),k(!1);return}return R.current=setTimeout(async()=>{H(!0);try{const s=await d.getClients({search:v,limit:8});E(s||[]),k(!0)}catch{E([])}H(!1)},200),()=>clearTimeout(R.current)},[v]),n.useEffect(()=>{const s=t=>{q.current&&!q.current.contains(t.target)&&k(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const Ne=s=>{u(s),r(t=>({...t,client_id:s.id,client_nom:s.nom||"",client_prenom:s.prenom||"",client_tel:s.telephone||"",client_email:s.email||""})),p(`${s.prenom||""} ${s.nom||""}`.trim()),k(!1),m(!1)},G=()=>{u(null),p(""),r(s=>({...s,client_id:null,client_nom:"",client_prenom:"",client_tel:"",client_email:""})),m(!1)},f=async()=>{B(!0);try{const s={};y&&(s.search=y),_&&(s.statut=_);const[t,l]=await Promise.all([d.getDevis(s),d.getDevisStats()]);oe(t||[]),ue(l)}catch(s){console.error(s)}B(!1)};n.useEffect(()=>{f()},[y,_]);const K=()=>{A(null),r(L()),j([{description:"",quantite:1,prix_unitaire:0}]),u(null),p(""),m(!1),h(!0)},W=async s=>{var t;try{const l=await d.getDevisById(s);A(s),r({client_id:l.client_id||null,client_nom:l.client_nom||"",client_prenom:l.client_prenom||"",client_tel:l.client_tel||"",client_email:l.client_email||"",appareil:l.appareil||"",description:l.description||"",tva:l.tva||20,remise:l.remise||0,notes:l.notes||"",validite_jours:l.validite_jours||30}),l.client_id&&l.client?(u(l.client),p(`${l.client.prenom||""} ${l.client.nom||""}`.trim()),m(!1)):l.client_nom?(u(null),p(""),m(!0)):(u(null),p(""),m(!1)),j(((t=l.lignes)==null?void 0:t.length)>0?l.lignes.map(c=>({description:c.description,quantite:c.quantite,prix_unitaire:Number(c.prix_unitaire)})):[{description:"",quantite:1,prix_unitaire:0}]),h(!0)}catch{}},ve=async s=>{try{const t=await d.getDevisById(s);J(t),g(!0)}catch{}},F=n.useMemo(()=>{const s=N.reduce((t,l)=>t+(l.quantite||0)*(l.prix_unitaire||0),0);return Math.max(0,s-(i.remise||0))},[N,i.remise]),ge=n.useMemo(()=>F*(1+(i.tva||0)/100),[F,i.tva]),we=async()=>{if(!(!i.client_nom&&!i.client_tel&&!i.client_id)){z(!0);try{const s=N.filter(l=>l.description.trim()),t={...i,lignes:s};C?await d.updateDevis(C,t):await d.createDevis(t),h(!1),f()}catch(s){console.error(s)}z(!1)}},ye=async s=>{if(confirm("Supprimer ce devis ?"))try{await d.deleteDevis(s),f()}catch{}},P=async(s,t)=>{try{await d.updateDevis(s,{statut:t}),f(),Q&&(a==null?void 0:a.id)===s&&J(l=>({...l,statut:t}))}catch{}},_e=async s=>{if(confirm("Convertir ce devis en ticket SAV ?"))try{const t=await d.convertDevisToTicket(s);alert(`Ticket créé: ${t.ticket_code}`),f(),g(!1)}catch(t){alert("Erreur: "+t.message)}},Y=async s=>{try{await d.duplicateDevis(s),f()}catch{}},Ce=()=>j(s=>[...s,{description:"",quantite:1,prix_unitaire:0}]),ke=s=>j(t=>t.filter((l,c)=>c!==s)),M=(s,t,l)=>j(c=>c.map((le,Se)=>Se===s?{...le,[t]:l}:le));return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 max-w-7xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-brand-600"})," Devis"]}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:"Gestion des devis clients"})]}),e.jsxs("button",{onClick:K,className:"btn-primary",children:[e.jsx(U,{className:"w-4 h-4"})," Nouveau devis"]})]}),b&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Total"})]}),e.jsx("p",{className:"text-xl font-bold text-slate-900",children:b.total||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ne,{className:"w-4 h-4 text-emerald-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Acceptés"})]}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:b.acceptes||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ae,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"En attente"})]}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:b.envoyes||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ee,{className:"w-4 h-4 text-brand-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"CA Accepté"})]}),e.jsxs("p",{className:"text-xl font-bold text-brand-600",children:[o(b.ca_accepte)," €"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{value:y,onChange:s=>me(s.target.value),placeholder:"Rechercher par nom, téléphone, numéro...",className:"input pl-9"})]}),e.jsxs("select",{value:_,onChange:s=>pe(s.target.value),className:"input w-auto min-w-[140px]",children:[e.jsx("option",{value:"",children:"Tous statuts"}),Me.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),xe?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"w-6 h-6 animate-spin text-brand-600"})}):$.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(w,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Aucun devis"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Créez votre premier devis"})]}):e.jsx("div",{className:"space-y-2",children:$.map(s=>{const t=T[s.statut]||T.Brouillon;return e.jsx("div",{className:"card p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>ve(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shrink-0",style:{background:t.bg},children:e.jsx(w,{className:"w-5 h-5",style:{color:t.text}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-sm text-slate-900",children:s.numero}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:t.bg,color:t.text,border:`1px solid ${t.border}`},children:s.statut})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-0.5 truncate",children:[s.client_prenom," ",s.client_nom,s.appareil?` — ${s.appareil}`:""]})]})]}),e.jsxs("div",{className:"text-right shrink-0 ml-3",children:[e.jsxs("p",{className:"font-bold text-sm text-slate-900",children:[o(s.total_ttc)," €"]}),e.jsx("p",{className:"text-[11px] text-slate-400",children:s.date_creation?new Date(s.date_creation).toLocaleDateString("fr-FR"):""})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-3",onClick:l=>l.stopPropagation(),children:[e.jsx("button",{onClick:()=>W(s.id),className:"p-1.5 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600",title:"Modifier",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Y(s.id),className:"p-1.5 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600",title:"Dupliquer",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ye(s.id),className:"p-1.5 rounded-lg hover:bg-red-50 text-slate-400 hover:text-red-500",title:"Supprimer",children:e.jsx(Re,{className:"w-4 h-4"})})]})]})},s.id)})}),he&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-start justify-center overflow-y-auto p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100",children:[e.jsx("h2",{className:"text-lg font-display font-bold text-slate-900",children:C?"Modifier le devis":"Nouveau devis"}),e.jsx("button",{onClick:()=>h(!1),className:"p-2 rounded-lg hover:bg-slate-100",children:e.jsx(S,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-6 space-y-5 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3",children:"Client"}),x?e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 flex items-center justify-center shrink-0",children:e.jsxs("span",{className:"text-sm font-bold text-brand-700",children:[(((Z=x.prenom)==null?void 0:Z[0])||"").toUpperCase(),(((ee=x.nom)==null?void 0:ee[0])||"").toUpperCase()]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-semibold text-sm text-slate-900",children:[x.prenom," ",x.nom]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 mt-0.5",children:[x.telephone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"})," ",x.telephone]}),x.email&&e.jsx("span",{children:x.email})]})]}),e.jsx("button",{onClick:G,className:"p-1.5 rounded-lg hover:bg-slate-200 text-slate-400",children:e.jsx(S,{className:"w-4 h-4"})})]}):be?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Nouveau client"}),e.jsxs("button",{onClick:()=>{m(!1),G()},className:"text-xs text-brand-600 hover:text-brand-700 font-medium flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"})," Rechercher"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom *"}),e.jsx("input",{value:i.client_nom,onChange:s=>r(t=>({...t,client_nom:s.target.value})),className:"input",placeholder:"Dupont"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prénom"}),e.jsx("input",{value:i.client_prenom,onChange:s=>r(t=>({...t,client_prenom:s.target.value})),className:"input",placeholder:"Jean"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Téléphone"}),e.jsx("input",{value:i.client_tel,onChange:s=>r(t=>({...t,client_tel:s.target.value})),className:"input",placeholder:"06 XX XX XX XX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email"}),e.jsx("input",{value:i.client_email,onChange:s=>r(t=>({...t,client_email:s.target.value})),className:"input",placeholder:"email@exemple.com"})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",ref:q,children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{value:v,onChange:s=>p(s.target.value),placeholder:"Nom, prénom ou téléphone...",className:"input pl-9 pr-8"}),je&&e.jsx(I,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-brand-500"}),fe&&O.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-xl shadow-xl border border-slate-200 z-50 max-h-52 overflow-y-auto",children:O.map(s=>{var t,l;return e.jsxs("button",{onClick:()=>Ne(s),className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-slate-50 text-left border-b border-slate-50 last:border-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center shrink-0",children:e.jsxs("span",{className:"text-xs font-bold text-brand-700",children:[(((t=s.prenom)==null?void 0:t[0])||"").toUpperCase(),(((l=s.nom)==null?void 0:l[0])||"").toUpperCase()]})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-slate-800 truncate",children:[s.prenom," ",s.nom]}),e.jsx("p",{className:"text-xs text-slate-400",children:s.telephone||""})]})]},s.id)})})]}),e.jsxs("button",{onClick:()=>m(!0),className:"text-xs text-brand-600 hover:text-brand-700 font-medium flex items-center gap-1",children:[e.jsx(U,{className:"w-3.5 h-3.5"})," Nouveau client"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3",children:"Appareil & Description"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Appareil"}),e.jsx("input",{value:i.appareil,onChange:s=>r(t=>({...t,appareil:s.target.value})),className:"input",placeholder:"iPhone 15 Pro Max"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Description"}),e.jsx("input",{value:i.description,onChange:s=>r(t=>({...t,description:s.target.value})),className:"input",placeholder:"Remplacement écran OLED"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Lignes du devis"}),e.jsxs("button",{onClick:Ce,className:"text-xs text-brand-600 hover:text-brand-700 font-medium flex items-center gap-1",children:[e.jsx(U,{className:"w-3.5 h-3.5"})," Ajouter"]})]}),e.jsx("div",{className:"space-y-2",children:N.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:s.description,onChange:l=>M(t,"description",l.target.value),placeholder:"Description",className:"input flex-1"}),e.jsx("input",{type:"number",value:s.quantite,onChange:l=>M(t,"quantite",parseInt(l.target.value)||1),className:"input w-16 text-center",min:"1"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.prix_unitaire,onChange:l=>M(t,"prix_unitaire",parseFloat(l.target.value)||0),className:"input w-24 pr-6 text-right",step:"0.01",min:"0"}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"€"})]}),e.jsxs("span",{className:"text-sm font-semibold text-slate-700 w-20 text-right",children:[o((s.quantite||0)*(s.prix_unitaire||0))," €"]}),N.length>1&&e.jsx("button",{onClick:()=>ke(t),className:"p-1.5 rounded-lg hover:bg-red-50 text-slate-400 hover:text-red-500",children:e.jsx(S,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"TVA (%)"}),e.jsx("input",{type:"number",value:i.tva,onChange:s=>r(t=>({...t,tva:parseFloat(s.target.value)||0})),className:"input",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Remise (€)"}),e.jsx("input",{type:"number",value:i.remise,onChange:s=>r(t=>({...t,remise:parseFloat(s.target.value)||0})),className:"input",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Validité (jours)"}),e.jsx("input",{type:"number",value:i.validite_jours,onChange:s=>r(t=>({...t,validite_jours:parseInt(s.target.value)||30})),className:"input"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Total HT"}),e.jsxs("span",{className:"font-semibold",children:[o(F)," €"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-lg font-bold mt-2 pt-2 border-t border-slate-200",children:[e.jsx("span",{className:"text-slate-900",children:"Total TTC"}),e.jsxs("span",{className:"text-brand-600",children:[o(ge)," €"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Notes"}),e.jsx("textarea",{value:i.notes,onChange:s=>r(t=>({...t,notes:s.target.value})),className:"input min-h-[60px]",placeholder:"Notes internes ou conditions..."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 px-6 py-4 border-t border-slate-100",children:[e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Annuler"}),e.jsxs("button",{onClick:we,disabled:V||!i.client_nom&&!i.client_tel&&!i.client_id,className:"btn-primary",children:[V?e.jsx(I,{className:"w-4 h-4 animate-spin"}):e.jsx(w,{className:"w-4 h-4"}),C?"Enregistrer":"Créer le devis"]})]})]})}),Q&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-start justify-center overflow-y-auto p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-display font-bold text-slate-900",children:a.numero}),(()=>{const s=T[a.statut]||T.Brouillon;return e.jsx("span",{className:"text-xs px-2.5 py-1 rounded-full font-semibold",style:{background:s.bg,color:s.text,border:`1px solid ${s.border}`},children:a.statut})})()]}),e.jsx("button",{onClick:()=>g(!1),className:"p-2 rounded-lg hover:bg-slate-100",children:e.jsx(S,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-6 space-y-5 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2",children:"Client"}),a.client?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 flex items-center justify-center shrink-0",children:e.jsxs("span",{className:"text-sm font-bold text-brand-700",children:[(((se=a.client.prenom)==null?void 0:se[0])||"").toUpperCase(),(((te=a.client.nom)==null?void 0:te[0])||"").toUpperCase()]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-slate-900",children:[a.client.prenom," ",a.client.nom]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[a.client.telephone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"})," ",a.client.telephone]}),a.client.email&&e.jsx("span",{children:a.client.email})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-semibold text-slate-900",children:[a.client_prenom," ",a.client_nom]}),e.jsxs("p",{className:"text-sm text-slate-500",children:[a.client_tel," ",a.client_email?`— ${a.client_email}`:""]})]}),a.appareil&&e.jsxs("p",{className:"text-sm text-slate-600 mt-2",children:[e.jsx("b",{children:"Appareil:"})," ",a.appareil]}),a.description&&e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:a.description})]}),((ae=a.lignes)==null?void 0:ae.length)>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2",children:"Détail"}),e.jsx("div",{className:"divide-y divide-slate-100",children:a.lignes.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:s.description}),e.jsxs("p",{className:"text-xs text-slate-400",children:[s.quantite," x ",o(s.prix_unitaire)," €"]})]}),e.jsxs("span",{className:"font-semibold text-sm",children:[o(s.total)," €"]})]},t))})]}),e.jsxs("div",{className:"bg-brand-50/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total HT"}),e.jsxs("span",{children:[o(a.total_ht)," €"]})]}),Number(a.remise)>0&&e.jsxs("div",{className:"flex justify-between text-sm text-red-600",children:[e.jsx("span",{children:"Remise"}),e.jsxs("span",{children:["-",o(a.remise)," €"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["TVA (",o(a.tva),"%)"]}),e.jsxs("span",{children:[o(Number(a.total_ttc)-Number(a.total_ht))," €"]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold mt-2 pt-2 border-t border-brand-200",children:[e.jsx("span",{children:"Total TTC"}),e.jsxs("span",{className:"text-brand-600",children:[o(a.total_ttc)," €"]})]})]}),a.notes&&e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4 text-sm text-amber-800",children:[e.jsx("b",{children:"Notes:"})," ",a.notes]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 px-6 py-4 border-t border-slate-100",children:[a.statut==="Brouillon"&&e.jsxs("button",{onClick:()=>P(a.id,"Envoyé"),className:"btn-primary text-xs",children:[e.jsx(qe,{className:"w-3.5 h-3.5"})," Marquer envoyé"]}),a.statut==="Envoyé"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>P(a.id,"Accepté"),className:"btn-primary text-xs",style:{background:"#059669"},children:[e.jsx(ne,{className:"w-3.5 h-3.5"})," Accepter"]}),e.jsxs("button",{onClick:()=>P(a.id,"Refusé"),className:"btn-secondary text-xs text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(Le,{className:"w-3.5 h-3.5"})," Refuser"]})]}),a.statut==="Accepté"&&e.jsxs("button",{onClick:()=>_e(a.id),className:"btn-primary text-xs",children:[e.jsx(Fe,{className:"w-3.5 h-3.5"})," Convertir en ticket"]}),e.jsxs("a",{href:d.getDevisPrintUrl(a.id),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary text-xs",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"})," Imprimer"]}),e.jsxs("button",{onClick:()=>{W(a.id),g(!1)},className:"btn-secondary text-xs",children:[e.jsx(ie,{className:"w-3.5 h-3.5"})," Modifier"]}),e.jsxs("button",{onClick:()=>{Y(a.id),g(!1)},className:"btn-secondary text-xs",children:[e.jsx(re,{className:"w-3.5 h-3.5"})," Dupliquer"]})]})]})})]})}export{$e as default};
