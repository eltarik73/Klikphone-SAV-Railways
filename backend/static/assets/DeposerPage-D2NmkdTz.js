import{c as x,j as e}from"./index-YtI8KFVX.js";import{u as K,r as l}from"./vendor-react-DWtYaMjq.js";import{a8 as g,m as y,a2 as W,aK as G,o as I,ab as U,s as B,A as C,w as q,x as S,G as J,ae as O,c as H,u as Q}from"./vendor-icons-CUXb3u1C.js";const Y=i=>/^(?:0|\+33\s?)[1-9](?:[\s.-]?\d{2}){4}$/.test(i.replace(/\s/g,"").length>=10?i:"")||/^\d{10,14}$/.test(i.replace(/[\s.-]/g,"")),Z=i=>!i||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),ee=["Coordonnées","Appareil","Panne"];function le(){const i=K(),[a,b]=l.useState(0),[v,f]=l.useState(!1),[c,u]=l.useState({}),[o,k]=l.useState(null),[A,$]=l.useState([]),[_,N]=l.useState([]),[P,p]=l.useState([]),[E,z]=l.useState([]),[t,j]=l.useState({nom:"",prenom:"",telephone:"",email:"",categorie:"",marque:"",modele:"",modele_autre:"",panne:"",panne_detail:"",notes_client:""});l.useEffect(()=>{x.getCategories().then($).catch(()=>{}),x.getPannes().then(z).catch(()=>{})},[]),l.useEffect(()=>{t.categorie&&(x.getMarques(t.categorie).then(N).catch(()=>N([])),j(s=>({...s,marque:"",modele:"",modele_autre:""})))},[t.categorie]),l.useEffect(()=>{t.categorie&&t.marque&&t.marque!=="Autre"?x.getModeles(t.categorie,t.marque).then(p).catch(()=>p([])):p([]),j(s=>({...s,modele:"",modele_autre:""}))},[t.marque]);const r=(s,n)=>{j(m=>({...m,[s]:n})),u(m=>({...m,[s]:void 0}))},D=()=>{const s={};return a===0&&(t.nom.trim()||(s.nom="Le nom est requis"),t.telephone.trim()?Y(t.telephone)||(s.telephone="Numéro invalide (10 chiffres min.)"):s.telephone="Le téléphone est requis",t.email&&!Z(t.email)&&(s.email="Email invalide")),a===1&&(t.categorie||(s.categorie="La catégorie est requise"),t.marque||(s.marque="La marque est requise"),t.marque==="Autre"&&!t.modele_autre.trim()&&(s.modele_autre="Veuillez préciser le modèle")),a===2&&(t.panne||(s.panne="Veuillez sélectionner une panne")),u(s),Object.keys(s).length===0},T=()=>a===0?t.nom&&t.telephone:a===1?t.categorie&&t.marque&&(t.marque!=="Autre"||t.modele_autre.trim()):a===2?t.panne:!0,M=async()=>{f(!0);try{const s=await x.createDepotDistance({nom:t.nom,prenom:t.prenom,telephone:t.telephone,email:t.email,categorie:t.categorie,marque:t.marque,modele:t.marque==="Autre"?"":t.modele,modele_autre:t.marque==="Autre"?t.modele_autre:"",panne:t.panne,panne_detail:t.panne_detail,notes_client:t.notes_client});k(s.ticket_code)}catch(s){u({submit:s.message||"Erreur lors de l'envoi"})}finally{f(!1)}},V=()=>{D()&&(a===2?M():b(s=>s+1))},d=({field:s})=>c[s]?e.jsx("p",{className:"text-xs text-red-500 mt-1",children:c[s]}):null,[w,h]=l.useState(!1),L=()=>{navigator.clipboard.writeText(o).then(()=>{h(!0),setTimeout(()=>h(!1),2e3)}).catch(()=>{})},X=()=>{const s=`${window.location.origin}/suivi?ticket=${o}`,n=`Mon numéro de suivi Klikphone : ${o}
Suivre ma réparation : ${s}`;navigator.share?navigator.share({title:`Klikphone - ${o}`,text:n}).catch(()=>{}):navigator.clipboard.writeText(n).then(()=>{h(!0),setTimeout(()=>h(!1),2e3)}).catch(()=>{})},R=()=>{const s=t.telephone.replace(/[\s.-]/g,""),n=s.startsWith("0")?"33"+s.slice(1):s,m=`${window.location.origin}/suivi?ticket=${o}`,F=`Klikphone - Votre numéro de suivi : ${o}
Suivez votre réparation ici : ${m}`;window.open(`https://wa.me/${n}?text=${encodeURIComponent(F)}`,"_blank")};return o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-brand-50/30",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-8",children:[e.jsxs("div",{className:"card p-8 text-center animate-in",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-emerald-50 flex items-center justify-center mx-auto mb-6",children:e.jsx(g,{className:"w-10 h-10 text-emerald-500"})}),e.jsx("h2",{className:"text-2xl font-display font-bold text-slate-900 mb-2",children:"Demande enregistrée !"}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3 mb-5 flex items-center gap-2 text-left",children:[e.jsx(y,{className:"w-5 h-5 text-amber-500 shrink-0"}),e.jsx("p",{className:"text-xs font-semibold text-amber-800",children:"Conservez ce numéro ! Il vous permettra de suivre votre réparation."})]}),e.jsx("p",{className:"text-slate-500 text-sm mb-2",children:"Votre numéro de suivi :"}),e.jsxs("div",{className:"bg-brand-50 rounded-xl py-5 px-6 mb-3 border-2 border-brand-200 relative",children:[e.jsx("p",{className:"text-4xl font-extrabold font-mono text-brand-600 tracking-wider select-all",children:o}),e.jsx("button",{onClick:L,className:"absolute top-2 right-2 p-2 rounded-lg bg-white/80 hover:bg-white shadow-sm transition-all",title:"Copier",children:w?e.jsx(g,{className:"w-4 h-4 text-emerald-500"}):e.jsx(W,{className:"w-4 h-4 text-brand-400"})})]}),w&&e.jsx("p",{className:"text-xs text-emerald-600 font-medium mb-2",children:"Copié !"}),e.jsxs("div",{className:"flex gap-2 mb-5",children:[e.jsxs("button",{onClick:X,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-medium transition-all",children:[e.jsx(G,{className:"w-4 h-4"})," Partager"]}),e.jsxs("button",{onClick:R,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-emerald-100 hover:bg-emerald-200 text-emerald-700 text-sm font-medium transition-all",children:[e.jsx(I,{className:"w-4 h-4"})," M'envoyer par WhatsApp"]})]}),e.jsxs("div",{className:"bg-indigo-50 border border-indigo-100 rounded-xl p-4 mb-5 text-left",children:[e.jsxs("h3",{className:"text-sm font-bold text-indigo-800 mb-2 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"})," Prochaines étapes"]}),e.jsxs("ol",{className:"text-sm text-indigo-700 space-y-2 list-decimal list-inside",children:[e.jsx("li",{children:"Notre équipe va valider votre demande"}),e.jsx("li",{children:"Présentez-vous en boutique avec votre appareil"}),e.jsx("li",{children:"Votre dossier est déjà créé — accueil rapide"})]})]}),t.email&&e.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["Un email de confirmation a été envoyé à ",e.jsx("strong",{children:t.email})]}),!t.email&&e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"Vous pouvez retrouver votre ticket avec votre numéro de téléphone sur la page de suivi."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>i(`/suivi?ticket=${o}`),className:"btn-primary w-full",children:[e.jsx(B,{className:"w-4 h-4"})," Suivre ma réparation"]}),e.jsxs("a",{href:"/",className:"btn-secondary w-full inline-flex items-center justify-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"})," Retour à l'accueil"]})]})]}),e.jsxs("div",{className:"mt-6 card p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-600",children:[e.jsx(q,{className:"w-4 h-4 text-brand-600 shrink-0"}),e.jsx("span",{children:"79 Place Saint Léger, Chambéry"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-600 mt-2",children:[e.jsx(S,{className:"w-4 h-4 text-brand-600 shrink-0"}),e.jsx("span",{children:"04 79 60 89 22"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-white to-brand-50/30",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8 animate-in",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-indigo-600 flex items-center justify-center mx-auto mb-4 shadow-lg shadow-indigo-600/20",children:e.jsx(J,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900",children:"Dépôt à distance"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Pré-enregistrez votre appareil en ligne"})]}),e.jsx("div",{className:"flex items-center gap-1 mb-8",children:ee.map((s,n)=>e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:`w-full h-2 rounded-full transition-all duration-500 ${n<a?"bg-indigo-500":n===a?"bg-indigo-400":"bg-slate-200"}`}),e.jsx("p",{className:`text-xs font-medium mt-1.5 ${n<=a?"text-indigo-600":"text-slate-400"}`,children:s})]},n))}),a===0&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-sky-50 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Vos coordonnées"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Pour vous recontacter"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom *"}),e.jsx("input",{value:t.nom,onChange:s=>r("nom",s.target.value),className:`input ${c.nom?"border-red-300":""}`,placeholder:"Dupont"}),e.jsx(d,{field:"nom"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prénom"}),e.jsx("input",{value:t.prenom,onChange:s=>r("prenom",s.target.value),className:"input",placeholder:"Jean"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Téléphone *"}),e.jsx("input",{type:"tel",value:t.telephone,onChange:s=>r("telephone",s.target.value),className:`input ${c.telephone?"border-red-300":""}`,placeholder:"06 XX XX XX XX"}),e.jsx(d,{field:"telephone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>r("email",s.target.value),className:`input ${c.email?"border-red-300":""}`,placeholder:"pour recevoir les notifications"}),e.jsx(d,{field:"email"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Recommandé pour recevoir les mises à jour de votre réparation"})]})]}),a===1&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-50 flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Votre appareil"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Type, marque et modèle"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Catégorie *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:A.filter(s=>s!=="Commande").map(s=>e.jsx("button",{onClick:()=>r("categorie",s),className:`p-3 rounded-xl text-sm font-medium border-2 transition-all text-left
                      ${t.categorie===s?"border-brand-500 bg-brand-50 text-brand-700":"border-slate-200 hover:border-slate-300 text-slate-700"}`,children:s},s))}),e.jsx(d,{field:"categorie"})]}),t.categorie&&e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Marque *"}),e.jsxs("select",{value:t.marque,onChange:s=>r("marque",s.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Sélectionner..."}),_.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"Autre",children:"Autre"})]}),e.jsx(d,{field:"marque"})]}),t.marque&&t.marque!=="Autre"&&e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Modèle"}),e.jsx("input",{type:"text",list:"modeles-list",value:t.modele,onChange:s=>r("modele",s.target.value),className:"input",placeholder:`Ex: ${t.marque==="Apple"?"iPhone 14 Pro":t.marque==="Samsung"?"Galaxy S24":"Tapez le modèle..."}`,autoComplete:"off"}),e.jsx("datalist",{id:"modeles-list",children:P.filter(s=>s!=="Autre").map(s=>e.jsx("option",{value:s},s))}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Tapez pour chercher ou saisissez librement"})]}),t.marque==="Autre"&&e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Préciser marque / modèle *"}),e.jsx("input",{value:t.modele_autre,onChange:s=>r("modele_autre",s.target.value),className:`input ${c.modele_autre?"border-red-300":""}`,placeholder:"Ex: Samsung Galaxy S24"}),e.jsx(d,{field:"modele_autre"})]})]}),a===2&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Le problème"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Décrivez la panne"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Type de panne *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:E.map(s=>e.jsx("button",{onClick:()=>r("panne",s),className:`p-3 rounded-xl text-sm font-medium border-2 transition-all text-left
                      ${t.panne===s?"border-brand-500 bg-brand-50 text-brand-700":"border-slate-200 hover:border-slate-300 text-slate-700"}`,children:s},s))}),e.jsx(d,{field:"panne"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Détails"}),e.jsx("textarea",{value:t.panne_detail,onChange:s=>r("panne_detail",s.target.value),className:"input min-h-[80px] resize-none",placeholder:"Décrivez plus précisément le problème..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Notes"}),e.jsx("textarea",{value:t.notes_client,onChange:s=>r("notes_client",s.target.value),className:"input min-h-[60px] resize-none",placeholder:"Informations complémentaires (accessoires, état cosmétique...)"})]}),c.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700",children:c.submit})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs("button",{onClick:()=>a===0?i("/"):b(s=>s-1),className:"btn-secondary flex-1 py-3",children:[e.jsx(C,{className:"w-4 h-4"})," ",a===0?"Accueil":"Retour"]}),e.jsx("button",{onClick:V,disabled:v||!T(),className:`flex-[2] py-3 ${a===2?"btn-primary bg-emerald-600 hover:bg-emerald-700":"btn-primary"}`,children:v?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Envoi..."]}):a===2?e.jsxs(e.Fragment,{children:["Envoyer ma demande ",e.jsx(g,{className:"w-4 h-4"})]}):e.jsxs(e.Fragment,{children:["Suivant ",e.jsx(Q,{className:"w-4 h-4"})]})})]}),e.jsxs("div",{className:"mt-8 card p-4 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx(q,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:"79 Place Saint Léger, Chambéry"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500 mt-1.5",children:[e.jsx(S,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:"04 79 60 89 22"})]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{style:{textAlign:"center",padding:"12px 0",fontSize:10,color:"#A1A1AA"},children:["Propulsé par"," ",e.jsxs("span",{style:{fontWeight:800,fontSize:11},children:[e.jsx("span",{style:{color:"#7C3AED"},children:"Tk"}),e.jsx("span",{style:{color:"#18181B"},children:"S"}),e.jsx("span",{style:{color:"#EC4899"},children:"∞"}),e.jsx("span",{style:{color:"#18181B"},children:"26"})]})," ","— une solution"," ",e.jsx("span",{style:{fontWeight:700,color:"#7C3AED"},children:"Klik&Dev"})]})})]})})}export{le as default};
