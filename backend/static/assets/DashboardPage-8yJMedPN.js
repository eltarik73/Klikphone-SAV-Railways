import{u as _e,a as W,p as G,j as t,S as te,g as D,f as Ce,w as ye,s as Se,b as $e,c,i as Pe}from"./index-CmrG9pj-.js";import{u as Te,r as n}from"./vendor-react-DWtYaMjq.js";import{c as se,S as ae,W as Ae,m as Me,P as z,R as Re,N as Ee,O as B,G as le,C as De,X as ze,Q as ne,Y as ie,_ as Be,L as Ie,$ as qe,z as Ke,o as Le,s as Ve,a0 as Fe,a1 as Oe}from"./vendor-icons-BZCI2oc_.js";function Ye(){const m=Te(),{user:i}=_e(),h=(i==null?void 0:i.target)==="tech"?"/tech":"/accueil",[I,re]=n.useState(""),[k,ce]=n.useState(""),[g,T]=n.useState(""),[H,A]=n.useState(null),[q,f]=n.useState(!1),[u,_]=n.useState(new Set),[Ue,We]=n.useState(""),[J,K]=n.useState(!1),[C,oe]=n.useState(""),[p,de]=n.useState(()=>parseInt(localStorage.getItem("kp_page_size")||"50")),[x,b]=n.useState(0),M=n.useRef(null);n.useEffect(()=>(M.current&&clearTimeout(M.current),M.current=setTimeout(()=>ce(I),300),()=>clearTimeout(M.current)),[I]);const me=n.useMemo(()=>{const e=["dashboard"];return k&&e.push(`s:${k}`),g&&e.push(`f:${g}`),e.join(":")},[k,g]),{data:j,loading:L,isRevalidating:xe,mutate:y}=W(me,async()=>{const e={limit:200};k&&(e.search=k),g&&(e.statut=g);const[a,l]=await Promise.all([c.getKPI(),c.getTickets(e)]);return{kpi:a,tickets:l}},{tags:["dashboard","tickets"],ttl:3e4}),o=(j==null?void 0:j.kpi)??null,S=(j==null?void 0:j.tickets)??[],{data:he}=W("team:active",()=>c.getActiveTeam(),{tags:["team"],ttl:3e5}),$=he??[],Y=n.useMemo(()=>{const e={};return $.forEach(a=>{a.couleur&&(e[a.nom]=a.couleur)}),e},[$]);n.useEffect(()=>{G("clients:p:0:20",()=>c.getClients({limit:20,offset:0}),{tags:["clients"],ttl:6e4}),G("tarifs",()=>Promise.all([c.getTarifs(),c.getTarifsStats(),c.getAppleDevices()]).then(([e,a,l])=>({tarifs:e,stats:a,appleDevices:l})),{tags:["tarifs"],ttl:3e5}),G("config:main",()=>Promise.all([c.getConfig(),c.getActiveTeam()]).then(([e,a])=>({config:e,team:a})),{tags:["config","team"],ttl:3e5})},[]);const Q=n.useRef(y);Q.current=y,n.useEffect(()=>{const e=setInterval(()=>Q.current(),3e4);return()=>clearInterval(e)},[]);const ue=e=>{_(a=>{const l=new Set(a);return l.has(e)?l.delete(e):l.add(e),l})},pe=()=>{u.size===v.length?_(new Set):_(new Set(v.map(e=>e.id)))},ge=async e=>{if(u.size!==0)try{await Promise.all([...u].map(a=>c.changeStatus(a,e))),_(new Set),K(!1),Pe("tickets","dashboard")}catch(a){console.error(a)}},fe=async(e,a)=>{try{await c.changeStatus(e,a),y(l=>l&&{...l,tickets:l.tickets.map(s=>s.id===e?{...s,statut:a}:s)})}catch(l){console.error(l)}},be=async(e,a)=>{try{await c.updateTicket(e,{technicien_assigne:a||null}),y(l=>l&&{...l,tickets:l.tickets.map(s=>s.id===e?{...s,technicien_assigne:a||null}:s)})}catch(l){console.error(l)}},je=(e,a)=>{H===a?(A(null),T(""),f(!1)):(A(a),e&&(T(e),f(!1)))},X=(i==null?void 0:i.target)==="tech",R=i==null?void 0:i.utilisateur,V=(e,a)=>{if(!e||!a)return!1;const l=e.trim(),s=a.trim();return l===s||l.startsWith(s+" ")},F=e=>{if(!e)return null;const a=Y[e];if(a)return a;for(const[l,s]of Object.entries(Y))if(V(e,l))return s;return null},E=n.useMemo(()=>C==="__mine__"&&R?S.filter(e=>V(e.technicien_assigne,R)||!e.technicien_assigne):C?S.filter(e=>V(e.technicien_assigne,C)):S,[S,C,R]),Z=n.useMemo(()=>E.filter(e=>!["Clôturé","Rendu au client"].includes(e.statut)),[E]),ee=n.useMemo(()=>E.filter(e=>["Clôturé","Rendu au client"].includes(e.statut)),[E]),P=q?ee:Z,O=Math.ceil(P.length/p),v=P.slice(x*p,(x+1)*p),ve=e=>{de(e),b(0),localStorage.setItem("kp_page_size",e.toString())},{data:U}=W("commandes:en_cours:count",async()=>{const e=await c.getParts({statut:"en_cours"});return(e==null?void 0:e.length)??0},{tags:["commandes"],ttl:6e4}),Ne=o?[{label:"Total actifs",value:o.total_actifs,icon:se,color:"text-brand-600",iconBg:"bg-brand-100"},{label:"Diagnostic",value:o.en_attente_diagnostic,icon:ae,color:"text-amber-600",iconBg:"bg-amber-100",filter:"En attente de diagnostic"},{label:"Réparation",value:o.en_cours,icon:Ae,color:"text-blue-600",iconBg:"bg-blue-100",filter:"En cours de réparation"},{label:"Accord client",value:o.en_attente_accord,icon:Me,color:"text-orange-600",iconBg:"bg-orange-100",filter:"En attente d'accord client"},{label:"Pièces",value:o.en_attente_piece,icon:z,color:"text-violet-600",iconBg:"bg-violet-100",filter:"En attente de pièce"}]:[],we=e=>{if(!e)return{text:"Non définie",color:"text-slate-400",urgent:!1};const a=new Date;let l;if(e.includes("-")&&e.length>=10)l=new Date(e);else{const w=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(w)l=new Date(`${w[3]}-${w[2].padStart(2,"0")}-${w[1].padStart(2,"0")}`);else return{text:e,color:"text-slate-500",urgent:!1}}if(isNaN(l.getTime()))return{text:e,color:"text-slate-500",urgent:!1};const s=l-a,d=Math.round(s/36e5),r=Math.floor(Math.abs(d)/24),N=Math.abs(d)%24;return s>0?{text:r>0?`dans ${r}j ${N}h`:`dans ${Math.abs(d)}h`,color:"text-emerald-600",urgent:!1}:{text:r>0?`DÉPASSÉ ${r}j ${N}h`:`DÉPASSÉ ${Math.abs(d)}h`,color:"text-red-600 font-bold",urgent:!0}},ke=[{label:"Tous",value:""},{label:"Pré-enregistré",value:"Pré-enregistré"},{label:"Diagnostic",value:"En attente de diagnostic"},{label:"Réparation",value:"En cours de réparation"},{label:"Accord",value:"En attente d'accord client"},{label:"Pièces",value:"En attente de pièce"},{label:"Pièce reçue",value:"Pièce reçue"},{label:"Terminés",value:"Réparation terminée"},{label:"Rendus",value:"Rendu au client"},{label:"Clôturés",value:"Clôturé"}];return t.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("img",{src:"/logo_k.png",alt:"",className:"w-8 h-8 rounded-lg object-contain shadow-sm hidden sm:block"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight",children:(i==null?void 0:i.target)==="tech"?"Espace Technicien":"Tableau de bord"}),t.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:(i==null?void 0:i.target)==="tech"?`Bienvenue ${(i==null?void 0:i.utilisateur)||""} — vos réparations`:"Vue d'ensemble des réparations"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>y(),className:"btn-ghost p-2.5",title:"Rafraîchir",children:t.jsx(Re,{className:`w-4 h-4 ${L||xe?"animate-spin":""}`})}),t.jsxs("button",{onClick:()=>m("/client"),className:"btn-primary",children:[t.jsx(Ee,{className:"w-4 h-4"})," Nouveau ticket"]})]})]}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 mb-6",children:!o&&L?Array.from({length:5}).map((e,a)=>t.jsxs("div",{className:"card p-4 animate-pulse",children:[t.jsx("div",{className:"w-9 h-9 rounded-lg bg-slate-100 mb-3"}),t.jsx("div",{className:"h-7 w-12 bg-slate-100 rounded mb-1"}),t.jsx("div",{className:"h-3 w-20 bg-slate-100 rounded"})]},a)):Ne.map(({label:e,value:a,icon:l,color:s,iconBg:d,filter:r},N)=>t.jsxs("button",{onClick:()=>je(r,N),className:`card p-4 hover:shadow-md hover:-translate-y-0.5 transition-all duration-200 animate-in text-left
              ${H===N?"ring-2 ring-brand-500 shadow-lg shadow-brand-500/10":""}`,style:{animationDelay:`${N*50}ms`},children:[t.jsx("div",{className:`w-9 h-9 rounded-lg ${d} flex items-center justify-center mb-3`,children:t.jsx(l,{className:`w-4 h-4 ${s}`})}),t.jsx("p",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:a}),t.jsx("p",{className:"text-[11px] text-slate-500 font-medium mt-0.5 leading-tight",children:e})]},e))}),U>0&&t.jsxs("button",{onClick:()=>m(`${h}/commandes`),className:"card px-4 py-3 mb-6 flex items-center gap-3 hover:shadow-md transition-all group w-full text-left",children:[t.jsx("div",{className:"w-9 h-9 rounded-lg bg-amber-100 flex items-center justify-center shrink-0",children:t.jsx(z,{className:"w-4 h-4 text-amber-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-sm font-semibold text-slate-800",children:[U," commande",U>1?"s":""," de pièces en cours"]}),t.jsx("p",{className:"text-xs text-slate-400",children:"Cliquez pour voir le détail"})]}),t.jsx(B,{className:"w-4 h-4 text-slate-300 group-hover:text-brand-500 transition-colors"})]}),(o==null?void 0:o.pre_enregistres)>0&&t.jsxs("button",{onClick:()=>{T("Pré-enregistré"),A(null),f(!1)},className:"card px-4 py-3 mb-6 flex items-center gap-3 hover:shadow-md transition-all group w-full text-left bg-indigo-50 border border-indigo-200",children:[t.jsx("div",{className:"w-9 h-9 rounded-lg bg-indigo-100 flex items-center justify-center shrink-0",children:t.jsx(le,{className:"w-4 h-4 text-indigo-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-sm font-semibold text-indigo-800",children:[o.pre_enregistres," dépôt",o.pre_enregistres>1?"s":""," à distance en attente de validation"]}),t.jsx("p",{className:"text-xs text-indigo-500",children:"Cliquez pour voir et valider"})]}),t.jsx(B,{className:"w-4 h-4 text-indigo-300 group-hover:text-indigo-500 transition-colors"})]}),t.jsxs("div",{className:"card overflow-hidden mb-6",children:[t.jsx("div",{className:"p-3 sm:p-4 border-b border-slate-100",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ae,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),t.jsx("input",{type:"text",placeholder:"Rechercher par nom, téléphone, code, marque, modèle...",value:I,onChange:e=>{re(e.target.value),b(0)},className:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 bg-slate-50/50 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 focus:bg-white transition-all"})]}),$.length>0&&t.jsxs("select",{value:C,onChange:e=>{oe(e.target.value),b(0)},className:"px-3 py-2.5 rounded-lg border border-slate-200 bg-slate-50/50 text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 min-w-[140px]",children:[t.jsx("option",{value:"",children:"Tous les techs"}),X&&R&&t.jsx("option",{value:"__mine__",children:"Mes tickets"}),$.map(e=>t.jsx("option",{value:e.nom,children:e.nom},e.id))]})]})}),t.jsx("div",{className:"px-3 sm:px-4 py-2 flex gap-1 overflow-x-auto scrollbar-none bg-slate-50/50",children:ke.map(({label:e,value:a})=>t.jsx("button",{onClick:()=>{T(a),A(null),f(["Rendu au client","Clôturé"].includes(a))},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap transition-all
                ${g===a?"bg-brand-600 text-white shadow-sm shadow-brand-600/25":"text-slate-500 hover:bg-white hover:text-slate-700 hover:shadow-sm"}`,children:e},a))})]}),t.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[t.jsxs("button",{onClick:()=>f(!1),className:`text-sm font-medium ${q?"text-slate-400 hover:text-slate-600":"text-brand-600"}`,children:[Z.length," actif(s)"]}),t.jsxs("button",{onClick:()=>f(!0),className:`text-sm font-medium ${q?"text-brand-600":"text-slate-400 hover:text-slate-600"}`,children:["Voir ",ee.length," archivé(s)"]})]}),u.size>0&&t.jsxs("div",{className:"flex items-center gap-3 mb-3 px-4 py-2.5 bg-brand-50 border border-brand-200 rounded-xl animate-in",children:[t.jsxs("span",{className:"text-sm font-semibold text-brand-700",children:[u.size," sélectionné(s)"]}),t.jsxs("div",{className:"relative ml-auto",children:[t.jsxs("button",{onClick:()=>K(!J),className:"btn-primary text-xs px-3 py-1.5",children:["Changer statut ",t.jsx(De,{className:"w-3.5 h-3.5"})]}),J&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>K(!1)}),t.jsx("div",{className:"absolute right-0 top-full mt-1 w-64 card p-1.5 shadow-xl z-50 animate-in",children:te.map(e=>t.jsx("button",{onClick:()=>ge(e),className:"w-full text-left px-3 py-2 rounded-lg text-sm hover:bg-slate-50 text-slate-700 transition-colors",children:e},e))})]})]}),t.jsx("button",{onClick:()=>_(new Set),className:"btn-ghost p-1.5",children:t.jsx(ze,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"card overflow-hidden",children:[t.jsxs("div",{className:"hidden lg:grid grid-cols-[28px_72px_minmax(120px,1fr)_120px_minmax(100px,1fr)_90px_150px_68px_72px_80px_28px] gap-2 items-center px-5 py-3 bg-slate-50/80 border-b border-slate-100",children:[t.jsx("button",{onClick:pe,className:"flex items-center justify-center",children:u.size===v.length&&v.length>0?t.jsx(ne,{className:"w-4 h-4 text-brand-600"}):t.jsx(ie,{className:"w-4 h-4 text-slate-300"})}),t.jsx("span",{className:"table-header",children:"Ticket"}),t.jsx("span",{className:"table-header",children:"Client"}),t.jsx("span",{className:"table-header",children:"Appareil"}),t.jsx("span",{className:"table-header",children:"Panne"}),t.jsx("span",{className:"table-header",children:"Tech"}),t.jsx("span",{className:"table-header",children:"Statut"}),t.jsx("span",{className:"table-header",children:"Date"}),t.jsx("span",{className:"table-header",children:"Contact"}),t.jsx("span",{className:"table-header text-right",children:"Prix"}),t.jsx("span",{})]}),L&&S.length===0?t.jsx("div",{className:"divide-y divide-slate-100/80",children:Array.from({length:8}).map((e,a)=>t.jsxs("div",{className:"px-5 py-3.5 animate-pulse flex items-center gap-3",children:[t.jsx("div",{className:"w-7 h-7 rounded-full bg-slate-100 shrink-0"}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx("div",{className:"h-4 w-32 bg-slate-100 rounded"}),t.jsx("div",{className:"h-3 w-48 bg-slate-100 rounded"})]}),t.jsx("div",{className:"hidden lg:block h-6 w-20 bg-slate-100 rounded-lg"}),t.jsx("div",{className:"hidden lg:block h-6 w-28 bg-slate-100 rounded-lg"})]},a))}):v.length===0?t.jsxs("div",{className:"py-16 text-center",children:[t.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-4",children:t.jsx(se,{className:"w-7 h-7 text-slate-300"})}),t.jsx("p",{className:"text-slate-500 font-medium",children:"Aucun ticket trouvé"}),t.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Modifiez vos filtres ou créez un nouveau ticket"})]}):t.jsx("div",{className:"divide-y divide-slate-100/80",children:v.map(e=>{var a,l;return t.jsxs("div",{className:"lg:grid lg:grid-cols-[28px_72px_minmax(120px,1fr)_120px_minmax(100px,1fr)_90px_150px_68px_72px_80px_28px] gap-2 items-center px-4 sm:px-5 py-3 hover:bg-brand-50/40 transition-colors group",children:[t.jsx("div",{className:"hidden lg:flex items-center justify-center",children:t.jsx("button",{onClick:()=>ue(e.id),children:u.has(e.id)?t.jsx(ne,{className:"w-4 h-4 text-brand-600"}):t.jsx(ie,{className:"w-4 h-4 text-slate-300 group-hover:text-slate-400"})})}),t.jsx("div",{className:"cursor-pointer",onClick:()=>m(`${h}/ticket/${e.id}`),children:t.jsxs("div",{className:"flex items-center gap-1",children:[e.attention&&t.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 shrink-0",title:"Attention"}),t.jsx("p",{className:"text-xs font-bold text-brand-600 font-mono",children:e.ticket_code}),e.est_retour_sav&&t.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-red-100 text-red-600 text-[9px] font-bold flex items-center gap-0.5",title:"Retour SAV",children:[t.jsx(Be,{className:"w-2.5 h-2.5"})," SAV"]}),e.source==="distance"&&t.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-indigo-100 text-indigo-600 text-[9px] font-bold flex items-center gap-0.5",title:"Dépôt à distance",children:[t.jsx(le,{className:"w-2.5 h-2.5"})," Dist."]})]})}),t.jsx("div",{className:"min-w-0 mt-1 lg:mt-0 cursor-pointer",onClick:()=>m(`${h}/ticket/${e.id}`),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-7 h-7 rounded-full bg-brand-100 flex items-center justify-center shrink-0",children:t.jsxs("span",{className:"text-brand-700 font-bold text-[10px]",children:[(((a=e.client_prenom)==null?void 0:a[0])||"").toUpperCase(),(((l=e.client_nom)==null?void 0:l[0])||"").toUpperCase()]})}),t.jsxs("div",{className:"min-w-0",children:[t.jsxs("p",{className:"text-sm font-semibold text-slate-800 truncate",title:`${e.client_prenom||""} ${e.client_nom||""}`.trim(),children:[e.client_prenom||""," ",e.client_nom||""]}),t.jsx("p",{className:"text-[11px] text-slate-400 font-mono truncate",title:e.client_tel||"",children:e.client_tel||""})]})]})}),t.jsxs("div",{className:"hidden lg:block cursor-pointer",onClick:()=>m(`${h}/ticket/${e.id}`),children:[t.jsxs("p",{className:"text-xs text-slate-700 font-medium truncate",title:`${e.marque||""} ${e.modele||e.modele_autre||""}`.trim(),children:[e.marque," ",e.modele||e.modele_autre]}),X&&(e.pin||e.pattern)&&t.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.pin&&t.jsxs("span",{className:"text-[10px] font-mono text-amber-600 flex items-center gap-0.5",children:[t.jsx(Ie,{className:"w-2.5 h-2.5"})," ",e.pin]}),e.pattern&&t.jsxs("span",{className:"text-[10px] font-mono text-violet-600 flex items-center gap-0.5",children:[t.jsx(qe,{className:"w-2.5 h-2.5"})," ",e.pattern]})]})]}),t.jsx("div",{className:"hidden lg:block cursor-pointer",onClick:()=>m(`${h}/ticket/${e.id}`),children:e.commande_piece===1&&!e.panne&&(()=>{let s=[];try{const d=JSON.parse(e.reparation_supp||"[]");Array.isArray(d)&&(s=d.filter(r=>r.label).map(r=>r.label))}catch{}return s.length===0})()?t.jsxs("p",{className:"text-xs text-amber-600 font-medium truncate flex items-center gap-1",children:[t.jsx(z,{className:"w-3 h-3 shrink-0"})," Pièce à commander"]}):(()=>{let s=[];try{const d=JSON.parse(e.reparation_supp||"[]");Array.isArray(d)&&(s=d.filter(r=>r.label).map(r=>r.label))}catch{}return s.length===0&&e.panne&&(s=[e.panne]),t.jsxs("p",{className:"text-xs text-slate-600 truncate flex items-center gap-1",title:s.join(" + "),children:[e.commande_piece===1&&t.jsx(z,{className:"w-3 h-3 shrink-0 text-amber-500"}),t.jsx("span",{className:"truncate",children:s.join(" + ")||"—"})]})})()}),t.jsx("div",{className:"hidden lg:block",onClick:s=>s.stopPropagation(),children:t.jsxs("select",{value:e.technicien_assigne||"",onChange:s=>be(e.id,s.target.value),className:"w-full py-1.5 px-2 text-[11px] font-medium rounded-lg border cursor-pointer appearance-none bg-no-repeat truncate transition-colors",style:{borderColor:e.technicien_assigne?F(e.technicien_assigne)||"#94a3b8":"#e2e8f0",color:e.technicien_assigne?"#334155":"#94a3b8",backgroundColor:e.technicien_assigne&&F(e.technicien_assigne)?F(e.technicien_assigne)+"15":"#f8fafc",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E")`,backgroundPosition:"right 4px center",backgroundSize:"12px",paddingRight:"20px"},children:[t.jsx("option",{value:"",children:"— Aucun"}),$.map(s=>t.jsx("option",{value:s.nom,children:s.nom},s.id))]})}),t.jsx("div",{className:"mt-2 lg:mt-0",onClick:s=>s.stopPropagation(),children:t.jsx("select",{value:e.statut,onChange:s=>fe(e.id,s.target.value),className:"w-full py-1.5 px-2 text-[11px] font-semibold rounded-lg border-2 cursor-pointer appearance-none bg-no-repeat truncate",style:{borderColor:D(e.statut).color,color:D(e.statut).color,backgroundColor:D(e.statut).color+"10",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='${encodeURIComponent(D(e.statut).color)}' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E")`,backgroundPosition:"right 4px center",backgroundSize:"14px",paddingRight:"22px"},children:te.map(s=>t.jsx("option",{value:s,children:s},s))})}),t.jsxs("div",{className:"hidden lg:block cursor-pointer",onClick:()=>m(`${h}/ticket/${e.id}`),children:[t.jsx("p",{className:"text-[11px] text-slate-500",children:Ce(e.date_depot)}),e.date_recuperation&&(()=>{const s=we(e.date_recuperation);return t.jsxs("p",{className:`text-[10px] flex items-center gap-0.5 mt-0.5 ${s.color}`,children:[t.jsx(Ke,{className:"w-2.5 h-2.5"})," ",s.text]})})()]}),t.jsxs("div",{className:"flex items-center gap-1 mt-2 lg:mt-0",children:[t.jsx("a",{href:e.client_tel?ye(e.client_tel,`Bonjour, concernant votre ticket ${e.ticket_code}...`):"#",target:"_blank",rel:"noopener noreferrer",onClick:s=>{e.client_tel||s.preventDefault(),s.stopPropagation()},className:"p-1.5 rounded-md hover:bg-green-50 transition-colors",title:"WhatsApp",children:t.jsx(Le,{className:`w-3.5 h-3.5 ${e.msg_whatsapp?"text-green-500":"text-slate-300"}`})}),t.jsx("a",{href:e.client_tel?Se(e.client_tel,`Klikphone: Votre ticket ${e.ticket_code}...`):"#",onClick:s=>{e.client_tel||s.preventDefault(),s.stopPropagation()},className:"p-1.5 rounded-md hover:bg-blue-50 transition-colors",title:"SMS",children:t.jsx(Ve,{className:`w-3.5 h-3.5 ${e.msg_sms?"text-blue-500":"text-slate-300"}`})}),t.jsx("a",{href:e.client_email?`mailto:${e.client_email}`:"#",onClick:s=>{e.client_email||s.preventDefault(),s.stopPropagation()},className:"p-1.5 rounded-md hover:bg-amber-50 transition-colors",title:"Email",children:t.jsx(Fe,{className:`w-3.5 h-3.5 ${e.msg_email?"text-amber-500":"text-slate-300"}`})})]}),t.jsx("div",{className:"hidden lg:block text-right cursor-pointer",onClick:()=>m(`${h}/ticket/${e.id}`),children:e.devis_estime||e.tarif_final?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:`text-xs font-semibold ${e.paye?"text-emerald-600":"text-slate-800"}`,children:$e(e.tarif_final||e.devis_estime)}),e.paye?t.jsx("span",{className:"inline-block mt-0.5 px-1.5 py-0.5 rounded text-[9px] font-bold bg-emerald-100 text-emerald-700",children:"PAYÉ"}):null]}):t.jsx("p",{className:"text-xs text-slate-300",children:"—"})}),t.jsx("div",{className:"hidden lg:flex justify-end cursor-pointer",onClick:()=>m(`${h}/ticket/${e.id}`),children:t.jsx(B,{className:"w-4 h-4 text-slate-300 group-hover:text-brand-500 transition-colors"})})]},e.id)})}),P.length>p&&t.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-t border-slate-100 bg-slate-50/50",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-xs text-slate-500",children:[x*p+1,"–",Math.min((x+1)*p,P.length)," sur ",P.length]}),t.jsx("select",{value:p,onChange:e=>ve(Number(e.target.value)),className:"text-xs border border-slate-200 rounded-md px-2 py-1 bg-white text-slate-600",children:[10,25,50,100].map(e=>t.jsxs("option",{value:e,children:[e," / page"]},e))})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>b(e=>Math.max(0,e-1)),disabled:x===0,className:"p-1.5 rounded-md hover:bg-slate-100 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:t.jsx(Oe,{className:"w-4 h-4 text-slate-600"})}),Array.from({length:O},(e,a)=>t.jsx("button",{onClick:()=>b(a),className:`w-7 h-7 rounded-md text-xs font-medium transition-colors ${a===x?"bg-brand-600 text-white":"text-slate-500 hover:bg-slate-100"}`,children:a+1},a)).slice(Math.max(0,x-2),x+3),t.jsx("button",{onClick:()=>b(e=>Math.min(O-1,e+1)),disabled:x>=O-1,className:"p-1.5 rounded-md hover:bg-slate-100 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:t.jsx(B,{className:"w-4 h-4 text-slate-600"})})]})]})]})]})}export{Ye as default};
