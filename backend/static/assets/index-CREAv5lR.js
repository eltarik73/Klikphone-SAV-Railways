const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardPage-Ydy-KngY.js","assets/vendor-react-DWtYaMjq.js","assets/vendor-icons-BFVyu274.js","assets/TicketDetailPage-DAE3p5vd.js","assets/PatternGrid-Cv_ZFI8s.js","assets/vendor-charts-O0jNFQnY.js","assets/ClientFormPage-CKvoECM7.js","assets/ClientsPage-C2T15Eao.js","assets/CommandesPage-BJ-jr3Rz.js","assets/AttestationPage-DsMnO47a.js","assets/ConfigPage-C8MUSG_y.js","assets/AdminPage-DgikvVlC.js","assets/TarifsPage-B6cCljOy.js","assets/DepotPage-yNCgMgQt.js","assets/AvisGoogle-2rGRKpSu.js","assets/CommunityManager-BD5dyIeE.js","assets/TarifsTelephonesPage-BcXJKxTs.js","assets/DevisPage-DBL57R9q.js","assets/DevisFlashPage-ClP0_q1O.js","assets/TelephonesVentePage-BLKtR0M2.js","assets/DeposerPage-B3td3egM.js"])))=>i.map(i=>d[i]);
var wt=Object.defineProperty;var kt=(n,t,s)=>t in n?wt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var ce=(n,t,s)=>kt(n,typeof t!="symbol"?t+"":t,s);import{r,a as St,u as H,b as rt,c as Ct,d as it,B as _t,e as $t,f as E,N as xe,h as Et}from"./vendor-react-DWtYaMjq.js";import{L as Z,E as Rt,a as Pt,M as Tt,X as je,b as At,U as lt,P as ie,F as J,S as te,C as de,Z as It,T as Ae,W as se,c as he,d as Dt,e as Ut,f as Lt,g as ve,h as Ft,i as Ot,j as qt,k as Ie,R as ee,l as De,m as pe,A as Q,I as ot,n as Ne,o as Ue,B as ge,p as Mt,q as Bt,r as B,s as ye,V as ct,t as dt,u as ue,G as ae,v as zt,w as we,x as ke,y as ut,H as Vt,z as Kt,D as Gt,J as Wt,K as Jt}from"./vendor-icons-BFVyu274.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const i of d.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(l){if(l.ep)return;l.ep=!0;const d=s(l);fetch(l.href,d)}})();var mt={exports:{}},le={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ht=r,Qt=Symbol.for("react.element"),Xt=Symbol.for("react.fragment"),Yt=Object.prototype.hasOwnProperty,Zt=Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,es={key:!0,ref:!0,__self:!0,__source:!0};function xt(n,t,s){var a,l={},d=null,i=null;s!==void 0&&(d=""+s),t.key!==void 0&&(d=""+t.key),t.ref!==void 0&&(i=t.ref);for(a in t)Yt.call(t,a)&&!es.hasOwnProperty(a)&&(l[a]=t[a]);if(n&&n.defaultProps)for(a in t=n.defaultProps,t)l[a]===void 0&&(l[a]=t[a]);return{$$typeof:Qt,type:n,key:d,ref:i,props:l,_owner:Zt.current}}le.Fragment=Xt;le.jsx=xt;le.jsxs=xt;mt.exports=le;var e=mt.exports,fe={},Le=St;fe.createRoot=Le.createRoot,fe.hydrateRoot=Le.hydrateRoot;const ts="modulepreload",ss=function(n){return"/"+n},Fe={},D=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),m=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));l=Promise.allSettled(s.map(o=>{if(o=ss(o),o in Fe)return;Fe[o]=!0;const h=o.endsWith(".css"),j=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${j}`))return;const v=document.createElement("link");if(v.rel=h?"stylesheet":ts,h||(v.as="script"),v.crossOrigin="",v.href=o,m&&v.setAttribute("nonce",m),document.head.appendChild(v),h)return new Promise((f,k)=>{v.addEventListener("load",f),v.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${o}`)))})}))}function d(i){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=i,window.dispatchEvent(m),!m.defaultPrevented)throw i}return l.then(i=>{for(const m of i||[])m.status==="rejected"&&d(m.reason);return t().catch(d)})},W="",Oe=W.trim();class ns{constructor(){this.token=localStorage.getItem("kp_token")||null}setToken(t){this.token=t,t?localStorage.setItem("kp_token",t):localStorage.removeItem("kp_token")}async request(t,s={},a=1e4){const l=`${W}${t}`,d={"Content-Type":"application/json",...s.headers};this.token&&(d.Authorization=`Bearer ${this.token}`);const i=new AbortController,m=setTimeout(()=>i.abort(),a);let o;try{o=await fetch(l,{...s,headers:d,signal:i.signal})}catch(j){throw clearTimeout(m),j.name==="AbortError"?new Error("Connexion au serveur expirÃ©e (timeout)"):j}if(clearTimeout(m),o.status===401)throw this.setToken(null),window.location.href="/",new Error("Non authentifiÃ©");if(!o.ok){const j=await o.json().catch(()=>({}));throw new Error(j.detail||`Erreur ${o.status}`)}if(o.status===204)return null;if(!(o.headers.get("content-type")||"").includes("application/json"))throw new Error("Serveur indisponible (rÃ©ponse non-JSON)");return o.json()}get(t){return this.request(t)}post(t,s){return this.request(t,{method:"POST",body:JSON.stringify(s)})}patch(t,s){return this.request(t,{method:"PATCH",body:JSON.stringify(s)})}put(t,s){return this.request(t,{method:"PUT",body:JSON.stringify(s)})}delete(t){return this.request(t,{method:"DELETE"})}async login(t,s,a){const l=await this.post("/api/auth/login",{pin:t,target:s,utilisateur:a});return this.setToken(l.access_token),localStorage.setItem("kp_target",l.target),localStorage.setItem("kp_user",l.utilisateur),l}logout(){this.setToken(null),localStorage.removeItem("kp_target"),localStorage.removeItem("kp_user")}getTickets(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/tickets${s?"?"+s:""}`)}getTicket(t){return this.get(`/api/tickets/${t}`)}getTicketByCode(t){return this.get(`/api/tickets/code/${t}`)}getTicketsByPhone(t){return this.get(`/api/tickets/phone/${encodeURIComponent(t)}`)}createTicket(t){return this.post("/api/tickets",t)}createRetourSAV(t,s,a){return this.post("/api/tickets",{...a,client_id:s,est_retour_sav:!0,ticket_original_id:t})}updateTicket(t,s){return this.patch(`/api/tickets/${t}`,s)}changeStatus(t,s){return this.patch(`/api/tickets/${t}/statut`,{statut:s})}deleteTicket(t){return this.delete(`/api/tickets/${t}`)}getKPI(){return this.get("/api/tickets/stats/kpi")}addNote(t,s){return this.post(`/api/tickets/${t}/note?note=${encodeURIComponent(s)}`)}addHistory(t,s){return this.post(`/api/tickets/${t}/historique?texte=${encodeURIComponent(s)}`)}getHistorique(t){return this.get(`/api/tickets/${t}/historique`)}togglePaye(t){return this.patch(`/api/tickets/${t}/paye`,{})}getRepairQueue(t){const s=t?`?tech=${encodeURIComponent(t)}`:"";return this.get(`/api/tickets/queue/repair${s}`)}getClients(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/clients${s?"?"+s:""}`)}getClient(t){return this.get(`/api/clients/${t}`)}getClientByTel(t){return this.get(`/api/clients/tel/${encodeURIComponent(t)}`)}createOrGetClient(t){return this.post("/api/clients",t)}updateClient(t,s){return this.patch(`/api/clients/${t}`,s)}deleteClient(t){return this.delete(`/api/clients/${t}`)}getClientTickets(t){return this.get(`/api/clients/${t}/tickets`)}getCategories(){return this.get("/api/catalog/categories")}getPannes(){return this.get("/api/catalog/pannes")}getMarques(t){return this.get(`/api/catalog/marques?categorie=${encodeURIComponent(t)}`)}getModeles(t,s){return this.get(`/api/catalog/modeles?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}`)}getAllCatalog(){return this.get("/api/catalog/all")}addMarque(t,s){return this.post(`/api/catalog/marques?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}`)}addModele(t,s,a){return this.post(`/api/catalog/modeles?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}&modele=${encodeURIComponent(a)}`)}deleteMarque(t,s){return this.delete(`/api/catalog/marques?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}`)}deleteModele(t,s,a){return this.delete(`/api/catalog/modeles?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}&modele=${encodeURIComponent(a)}`)}searchAutocomplete(t,s,a=8){return this.get(`/api/autocomplete/search?categorie=${encodeURIComponent(t)}&q=${encodeURIComponent(s)}&limit=${a}`)}learnTerm(t,s){return this.post("/api/autocomplete/learn",{categorie:t,terme:s})}getTeam(){return this.get("/api/team")}getActiveTeam(){return this.get("/api/team/active")}createTeamMember(t,s){const a=s?`?admin_code=${encodeURIComponent(s)}`:"";return this.post(`/api/team${a}`,t)}updateTeamMember(t,s,a){const l=a?`?admin_code=${encodeURIComponent(a)}`:"";return this.patch(`/api/team/${t}${l}`,s)}deleteTeamMember(t){return this.delete(`/api/team/${t}`)}getParts(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/parts${s?"?"+s:""}`)}getPartsByTicket(t){return this.get(`/api/parts?ticket_id=${t}`)}getPublicCommandes(t){return this.get(`/api/parts/public/${encodeURIComponent(t)}`)}createPart(t){return this.post("/api/parts",t)}createPartAuto(t){return this.post("/api/parts/auto",t)}updatePart(t,s){return this.patch(`/api/parts/${t}`,s)}deletePart(t){return this.delete(`/api/parts/${t}`)}getConfig(){return this.get("/api/config")}getPublicConfig(){return this.get("/api/config/public")}setParam(t,s){return this.put("/api/config",{cle:t,valeur:s})}setParams(t){return this.put("/api/config/batch",t)}changePin(t,s,a){return this.post("/api/config/change-pin",{target:t,old_pin:s,new_pin:a})}testDiscord(){return this.post("/api/config/test-discord")}getBackup(){return this.get("/api/config/backup")}importBackup(t){return this.post("/api/config/backup/import",t)}async exportFile(t,s){const a=`${W}${t}`,l={};this.token&&(l.Authorization=`Bearer ${this.token}`);const d=await fetch(a,{headers:l});if(!d.ok)throw new Error(`Erreur ${d.status}`);const i=await d.blob(),m=URL.createObjectURL(i),o=document.createElement("a");o.href=m,o.download=s,o.click(),URL.revokeObjectURL(m)}exportClientsCsv(){return this.exportFile("/api/clients/export/csv","clients_klikphone.csv")}exportClientsExcel(){return this.exportFile("/api/clients/export/excel","clients_klikphone.xlsx")}getTemplates(){return this.get("/api/notifications/templates")}generateMessage(t,s){return this.post(`/api/notifications/generate-message?ticket_id=${t}&template_key=${s}`)}sendWhatsApp(t,s){return this.post(`/api/notifications/whatsapp?ticket_id=${t}&message=${encodeURIComponent(s)}`)}sendSMS(t,s){return this.post(`/api/notifications/sms?ticket_id=${t}&message=${encodeURIComponent(s)}`)}sendEmail(t,s,a){return this.request(`/api/notifications/email?ticket_id=${t}&message=${encodeURIComponent(s)}&sujet=${encodeURIComponent(a)}`,{method:"POST"},45e3)}getPrintUrl(t,s){return`${W}/api/tickets/${t}/print/${s}`}getPdfUrl(t,s){return`${W}/api/tickets/${t}/pdf/${s}`}getSharePrintUrl(t,s){return`${Oe}/api/tickets/${t}/print/${s}`}getSharePdfUrl(t,s){return`${Oe}/api/tickets/${t}/pdf/${s}`}sendToCaisse(t){return this.post(`/api/caisse/send?ticket_id=${t}`)}envoyerCaisse(t){return this.post("/api/caisse/envoyer",t)}getCaisseConfig(){return this.get("/api/config/caisse")}saveCaisseConfig(t){return this.put("/api/config/caisse",t)}testCaisseConnexion(){return this.post("/api/config/caisse/test")}envoyerEmail(t,s,a){return this.request("/api/email/envoyer",{method:"POST",body:JSON.stringify({to:t,subject:s,body:a})},45e3)}sendDocument(t,s,a){return this.request("/api/email/send-document",{method:"POST",body:JSON.stringify({ticket_id:t,doc_type:s,to:a})},45e3)}testSmtpEmail(t){return this.request("/api/email/test",{method:"POST",body:JSON.stringify({to:t})},45e3)}generateAttestation(t){return this.post("/api/attestation/generate",t)}emailAttestation(t,s){return this.post(`/api/attestation/email?destinataire=${encodeURIComponent(s)}`,t)}getFidelite(t){return this.get(`/api/fidelite/${t}`)}getFideliteByTicket(t){return this.get(`/api/fidelite/ticket/${t}`)}crediterPoints(t){return this.post("/api/fidelite/crediter",t)}utiliserPoints(t){return this.post("/api/fidelite/utiliser",t)}getGrattage(t){return this.get(`/api/fidelite/grattage/${t}`)}gratter(t){return this.post(`/api/fidelite/grattage/${t}`)}adminLogin(t,s){return this.post("/api/admin/login",{identifiant:t,password:s})}verifyAdmin(t,s){return this.post("/api/admin/verify",{login:t,password:s})}changeAdminPassword(t,s){return this.post("/api/admin/change-password",{old_password:t,new_password:s})}getAdminStats(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/stats${s?"?"+s:""}`)}getAdminReparations(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/reparations${s?"?"+s:""}`)}getAdminFluxClients(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/flux-clients${s?"?"+s:""}`)}getAdminPerformanceTech(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/performance-tech${s?"?"+s:""}`)}getAdminEvolution(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/evolution${s?"?"+s:""}`)}_adminQs(t={}){const s={};t.date_start&&(s.date_start=t.date_start),t.date_end&&(s.date_end=t.date_end);const a=new URLSearchParams(s).toString();return a?"?"+a:""}getAdminOverview(t){return this.get(`/api/admin/stats/overview${this._adminQs(t)}`)}getAdminReparationsParTech(t=7,s={}){const a=this._adminQs(s);return this.get(`/api/admin/stats/reparations-par-tech?days=${t}${a?"&"+a.slice(1):""}`)}getAdminAffluenceHeure(t){return this.get(`/api/admin/stats/affluence-heure${this._adminQs(t)}`)}getAdminAffluenceJour(t){return this.get(`/api/admin/stats/affluence-jour${this._adminQs(t)}`)}getAdminRepartitionMarques(t){return this.get(`/api/admin/stats/repartition-marques${this._adminQs(t)}`)}getAdminRepartitionPannes(t){return this.get(`/api/admin/stats/repartition-pannes${this._adminQs(t)}`)}getAdminEvolutionCA(t){return this.get(`/api/admin/stats/evolution-ca${this._adminQs(t)}`)}getAdminTempsReparation(t){return this.get(`/api/admin/stats/temps-reparation${this._adminQs(t)}`)}getAdminTauxConversion(t){return this.get(`/api/admin/stats/taux-conversion${this._adminQs(t)}`)}getAdminTopClients(t){return this.get(`/api/admin/stats/top-clients${this._adminQs(t)}`)}getReporting(t={}){const s=new URLSearchParams;t.debut&&s.set("debut",t.debut),t.fin&&s.set("fin",t.fin),t.granularite&&s.set("granularite",t.granularite);const a=s.toString();return this.get(`/api/reporting${a?"?"+a:""}`)}getMessageTemplates(){return this.get("/api/config/message-templates")}saveMessageTemplates(t){return this.put("/api/config/message-templates",{templates:t})}logMessage(t,s,a,l){return this.post(`/api/tickets/${t}/message-log?auteur=${encodeURIComponent(s)}&contenu=${encodeURIComponent(a)}&canal=${encodeURIComponent(l)}`)}getNotes(t){return this.get(`/api/tickets/${t}/notes`)}addPrivateNote(t,s,a,l=!1){return this.post(`/api/tickets/${t}/notes?auteur=${encodeURIComponent(s)}&contenu=${encodeURIComponent(a)}&important=${l}`)}deleteNote(t,s){return this.delete(`/api/tickets/${t}/notes/${s}`)}toggleNoteImportant(t,s,a){return this.patch(`/api/tickets/${t}/notes/${s}?important=${a}`,{})}chatAI(t,s,a,l){return this.post("/api/chat/ai",{message:t,user:s,conversation_id:a,role:l||""})}clearAIConversation(t){return this.delete(`/api/chat/ai/conversation/${t}`)}chatTeamSend(t,s,a="all"){return this.post("/api/chat/team/send",{message:t,sender:s,recipient:a})}chatTeamMessages(t,s="all",a=50){return this.get(`/api/chat/team/messages?user=${encodeURIComponent(t)}&channel=${s}&limit=${a}`)}chatTeamContacts(t){return this.get(`/api/chat/team/contacts?user=${encodeURIComponent(t)}`)}chatTeamConversation(t,s){return this.get(`/api/chat/team/conversation?user=${encodeURIComponent(t)}&with=${encodeURIComponent(s)}`)}chatTeamMarkRead(t,s){const a=s?`&contact=${encodeURIComponent(s)}`:"";return this.put(`/api/chat/team/read?user=${encodeURIComponent(t)}${a}`)}chatTeamUnread(t){return this.get(`/api/chat/team/unread?user=${encodeURIComponent(t)}`)}chatTeamUnreadTotal(t){return this.get(`/api/chat/team/unread/total?user=${encodeURIComponent(t)}`)}getTarifs(t={}){const s=new URLSearchParams;t.q&&s.set("q",t.q),t.marque&&s.set("marque",t.marque);const a=s.toString();return this.get(`/api/tarifs${a?"?"+a:""}`)}getTarifsStats(){return this.get("/api/tarifs/stats")}importTarifs(t){return this.request("/api/tarifs/import",{method:"POST",body:JSON.stringify({items:t})})}clearTarifs(){return this.request("/api/tarifs/clear",{method:"DELETE"})}toggleTarifStock(t){return this.request(`/api/tarifs/${t}/stock`,{method:"PATCH"})}checkTarifStock(){return this.request("/api/tarifs/check-stock",{method:"POST"},3e5)}getAppleDevices(){return this.get("/api/tarifs/apple-devices")}importAppleDevices(t){return this.request("/api/tarifs/apple-devices/import",{method:"POST",body:JSON.stringify({items:t})})}getAvisGoogle(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/marketing/avis${s?"?"+s:""}`)}getAvisGoogleStats(){return this.get("/api/marketing/avis/stats")}syncAvisGoogle(){return this.post("/api/marketing/avis/sync",{})}genererReponseAvis(t){return this.post(`/api/marketing/avis/${t}/generer-reponse`,{})}publierReponseAvis(t,s){return this.post(`/api/marketing/avis/${t}/publier-reponse`,s)}updateReponseAvis(t,s){return this.put(`/api/marketing/avis/${t}/reponse`,s)}getMarketingPosts(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/marketing/posts${s?"?"+s:""}`)}createMarketingPost(t){return this.post("/api/marketing/posts",t)}updateMarketingPost(t,s){return this.put(`/api/marketing/posts/${t}`,s)}deleteMarketingPost(t){return this.delete(`/api/marketing/posts/${t}`)}publierPost(t){return this.post(`/api/marketing/posts/${t}/publier`,{})}programmerPost(t,s){return this.post(`/api/marketing/posts/${t}/programmer`,s)}genererPost(t){return this.request("/api/marketing/posts/generer",{method:"POST",body:JSON.stringify(t)},6e4)}genererImage(t){return this.request("/api/marketing/posts/generer-image",{method:"POST",body:JSON.stringify(t)},18e4)}getCalendrierMarketing(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/marketing/calendrier${s?"?"+s:""}`)}createCalendrierEvent(t){return this.post("/api/marketing/calendrier",t)}updateCalendrierEvent(t,s){return this.put(`/api/marketing/calendrier/${t}`,s)}deleteCalendrierEvent(t){return this.delete(`/api/marketing/calendrier/${t}`)}getMarketingTemplates(){return this.get("/api/marketing/templates")}createMarketingTemplate(t){return this.post("/api/marketing/templates",t)}getMarketingAnalytics(){return this.get("/api/marketing/analytics/overview")}getMarketingAnalyticsPosts(){return this.get("/api/marketing/analytics/posts")}getDevis(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/devis${s?"?"+s:""}`)}getDevisById(t){return this.get(`/api/devis/${t}`)}createDevis(t){return this.post("/api/devis",t)}updateDevis(t,s){return this.patch(`/api/devis/${t}`,s)}deleteDevis(t){return this.delete(`/api/devis/${t}`)}convertDevisToTicket(t){return this.post(`/api/devis/${t}/convert`)}duplicateDevis(t){return this.post(`/api/devis/${t}/duplicate`)}getDevisStats(){return this.get("/api/devis/stats/overview")}getDevisPrintUrl(t){return`${W}/api/devis/${t}/print`}devisFlashSearch(t,s=20){return this.get(`/api/devis/flash/search?q=${encodeURIComponent(t)}&limit=${s}`)}getTelephonesVente(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/devis/telephones-vente${s?"?"+s:""}`)}getTelephonesVenteStats(){return this.get("/api/devis/telephones-vente/stats")}getTelephonesVenteMarques(){return this.get("/api/devis/telephones-vente/marques")}createTelephoneVente(t){return this.post("/api/devis/telephones-vente",t)}updateTelephoneVente(t,s){return this.patch(`/api/devis/telephones-vente/${t}`,s)}deleteTelephoneVente(t){return this.delete(`/api/devis/telephones-vente/${t}`)}createDepotDistance(t){return this.post("/api/depot-distance",t)}validerDepot(t){return this.put(`/api/depot-distance/${t}/valider`,{})}refuserDepot(t,s){return this.put(`/api/depot-distance/${t}/refuser`,{motif:s})}getPendingDepots(){return this.get("/api/depot-distance/pending")}getSuiviPublic(t){return this.get(`/api/depot-distance/suivi/${encodeURIComponent(t)}`)}getTelephonesCatalogue(t={}){const s=Object.fromEntries(Object.entries(t).filter(([,l])=>l!=null&&l!==""));s.page||(s.page=1),s.limit||(s.limit=24);const a=new URLSearchParams(s).toString();return this.get(`/api/telephones/catalogue${a?"?"+a:""}`)}getTelephoneStats(){return this.get("/api/telephones/stats")}getTelephoneMarques(){return this.get("/api/telephones/marques")}syncTelephones(){return this.request("/api/telephones/sync",{method:"POST"},3e4)}getSyncStatus(){return this.get("/api/telephones/sync-status")}}const C=new ns,M=new Map,be=new Set;function as(n){be.forEach(t=>t(n))}function Ws(...n){var t;if(n.length){for(const[,s]of M)(t=s.tags)!=null&&t.some(a=>n.includes(a))&&(s.stale=!0);as(n)}}function rs(){M.clear()}function Js(n,t,s={}){const{tags:a=[],ttl:l=6e4}=s,d=M.get(n);if(!(d&&!d.stale&&Date.now()-d.ts<d.ttl))try{t().then(i=>{M.set(n,{data:i,ts:Date.now(),tags:a,ttl:l,stale:!1})}).catch(()=>{})}catch{}}function Hs(n,t,s={}){var N;const{tags:a=[],ttl:l=6e4}=s,d=r.useRef(t);d.current=t;const i=r.useRef(a);i.current=a;const m=r.useRef(l);m.current=l;const o=r.useRef(n),h=r.useRef(null),[j,v]=r.useState(()=>{var R;const y=n?((R=M.get(n))==null?void 0:R.data)??null:null;return h.current=y,y}),[f,k]=r.useState(null),[b,p]=r.useState(()=>{var y;return!!n&&!((y=M.get(n))!=null&&y.data)}),[w,u]=r.useState(!1),[S,T]=r.useState(n);if(n!==S){T(n),o.current=n;const y=n?((N=M.get(n))==null?void 0:N.data)??null:null;h.current=y,v(y),k(null),p(!!n&&!y),u(!1)}const c=r.useCallback(async(y,R)=>{if(R){y?u(!0):p(!0);try{const g=await d.current();if(o.current!==R)return;M.set(R,{data:g,ts:Date.now(),tags:i.current,ttl:m.current,stale:!1}),h.current=g,v(g),k(null)}catch(g){if(o.current!==R)return;k(g)}finally{o.current===R&&(p(!1),u(!1))}}},[]);r.useEffect(()=>{if(!n)return;const y=M.get(n),R=(y==null?void 0:y.data)!=null;R&&!y.stale&&Date.now()-y.ts<y.ttl||c(R,n)},[n,c]),r.useEffect(()=>{if(!n)return;const y=R=>{o.current&&R.some(g=>i.current.includes(g))&&c(!0,o.current)};return be.add(y),()=>be.delete(y)},[n,c]);const x=r.useCallback(y=>{if(y===void 0)return c(!0,o.current);const R=typeof y=="function"?y(h.current):y,g=o.current;g&&M.set(g,{data:R,ts:Date.now(),tags:i.current,ttl:m.current,stale:!1}),h.current=R,v(R)},[c]);return{data:j,error:f,loading:b,isRevalidating:w,mutate:x}}const ht=r.createContext(null);function is({children:n}){const[t,s]=r.useState(null),[a,l]=r.useState(!0);r.useEffect(()=>{const o=localStorage.getItem("kp_token"),h=localStorage.getItem("kp_target"),j=localStorage.getItem("kp_user");o&&h&&j?(C.setToken(o),C.get("/api/auth/me").then(v=>{const f=v.role||"";localStorage.setItem("kp_role",f),s({target:h,utilisateur:j,role:f}),l(!1)}).catch(()=>{C.logout(),localStorage.removeItem("kp_role"),s(null),l(!1)})):l(!1)},[]);const d=async(o,h,j)=>{const v=await C.login(o,h,j);try{const f=await C.get("/api/auth/me");localStorage.setItem("kp_role",f.role||""),s({target:v.target,utilisateur:v.utilisateur,role:f.role||""})}catch{s({target:v.target,utilisateur:v.utilisateur,role:""})}return v},i=async o=>{const h=await C.post("/api/auth/switch-user",{utilisateur:o});C.setToken(h.access_token),localStorage.setItem("kp_token",h.access_token),localStorage.setItem("kp_user",h.utilisateur);try{const j=await C.get("/api/auth/me");localStorage.setItem("kp_role",j.role||""),s({target:h.target,utilisateur:h.utilisateur,role:j.role||""})}catch{s({target:h.target,utilisateur:h.utilisateur,role:""})}return h},m=()=>{C.logout(),localStorage.removeItem("kp_role"),rs(),s(null)};return e.jsx(ht.Provider,{value:{user:t,login:d,logout:m,switchUser:i,loading:a,isAuthenticated:!!t},children:n})}function V(){const n=r.useContext(ht);if(!n)throw new Error("useAuth must be used within AuthProvider");return n}const pt=r.createContext(null);function ls({children:n}){const[t,s]=r.useState(()=>localStorage.getItem("kp_animations")!=="0");return r.useEffect(()=>{localStorage.setItem("kp_animations",t?"1":"0"),t?document.documentElement.classList.remove("no-animations"):document.documentElement.classList.add("no-animations")},[t]),e.jsx(pt.Provider,{value:{animations:t,setAnimations:s},children:n})}function Qs(){const n=r.useContext(pt);if(!n)throw new Error("useSettings must be used within SettingsProvider");return n}function os({open:n,onClose:t,onSuccess:s}){const[a,l]=r.useState(""),[d,i]=r.useState(""),[m,o]=r.useState(!1),[h,j]=r.useState(""),[v,f]=r.useState(!1),[k,b]=r.useState(!1),p=r.useRef(null);r.useEffect(()=>{n&&(l(""),i(""),j(""),o(!1),setTimeout(()=>{var u;return(u=p.current)==null?void 0:u.focus()},100))},[n]);const w=async u=>{if(u==null||u.preventDefault(),!(!a||!d)){f(!0),j("");try{await C.verifyAdmin(a,d),localStorage.setItem("klikphone_admin","true"),s()}catch{j("Identifiants incorrects"),b(!0),setTimeout(()=>b(!1),400)}finally{f(!1)}}};return n?e.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",backdropFilter:"blur(4px)"},className:"fixed inset-0 z-[60] flex items-center justify-center p-4",onClick:t,children:[e.jsxs("form",{onClick:u=>u.stopPropagation(),onSubmit:w,className:k?"animate-shake":"",style:{background:"#1E293B",border:"1px solid #334155",borderRadius:16,padding:"32px 28px",width:360,maxWidth:"100%",boxShadow:"0 24px 48px rgba(0,0,0,0.5)"},children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{style:{width:56,height:56,borderRadius:14,background:"#F59E0B20",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Z,{style:{width:28,height:28,color:"#F59E0B"}})})}),e.jsx("h2",{style:{color:"#F1F5F9",fontSize:18,fontWeight:800,textAlign:"center",marginBottom:4},children:"AccÃ¨s Administrateur"}),e.jsx("p",{style:{color:"#64748B",fontSize:13,textAlign:"center",marginBottom:20},children:"Zone protÃ©gÃ©e â€” Identifiez-vous"}),h&&e.jsx("div",{style:{background:"#EF444420",border:"1px solid #EF444440",borderRadius:8,padding:"8px 12px",marginBottom:16,color:"#EF4444",fontSize:13,textAlign:"center",fontWeight:600},children:h}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx("label",{style:{display:"block",color:"#94A3B8",fontSize:12,fontWeight:600,marginBottom:6},children:"Identifiant"}),e.jsx("input",{ref:p,type:"text",value:a,onChange:u=>{l(u.target.value),j("")},placeholder:"admin",autoComplete:"username",style:{width:"100%",padding:"10px 14px",background:"#0F172A",border:"1px solid #334155",borderRadius:8,color:"#F1F5F9",fontSize:14,outline:"none",transition:"border-color 0.2s"},onFocus:u=>u.target.style.borderColor="#F59E0B",onBlur:u=>u.target.style.borderColor="#334155"})]}),e.jsxs("div",{style:{marginBottom:20},children:[e.jsx("label",{style:{display:"block",color:"#94A3B8",fontSize:12,fontWeight:600,marginBottom:6},children:"Mot de passe"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:m?"text":"password",value:d,onChange:u=>{i(u.target.value),j("")},placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoComplete:"current-password",style:{width:"100%",padding:"10px 42px 10px 14px",background:"#0F172A",border:"1px solid #334155",borderRadius:8,color:"#F1F5F9",fontSize:14,outline:"none",transition:"border-color 0.2s"},onFocus:u=>u.target.style.borderColor="#F59E0B",onBlur:u=>u.target.style.borderColor="#334155",onKeyDown:u=>u.key==="Enter"&&w()}),e.jsx("button",{type:"button",onClick:()=>o(!m),style:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",padding:4,color:"#64748B"},children:m?e.jsx(Rt,{style:{width:18,height:18}}):e.jsx(Pt,{style:{width:18,height:18}})})]})]}),e.jsx("button",{type:"submit",disabled:v||!a||!d,style:{width:"100%",padding:"12px 0",background:v||!a||!d?"#F59E0B80":"#F59E0B",color:"#000",borderRadius:10,border:"none",fontSize:14,fontWeight:700,cursor:v?"wait":"pointer",marginBottom:10},children:v?"VÃ©rification...":"Se connecter"}),e.jsx("button",{type:"button",onClick:t,style:{width:"100%",padding:"10px 0",background:"none",border:"none",color:"#64748B",fontSize:13,cursor:"pointer"},children:"Annuler"})]}),e.jsx("style",{children:`
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          20% { transform: translateX(-8px); }
          40% { transform: translateX(8px); }
          60% { transform: translateX(-6px); }
          80% { transform: translateX(6px); }
        }
        .animate-shake { animation: shake 0.4s ease-in-out; }
      `})]}):null}function cs(){var $e,Ee,Re,Pe;const{user:n,logout:t}=V(),s=H(),a=rt(),[l,d]=r.useState(!1),[i,m]=r.useState(()=>localStorage.getItem("kp_sidebar_collapsed")==="1"),[o,h]=r.useState(0),[j,v]=r.useState(()=>localStorage.getItem("kp_tarifs_open")!=="0"),[f,k]=r.useState(()=>localStorage.getItem("kp_admin_open")!=="0"),[b,p]=r.useState(0),[w,u]=r.useState(!1),[S,T]=r.useState(!1),[c,x]=r.useState(()=>localStorage.getItem("kp_devis_open")!=="0"),[N,y]=r.useState(()=>localStorage.getItem("klikphone_admin")==="true"),[R,g]=r.useState(!1),[P,A]=r.useState(null);r.useEffect(()=>{if(!n)return;const $=()=>{C.getKPI().then(F=>h((F==null?void 0:F.total_actifs)||0)).catch(()=>{}),C.getAvisGoogleStats().then(F=>p((F==null?void 0:F.non_repondus)||0)).catch(()=>{})};$();const G=setInterval($,3e4);return C.getConfig().then(F=>{const L={};(Array.isArray(F)?F:[]).forEach(Te=>{L[Te.cle]=Te.valeur}),u(L.MODULE_DEVIS_VISIBLE==="true"),T(L.MODULE_DEVIS_FLASH_VISIBLE==="true")}).catch(()=>{}),()=>clearInterval(G)},[n]);const q=()=>{const $=!i;m($),localStorage.setItem("kp_sidebar_collapsed",$?"1":"0"),window.dispatchEvent(new CustomEvent("sidebar-toggle",{detail:{collapsed:$}}))};if(!n)return null;const _=n.target==="tech"?"/tech":"/accueil",O=[{path:_,label:"Dashboard",icon:At,badge:o},{path:`${_}/clients`,label:"Clients",icon:lt},{path:`${_}/commandes`,label:"Commandes",icon:ie},{path:`${_}/attestation`,label:"Attestation",icon:J},{path:"/suivi",label:"Suivi client",icon:te}],ne=[{path:`${_}/admin`,label:"Reporting",icon:Ut},{path:`${_}/avis-google`,label:"Avis Google",icon:Lt,badge:b},{path:`${_}/community`,label:"Community Manager",icon:ve},{path:`${_}/config`,label:"Configuration",icon:Ft}],U=$=>a.pathname===$||a.pathname.startsWith($+"/"),X=["/admin","/avis-google","/community","/config"].some($=>a.pathname.includes($)),K=$=>{s($),d(!1)},Nt=$=>{N?K($):(A($),g(!0))},yt=()=>{y(!0),g(!1),P&&(s(P),d(!1),A(null))},Ce=()=>{localStorage.removeItem("klikphone_admin"),y(!1),X&&s(_,{replace:!0})},_e=()=>{s(`/login/${n.target}?switch=1`)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:hidden fixed top-0 left-0 right-0 h-14 bg-slate-900 border-b border-white/10 flex items-center px-4 z-40",children:[e.jsx("button",{onClick:()=>d(!0),className:"p-2 -ml-2 text-slate-400 hover:text-white transition-colors",children:e.jsx(Tt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2.5 ml-2",children:[e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-7 h-7 rounded-lg object-contain"}),e.jsx("span",{className:"text-white font-display font-bold tracking-tight",children:"KLIKPHONE"})]}),o>0&&e.jsx("span",{className:"ml-auto bg-brand-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:o})]}),l&&e.jsx("div",{className:"lg:hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-40",onClick:()=>d(!1)}),e.jsxs("aside",{className:`
        fixed top-0 left-0 bottom-0 bg-slate-900 flex flex-col z-50
        transition-all duration-300 ease-in-out
        ${i?"w-[68px]":"w-64"}
        ${l?"translate-x-0":"-translate-x-full"} lg:translate-x-0
      `,children:[e.jsxs("div",{className:"h-16 px-4 flex items-center gap-3 border-b border-white/[0.06] shrink-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white p-1 overflow-hidden shrink-0",children:e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-full h-full object-contain"})}),!i&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-white font-display font-bold text-[15px] tracking-tight leading-none",children:"KLIKPHONE"}),e.jsx("p",{className:"text-slate-500 text-[10px] uppercase tracking-[0.15em] mt-0.5",children:"Service aprÃ¨s-vente"})]}),e.jsx("button",{onClick:()=>d(!1),className:"lg:hidden p-1.5 rounded-lg text-slate-500 hover:text-slate-300 hover:bg-white/5 transition-colors",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("nav",{className:"flex-1 px-2 py-4 space-y-0.5 overflow-y-auto scrollbar-none",children:[!i&&e.jsx("p",{className:"px-3 mb-2 text-[10px] font-semibold text-slate-500 uppercase tracking-widest",children:"Menu"}),O.map(({path:$,label:G,icon:F,badge:L})=>e.jsxs("button",{onClick:()=>K($),title:i?G:void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                ${i?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                ${U($)?`bg-brand-600/20 text-brand-300 ${i?"":"border-l-2 border-brand-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(F,{className:`w-[18px] h-[18px] shrink-0 ${U($)?"text-brand-400":""}`}),!i&&e.jsx("span",{className:"flex-1 text-left",children:G}),!i&&L>0&&e.jsx("span",{className:"bg-brand-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:L}),i&&L>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-brand-500 text-white text-[8px] font-bold w-4 h-4 rounded-full flex items-center justify-center",children:L>9?"9+":L})]},$)),(w||S)&&e.jsxs("div",{className:`pt-4 mt-4 border-t border-white/[0.06] ${i?"px-0":""}`,children:[i?e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(J,{className:"w-4 h-4",style:{color:"#7C3AED"}})}):e.jsxs("button",{onClick:()=>{const $=!c;x($),localStorage.setItem("kp_devis_open",$?"1":"0")},className:"w-full flex items-center justify-between px-3 mb-2 group",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-[0.12em] flex items-center gap-1.5",style:{color:"#7C3AED"},children:[e.jsx(J,{className:"w-3 h-3"}),"Devis"]}),e.jsx(de,{className:`w-3 h-3 transition-transform duration-200 ${c?"rotate-180":""}`,style:{color:"#7C3AED"}})]}),(c||i)&&e.jsxs(e.Fragment,{children:[w&&e.jsxs("button",{onClick:()=>K(`${_}/devis`),title:i?"Devis":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                        ${i?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                        ${U(`${_}/devis`)?`bg-brand-600/20 text-brand-300 ${i?"":"border-l-2 border-brand-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(J,{className:`w-[18px] h-[18px] shrink-0 ${U(`${_}/devis`)?"text-brand-400":""}`}),!i&&e.jsx("span",{className:"flex-1 text-left",children:"Devis"})]}),S&&e.jsxs("button",{onClick:()=>K(`${_}/devis-flash`),title:i?"Devis Flash":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                        ${i?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                        ${U(`${_}/devis-flash`)?`bg-amber-500/20 text-amber-300 ${i?"":"border-l-2 border-amber-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(It,{className:`w-[18px] h-[18px] shrink-0 ${U(`${_}/devis-flash`)?"text-amber-400":""}`}),!i&&e.jsx("span",{className:"flex-1 text-left",children:"Devis Flash"})]})]})]}),e.jsxs("div",{className:`pt-4 mt-4 border-t border-white/[0.06] ${i?"px-0":""}`,children:[i?e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(Ae,{className:"w-4 h-4",style:{color:"#F59E0B"}})}):e.jsxs("button",{onClick:()=>{const $=!j;v($),localStorage.setItem("kp_tarifs_open",$?"1":"0")},className:"w-full flex items-center justify-between px-3 mb-2 group",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-[0.12em] flex items-center gap-1.5",style:{color:"#F59E0B"},children:[e.jsx(Ae,{className:"w-3 h-3"}),"Tarifs"]}),e.jsx(de,{className:`w-3 h-3 transition-transform duration-200 ${j?"rotate-180":""}`,style:{color:"#F59E0B"}})]}),(j||i)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>K(`${_}/tarifs`),title:i?"RÃ©parations":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                    ${i?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                    ${U(`${_}/tarifs`)?`bg-amber-500/20 text-amber-300 ${i?"":"border-l-2 border-amber-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(se,{className:`w-[18px] h-[18px] shrink-0 ${U(`${_}/tarifs`)?"text-amber-400":""}`}),!i&&e.jsx("span",{className:"flex-1 text-left",children:"RÃ©parations"})]}),e.jsxs("button",{onClick:()=>K(`${_}/tarifs-telephones`),title:i?"TÃ©lÃ©phones":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                    ${i?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                    ${U(`${_}/tarifs-telephones`)?`bg-amber-500/20 text-amber-300 ${i?"":"border-l-2 border-amber-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(he,{className:`w-[18px] h-[18px] shrink-0 ${U(`${_}/tarifs-telephones`)?"text-amber-400":""}`}),!i&&e.jsx("span",{className:"flex-1 text-left",children:"TÃ©lÃ©phones"})]}),e.jsxs("button",{onClick:()=>K(`${_}/telephones-vente`),title:i?"Mes tÃ©lÃ©phones":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                    ${i?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                    ${U(`${_}/telephones-vente`)?`bg-amber-500/20 text-amber-300 ${i?"":"border-l-2 border-amber-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(Dt,{className:`w-[18px] h-[18px] shrink-0 ${U(`${_}/telephones-vente`)?"text-amber-400":""}`}),!i&&e.jsx("span",{className:"flex-1 text-left",children:"Mes tÃ©lÃ©phones"})]})]})]}),e.jsxs("div",{className:`pt-4 mt-4 border-t border-white/[0.06] ${i?"px-0":""}`,children:[i?e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(Z,{className:"w-4 h-4",style:{color:"#EF4444"}})}):e.jsxs("button",{onClick:()=>{const $=!f;k($),localStorage.setItem("kp_admin_open",$?"1":"0")},className:"w-full flex items-center justify-between px-3 mb-2 group",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-[0.12em] flex items-center gap-1.5",style:{color:"#EF4444"},children:[e.jsx(Z,{className:"w-3 h-3"}),"Administration"]}),e.jsx(de,{className:`w-3 h-3 transition-transform duration-200 ${f?"rotate-180":""}`,style:{color:"#EF4444"}})]}),(f||i)&&e.jsx(e.Fragment,{children:ne.map(({path:$,label:G,icon:F,badge:L})=>e.jsxs("button",{onClick:()=>Nt($),title:i?G:void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                      ${i?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                      ${U($)?`bg-red-500/20 text-red-300 ${i?"":"border-l-2 border-red-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(F,{className:`w-[18px] h-[18px] shrink-0 ${U($)?"text-red-400":""}`}),!i&&e.jsx("span",{className:"flex-1 text-left",children:G}),!i&&L>0&&e.jsx("span",{className:"bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:L}),i&&L>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[8px] font-bold w-4 h-4 rounded-full flex items-center justify-center",children:L>9?"9+":L})]},$))})]})]}),e.jsx("div",{className:"hidden lg:block px-2 py-2 border-t border-white/[0.06]",children:e.jsxs("button",{onClick:q,className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-slate-500 hover:text-slate-300 hover:bg-white/[0.04] transition-colors text-xs",title:i?"Ouvrir la barre":"RÃ©duire la barre",children:[i?e.jsx(Ot,{className:"w-4 h-4"}):e.jsx(qt,{className:"w-4 h-4"}),!i&&e.jsx("span",{children:"RÃ©duire"})]})}),N&&!i&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,margin:"0 8px 4px",padding:"6px 10px",background:"#EF444415",borderRadius:8},children:[e.jsx(Ie,{style:{width:12,height:12,color:"#EF4444"}}),e.jsx("span",{style:{color:"#EF4444",fontSize:11,fontWeight:600,flex:1},children:"Mode Admin"}),e.jsx("button",{onClick:Ce,style:{background:"none",border:"none",color:"#64748B",fontSize:10,cursor:"pointer",textDecoration:"underline",padding:0},children:"Verrouiller"})]}),N&&i&&e.jsx("div",{className:"flex justify-center px-2 pb-1",children:e.jsx("button",{onClick:Ce,title:"Verrouiller admin",className:"p-1.5 rounded-lg hover:bg-red-500/10 transition-colors",children:e.jsx(Ie,{style:{width:14,height:14,color:"#EF4444"}})})}),e.jsx("div",{className:"px-2 py-3 border-t border-white/[0.06] shrink-0",children:i?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-brand-600/20 flex items-center justify-center",children:e.jsx("span",{className:"text-brand-300 font-bold text-sm",children:(Ee=($e=n.utilisateur)==null?void 0:$e.charAt(0))==null?void 0:Ee.toUpperCase()})}),e.jsx("button",{onClick:_e,className:"p-2 rounded-lg text-slate-500 hover:text-brand-400 hover:bg-white/5 transition-colors",title:"Changer d'utilisateur",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{t(),s("/")},className:"p-2 rounded-lg text-slate-500 hover:text-rose-400 hover:bg-white/5 transition-colors",title:"DÃ©connexion",children:e.jsx(De,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"space-y-2 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-brand-600/20 flex items-center justify-center shrink-0",children:e.jsx("span",{className:"text-brand-300 font-bold text-sm",children:(Pe=(Re=n.utilisateur)==null?void 0:Re.charAt(0))==null?void 0:Pe.toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-200 truncate",children:n.utilisateur}),e.jsxs("p",{className:"text-[11px] text-slate-500 capitalize",children:[n.target,n.role?` Â· ${n.role}`:""]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:_e,className:"flex-1 flex items-center justify-center gap-1.5 py-1.5 rounded-lg text-[11px] text-slate-400 hover:text-brand-300 hover:bg-white/5 transition-colors",children:[e.jsx(ee,{className:"w-3 h-3"})," Changer"]}),e.jsxs("button",{onClick:()=>{t(),s("/")},className:"flex-1 flex items-center justify-center gap-1.5 py-1.5 rounded-lg text-[11px] text-slate-400 hover:text-rose-400 hover:bg-white/5 transition-colors",children:[e.jsx(De,{className:"w-3 h-3"})," DÃ©connexion"]})]})]})}),!i&&e.jsxs("div",{style:{textAlign:"center",padding:"12px 0",fontSize:10,color:"#A1A1AA"},children:["PropulsÃ© par"," ",e.jsxs("span",{style:{fontWeight:800,fontSize:11},children:[e.jsx("span",{style:{color:"#7C3AED"},children:"Tk"}),e.jsx("span",{style:{color:"#FAFAFA"},children:"S"}),e.jsx("span",{style:{color:"#EC4899"},children:"âˆž"}),e.jsx("span",{style:{color:"#FAFAFA"},children:"26"})]})," ","â€” une solution"," ",e.jsx("span",{style:{fontWeight:700,color:"#7C3AED"},children:"Klik&Dev"})]})]}),e.jsx(os,{open:R,onClose:()=>{g(!1),A(null)},onSuccess:yt})]})}class gt extends r.Component{constructor(s){super(s);ce(this,"handleBack",()=>{this.setState({hasError:!1,error:null}),window.history.length>1?window.history.back():window.location.href="/"});ce(this,"handleReload",()=>{this.setState({hasError:!1,error:null}),window.location.reload()});this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 max-w-sm w-full p-8 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-red-100 flex items-center justify-center mx-auto mb-5",children:e.jsx(pe,{className:"w-7 h-7 text-red-500"})}),e.jsx("h2",{className:"text-lg font-bold text-slate-900 mb-2",children:"Oups, une erreur"}),e.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"Quelque chose s'est mal passÃ©. Pas de panique, vous pouvez revenir en arriÃ¨re."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:this.handleBack,className:"w-full py-3 px-4 rounded-xl bg-brand-600 hover:bg-brand-700 text-white text-sm font-bold transition-colors flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"})," Retour"]}),e.jsxs("button",{onClick:this.handleReload,className:"w-full py-2.5 px-4 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-600 text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"})," Recharger la page"]})]})]})}):this.props.children}}const ft=r.createContext(null),ds={success:Ne,error:pe,info:ot,warning:pe},qe={success:"bg-emerald-50 border-emerald-200 text-emerald-800",error:"bg-red-50 border-red-200 text-red-800",info:"bg-blue-50 border-blue-200 text-blue-800",warning:"bg-amber-50 border-amber-200 text-amber-800"},Me={success:"text-emerald-500",error:"text-red-500",info:"text-blue-500",warning:"text-amber-500"};function us({toast:n,onDismiss:t}){const[s,a]=r.useState(!1),l=ds[n.type]||ot;return r.useEffect(()=>{const d=setTimeout(()=>{a(!0),setTimeout(()=>t(n.id),300)},n.duration||3e3);return()=>clearTimeout(d)},[n,t]),e.jsxs("div",{className:`flex items-start gap-3 px-4 py-3 rounded-xl border shadow-lg transition-all duration-300 ${qe[n.type]||qe.info} ${s?"opacity-0 translate-x-8":"opacity-100 translate-x-0"}`,style:{animation:"slideInToast 0.3s ease-out"},children:[e.jsx(l,{className:`w-5 h-5 shrink-0 mt-0.5 ${Me[n.type]||Me.info}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[n.title&&e.jsx("p",{className:"font-semibold text-sm",children:n.title}),e.jsx("p",{className:"text-sm",children:n.message})]}),e.jsx("button",{onClick:()=>{a(!0),setTimeout(()=>t(n.id),300)},className:"p-0.5 rounded hover:bg-black/5 transition-colors shrink-0",children:e.jsx(je,{className:"w-4 h-4"})})]})}function ms({children:n}){const[t,s]=r.useState([]);let a=0;const l=r.useCallback((m,o,h={})=>{const j=Date.now()+a++;s(v=>[...v,{id:j,type:m,message:o,...h}])},[]),d=r.useCallback(m=>{s(o=>o.filter(h=>h.id!==m))},[]),i=r.useCallback({success:(m,o)=>l("success",m,o),error:(m,o)=>l("error",m,o),info:(m,o)=>l("info",m,o),warning:(m,o)=>l("warning",m,o)},[l]);return e.jsxs(ft.Provider,{value:i,children:[n,e.jsx("div",{className:"fixed top-4 right-4 z-[100] flex flex-col gap-2 w-80 pointer-events-none",children:t.map(m=>e.jsx("div",{className:"pointer-events-auto",children:e.jsx(us,{toast:m,onDismiss:d})},m.id))}),e.jsx("style",{children:`
        @keyframes slideInToast {
          from { opacity: 0; transform: translateX(100%); }
          to { opacity: 1; transform: translateX(0); }
        }
      `})]})}function Xs(){const n=r.useContext(ft);return n||{success:()=>{},error:()=>{},info:()=>{},warning:()=>{}}}function Se(){try{const n=new(window.AudioContext||window.webkitAudioContext),t=n.createOscillator(),s=n.createGain();t.connect(s),s.connect(n.destination),t.frequency.value=800,t.type="sine",s.gain.setValueAtTime(.3,n.currentTime),s.gain.exponentialRampToValueAtTime(.01,n.currentTime+.3),t.start(n.currentTime),t.stop(n.currentTime+.3)}catch{}}function re(n){try{return!!JSON.parse(localStorage.getItem("kp_chat_muted")||"{}")[n]}catch{return!1}}function bt(n){try{const t=JSON.parse(localStorage.getItem("kp_chat_muted")||"{}");return t[n]=!t[n],localStorage.setItem("kp_chat_muted",JSON.stringify(t)),t[n]}catch{return!1}}function xs({content:n}){const t=H(),s=localStorage.getItem("kp_target")||"accueil";if(!n)return null;let a=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");a=a.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\/tickets\/(\d+)/g,`<a href="/${s}/ticket/$1" class="text-brand-600 underline font-medium hover:text-brand-700" data-ticket-link="$1">Voir ticket #$1</a>`),a=a.replace(/(KP-\d{6})/g,'<span class="text-brand-600 font-mono font-bold bg-brand-50 px-1 rounded">$1</span>'),a=a.replace(/\n/g,"<br/>");const l=d=>{const i=d.target.closest("[data-ticket-link]");i&&(d.preventDefault(),t(`/${s}/ticket/${i.dataset.ticketLink}`))};return e.jsx("div",{onClick:l,className:"prose-sm break-words [&_strong]:font-bold [&_a]:cursor-pointer",dangerouslySetInnerHTML:{__html:a}})}const hs=[{icon:"ðŸ“Š",text:"Combien de tickets en cours ?"},{icon:"ðŸ”",text:"Quels tickets sont en attente de diagnostic ?"},{icon:"ðŸ”§",text:"Comment changer l'ecran d'un iPhone 15 ?"},{icon:"ðŸ’°",text:"Quel est le CA du jour ?"},{icon:"ðŸ“±",text:"Quels tickets sont assignes a Marina ?"}];function jt(n){return n?new Date(n).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):""}function ps(n){if(!n)return"ðŸ”§";const t=n.toLowerCase();return t.includes("manager")?"ðŸ‘”":t.includes("accueil")?"ðŸ“‹":"ðŸ”§"}function gs(){const[n,t]=r.useState([]),[s,a]=r.useState(""),[l,d]=r.useState(!1),[i,m]=r.useState(null),o=r.useRef(null),h=r.useRef(null),j=localStorage.getItem("kp_user")||"Utilisateur",v=localStorage.getItem("kp_role")||"";r.useEffect(()=>{var b;(b=o.current)==null||b.scrollTo({top:o.current.scrollHeight,behavior:"smooth"})},[n,l]);const f=async b=>{var w;const p=(b||s).trim();if(!(!p||l)){t(u=>[...u,{role:"user",content:p}]),a(""),d(!0);try{const u=await C.chatAI(p,j,i,v);m(u.conversation_id),t(S=>[...S,{role:"assistant",content:u.response}])}catch(u){t(S=>[...S,{role:"assistant",content:`Erreur : ${u.message||"connexion impossible"}`}])}finally{d(!1),(w=h.current)==null||w.focus()}}},k=()=>{i&&C.clearAIConversation(i).catch(()=>{}),t([]),m(null)};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{ref:o,className:"flex-1 overflow-y-auto p-4 space-y-3",children:[n.length===0&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-brand-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(Mt,{className:"w-7 h-7 text-brand-600"})}),e.jsx("h3",{className:"font-bold text-slate-700 text-sm",children:"Assistant Klikphone"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1 mb-4",children:"Pose-moi une question technique ou sur la base !"}),e.jsx("div",{className:"space-y-1.5",children:hs.map((b,p)=>e.jsxs("button",{onClick:()=>f(b.text),className:"block w-full text-left text-xs px-3 py-2 rounded-lg bg-brand-50 text-brand-700 hover:bg-brand-100 transition",children:[b.icon," ",b.text]},p))})]}),n.map((b,p)=>e.jsxs("div",{className:`flex ${b.role==="user"?"justify-end":"justify-start"}`,children:[b.role==="assistant"&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-100 flex items-center justify-center mr-2 mt-1 shrink-0",children:e.jsx(ge,{className:"w-3.5 h-3.5 text-brand-600"})}),e.jsx("div",{className:`max-w-[85%] rounded-2xl px-3.5 py-2.5 text-sm ${b.role==="user"?"bg-brand-600 text-white rounded-br-md":"bg-slate-100 text-slate-700 rounded-bl-md"}`,children:b.role==="user"?b.content:e.jsx(xs,{content:b.content})})]},p)),l&&e.jsxs("div",{className:"flex justify-start",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-100 flex items-center justify-center mr-2 mt-1 shrink-0",children:e.jsx(ge,{className:"w-3.5 h-3.5 text-brand-600"})}),e.jsx("div",{className:"bg-slate-100 rounded-2xl px-4 py-3 rounded-bl-md",children:e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]})]}),e.jsxs("div",{className:"border-t border-slate-200 p-3 bg-white",children:[n.length>0&&e.jsxs("button",{onClick:k,className:"flex items-center gap-1 text-[10px] text-slate-400 hover:text-slate-600 mb-2 transition",children:[e.jsx(Bt,{className:"w-3 h-3"})," Nouvelle conversation"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:h,value:s,onChange:b=>a(b.target.value),onKeyDown:b=>b.key==="Enter"&&!b.shiftKey&&f(),placeholder:"Pose une question...",className:`flex-1 px-3 py-2 rounded-xl border border-slate-200 text-sm
                       focus:border-brand-400 focus:ring-2 focus:ring-brand-100 outline-none`,disabled:l}),e.jsx("button",{onClick:()=>f(),disabled:l||!s.trim(),className:`px-3 py-2 bg-brand-600 text-white rounded-xl hover:bg-brand-700
                       disabled:opacity-40 transition shrink-0`,children:l?e.jsx(B,{className:"w-4 h-4 animate-spin"}):e.jsx(ye,{className:"w-4 h-4"})})]})]})]})}function fs({onReadMessages:n}){const[t,s]=r.useState([]),[a,l]=r.useState(""),[d,i]=r.useState(!1),[m,o]=r.useState(()=>re("general")),h=r.useRef(null),j=r.useRef(null),v=r.useRef(0),f=localStorage.getItem("kp_user")||"Utilisateur",k=r.useCallback(async()=>{try{const p=await C.chatTeamMessages(f,"general");if(p.length>v.current&&v.current>0&&!m){const w=p[p.length-1];w&&w.sender!==f&&Se()}v.current=p.length,s(p)}catch{}},[f,m]);r.useEffect(()=>{k();const p=setInterval(k,5e3);return()=>clearInterval(p)},[k]),r.useEffect(()=>{C.chatTeamMarkRead(f).then(()=>n==null?void 0:n()).catch(()=>{})},[t.length,f,n]),r.useEffect(()=>{var p;(p=h.current)==null||p.scrollTo({top:h.current.scrollHeight,behavior:"smooth"})},[t]);const b=async()=>{var w;const p=a.trim();if(!(!p||d)){i(!0);try{await C.chatTeamSend(p,f,"all"),l(""),k()}catch{}i(!1),(w=j.current)==null||w.focus()}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-slate-50",children:[e.jsxs("span",{className:"text-[10px] text-slate-400",children:[t.length," message(s)"]}),e.jsx("button",{onClick:()=>o(bt("general")),className:"p-1 rounded hover:bg-slate-100 transition-colors",title:m?"Activer le son":"Couper le son",children:m?e.jsx(ct,{className:"w-3.5 h-3.5 text-slate-400"}):e.jsx(dt,{className:"w-3.5 h-3.5 text-slate-400"})})]}),e.jsxs("div",{ref:h,className:"flex-1 overflow-y-auto p-3 space-y-2.5",children:[t.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Aucun message pour le moment"})]}),t.map(p=>{const w=p.sender===f,u=p.sender_color||"#94a3b8";return e.jsx("div",{className:`flex ${w?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] ${w?"items-end":"items-start"}`,children:[e.jsxs("div",{className:`flex items-center gap-1 text-[10px] mb-0.5 ${w?"justify-end":""} text-slate-400`,children:[e.jsx("span",{className:"w-2 h-2 rounded-full shrink-0",style:{background:u}}),e.jsx("span",{className:"font-medium",children:p.sender}),e.jsx("span",{children:jt(p.created_at)})]}),e.jsx("div",{className:`rounded-2xl px-3.5 py-2 text-sm ${w?"bg-brand-600 text-white rounded-br-sm":"bg-slate-100 text-slate-700 rounded-bl-sm"}`,children:p.message})]})},p.id)})]}),e.jsxs("div",{className:"border-t border-slate-200 p-3 bg-white flex gap-2",children:[e.jsx("input",{ref:j,value:a,onChange:p=>l(p.target.value),onKeyDown:p=>p.key==="Enter"&&!p.shiftKey&&b(),placeholder:"Message a tout le monde...",className:`flex-1 px-3 py-2 rounded-xl border border-slate-200 text-sm
                     focus:border-brand-400 focus:ring-2 focus:ring-brand-100 outline-none`,disabled:d}),e.jsx("button",{onClick:b,disabled:d||!a.trim(),className:`px-3 py-2 bg-brand-600 text-white rounded-xl hover:bg-brand-700
                     disabled:opacity-40 transition shrink-0`,children:e.jsx(ye,{className:"w-4 h-4"})})]})]})}function bs({onReadMessages:n}){const[t,s]=r.useState(null),[a,l]=r.useState([]),[d,i]=r.useState([]),[m,o]=r.useState(""),[h,j]=r.useState(!1),[v,f]=r.useState(!1),k=r.useRef(null),b=r.useRef(null),p=r.useRef(0),w=localStorage.getItem("kp_user")||"Utilisateur",u=r.useCallback(async()=>{try{const x=await C.chatTeamContacts(w);l(x)}catch{}},[w]);r.useEffect(()=>{u();const x=setInterval(u,5e3);return()=>clearInterval(x)},[u]);const S=r.useCallback(async x=>{try{const N=await C.chatTeamConversation(w,x);if(N.length>p.current&&p.current>0&&!re(`private_${x}`)){const y=N[N.length-1];y&&y.sender!==w&&Se()}p.current=N.length,i(N)}catch{}},[w]);r.useEffect(()=>{if(!t)return;f(re(`private_${t}`)),p.current=0,S(t),C.chatTeamMarkRead(w,t).then(()=>{n==null||n(),u()}).catch(()=>{});const x=setInterval(()=>S(t),3e3);return()=>clearInterval(x)},[t,S,w,n,u]),r.useEffect(()=>{var x;(x=k.current)==null||x.scrollTo({top:k.current.scrollHeight,behavior:"smooth"})},[d]);const T=async()=>{var N;const x=m.trim();if(!(!x||!t||h)){j(!0);try{await C.chatTeamSend(x,w,t),o(""),S(t)}catch{}j(!1),(N=b.current)==null||N.focus()}};if(!t)return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"px-4 py-3 border-b border-slate-100",children:e.jsxs("h3",{className:"font-semibold text-slate-700 text-sm flex items-center gap-1.5",children:[e.jsx(Z,{className:"w-3.5 h-3.5 text-brand-500"}),"Messages prives"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[a.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(lt,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Aucun contact"})]}),a.map(x=>e.jsxs("button",{onClick:()=>s(x.name),className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-slate-50 transition border-b border-slate-50",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shrink-0",style:{background:x.color||"#94a3b8"},children:x.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-semibold text-sm text-slate-700",children:[ps(x.role)," ",x.name]}),e.jsx("span",{className:"text-[10px] text-slate-400",children:x.last_message_time||""})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:x.last_message||"Pas de message"})]}),x.unread>0&&e.jsx("span",{className:"bg-red-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center shrink-0",children:x.unread>9?"9+":x.unread})]},x.name))]})]});const c=a.find(x=>x.name===t);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5 border-b border-slate-100 bg-slate-50/50 shrink-0",children:[e.jsx("button",{onClick:()=>{s(null),i([]),p.current=0},className:"text-slate-400 hover:text-slate-600 transition p-0.5",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-xs shrink-0",style:{background:(c==null?void 0:c.color)||"#94a3b8"},children:t.charAt(0).toUpperCase()}),e.jsx("span",{className:"font-semibold text-sm text-slate-700 flex-1",children:t}),e.jsx("button",{onClick:()=>f(bt(`private_${t}`)),className:"p-1 rounded hover:bg-slate-100 transition-colors",title:v?"Activer le son":"Couper le son",children:v?e.jsx(ct,{className:"w-3.5 h-3.5 text-slate-400"}):e.jsx(dt,{className:"w-3.5 h-3.5 text-slate-400"})})]}),e.jsxs("div",{ref:k,className:"flex-1 overflow-y-auto p-3 space-y-2",children:[d.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-xs text-slate-400",children:["Commencez une conversation avec ",t]})}),d.map(x=>{const N=x.sender===w;return e.jsx("div",{className:`flex ${N?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"max-w-[80%]",children:[e.jsx("div",{className:`rounded-2xl px-3.5 py-2.5 text-sm ${N?"bg-brand-600 text-white rounded-br-sm":"bg-slate-100 text-slate-700 rounded-bl-sm"}`,children:x.message}),e.jsx("div",{className:`text-[10px] text-slate-300 mt-0.5 ${N?"text-right":""}`,children:jt(x.created_at)})]})},x.id)})]}),e.jsxs("div",{className:"border-t border-slate-200 p-3 bg-white flex gap-2 shrink-0",children:[e.jsx("input",{ref:b,value:m,onChange:x=>o(x.target.value),onKeyDown:x=>x.key==="Enter"&&!x.shiftKey&&T(),placeholder:`Message a ${t}...`,className:`flex-1 px-3 py-2 rounded-xl border border-slate-200 text-sm
                     focus:border-brand-400 focus:ring-2 focus:ring-brand-100 outline-none`,disabled:h}),e.jsx("button",{onClick:T,disabled:h||!m.trim(),className:`px-3 py-2 bg-brand-600 text-white rounded-xl hover:bg-brand-700
                     disabled:opacity-40 transition shrink-0`,children:e.jsx(ye,{className:"w-4 h-4"})})]})]})}function js(){const[n,t]=r.useState(!1),[s,a]=r.useState("ai"),[l,d]=r.useState(0),[i,m]=r.useState(0),o=localStorage.getItem("kp_user")||"Utilisateur",h=r.useRef(0);r.useEffect(()=>{const k=()=>{C.chatTeamUnreadTotal(o).then(p=>{const w=(p.general||0)+(p.private||0);w>h.current&&h.current>=0&&!n&&!re("global")&&Se(),h.current=w,d(p.general||0),m(p.private||0)}).catch(()=>{})};k();const b=setInterval(k,8e3);return()=>clearInterval(b)},[o,n]);const j=l+i,v=r.useCallback(()=>d(0),[]),f=r.useCallback(()=>{C.chatTeamUnreadTotal(o).then(k=>m(k.private||0)).catch(()=>{})},[o]);return e.jsxs(e.Fragment,{children:[!n&&e.jsxs("button",{onClick:()=>t(!0),className:`fixed bottom-5 right-5 z-[100] w-14 h-14 rounded-full bg-brand-600 text-white
                     shadow-lg shadow-brand-600/30 hover:bg-brand-700 hover:scale-105
                     transition-all flex items-center justify-center`,children:[e.jsx(Ue,{className:"w-6 h-6"}),j>0&&e.jsx("span",{className:`absolute -top-1 -right-1 w-5 h-5 rounded-full bg-red-500 text-white
                           text-[10px] font-bold flex items-center justify-center ring-2 ring-white`,children:j>9?"9+":j})]}),n&&e.jsxs("div",{className:`fixed bottom-5 right-5 z-[100] w-[380px] h-[560px] bg-white rounded-2xl
                     shadow-2xl border border-slate-200 flex flex-col overflow-hidden`,style:{animation:"chatSlideUp 250ms ease-out"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-brand-600 text-white shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),e.jsx("span",{className:"font-display font-bold text-sm",children:"Chat Klikphone"})]}),e.jsx("button",{onClick:()=>t(!1),className:"p-1 rounded-lg hover:bg-white/20 transition",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex border-b border-slate-100 shrink-0",children:[e.jsxs("button",{onClick:()=>a("ai"),className:`flex-1 flex items-center justify-center gap-1 py-2.5 text-[11px] font-medium transition ${s==="ai"?"text-brand-600 border-b-2 border-brand-600 bg-brand-50/30":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),"Assistant"]}),e.jsxs("button",{onClick:()=>a("general"),className:`flex-1 flex items-center justify-center gap-1 py-2.5 text-[11px] font-medium transition relative ${s==="general"?"text-brand-600 border-b-2 border-brand-600 bg-brand-50/30":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(ve,{className:"w-3.5 h-3.5"}),"General",l>0&&s!=="general"&&e.jsx("span",{className:"w-4 h-4 rounded-full bg-red-500 text-white text-[9px] font-bold flex items-center justify-center",children:l>9?"9+":l})]}),e.jsxs("button",{onClick:()=>a("private"),className:`flex-1 flex items-center justify-center gap-1 py-2.5 text-[11px] font-medium transition relative ${s==="private"?"text-brand-600 border-b-2 border-brand-600 bg-brand-50/30":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(Z,{className:"w-3.5 h-3.5"}),"Prive",i>0&&s!=="private"&&e.jsx("span",{className:"w-4 h-4 rounded-full bg-red-500 text-white text-[9px] font-bold flex items-center justify-center",children:i>9?"9+":i})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[s==="ai"&&e.jsx(gs,{}),s==="general"&&e.jsx(fs,{onReadMessages:v}),s==="private"&&e.jsx(bs,{onReadMessages:f})]})]}),e.jsx("style",{children:`
        @keyframes chatSlideUp {
          from { opacity: 0; transform: translateY(20px) scale(0.95); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
      `})]})}function vs(){const n=H(),{user:t,loading:s}=V();if(!s&&t){const a=t.target==="tech"?"/tech":"/accueil";return n(a,{replace:!0}),null}return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-brand-900 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-12",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-20 h-20 rounded-2xl object-contain shadow-xl shadow-brand-600/20"})}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-display font-extrabold text-white text-center tracking-tight mt-3",children:"KLIKPHONE"}),e.jsx("p",{className:"text-brand-300 text-sm font-medium uppercase tracking-[0.2em] mt-1",children:"SpÃ©cialiste Apple & Multimarque"}),e.jsx("p",{className:"text-slate-400 text-sm mt-3 text-center max-w-md",children:"RÃ©paration smartphones, tablettes, PC portables et consoles. DÃ©posez votre appareil ou suivez votre rÃ©paration."}),e.jsxs("div",{className:"mt-10 w-full max-w-sm space-y-3",children:[e.jsxs("button",{onClick:()=>n("/client"),className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-brand-600 hover:bg-brand-700 text-white shadow-lg shadow-brand-600/30 transition-all group hover:-translate-y-0.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-white/10 flex items-center justify-center shrink-0 backdrop-blur-sm",children:e.jsx("img",{src:"/logo_k.png",alt:"",className:"w-6 h-6 object-contain"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-semibold",children:"DÃ©poser un appareil"}),e.jsx("p",{className:"text-sm text-brand-200 mt-0.5",children:"CrÃ©er un ticket de rÃ©paration"})]}),e.jsx(ue,{className:"w-5 h-5 text-brand-200 group-hover:translate-x-1 transition-transform"})]}),e.jsxs("button",{onClick:()=>n("/deposer"),className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-indigo-600/80 hover:bg-indigo-600 border border-indigo-500/30 text-white shadow-lg shadow-indigo-600/20 transition-all group hover:-translate-y-0.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-white/10 flex items-center justify-center shrink-0 backdrop-blur-sm",children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-semibold",children:"DÃ©pÃ´t Ã  distance"}),e.jsx("p",{className:"text-sm text-indigo-200 mt-0.5",children:"PrÃ©-enregistrez votre appareil en ligne"})]}),e.jsx(ue,{className:"w-5 h-5 text-indigo-200 group-hover:translate-x-1 transition-transform"})]}),e.jsxs("button",{onClick:()=>n("/suivi"),className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 text-white transition-all group backdrop-blur-sm hover:-translate-y-0.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-white/10 flex items-center justify-center shrink-0",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-semibold",children:"Suivre ma rÃ©paration"}),e.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Avec mon numÃ©ro de ticket"})]}),e.jsx(ue,{className:"w-5 h-5 text-slate-500 group-hover:translate-x-1 transition-transform"})]})]}),e.jsxs("div",{className:"mt-12 w-full max-w-sm",children:[e.jsx("p",{className:"text-center text-[11px] text-slate-500 uppercase tracking-widest font-medium mb-3",children:"AccÃ¨s staff"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>n("/login/accueil"),className:"flex items-center justify-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10 text-slate-300 text-sm font-medium hover:bg-white/10 transition-all hover:-translate-y-0.5",children:[e.jsx(zt,{className:"w-4 h-4 text-sky-400"})," Accueil"]}),e.jsxs("button",{onClick:()=>n("/login/tech"),className:"flex items-center justify-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10 text-slate-300 text-sm font-medium hover:bg-white/10 transition-all hover:-translate-y-0.5",children:[e.jsx(se,{className:"w-4 h-4 text-violet-400"})," Technicien"]})]})]})]}),e.jsxs("footer",{className:"py-4 text-center text-xs text-slate-600 flex flex-wrap items-center justify-center gap-2 px-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(we,{className:"w-3 h-3"})," 79 Place Saint LÃ©ger, ChambÃ©ry"]}),e.jsx("span",{className:"hidden sm:block",children:"Â·"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ke,{className:"w-3 h-3"})," 04 79 60 89 22"]})]})]})}function Ns(){const{target:n}=Ct(),[t]=it(),s=t.get("switch")==="1",{login:a,switchUser:l,user:d}=V(),i=H(),[m,o]=r.useState(["","","",""]),[h,j]=r.useState([]),[v,f]=r.useState(!0),[k,b]=r.useState(""),[p,w]=r.useState(""),[u,S]=r.useState(!1),T=[r.useRef(),r.useRef(),r.useRef(),r.useRef()];r.useEffect(()=>{d&&!s&&i(d.target==="tech"?"/tech":"/accueil")},[d,s]),r.useEffect(()=>{var g;s||(g=T[0].current)==null||g.focus()},[s]),r.useEffect(()=>{C.getActiveTeam().then(g=>{const P=g.map(A=>A.nom.trim());j(P),P.length>0&&b(P[0])}).catch(()=>{j(["Utilisateur"]),b("Utilisateur")}).finally(()=>f(!1))},[]);const c=(g,P)=>{var q;if(!/^\d?$/.test(P))return;const A=[...m];A[g]=P,o(A),P&&g<3&&((q=T[g+1].current)==null||q.focus())},x=(g,P)=>{var A;P.key==="Backspace"&&!m[g]&&g>0&&((A=T[g-1].current)==null||A.focus())},N=async g=>{var A;g==null||g.preventDefault();const P=m.join("");if(!(P.length<4)){w(""),S(!0);try{await a(P,n,k),i(n==="tech"?"/tech":"/accueil")}catch(q){w(q.message||"PIN incorrect"),o(["","","",""]),(A=T[0].current)==null||A.focus()}finally{S(!1)}}},y=async()=>{if(k){w(""),S(!0);try{await l(k),i(n==="tech"?"/tech":"/accueil")}catch(g){w(g.message||"Erreur")}finally{S(!1)}}};r.useEffect(()=>{!s&&m.every(g=>g!=="")&&N()},[m]);const R=n==="accueil";return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("button",{onClick:()=>i(s?-1:"/"),className:"flex items-center gap-2 text-sm text-slate-400 hover:text-slate-600 mb-8 transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"})," Retour"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200/60 p-8 animate-in",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-white border border-slate-100 p-1.5 overflow-hidden",children:e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-full h-full object-contain"})})}),e.jsx("h1",{className:"text-xl font-display font-bold text-center text-slate-900 mb-1",children:s?"Changer d'utilisateur":R?"Espace Accueil":"Espace Technicien"}),e.jsx("p",{className:"text-sm text-slate-400 text-center mb-8",children:s?"SÃ©lectionnez votre profil":"Entrez votre PIN pour continuer"}),s?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Utilisateur"}),v?e.jsx("div",{className:"input flex items-center justify-center",children:e.jsx(B,{className:"w-4 h-4 animate-spin text-slate-400"})}):e.jsx("select",{value:k,onChange:g=>b(g.target.value),className:"input",children:h.map(g=>e.jsx("option",{value:g,children:g},g))})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl px-4 py-2.5 text-sm text-red-600 font-medium text-center animate-in",children:p}),e.jsx("button",{onClick:y,disabled:u||!k,className:`w-full btn text-white shadow-sm ${R?"bg-sky-500 hover:bg-sky-600":"bg-brand-600 hover:bg-brand-700"}`,children:u?e.jsx(B,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4"})," Continuer"]})})]}):e.jsxs("form",{onSubmit:N,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Utilisateur"}),v?e.jsx("div",{className:"input flex items-center justify-center",children:e.jsx(B,{className:"w-4 h-4 animate-spin text-slate-400"})}):e.jsx("select",{value:k,onChange:g=>b(g.target.value),className:"input",children:h.map(g=>e.jsx("option",{value:g,children:g},g))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Code PIN"}),e.jsx("div",{className:"flex gap-3 justify-center",children:m.map((g,P)=>e.jsx("input",{ref:T[P],type:"password",inputMode:"numeric",maxLength:1,value:g,onChange:A=>c(P,A.target.value),onKeyDown:A=>x(P,A),className:`w-14 h-14 text-center text-2xl font-bold rounded-xl border-2 border-slate-200 bg-slate-50/50
                        focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 focus:bg-white outline-none transition-all`},P))})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl px-4 py-2.5 text-sm text-red-600 font-medium text-center animate-in",children:p}),e.jsx("button",{type:"submit",disabled:u||m.some(g=>!g),className:`w-full btn text-white shadow-sm ${R?"bg-sky-500 hover:bg-sky-600":"bg-brand-600 hover:bg-brand-700"}`,children:u?e.jsx(B,{className:"w-4 h-4 animate-spin"}):"Se connecter"})]})]}),e.jsxs("div",{className:"text-center text-xs text-slate-400 mt-6 space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Klikphone SAV"}),e.jsxs("p",{className:"flex items-center justify-center gap-1.5",children:[e.jsx(we,{className:"w-3 h-3"})," 79 Place Saint LÃ©ger, ChambÃ©ry"]}),e.jsxs("p",{className:"flex items-center justify-center gap-1.5",children:[e.jsx(ke,{className:"w-3 h-3"})," 04 79 60 89 22"]}),e.jsxs("div",{style:{textAlign:"center",padding:"12px 0",fontSize:10,color:"#A1A1AA"},children:["PropulsÃ© par"," ",e.jsxs("span",{style:{fontWeight:800,fontSize:11},children:[e.jsx("span",{style:{color:"#7C3AED"},children:"Tk"}),e.jsx("span",{style:{color:"#18181B"},children:"S"}),e.jsx("span",{style:{color:"#EC4899"},children:"âˆž"}),e.jsx("span",{style:{color:"#18181B"},children:"26"})]})," ","â€” une solution"," ",e.jsx("span",{style:{fontWeight:700,color:"#7C3AED"},children:"Klik&Dev"})]})]})]})})}function vt(n){if(!n)return null;const t=String(n);return t.endsWith("Z")||t.includes("+")?new Date(t):new Date(t+"Z")}function me(n){if(!n)return"â€”";try{return vt(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return n}}function Ys(n){if(!n)return"â€”";try{return vt(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return n}}function Y(n){return n==null?"â€”":`${Number(n).toFixed(2)} â‚¬`}const Zs=["PrÃ©-enregistrÃ©","En attente de diagnostic","En attente de piÃ¨ce","PiÃ¨ce reÃ§ue","En attente d'accord client","En cours de rÃ©paration","RÃ©paration terminÃ©e","Rendu au client","ClÃ´turÃ©"],ys={"PrÃ©-enregistrÃ©":{bg:"bg-indigo-50",text:"text-indigo-700",ring:"ring-indigo-200/80",dot:"bg-indigo-500",color:"#6366F1"},"En attente de diagnostic":{bg:"bg-amber-50",text:"text-amber-700",ring:"ring-amber-200/80",dot:"bg-amber-500",color:"#F59E0B"},"En attente de piÃ¨ce":{bg:"bg-violet-50",text:"text-violet-700",ring:"ring-violet-200/80",dot:"bg-violet-500",color:"#8B5CF6"},"PiÃ¨ce reÃ§ue":{bg:"bg-cyan-50",text:"text-cyan-700",ring:"ring-cyan-200/80",dot:"bg-cyan-500",color:"#06B6D4"},"En attente d'accord client":{bg:"bg-orange-50",text:"text-orange-700",ring:"ring-orange-200/80",dot:"bg-orange-500",color:"#F97316"},"En cours de rÃ©paration":{bg:"bg-blue-50",text:"text-blue-700",ring:"ring-blue-200/80",dot:"bg-blue-500",color:"#3B82F6"},"RÃ©paration terminÃ©e":{bg:"bg-emerald-50",text:"text-emerald-700",ring:"ring-emerald-200/80",dot:"bg-emerald-500",color:"#10B981"},"Rendu au client":{bg:"bg-gray-50",text:"text-gray-600",ring:"ring-gray-200/80",dot:"bg-gray-500",color:"#6B7280"},ClÃ´turÃ©:{bg:"bg-slate-100",text:"text-slate-600",ring:"ring-slate-200/80",dot:"bg-slate-800",color:"#1E293B"}},ws={bg:"bg-slate-100",text:"text-slate-500",ring:"ring-slate-200/80",dot:"bg-slate-400",color:"#94A3B8"};function ks(n){return ys[n]||ws}function en(n,t){let s=n.replace(/\D/g,"");return s.startsWith("0")&&(s="33"+s.slice(1)),`https://wa.me/${s}?text=${encodeURIComponent(t)}`}function tn(n,t){return`sms:${n.replace(/\D/g,"")}?body=${encodeURIComponent(t)}`}const Be=r.memo(function({statut:t,size:s="default"}){const a=ks(t),l=s==="lg"?"px-3.5 py-1.5 text-sm":"px-2.5 py-1 text-xs";return e.jsxs("span",{className:`inline-flex items-center gap-1.5 rounded-full font-semibold ring-1 transition-colors ${l} ${a.bg} ${a.text} ${a.ring}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${a.dot}`}),t]})}),ze={"PrÃ©-enregistrÃ©":{color:"#6366F1",bg:"#E0E7FF"},Diagnostic:{color:"#F59E0B",bg:"#FEF3C7"},Devis:{color:"#3B82F6",bg:"#DBEAFE"},PiÃ¨ce:{color:"#F97316",bg:"#FFEDD5"},RÃ©paration:{color:"#8B5CF6",bg:"#EDE9FE"},TerminÃ©:{color:"#10B981",bg:"#D1FAE5"},Rendu:{color:"#18181B",bg:"#F4F4F5"}},Ss=[{label:"Diagnostic",icon:te},{label:"Devis",icon:J},{label:"RÃ©paration",icon:se},{label:"TerminÃ©",icon:Ne},{label:"Rendu",icon:ie}],Cs=[{label:"Diagnostic",icon:te},{label:"Devis",icon:J},{label:"PiÃ¨ce",icon:ut},{label:"RÃ©paration",icon:se},{label:"TerminÃ©",icon:Ne},{label:"Rendu",icon:ie}],_s={"PrÃ©-enregistrÃ©":-1,"En attente de diagnostic":0,"En attente de piÃ¨ce":1,"PiÃ¨ce reÃ§ue":1,"En attente d'accord client":1,"En cours de rÃ©paration":2,"RÃ©paration terminÃ©e":3,"Rendu au client":4,ClÃ´turÃ©:4},$s={"PrÃ©-enregistrÃ©":-1,"En attente de diagnostic":0,"En attente d'accord client":1,"En attente de piÃ¨ce":2,"PiÃ¨ce reÃ§ue":2,"En cours de rÃ©paration":3,"RÃ©paration terminÃ©e":4,"Rendu au client":5,ClÃ´turÃ©:5};function Es({statut:n,hasPiece:t,isDistance:s}){const a=n==="PrÃ©-enregistrÃ©",l=t?Cs:Ss,i=(t?$s:_s)[n]??-1;return a?e.jsxs("div",{className:"text-center py-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full mx-auto mb-2 flex items-center justify-center",style:{backgroundColor:"#E0E7FF"},children:e.jsx(ae,{className:"w-6 h-6",style:{color:"#6366F1"}})}),e.jsx("p",{className:"text-sm font-bold",style:{color:"#6366F1"},children:"PrÃ©-enregistrÃ©"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"En attente de validation par l'Ã©quipe"})]}):e.jsx("div",{className:"flex items-center justify-between w-full",children:l.map((m,o)=>{const h=m.icon,j=o<=i,v=o===i,f=ze[m.label],k=j?{backgroundColor:f.color,color:"#fff",...v?{boxShadow:`0 0 0 4px ${f.bg}, 0 4px 12px ${f.color}30`,transform:"scale(1.15)"}:{boxShadow:`0 2px 6px ${f.color}30`}}:{backgroundColor:"#F4F4F5",color:"#D4D4D8"},b={color:j?f.color:"#A1A1AA"},p=o<i?ze[m.label].color:"#E4E4E7";return e.jsxs("div",{className:"flex items-center flex-1 last:flex-none",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center transition-all",style:k,children:e.jsx(h,{className:"w-4.5 h-4.5"})}),e.jsx("span",{className:"text-[10px] mt-1.5 font-semibold",style:b,children:m.label})]}),o<l.length-1&&e.jsx("div",{className:"flex-1 h-0.5 mx-2 rounded-full transition-colors",style:{backgroundColor:p}})]},o)})})}function Rs({clientId:n,ticketCode:t,compact:s=!1}){const[a,l]=r.useState(null),[d,i]=r.useState(!0),[m,o]=r.useState(!1);if(r.useEffect(()=>{if(!n&&!t)return;i(!0),(n?C.getFidelite(n):C.getFideliteByTicket(t)).then(l).catch(()=>l(null)).finally(()=>i(!1))},[n,t]),d)return e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(B,{className:"w-5 h-5 animate-spin text-violet-400"})});if(!a||!a.active)return null;const{points:h,total_depense:j,palier_film:v,palier_reduction:f,montant_reduction:k,prochaine_recompense:b,recompenses_disponibles:p,historique:w}=a,u=Math.min(h/v*100,100),S=Math.min(h/f*100,100),T=async c=>{if(m)return;const x=n||a._client_id;if(x){o(!0);try{await C.utiliserPoints({client_id:x,type:c});const N=n?await C.getFidelite(n):await C.getFideliteByTicket(t);l(N)}catch(N){alert(N.message||"Erreur")}finally{o(!1)}}};return s?e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-indigo-50 rounded-xl border border-violet-200/60 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-bold text-violet-700 flex items-center gap-1.5",children:[e.jsx("span",{className:"text-base",children:"â­"})," FidÃ©litÃ©"]}),e.jsxs("span",{className:"text-lg font-extrabold text-violet-600",children:[h," pts"]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-0.5",children:[e.jsx("span",{children:"Film verre trempÃ©"}),e.jsxs("span",{children:[Math.min(h,v)," / ",v.toLocaleString()]})]}),e.jsx("div",{className:"w-full h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-violet-600 rounded-full transition-all duration-500",style:{width:`${u}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-0.5",children:[e.jsxs("span",{children:["RÃ©duction ",k,"â‚¬"]}),e.jsxs("span",{children:[Math.min(h,f)," / ",f.toLocaleString()]})]}),e.jsx("div",{className:"w-full h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-full transition-all duration-500",style:{width:`${S}%`}})})]}),b.points_restants>0&&e.jsxs("p",{className:"text-center text-[10px] text-slate-500 mt-2",children:["Plus que ",e.jsxs("strong",{className:"text-violet-600",children:[b.points_restants," pts"]})," pour : ",b.type]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-indigo-50 rounded-xl border border-violet-200 p-5",children:[e.jsxs("h3",{className:"text-sm font-bold text-violet-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:"â­"})," Programme FidÃ©litÃ©"]}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-4xl font-extrabold text-violet-600",children:h.toLocaleString()}),e.jsx("div",{className:"text-sm text-slate-500",children:"points fidÃ©litÃ©"}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Total dÃ©pensÃ© : ",j.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsx("span",{children:"Film verre trempÃ©"}),e.jsxs("span",{children:[Math.min(h,v).toLocaleString()," / ",v.toLocaleString()," pts"]})]}),e.jsx("div",{className:"w-full h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-violet-600 rounded-full transition-all duration-500",style:{width:`${u}%`}})}),p.film&&n&&e.jsx("button",{onClick:()=>T("film"),disabled:m,className:"mt-2 w-full py-2 bg-violet-600 text-white rounded-lg text-sm font-semibold hover:bg-violet-700 transition disabled:opacity-50",children:m?e.jsx(B,{className:"w-4 h-4 animate-spin mx-auto"}):"Offrir le film verre trempÃ©"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsxs("span",{children:["RÃ©duction ",k,"â‚¬"]}),e.jsxs("span",{children:[Math.min(h,f).toLocaleString()," / ",f.toLocaleString()," pts"]})]}),e.jsx("div",{className:"w-full h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-full transition-all duration-500",style:{width:`${S}%`}})}),p.reduction&&n&&e.jsx("button",{onClick:()=>T("reduction"),disabled:m,className:"mt-2 w-full py-2 bg-emerald-600 text-white rounded-lg text-sm font-semibold hover:bg-emerald-700 transition disabled:opacity-50",children:m?e.jsx(B,{className:"w-4 h-4 animate-spin mx-auto"}):`Utiliser la rÃ©duction ${k}â‚¬`})]}),b.points_restants>0&&e.jsxs("div",{className:"text-center text-xs text-slate-500 bg-white/60 rounded-lg p-2 mt-2",children:["Plus que ",e.jsxs("strong",{className:"text-violet-600",children:[b.points_restants," pts"]})," ","pour obtenir : ",b.type]}),w&&w.length>0&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-violet-200/50",children:[e.jsx("p",{className:"text-[10px] font-semibold text-violet-600 uppercase tracking-wider mb-2",children:"DerniÃ¨res opÃ©rations"}),e.jsx("div",{className:"space-y-1",children:w.slice(0,5).map((c,x)=>e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-slate-600 truncate flex-1",children:c.description}),e.jsxs("span",{className:`font-bold ml-2 ${c.points>0?"text-emerald-600":"text-red-500"}`,children:[c.points>0?"+":"",c.points]})]},x))})]})]})}function Ps({ticketCode:n}){const t=r.useRef(null),[s,a]=r.useState(!1),[l,d]=r.useState(null),[i,m]=r.useState(!0),[o,h]=r.useState(!1),[j,v]=r.useState(10),[f,k]=r.useState(!0),b=r.useRef(!1);r.useEffect(()=>{n&&C.getGrattage(n).then(u=>{if(!u.actif){k(!1);return}v(u.frequence||10),u.deja_gratte&&(d({gagnant:!!u.gain,gain:u.gain,gain_label:u.gain_label,deja_gratte:!0}),a(!0),b.current=!0)}).catch(()=>k(!1)).finally(()=>m(!1))},[n]),r.useEffect(()=>{if(i||s||!f)return;const u=t.current;if(!u)return;const S=u.getContext("2d"),T=S.createLinearGradient(0,0,u.width,u.height);T.addColorStop(0,"#C0C0C0"),T.addColorStop(.5,"#D4D4D4"),T.addColorStop(1,"#A8A8A8"),S.fillStyle=T,S.fillRect(0,0,u.width,u.height),S.fillStyle="rgba(255,255,255,0.15)";for(let c=0;c<5;c++)S.fillRect(c*60,0,20,u.height);S.fillStyle="#888",S.font="bold 18px system-ui, sans-serif",S.textAlign="center",S.fillText("GRATTEZ ICI",u.width/2,u.height/2-10),S.font="12px system-ui, sans-serif",S.fillText("Tentez votre chance !",u.width/2,u.height/2+15)},[i,s,f]);const p=r.useCallback(u=>{var O,ne,U,oe;if(b.current)return;const S=t.current;if(!S)return;const T=S.getContext("2d"),c=S.getBoundingClientRect(),x=S.width/c.width,N=S.height/c.height,y=u.clientX??((ne=(O=u.touches)==null?void 0:O[0])==null?void 0:ne.clientX),R=u.clientY??((oe=(U=u.touches)==null?void 0:U[0])==null?void 0:oe.clientY);if(y==null)return;const g=(y-c.left)*x,P=(R-c.top)*N;T.globalCompositeOperation="destination-out",T.beginPath(),T.arc(g,P,25,0,Math.PI*2),T.fill();const A=T.getImageData(0,0,S.width,S.height);let q=0;for(let X=3;X<A.data.length;X+=4)A.data[X]===0&&q++;q/(A.data.length/4)*100>45&&!b.current&&(b.current=!0,w())},[n]),w=async()=>{a(!0);try{const u=await C.gratter(n);d(u)}catch(u){d({gagnant:!1,error:u.message})}};return i?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(B,{className:"w-5 h-5 animate-spin text-violet-400"})}):f?s&&(l!=null&&l.deja_gratte)?e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 text-center",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Vous avez dÃ©jÃ  grattÃ© ce ticket"}),l.gain&&e.jsxs("p",{className:"text-lg font-bold text-emerald-600 mt-2",children:[l.gain==="film"?"ðŸŽ":"ðŸ’°"," ",l.gain_label]}),!l.gain&&e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Retentez votre chance au prochain passage !"})]}):e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-violet-200 p-6 text-center shadow-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-violet-700 mb-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸŽ°"})," Tentez votre chance !"]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Grattez pour dÃ©couvrir si vous avez gagnÃ©"}),e.jsxs("div",{className:"relative inline-block mx-auto rounded-xl overflow-hidden",style:{width:280,height:140},children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{background:s?l!=null&&l.gagnant?"linear-gradient(135deg, #fbbf24, #f59e0b)":"#f1f5f9":"#e2e8f0"},children:s?l!=null&&l.gagnant?e.jsxs("div",{className:"text-center",style:{animation:"bounceIn 0.5s ease-out"},children:[e.jsx("div",{className:"text-4xl mb-1",children:"ðŸŽ‰"}),e.jsx("div",{className:"text-lg font-extrabold text-white",children:"GAGNÃ‰ !"}),e.jsxs("div",{className:"text-sm font-semibold text-white/90",children:[l.gain==="film"?"ðŸŽ":"ðŸ’°"," ",l.gain_label]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-1",children:"ðŸ˜Š"}),e.jsx("div",{className:"text-sm font-semibold text-slate-500",children:"Pas cette fois !"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Retentez au prochain passage"})]}):e.jsx("div",{className:"text-xs text-slate-400",children:"?"})}),!s&&e.jsx("canvas",{ref:t,width:280,height:140,className:"absolute inset-0 cursor-pointer",style:{touchAction:"none"},onMouseDown:()=>h(!0),onMouseUp:()=>h(!1),onMouseLeave:()=>h(!1),onMouseMove:u=>o&&p(u),onTouchStart:()=>h(!0),onTouchEnd:()=>h(!1),onTouchMove:u=>p(u)})]}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-3",children:["1 chance sur ",j," de gagner un film verre trempÃ© ou une rÃ©duction"]}),e.jsx("style",{children:`
        @keyframes bounceIn {
          0% { transform: scale(0.3); opacity: 0; }
          50% { transform: scale(1.05); }
          70% { transform: scale(0.9); }
          100% { transform: scale(1); opacity: 1; }
        }
      `})]}):null}function Ts(){const[n]=it(),[t,s]=r.useState(n.get("ticket")||n.get("tel")||""),[a,l]=r.useState(null),[d,i]=r.useState([]),[m,o]=r.useState([]),[h,j]=r.useState(""),[v,f]=r.useState(!1),[k,b]=r.useState(null),p=r.useRef(null),w=c=>/^\+?\d[\d\s.-]{5,}$/.test(c.trim()),u=r.useCallback(async c=>{const x=(c||t).trim();if(x){f(!0),j(""),l(null),i([]);try{if(w(x)){const N=await C.getTicketsByPhone(x.replace(/[\s.-]/g,""));if(N.length===0)j("Aucun ticket trouvÃ© avec ce numÃ©ro.");else if(N.length===1){const y=await C.getTicketByCode(N[0].ticket_code);l(y),C.getPublicCommandes(y.ticket_code).then(o).catch(()=>o([]))}else i(N)}else{const N=await C.getTicketByCode(x.toUpperCase());l(N),C.getPublicCommandes(N.ticket_code).then(o).catch(()=>o([]))}}catch{j("Aucun ticket trouvÃ©.")}finally{f(!1)}}},[t]);r.useEffect(()=>{const c=n.get("ticket")||n.get("tel");c&&u(c)},[]),r.useEffect(()=>{if(a)return p.current=setInterval(async()=>{try{const c=await C.getTicketByCode(a.ticket_code);l(c),b(new Date)}catch{}},3e4),()=>{p.current&&clearInterval(p.current)}},[a==null?void 0:a.ticket_code]);const S=c=>{c==null||c.preventDefault(),u()},T=async c=>{f(!0);try{const x=await C.getTicketByCode(c);l(x),i([]),C.getPublicCommandes(x.ticket_code).then(o).catch(()=>o([]))}catch{j("Erreur de chargement du ticket.")}finally{f(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-brand-50/30",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8 animate-in",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-600 flex items-center justify-center mx-auto mb-4 shadow-lg shadow-brand-600/20",children:e.jsx(he,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900",children:"Suivi de rÃ©paration"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Entrez votre code ticket ou numÃ©ro de tÃ©lÃ©phone"})]}),e.jsxs("form",{onSubmit:S,className:"flex gap-2 mb-8",children:[e.jsx("input",{type:"text",value:t,onChange:c=>s(c.target.value),placeholder:"KP-000001 ou 06 12 34 56 78",className:"input flex-1 text-center font-mono text-lg font-bold tracking-wider",autoFocus:!0}),e.jsx("button",{type:"submit",disabled:v,className:"btn-primary px-5",children:e.jsx(te,{className:"w-5 h-5"})})]}),h&&e.jsxs("div",{className:"card p-6 text-center animate-in",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-50 flex items-center justify-center mx-auto mb-3",children:e.jsx(he,{className:"w-6 h-6 text-red-300"})}),e.jsx("p",{className:"text-red-500 font-medium",children:h})]}),d.length>0&&e.jsxs("div",{className:"card overflow-hidden animate-in mb-5",children:[e.jsx("div",{className:"px-5 py-3 bg-slate-50/80 border-b border-slate-100",children:e.jsxs("p",{className:"text-sm font-semibold text-slate-700",children:[d.length," ticket(s) trouvÃ©(s)"]})}),e.jsx("div",{className:"divide-y divide-slate-100",children:d.map(c=>e.jsxs("button",{onClick:()=>T(c.ticket_code),className:"w-full flex items-center gap-3 px-5 py-3.5 hover:bg-brand-50/40 transition-colors text-left",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-brand-50 flex items-center justify-center shrink-0",children:e.jsx(Vt,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-brand-600 font-mono",children:c.ticket_code}),e.jsxs("p",{className:"text-xs text-slate-500 truncate",children:[c.marque," ",c.modele||c.modele_autre," â€” ",c.panne]})]}),e.jsx(Be,{statut:c.statut})]},c.ticket_code))})]}),a&&e.jsxs("div",{className:"space-y-5 animate-in",children:[a.statut==="PrÃ©-enregistrÃ©"&&e.jsx("div",{className:"card p-5 bg-indigo-50 border border-indigo-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-100 flex items-center justify-center shrink-0",children:e.jsx(ae,{className:"w-5 h-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-indigo-800",children:"Demande prÃ©-enregistrÃ©e"}),e.jsx("p",{className:"text-xs text-indigo-600 mt-0.5",children:"Notre Ã©quipe va valider votre demande. PrÃ©sentez-vous en boutique avec votre appareil."})]})]})}),e.jsx("div",{className:"card p-5",children:e.jsx(Es,{statut:a.statut,hasPiece:a.commande_piece===1,isDistance:a.source==="distance"})}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold font-mono text-brand-600",children:a.ticket_code}),a.source==="distance"&&e.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-indigo-100 text-indigo-600 text-[9px] font-bold flex items-center gap-0.5",children:[e.jsx(ae,{className:"w-2.5 h-2.5"})," Distance"]})]}),e.jsx(Be,{statut:a.statut})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:"Appareil"}),e.jsxs("p",{className:"font-medium text-slate-800",children:[a.marque," ",a.modele||a.modele_autre]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:"Panne"}),e.jsx("p",{className:"font-medium text-slate-800",children:a.panne})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:"DÃ©posÃ© le"}),e.jsx("p",{className:"font-medium text-slate-800",children:me(a.date_depot)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:"DerniÃ¨re mise Ã  jour"}),e.jsx("p",{className:"font-medium text-slate-800",children:me(a.date_maj)})]})]}),a.date_recuperation&&(()=>{const c=new Date(a.date_recuperation),x=!isNaN(c.getTime()),N=new Date;let y="";if(x&&c>N){const g=c-N,P=Math.floor(g/864e5),A=Math.floor(g%864e5/36e5);y=P>0?`dans ${P}j ${A}h`:`dans ${A}h`}else x&&c<=N&&(y="Date dÃ©passÃ©e");const R=x?c.toLocaleString("fr-FR",{weekday:"long",day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"}):a.date_recuperation;return e.jsxs("div",{className:`mt-4 flex items-center gap-2 p-3 rounded-lg ${x&&c<=N?"bg-red-50 border border-red-100":"bg-blue-50 border border-blue-100"}`,children:[e.jsx(Kt,{className:`w-4 h-4 shrink-0 ${x&&c<=N?"text-red-500":"text-blue-500"}`}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:`font-medium ${x&&c<=N?"text-red-600":"text-blue-600"}`,children:"RÃ©cupÃ©ration prÃ©vue : "}),e.jsx("span",{className:`font-bold ${x&&c<=N?"text-red-800":"text-blue-800"}`,children:R}),y&&e.jsxs("span",{className:`ml-2 text-xs font-semibold ${x&&c<=N?"text-red-500":"text-emerald-600"}`,children:["(",y,")"]})]})]})})(),(()=>{let c=[];try{const N=JSON.parse(a.reparation_supp||"[]");Array.isArray(N)&&(c=N.filter(y=>y.label))}catch{}return a.panne_detail||c.length>0?e.jsxs("div",{className:"mt-4 p-3 bg-slate-50 border border-slate-100 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600 font-semibold mb-2",children:[e.jsx(se,{className:"w-3.5 h-3.5"}),"DÃ©tail rÃ©paration"]}),a.panne_detail&&e.jsx("p",{className:"text-slate-600 text-xs mb-1",children:a.panne_detail}),c.length>0&&e.jsx("p",{className:"text-slate-600 text-xs",children:c.map(N=>N.label).join(" + ")})]}):null})(),(()=>{let c=[];try{const _=JSON.parse(a.reparation_supp||"[]");Array.isArray(_)&&(c=_.filter(O=>O.label))}catch{}let x=[];if(c.length>0)x=c.map(_=>({label:_.label,prix:Number(_.prix||0)}));else{const _=Number(a.devis_estime||0);_>0&&x.push({label:a.panne||"RÃ©paration",prix:_});const O=Number(a.prix_supp||0);a.reparation_supp&&O>0&&x.push({label:a.reparation_supp,prix:O})}const N=x.reduce((_,O)=>_+O.prix,0);if(N<=0)return null;const y=Number(a.acompte||0),R=Number(a.reduction_pourcentage||0),g=Number(a.reduction_montant||0),P=R>0?N*(R/100):g,A=Math.max(0,N-P),q=A-y;return e.jsxs("div",{className:"mt-4 p-3 bg-emerald-50 border border-emerald-100 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-700 font-semibold mb-2",children:[e.jsx(Gt,{className:"w-3.5 h-3.5"}),"Tarification"]}),e.jsxs("div",{className:"space-y-1",children:[x.map((_,O)=>e.jsxs("div",{className:"flex justify-between text-slate-700",children:[e.jsx("span",{children:_.label}),e.jsx("span",{className:"font-medium",children:Y(_.prix)})]},O)),P>0&&e.jsxs("div",{className:"flex justify-between text-emerald-600 text-xs",children:[e.jsxs("span",{children:["RÃ©duction",R>0?` (${R}%)`:""]}),e.jsxs("span",{children:["- ",Y(P)]})]}),e.jsxs("div",{className:"border-t border-emerald-200 pt-1 mt-1 flex justify-between font-bold text-emerald-800",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:Y(A)})]}),y>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-slate-500 text-xs",children:[e.jsx("span",{children:"Acompte versÃ©"}),e.jsxs("span",{children:["- ",Y(y)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-emerald-900",children:[e.jsx("span",{children:"Reste Ã  payer"}),e.jsx("span",{children:Y(q)})]})]})]})]})})(),a.commentaire_client&&e.jsxs("div",{className:"mt-4 p-3 bg-brand-50 border border-brand-100 rounded-lg text-sm text-brand-800",children:[e.jsx("span",{className:"font-semibold",children:"Message :"})," ",a.commentaire_client]})]}),m.map(c=>{const x=c.statut==="ReÃ§ue";return["RÃ©paration terminÃ©e","Rendu au client","ClÃ´turÃ©"].includes(a.statut)?null:x?e.jsxs("div",{className:"card p-5 bg-green-50 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-green-600"})}),e.jsx("span",{className:"font-bold text-sm text-green-800",children:"PiÃ¨ce reÃ§ue"})]}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:c.piece}),c.date_reception&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["ReÃ§ue le ",me(c.date_reception)]}),e.jsx("div",{className:"text-xs text-slate-500 mt-2",children:"La rÃ©paration de votre appareil va Ãªtre lancÃ©e rapidement."})]},c.id):e.jsxs("div",{className:"card p-5 bg-amber-50 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(ut,{className:"w-4 h-4 text-amber-600"})}),e.jsx("span",{className:"font-bold text-sm text-amber-800",children:"PiÃ¨ce en cours d'acheminement"})]}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:c.piece}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full ${c.statut==="En attente"?"bg-amber-100 text-amber-700":c.statut==="CommandÃ©e"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:c.statut==="En attente"?"En attente de commande":c.statut==="CommandÃ©e"?"CommandÃ©e":"ExpÃ©diÃ©e"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-2",children:"Nous vous prÃ©viendrons dÃ¨s rÃ©ception pour lancer la rÃ©paration."})]},c.id)}),e.jsx(Rs,{ticketCode:a.ticket_code,compact:!0}),e.jsx(Ps,{ticketCode:a.ticket_code}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-slate-400",children:[e.jsx(ee,{className:"w-3 h-3"}),e.jsx("span",{children:"Mise Ã  jour automatique toutes les 30s"}),k&&e.jsxs("span",{children:["â€” ",k.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Une question sur votre rÃ©paration ?"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-lg font-bold text-slate-900",children:[e.jsx(ke,{className:"w-5 h-5 text-brand-600"}),"04 79 60 89 22"]}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-xs text-slate-400 mt-2",children:[e.jsx(we,{className:"w-3 h-3"}),"79 Place Saint LÃ©ger, ChambÃ©ry"]})]})]}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsxs("a",{href:"/",className:"inline-flex items-center gap-2 text-sm text-slate-400 hover:text-slate-600 transition-colors",children:[e.jsx(Q,{className:"w-4 h-4"})," Retour Ã  l'accueil"]}),e.jsxs("div",{style:{textAlign:"center",padding:"12px 0",fontSize:10,color:"#A1A1AA"},children:["PropulsÃ© par"," ",e.jsxs("span",{style:{fontWeight:800,fontSize:11},children:[e.jsx("span",{style:{color:"#7C3AED"},children:"Tk"}),e.jsx("span",{style:{color:"#18181B"},children:"S"}),e.jsx("span",{style:{color:"#EC4899"},children:"âˆž"}),e.jsx("span",{style:{color:"#18181B"},children:"26"})]})," ","â€” une solution"," ",e.jsx("span",{style:{fontWeight:700,color:"#7C3AED"},children:"Klik&Dev"})]})]})]})})}const Ve=r.lazy(()=>D(()=>import("./DashboardPage-Ydy-KngY.js"),__vite__mapDeps([0,1,2]))),Ke=r.lazy(()=>D(()=>import("./TicketDetailPage-DAE3p5vd.js"),__vite__mapDeps([3,1,4,2,5]))),As=r.lazy(()=>D(()=>import("./ClientFormPage-CKvoECM7.js"),__vite__mapDeps([6,1,4,2]))),Ge=r.lazy(()=>D(()=>import("./ClientsPage-C2T15Eao.js"),__vite__mapDeps([7,1,2]))),We=r.lazy(()=>D(()=>import("./CommandesPage-BJ-jr3Rz.js"),__vite__mapDeps([8,1,2]))),Je=r.lazy(()=>D(()=>import("./AttestationPage-DsMnO47a.js"),__vite__mapDeps([9,1,2]))),He=r.lazy(()=>D(()=>import("./ConfigPage-C8MUSG_y.js"),__vite__mapDeps([10,1,2]))),Qe=r.lazy(()=>D(()=>import("./AdminPage-DgikvVlC.js"),__vite__mapDeps([11,1,2,5]))),Xe=r.lazy(()=>D(()=>import("./TarifsPage-B6cCljOy.js"),__vite__mapDeps([12,1,2]))),Is=r.lazy(()=>D(()=>import("./DepotPage-yNCgMgQt.js"),__vite__mapDeps([13,1,4,2]))),Ye=r.lazy(()=>D(()=>import("./AvisGoogle-2rGRKpSu.js"),__vite__mapDeps([14,1,2]))),Ze=r.lazy(()=>D(()=>import("./CommunityManager-BD5dyIeE.js"),__vite__mapDeps([15,1,2]))),et=r.lazy(()=>D(()=>import("./TarifsTelephonesPage-BcXJKxTs.js"),__vite__mapDeps([16,1,2]))),tt=r.lazy(()=>D(()=>import("./DevisPage-DBL57R9q.js"),__vite__mapDeps([17,1,2]))),st=r.lazy(()=>D(()=>import("./DevisFlashPage-ClP0_q1O.js"),__vite__mapDeps([18,1,2]))),nt=r.lazy(()=>D(()=>import("./TelephonesVentePage-BLKtR0M2.js"),__vite__mapDeps([19,1,2]))),Ds=r.lazy(()=>D(()=>import("./DeposerPage-B3td3egM.js"),__vite__mapDeps([20,1,2]))),at=()=>{D(()=>import("./DashboardPage-Ydy-KngY.js"),__vite__mapDeps([0,1,2])),D(()=>import("./TarifsPage-B6cCljOy.js"),__vite__mapDeps([12,1,2])),D(()=>import("./ClientsPage-C2T15Eao.js"),__vite__mapDeps([7,1,2]))};typeof window<"u"&&("requestIdleCallback"in window?window.requestIdleCallback(at):setTimeout(at,2e3));function Us(){const n=H(),{user:t}=V(),s=(t==null?void 0:t.target)==="tech"?"/tech":"/accueil";return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 max-w-sm w-full p-8 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-amber-100 flex items-center justify-center mx-auto mb-5",children:e.jsx(Wt,{className:"w-7 h-7 text-amber-500"})}),e.jsx("h2",{className:"text-lg font-bold text-slate-900 mb-2",children:"AccÃ¨s restreint"}),e.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"Cette page nÃ©cessite les droits administrateur. Veuillez vous connecter en tant qu'admin depuis le menu."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>n(s,{replace:!0}),className:"w-full py-3 px-4 rounded-xl bg-brand-600 hover:bg-brand-700 text-white text-sm font-bold transition-colors flex items-center justify-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4"})," Retour au dashboard"]}),e.jsxs("button",{onClick:()=>n(-1),className:"w-full py-2.5 px-4 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-600 text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"})," Page prÃ©cÃ©dente"]})]})]})})}function Ls(){const n=rt(),t=H(),{user:s}=V(),[a]=r.useState(()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0);if(!s)return null;const l=s.target==="tech"?"/tech":"/accueil";return n.pathname===l||n.pathname===l+"/"?null:e.jsx("button",{onClick:()=>{window.history.length>1?t(-1):t(l,{replace:!0})},className:`fixed bottom-4 left-4 z-30 w-11 h-11 rounded-full bg-slate-900/80 backdrop-blur-sm text-white shadow-lg flex items-center justify-center active:scale-90 transition-transform ${a?"":"lg:hidden"}`,"aria-label":"Retour",children:e.jsx(Q,{className:"w-5 h-5"})})}function Fs({children:n,allowedTargets:t}){const{user:s,loading:a}=V(),[l,d]=r.useState(()=>localStorage.getItem("kp_sidebar_collapsed")==="1");return r.useEffect(()=>{const i=m=>d(m.detail.collapsed);return window.addEventListener("sidebar-toggle",i),()=>window.removeEventListener("sidebar-toggle",i)},[]),a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-slate-400 font-medium",children:"Chargement..."})]})}):s?t&&!t.includes(s.target)?e.jsx(xe,{to:"/",replace:!0}):e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(cs,{}),e.jsx("main",{className:`pt-14 lg:pt-0 min-h-screen transition-all duration-300 ${l?"lg:pl-[68px]":"lg:pl-64"}`,children:e.jsx(gt,{children:n})}),e.jsx(Ls,{})]}):e.jsx(xe,{to:"/",replace:!0})}const I=({children:n,targets:t})=>e.jsx(Fs,{allowedTargets:t,children:n});function Os({children:n}){const{user:t}=V();return localStorage.getItem("klikphone_admin")!=="true"?e.jsx(Us,{}):n}const z=({children:n,targets:t})=>e.jsx(I,{targets:t,children:e.jsx(Os,{children:n})});function qs(){const{user:n}=V();return n?e.jsx(js,{}):null}const Ms=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsx("div",{className:"w-6 h-6 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"})});function Bs(){return e.jsxs(r.Suspense,{fallback:e.jsx(Ms,{}),children:[e.jsxs($t,{children:[e.jsx(E,{path:"/",element:e.jsx(vs,{})}),e.jsx(E,{path:"/login/:target",element:e.jsx(Ns,{})}),e.jsx(E,{path:"/client",element:e.jsx(As,{})}),e.jsx(E,{path:"/depot",element:e.jsx(Is,{})}),e.jsx(E,{path:"/suivi",element:e.jsx(Ts,{})}),e.jsx(E,{path:"/deposer",element:e.jsx(Ds,{})}),e.jsx(E,{path:"/accueil",element:e.jsx(I,{targets:["accueil"],children:e.jsx(Ve,{})})}),e.jsx(E,{path:"/accueil/ticket/:id",element:e.jsx(I,{targets:["accueil"],children:e.jsx(Ke,{})})}),e.jsx(E,{path:"/accueil/clients",element:e.jsx(I,{targets:["accueil"],children:e.jsx(Ge,{})})}),e.jsx(E,{path:"/accueil/commandes",element:e.jsx(I,{targets:["accueil"],children:e.jsx(We,{})})}),e.jsx(E,{path:"/accueil/attestation",element:e.jsx(I,{targets:["accueil"],children:e.jsx(Je,{})})}),e.jsx(E,{path:"/accueil/tarifs",element:e.jsx(I,{targets:["accueil"],children:e.jsx(Xe,{})})}),e.jsx(E,{path:"/accueil/tarifs-telephones",element:e.jsx(I,{targets:["accueil"],children:e.jsx(et,{})})}),e.jsx(E,{path:"/accueil/devis",element:e.jsx(I,{targets:["accueil"],children:e.jsx(tt,{})})}),e.jsx(E,{path:"/accueil/devis-flash",element:e.jsx(I,{targets:["accueil"],children:e.jsx(st,{})})}),e.jsx(E,{path:"/accueil/telephones-vente",element:e.jsx(I,{targets:["accueil"],children:e.jsx(nt,{})})}),e.jsx(E,{path:"/accueil/config",element:e.jsx(z,{targets:["accueil"],children:e.jsx(He,{})})}),e.jsx(E,{path:"/accueil/avis-google",element:e.jsx(z,{targets:["accueil"],children:e.jsx(Ye,{})})}),e.jsx(E,{path:"/accueil/community",element:e.jsx(z,{targets:["accueil"],children:e.jsx(Ze,{})})}),e.jsx(E,{path:"/accueil/admin",element:e.jsx(z,{targets:["accueil"],children:e.jsx(Qe,{})})}),e.jsx(E,{path:"/tech",element:e.jsx(I,{targets:["tech"],children:e.jsx(Ve,{})})}),e.jsx(E,{path:"/tech/ticket/:id",element:e.jsx(I,{targets:["tech"],children:e.jsx(Ke,{})})}),e.jsx(E,{path:"/tech/clients",element:e.jsx(I,{targets:["tech"],children:e.jsx(Ge,{})})}),e.jsx(E,{path:"/tech/commandes",element:e.jsx(I,{targets:["tech"],children:e.jsx(We,{})})}),e.jsx(E,{path:"/tech/attestation",element:e.jsx(I,{targets:["tech"],children:e.jsx(Je,{})})}),e.jsx(E,{path:"/tech/tarifs",element:e.jsx(I,{targets:["tech"],children:e.jsx(Xe,{})})}),e.jsx(E,{path:"/tech/tarifs-telephones",element:e.jsx(I,{targets:["tech"],children:e.jsx(et,{})})}),e.jsx(E,{path:"/tech/devis",element:e.jsx(I,{targets:["tech"],children:e.jsx(tt,{})})}),e.jsx(E,{path:"/tech/devis-flash",element:e.jsx(I,{targets:["tech"],children:e.jsx(st,{})})}),e.jsx(E,{path:"/tech/telephones-vente",element:e.jsx(I,{targets:["tech"],children:e.jsx(nt,{})})}),e.jsx(E,{path:"/tech/config",element:e.jsx(z,{targets:["tech"],children:e.jsx(He,{})})}),e.jsx(E,{path:"/tech/avis-google",element:e.jsx(z,{targets:["tech"],children:e.jsx(Ye,{})})}),e.jsx(E,{path:"/tech/community",element:e.jsx(z,{targets:["tech"],children:e.jsx(Ze,{})})}),e.jsx(E,{path:"/tech/admin",element:e.jsx(z,{targets:["tech"],children:e.jsx(Qe,{})})}),e.jsx(E,{path:"*",element:e.jsx(xe,{to:"/",replace:!0})})]}),e.jsx(qs,{})]})}function zs(){return e.jsx(_t,{children:e.jsx(ls,{children:e.jsx(is,{children:e.jsx(ms,{children:e.jsx(gt,{children:e.jsx(Bs,{})})})})})})}fe.createRoot(document.getElementById("root")).render(e.jsx(Et.StrictMode,{children:e.jsx(zs,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});export{Rs as F,Es as P,Zs as S,Hs as a,Y as b,C as c,Xs as d,Be as e,Ys as f,ks as g,me as h,Ws as i,e as j,Qs as k,Js as p,tn as s,V as u,en as w};
