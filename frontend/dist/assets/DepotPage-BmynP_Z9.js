import{c as X,a as o,j as e}from"./index-C_zrz2WY.js";import{r as l}from"./vendor-react-DMwujlca.js";import{P as F}from"./PatternGrid-9nJleh3A.js";import{a5 as O,c as _,l as V,L as A,K,a4 as k,D as G,aB as B,A as H,t as J}from"./vendor-icons-CffLNJII.js";const U=i=>/^(?:0|\+33\s?)[1-9](?:[\s.-]?\d{2}){4}$/.test(i.replace(/\s/g,"").length>=10?i:"")||/^\d{10,14}$/.test(i.replace(/[\s.-]/g,"")),Q=i=>!i||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),N=["Client","Appareil","Modèle","Panne","Sécurité","Confirmation"],E={nom:"",prenom:"",telephone:"",email:"",societe:"",categorie:"",marque:"",modele:"",modele_autre:"",panne:"",panne_detail:"",pin:"",pattern:"",notes_client:"",imei:""};function te(){const i=X(),[a,m]=l.useState(0),[w,y]=l.useState(!1),[c,C]=l.useState({}),[x,q]=l.useState(null),[p,j]=l.useState(null),d=l.useRef(null),[P,$]=l.useState([]),[I,b]=l.useState([]),[S,f]=l.useState([]),[M,R]=l.useState([]),[s,u]=l.useState({...E});l.useEffect(()=>{o.getCategories().then($).catch(()=>{}),o.getPannes().then(R).catch(()=>{})},[]),l.useEffect(()=>{s.categorie&&(o.getMarques(s.categorie).then(b).catch(()=>b([])),u(t=>({...t,marque:"",modele:"",modele_autre:""})))},[s.categorie]),l.useEffect(()=>{s.categorie&&s.marque&&(o.getModeles(s.categorie,s.marque).then(f).catch(()=>f([])),u(t=>({...t,modele:"",modele_autre:""})))},[s.marque]),l.useEffect(()=>(a===5&&x&&(j(10),d.current=setInterval(()=>{j(t=>t<=1?(clearInterval(d.current),g(),null):t-1)},1e3)),()=>{d.current&&clearInterval(d.current)}),[a,x]);const g=()=>{d.current&&clearInterval(d.current),u({...E}),m(0),q(null),j(null),b([]),f([])},r=(t,n)=>{u(v=>({...v,[t]:n})),C(v=>({...v,[t]:void 0}))},z=()=>{const t={};return a===0&&(s.nom.trim()||(t.nom="Le nom est requis"),s.telephone.trim()?U(s.telephone)||(t.telephone="Numéro invalide (10 chiffres min.)"):t.telephone="Le téléphone est requis",s.email&&!Q(s.email)&&(t.email="Email invalide")),a===2&&(s.marque==="Autre"||s.modele==="Autre")&&!s.modele_autre.trim()&&(t.modele_autre="Veuillez préciser le modèle"),C(t),Object.keys(t).length===0},h=({field:t})=>c[t]?e.jsx("p",{className:"text-xs text-red-500 mt-1",children:c[t]}):null,L=async()=>{y(!0);try{const t=await o.createOrGetClient({nom:s.nom,prenom:s.prenom,telephone:s.telephone,email:s.email,societe:s.societe}),n=await o.createTicket({client_id:t.id,categorie:s.categorie,marque:s.marque,modele:s.marque==="Autre"||s.modele==="Autre"?"":s.modele,modele_autre:s.marque==="Autre"||s.modele==="Autre"?s.modele_autre:"",panne:s.panne,panne_detail:s.panne_detail,pin:s.pin,pattern:s.pattern,notes_client:s.notes_client});q(n.ticket_code),m(5)}catch(t){i.error(t.message||"Erreur lors de la création du ticket")}finally{y(!1)}},D=()=>a===0?s.nom&&s.telephone:a===1?s.categorie:a===2?s.marque&&(s.marque!=="Autre"&&s.modele!=="Autre"||s.modele_autre.trim()):a===3?s.panne:!0,T=()=>{z()&&(a===4?L():m(t=>t+1))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-brand-50/30 flex flex-col",children:[e.jsxs("div",{className:"bg-slate-900 text-white px-6 py-4 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white p-1 overflow-hidden",children:e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-display font-bold tracking-tight",children:"KLIKPHONE"}),e.jsx("p",{className:"text-[11px] text-slate-400",children:"Déposer un appareil en réparation"})]})]}),a<5&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-slate-400",children:["Étape ",a+1," / ",N.length]}),e.jsx("p",{className:"text-sm font-semibold text-brand-300",children:N[a]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsxs("div",{className:"depot-form w-[90%] lg:max-w-2xl mx-auto px-4 py-6 flex-1 flex flex-col",children:[a<5&&e.jsx("div",{className:"flex items-center mb-8",children:N.map((t,n)=>e.jsxs("div",{className:"flex-1 flex flex-col items-center relative",children:[n>0&&e.jsx("div",{className:`absolute top-3.5 right-1/2 w-full h-0.5 transition-all duration-500 ${n<=a?"bg-brand-500":"bg-slate-200"}`}),e.jsx("div",{className:`relative z-10 w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold transition-all duration-300 ${n<a?"bg-brand-500 text-white shadow-sm shadow-brand-500/25":n===a?"bg-brand-500 text-white shadow-md shadow-brand-500/30 ring-4 ring-brand-100":"bg-slate-200 text-slate-400"}`,children:n<a?"✓":n+1}),e.jsx("p",{className:`text-[9px] font-medium mt-1.5 text-center ${n<=a?"text-brand-600":"text-slate-400"}`,children:t})]},n))}),a===0&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-sky-50 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Vos coordonnées"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Informations de contact"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom *"}),e.jsx("input",{value:s.nom,onChange:t=>r("nom",t.target.value),className:`input ${c.nom?"border-red-300 focus:border-red-500 focus:ring-red-500/20":""}`,placeholder:"Dupont"}),e.jsx(h,{field:"nom"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prénom"}),e.jsx("input",{value:s.prenom,onChange:t=>r("prenom",t.target.value),className:"input",placeholder:"Jean"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Téléphone *"}),e.jsx("input",{type:"tel",value:s.telephone,onChange:t=>r("telephone",t.target.value),className:`input ${c.telephone?"border-red-300 focus:border-red-500 focus:ring-red-500/20":""}`,placeholder:"06 XX XX XX XX"}),e.jsx(h,{field:"telephone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email"}),e.jsx("input",{type:"email",value:s.email,onChange:t=>r("email",t.target.value),className:`input ${c.email?"border-red-300 focus:border-red-500 focus:ring-red-500/20":""}`,placeholder:"optionnel"}),e.jsx(h,{field:"email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Société"}),e.jsx("input",{value:s.societe,onChange:t=>r("societe",t.target.value),className:"input",placeholder:"optionnel"})]})]}),a===1&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-50 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Type d'appareil"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Sélectionnez la catégorie"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:P.map(t=>e.jsx("button",{onClick:()=>r("categorie",t),className:`p-4 rounded-xl text-sm font-medium border-2 transition-all text-left
                      ${s.categorie===t?"border-brand-500 bg-brand-50 text-brand-700 shadow-sm shadow-brand-500/10":"border-slate-200 hover:border-slate-300 text-slate-700"}`,children:t},t))})]}),a===2&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-50 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Marque & modèle"}),e.jsx("p",{className:"text-xs text-slate-400",children:s.categorie})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Marque *"}),e.jsxs("select",{value:s.marque,onChange:t=>r("marque",t.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Sélectionner..."}),I.map(t=>e.jsx("option",{value:t,children:t},t)),e.jsx("option",{value:"Autre",children:"Autre"})]})]}),s.marque&&s.marque!=="Autre"&&S.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Modèle"}),e.jsxs("select",{value:s.modele,onChange:t=>r("modele",t.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Sélectionner..."}),S.map(t=>e.jsx("option",{value:t,children:t},t)),e.jsx("option",{value:"Autre",children:"Autre"})]})]}),(s.marque==="Autre"||s.modele==="Autre")&&e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Préciser marque / modèle *"}),e.jsx("input",{value:s.modele_autre,onChange:t=>r("modele_autre",t.target.value),className:`input ${c.modele_autre?"border-red-300 focus:border-red-500 focus:ring-red-500/20":""}`,placeholder:"Ex: Samsung Galaxy S24",autoFocus:!0}),e.jsx(h,{field:"modele_autre"})]})]}),a===3&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Le problème"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Décrivez la panne"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Type de panne *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:M.map(t=>e.jsx("button",{onClick:()=>r("panne",t),className:`p-2.5 rounded-lg text-xs font-medium border-2 transition-all text-left
                        ${s.panne===t?"border-brand-500 bg-brand-50 text-brand-700":"border-slate-200 hover:border-slate-300 text-slate-700"}`,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Détails supplémentaires"}),e.jsx("textarea",{value:s.panne_detail,onChange:t=>r("panne_detail",t.target.value),className:"input min-h-[80px] resize-none",placeholder:"Décrivez plus précisément le problème..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Notes"}),e.jsx("textarea",{value:s.notes_client,onChange:t=>r("notes_client",t.target.value),className:"input min-h-[60px] resize-none",placeholder:"Informations complémentaires (accessoires, état cosmétique...)"})]})]}),a===4&&e.jsxs("div",{className:"card p-6 space-y-5 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-50 flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Codes d'accès"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Optionnel — nécessaire pour le diagnostic"})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-3 text-sm text-amber-700",children:"Ces informations sont confidentielles et nécessaires uniquement pour le diagnostic de votre appareil."}),e.jsxs("div",{children:[e.jsxs("label",{className:"input-label flex items-center gap-1.5",children:[e.jsx(A,{className:"w-3 h-3"})," Code PIN / Mot de passe"]}),e.jsx("input",{type:"text",value:s.pin,onChange:t=>r("pin",t.target.value),className:"input text-center text-lg font-mono tracking-widest",placeholder:"••••"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"input-label flex items-center gap-1.5",children:[e.jsx(K,{className:"w-3 h-3"})," Schéma de déverrouillage"]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(F,{value:s.pattern,onChange:t=>r("pattern",t),size:200})})]})]}),a===5&&x&&e.jsxs("div",{className:"card p-8 text-center animate-in",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-emerald-50 flex items-center justify-center mx-auto mb-6",children:e.jsx(k,{className:"w-10 h-10 text-emerald-500"})}),e.jsx("h2",{className:"text-2xl font-display font-bold text-slate-900 mb-2",children:"Demande enregistrée !"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Votre numéro de ticket :"}),e.jsx("div",{className:"bg-brand-50 rounded-xl py-4 px-6 mb-6 border border-brand-100",children:e.jsx("p",{className:"text-3xl font-bold font-mono text-brand-600 tracking-wider",children:x})}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Conservez ce code pour suivre l'avancement de votre réparation."}),p!==null&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto rounded-full border-4 border-slate-200 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-slate-600 font-mono",children:p})}),e.jsxs("p",{className:"text-xs text-slate-400 mt-2",children:["Retour automatique dans ",p,"s"]})]}),e.jsxs("button",{onClick:g,className:"btn-primary w-full text-base py-3",children:[e.jsx(G,{className:"w-5 h-5"})," Nouveau dépôt"]})]}),a<5&&e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx("button",{onClick:()=>a===0?g():m(t=>t-1),className:"btn-secondary",children:a===0?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4"})," Réinitialiser"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4"})," Retour"]})}),e.jsxs("button",{onClick:T,disabled:w||!D(),className:a===4?"btn-primary bg-emerald-600 hover:bg-emerald-700":"btn-primary",children:[w?"Envoi...":a===4?"Confirmer le dépôt":"Suivant",a<4&&e.jsx(J,{className:"w-4 h-4"}),a===4&&e.jsx(k,{className:"w-4 h-4"})]})]})]})})]})}export{te as default};
