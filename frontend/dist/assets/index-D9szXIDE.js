const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardPage-CSmYZcsg.js","assets/vendor-react-DMwujlca.js","assets/vendor-icons-DnXwj2oL.js","assets/TicketDetailPage-DOfObZcM.js","assets/PatternGrid-B-wxvvfm.js","assets/ClientFormPage-wB5eb53O.js","assets/ClientsPage-cFCf56K9.js","assets/CommandesPage-CIr4MCvp.js","assets/AttestationPage-DngdoRkm.js","assets/ConfigPage-ClVqHJSa.js","assets/AdminPage-C-C2INfy.js","assets/vendor-charts-DNuyOzTe.js","assets/TarifsPage-DSre4usB.js","assets/DepotPage-VRcDNJ3O.js","assets/AvisGoogle-CKdszBTT.js","assets/CommunityManager-D9SMgY_T.js","assets/TarifsTelephonesPage-DLSr287c.js"])))=>i.map(i=>d[i]);
import{r as i,a as Ze,u as G,b as et,c as tt,d as Me,B as st,e as at,f as T,N as K,h as nt}from"./vendor-react-DMwujlca.js";import{M as rt,X as te,L as it,U as qe,P as J,F as se,S as lt,a as B,T as xe,C as he,W as z,b as Y,R as pe,c as ot,d as ae,e as ct,f as dt,g as ut,h as X,i as ge,j as fe,I as Fe,k as ne,l as be,B as Z,m as Be,n as mt,o as xt,p as L,q as re,V as ze,r as Ke,A as ie,s as je,t as ht,u as le,v as oe,w as Ve,H as pt,x as gt,y as ft}from"./vendor-icons-DnXwj2oL.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const l of d.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(o){if(o.ep)return;o.ep=!0;const d=s(o);fetch(o.href,d)}})();var Ge={exports:{}},W={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bt=i,jt=Symbol.for("react.element"),vt=Symbol.for("react.fragment"),Nt=Object.prototype.hasOwnProperty,yt=bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wt={key:!0,ref:!0,__self:!0,__source:!0};function Je(a,t,s){var n,o={},d=null,l=null;s!==void 0&&(d=""+s),t.key!==void 0&&(d=""+t.key),t.ref!==void 0&&(l=t.ref);for(n in t)Nt.call(t,n)&&!wt.hasOwnProperty(n)&&(o[n]=t[n]);if(a&&a.defaultProps)for(n in t=a.defaultProps,t)o[n]===void 0&&(o[n]=t[n]);return{$$typeof:jt,type:a,key:d,ref:l,props:o,_owner:yt.current}}W.Fragment=vt;W.jsx=Je;W.jsxs=Je;Ge.exports=W;var e=Ge.exports,ee={},ve=Ze;ee.createRoot=ve.createRoot,ee.hydrateRoot=ve.hydrateRoot;const kt="modulepreload",St=function(a){return"/"+a},Ne={},E=function(t,s,n){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(s.map(c=>{if(c=St(c),c in Ne)return;Ne[c]=!0;const x=c.endsWith(".css"),b=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${b}`))return;const y=document.createElement("link");if(y.rel=x?"stylesheet":kt,x||(y.as="script"),y.crossOrigin="",y.href=c,u&&y.setAttribute("nonce",u),document.head.appendChild(y),x)return new Promise((v,S)=>{y.addEventListener("load",v),y.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${c}`)))})}))}function d(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return o.then(l=>{for(const u of l||[])u.status==="rejected"&&d(u.reason);return t().catch(d)})},F="https://klikphone-sav-v2-production.up.railway.app",ye=F.trim();class Ct{constructor(){this.token=localStorage.getItem("kp_token")||null}setToken(t){this.token=t,t?localStorage.setItem("kp_token",t):localStorage.removeItem("kp_token")}async request(t,s={},n=1e4){const o=`${F}${t}`,d={"Content-Type":"application/json",...s.headers};this.token&&(d.Authorization=`Bearer ${this.token}`);const l=new AbortController,u=setTimeout(()=>l.abort(),n);let c;try{c=await fetch(o,{...s,headers:d,signal:l.signal})}catch(b){throw clearTimeout(u),b.name==="AbortError"?new Error("Connexion au serveur expirÃ©e (timeout)"):b}if(clearTimeout(u),c.status===401)throw this.setToken(null),window.location.href="/",new Error("Non authentifiÃ©");if(!c.ok){const b=await c.json().catch(()=>({}));throw new Error(b.detail||`Erreur ${c.status}`)}if(c.status===204)return null;if(!(c.headers.get("content-type")||"").includes("application/json"))throw new Error("Serveur indisponible (rÃ©ponse non-JSON)");return c.json()}get(t){return this.request(t)}post(t,s){return this.request(t,{method:"POST",body:JSON.stringify(s)})}patch(t,s){return this.request(t,{method:"PATCH",body:JSON.stringify(s)})}put(t,s){return this.request(t,{method:"PUT",body:JSON.stringify(s)})}delete(t){return this.request(t,{method:"DELETE"})}async login(t,s,n){const o=await this.post("/api/auth/login",{pin:t,target:s,utilisateur:n});return this.setToken(o.access_token),localStorage.setItem("kp_target",o.target),localStorage.setItem("kp_user",o.utilisateur),o}logout(){this.setToken(null),localStorage.removeItem("kp_target"),localStorage.removeItem("kp_user")}getTickets(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/tickets${s?"?"+s:""}`)}getTicket(t){return this.get(`/api/tickets/${t}`)}getTicketByCode(t){return this.get(`/api/tickets/code/${t}`)}getTicketsByPhone(t){return this.get(`/api/tickets/phone/${encodeURIComponent(t)}`)}createTicket(t){return this.post("/api/tickets",t)}updateTicket(t,s){return this.patch(`/api/tickets/${t}`,s)}changeStatus(t,s){return this.patch(`/api/tickets/${t}/statut`,{statut:s})}deleteTicket(t){return this.delete(`/api/tickets/${t}`)}getKPI(){return this.get("/api/tickets/stats/kpi")}addNote(t,s){return this.post(`/api/tickets/${t}/note?note=${encodeURIComponent(s)}`)}addHistory(t,s){return this.post(`/api/tickets/${t}/historique?texte=${encodeURIComponent(s)}`)}getHistorique(t){return this.get(`/api/tickets/${t}/historique`)}togglePaye(t){return this.patch(`/api/tickets/${t}/paye`,{})}getClients(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/clients${s?"?"+s:""}`)}getClient(t){return this.get(`/api/clients/${t}`)}getClientByTel(t){return this.get(`/api/clients/tel/${encodeURIComponent(t)}`)}createOrGetClient(t){return this.post("/api/clients",t)}updateClient(t,s){return this.patch(`/api/clients/${t}`,s)}deleteClient(t){return this.delete(`/api/clients/${t}`)}getClientTickets(t){return this.get(`/api/clients/${t}/tickets`)}getCategories(){return this.get("/api/catalog/categories")}getPannes(){return this.get("/api/catalog/pannes")}getMarques(t){return this.get(`/api/catalog/marques?categorie=${encodeURIComponent(t)}`)}getModeles(t,s){return this.get(`/api/catalog/modeles?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}`)}getAllCatalog(){return this.get("/api/catalog/all")}addMarque(t,s){return this.post(`/api/catalog/marques?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}`)}addModele(t,s,n){return this.post(`/api/catalog/modeles?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}&modele=${encodeURIComponent(n)}`)}deleteMarque(t,s){return this.delete(`/api/catalog/marques?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}`)}deleteModele(t,s,n){return this.delete(`/api/catalog/modeles?categorie=${encodeURIComponent(t)}&marque=${encodeURIComponent(s)}&modele=${encodeURIComponent(n)}`)}getTeam(){return this.get("/api/team")}getActiveTeam(){return this.get("/api/team/active")}createTeamMember(t,s){const n=s?`?admin_code=${encodeURIComponent(s)}`:"";return this.post(`/api/team${n}`,t)}updateTeamMember(t,s,n){const o=n?`?admin_code=${encodeURIComponent(n)}`:"";return this.patch(`/api/team/${t}${o}`,s)}deleteTeamMember(t){return this.delete(`/api/team/${t}`)}getParts(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/parts${s?"?"+s:""}`)}getPartsByTicket(t){return this.get(`/api/parts?ticket_id=${t}`)}getPublicCommandes(t){return this.get(`/api/parts/public/${encodeURIComponent(t)}`)}createPart(t){return this.post("/api/parts",t)}createPartAuto(t){return this.post("/api/parts/auto",t)}updatePart(t,s){return this.patch(`/api/parts/${t}`,s)}deletePart(t){return this.delete(`/api/parts/${t}`)}getConfig(){return this.get("/api/config")}getPublicConfig(){return this.get("/api/config/public")}setParam(t,s){return this.put("/api/config",{cle:t,valeur:s})}setParams(t){return this.put("/api/config/batch",t)}changePin(t,s,n){return this.post("/api/config/change-pin",{target:t,old_pin:s,new_pin:n})}testDiscord(){return this.post("/api/config/test-discord")}getBackup(){return this.get("/api/config/backup")}importBackup(t){return this.post("/api/config/backup/import",t)}async exportFile(t,s){const n=`${F}${t}`,o={};this.token&&(o.Authorization=`Bearer ${this.token}`);const d=await fetch(n,{headers:o});if(!d.ok)throw new Error(`Erreur ${d.status}`);const l=await d.blob(),u=URL.createObjectURL(l),c=document.createElement("a");c.href=u,c.download=s,c.click(),URL.revokeObjectURL(u)}exportClientsCsv(){return this.exportFile("/api/clients/export/csv","clients_klikphone.csv")}exportClientsExcel(){return this.exportFile("/api/clients/export/excel","clients_klikphone.xlsx")}getTemplates(){return this.get("/api/notifications/templates")}generateMessage(t,s){return this.post(`/api/notifications/generate-message?ticket_id=${t}&template_key=${s}`)}sendWhatsApp(t,s){return this.post(`/api/notifications/whatsapp?ticket_id=${t}&message=${encodeURIComponent(s)}`)}sendSMS(t,s){return this.post(`/api/notifications/sms?ticket_id=${t}&message=${encodeURIComponent(s)}`)}sendEmail(t,s,n){return this.request(`/api/notifications/email?ticket_id=${t}&message=${encodeURIComponent(s)}&sujet=${encodeURIComponent(n)}`,{method:"POST"},45e3)}getPrintUrl(t,s){return`${F}/api/tickets/${t}/print/${s}`}getPdfUrl(t,s){return`${F}/api/tickets/${t}/pdf/${s}`}getSharePrintUrl(t,s){return`${ye}/api/tickets/${t}/print/${s}`}getSharePdfUrl(t,s){return`${ye}/api/tickets/${t}/pdf/${s}`}sendToCaisse(t){return this.post(`/api/caisse/send?ticket_id=${t}`)}envoyerCaisse(t){return this.post("/api/caisse/envoyer",t)}getCaisseConfig(){return this.get("/api/config/caisse")}saveCaisseConfig(t){return this.put("/api/config/caisse",t)}testCaisseConnexion(){return this.post("/api/config/caisse/test")}envoyerEmail(t,s,n){return this.request("/api/email/envoyer",{method:"POST",body:JSON.stringify({to:t,subject:s,body:n})},45e3)}sendDocument(t,s,n){return this.request("/api/email/send-document",{method:"POST",body:JSON.stringify({ticket_id:t,doc_type:s,to:n})},45e3)}testSmtpEmail(t){return this.request("/api/email/test",{method:"POST",body:JSON.stringify({to:t})},45e3)}generateAttestation(t){return this.post("/api/attestation/generate",t)}emailAttestation(t,s){return this.post(`/api/attestation/email?destinataire=${encodeURIComponent(s)}`,t)}getFidelite(t){return this.get(`/api/fidelite/${t}`)}getFideliteByTicket(t){return this.get(`/api/fidelite/ticket/${t}`)}crediterPoints(t){return this.post("/api/fidelite/crediter",t)}utiliserPoints(t){return this.post("/api/fidelite/utiliser",t)}getGrattage(t){return this.get(`/api/fidelite/grattage/${t}`)}gratter(t){return this.post(`/api/fidelite/grattage/${t}`)}adminLogin(t,s){return this.post("/api/admin/login",{identifiant:t,password:s})}getAdminStats(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/stats${s?"?"+s:""}`)}getAdminReparations(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/reparations${s?"?"+s:""}`)}getAdminFluxClients(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/flux-clients${s?"?"+s:""}`)}getAdminPerformanceTech(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/performance-tech${s?"?"+s:""}`)}getAdminEvolution(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/admin/evolution${s?"?"+s:""}`)}_adminQs(t={}){const s={};t.date_start&&(s.date_start=t.date_start),t.date_end&&(s.date_end=t.date_end);const n=new URLSearchParams(s).toString();return n?"?"+n:""}getAdminOverview(t){return this.get(`/api/admin/stats/overview${this._adminQs(t)}`)}getAdminReparationsParTech(t=7,s={}){const n=this._adminQs(s);return this.get(`/api/admin/stats/reparations-par-tech?days=${t}${n?"&"+n.slice(1):""}`)}getAdminAffluenceHeure(t){return this.get(`/api/admin/stats/affluence-heure${this._adminQs(t)}`)}getAdminAffluenceJour(t){return this.get(`/api/admin/stats/affluence-jour${this._adminQs(t)}`)}getAdminRepartitionMarques(t){return this.get(`/api/admin/stats/repartition-marques${this._adminQs(t)}`)}getAdminRepartitionPannes(t){return this.get(`/api/admin/stats/repartition-pannes${this._adminQs(t)}`)}getAdminEvolutionCA(t){return this.get(`/api/admin/stats/evolution-ca${this._adminQs(t)}`)}getAdminTempsReparation(t){return this.get(`/api/admin/stats/temps-reparation${this._adminQs(t)}`)}getAdminTauxConversion(t){return this.get(`/api/admin/stats/taux-conversion${this._adminQs(t)}`)}getAdminTopClients(t){return this.get(`/api/admin/stats/top-clients${this._adminQs(t)}`)}getMessageTemplates(){return this.get("/api/config/message-templates")}saveMessageTemplates(t){return this.put("/api/config/message-templates",{templates:t})}logMessage(t,s,n,o){return this.post(`/api/tickets/${t}/message-log?auteur=${encodeURIComponent(s)}&contenu=${encodeURIComponent(n)}&canal=${encodeURIComponent(o)}`)}getNotes(t){return this.get(`/api/tickets/${t}/notes`)}addPrivateNote(t,s,n,o=!1){return this.post(`/api/tickets/${t}/notes?auteur=${encodeURIComponent(s)}&contenu=${encodeURIComponent(n)}&important=${o}`)}deleteNote(t,s){return this.delete(`/api/tickets/${t}/notes/${s}`)}toggleNoteImportant(t,s,n){return this.patch(`/api/tickets/${t}/notes/${s}?important=${n}`,{})}chatAI(t,s,n,o){return this.post("/api/chat/ai",{message:t,user:s,conversation_id:n,role:o||""})}clearAIConversation(t){return this.delete(`/api/chat/ai/conversation/${t}`)}chatTeamSend(t,s,n="all"){return this.post("/api/chat/team/send",{message:t,sender:s,recipient:n})}chatTeamMessages(t,s="all",n=50){return this.get(`/api/chat/team/messages?user=${encodeURIComponent(t)}&channel=${s}&limit=${n}`)}chatTeamContacts(t){return this.get(`/api/chat/team/contacts?user=${encodeURIComponent(t)}`)}chatTeamConversation(t,s){return this.get(`/api/chat/team/conversation?user=${encodeURIComponent(t)}&with=${encodeURIComponent(s)}`)}chatTeamMarkRead(t,s){const n=s?`&contact=${encodeURIComponent(s)}`:"";return this.put(`/api/chat/team/read?user=${encodeURIComponent(t)}${n}`)}chatTeamUnread(t){return this.get(`/api/chat/team/unread?user=${encodeURIComponent(t)}`)}chatTeamUnreadTotal(t){return this.get(`/api/chat/team/unread/total?user=${encodeURIComponent(t)}`)}getTarifs(t={}){const s=new URLSearchParams;t.q&&s.set("q",t.q),t.marque&&s.set("marque",t.marque);const n=s.toString();return this.get(`/api/tarifs${n?"?"+n:""}`)}getTarifsStats(){return this.get("/api/tarifs/stats")}importTarifs(t){return this.request("/api/tarifs/import",{method:"POST",body:JSON.stringify({items:t})})}clearTarifs(){return this.request("/api/tarifs/clear",{method:"DELETE"})}toggleTarifStock(t){return this.request(`/api/tarifs/${t}/stock`,{method:"PATCH"})}checkTarifStock(){return this.request("/api/tarifs/check-stock",{method:"POST"},3e5)}getAppleDevices(){return this.get("/api/tarifs/apple-devices")}importAppleDevices(t){return this.request("/api/tarifs/apple-devices/import",{method:"POST",body:JSON.stringify({items:t})})}getAvisGoogle(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/marketing/avis${s?"?"+s:""}`)}getAvisGoogleStats(){return this.get("/api/marketing/avis/stats")}syncAvisGoogle(){return this.post("/api/marketing/avis/sync",{})}genererReponseAvis(t){return this.post(`/api/marketing/avis/${t}/generer-reponse`,{})}publierReponseAvis(t,s){return this.post(`/api/marketing/avis/${t}/publier-reponse`,s)}updateReponseAvis(t,s){return this.put(`/api/marketing/avis/${t}/reponse`,s)}getMarketingPosts(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/marketing/posts${s?"?"+s:""}`)}createMarketingPost(t){return this.post("/api/marketing/posts",t)}updateMarketingPost(t,s){return this.put(`/api/marketing/posts/${t}`,s)}deleteMarketingPost(t){return this.delete(`/api/marketing/posts/${t}`)}publierPost(t){return this.post(`/api/marketing/posts/${t}/publier`,{})}programmerPost(t,s){return this.post(`/api/marketing/posts/${t}/programmer`,s)}genererPost(t){return this.request("/api/marketing/posts/generer",{method:"POST",body:JSON.stringify(t)},6e4)}genererImage(t){return this.request("/api/marketing/posts/generer-image",{method:"POST",body:JSON.stringify(t)},18e4)}getCalendrierMarketing(t={}){const s=new URLSearchParams(t).toString();return this.get(`/api/marketing/calendrier${s?"?"+s:""}`)}createCalendrierEvent(t){return this.post("/api/marketing/calendrier",t)}updateCalendrierEvent(t,s){return this.put(`/api/marketing/calendrier/${t}`,s)}deleteCalendrierEvent(t){return this.delete(`/api/marketing/calendrier/${t}`)}getMarketingTemplates(){return this.get("/api/marketing/templates")}createMarketingTemplate(t){return this.post("/api/marketing/templates",t)}getMarketingAnalytics(){return this.get("/api/marketing/analytics/overview")}getMarketingAnalyticsPosts(){return this.get("/api/marketing/analytics/posts")}getTelephonesCatalogue(t={}){const s=Object.fromEntries(Object.entries(t).filter(([,o])=>o!=null&&o!==""));s.page||(s.page=1),s.limit||(s.limit=24);const n=new URLSearchParams(s).toString();return this.get(`/api/telephones/catalogue${n?"?"+n:""}`)}getTelephoneStats(){return this.get("/api/telephones/stats")}getTelephoneMarques(){return this.get("/api/telephones/marques")}syncTelephones(){return this.request("/api/telephones/sync",{method:"POST"},3e4)}getSyncStatus(){return this.get("/api/telephones/sync-status")}}const C=new Ct,We=i.createContext(null);function _t({children:a}){const[t,s]=i.useState(null),[n,o]=i.useState(!0);i.useEffect(()=>{const c=localStorage.getItem("kp_token"),x=localStorage.getItem("kp_target"),b=localStorage.getItem("kp_user");c&&x&&b?(C.setToken(c),C.get("/api/auth/me").then(y=>{const v=y.role||"";localStorage.setItem("kp_role",v),s({target:x,utilisateur:b,role:v}),o(!1)}).catch(()=>{C.logout(),localStorage.removeItem("kp_role"),s(null),o(!1)})):o(!1)},[]);const d=async(c,x,b)=>{const y=await C.login(c,x,b);try{const v=await C.get("/api/auth/me");localStorage.setItem("kp_role",v.role||""),s({target:y.target,utilisateur:y.utilisateur,role:v.role||""})}catch{s({target:y.target,utilisateur:y.utilisateur,role:""})}return y},l=async c=>{const x=await C.post("/api/auth/switch-user",{utilisateur:c});C.setToken(x.access_token),localStorage.setItem("kp_token",x.access_token),localStorage.setItem("kp_user",x.utilisateur);try{const b=await C.get("/api/auth/me");localStorage.setItem("kp_role",b.role||""),s({target:x.target,utilisateur:x.utilisateur,role:b.role||""})}catch{s({target:x.target,utilisateur:x.utilisateur,role:""})}return x},u=()=>{C.logout(),localStorage.removeItem("kp_role"),s(null)};return e.jsx(We.Provider,{value:{user:t,login:d,logout:u,switchUser:l,loading:n,isAuthenticated:!!t},children:a})}function M(){const a=i.useContext(We);if(!a)throw new Error("useAuth must be used within AuthProvider");return a}const He=i.createContext(null);function $t({children:a}){const[t,s]=i.useState(()=>localStorage.getItem("kp_animations")!=="0");return i.useEffect(()=>{localStorage.setItem("kp_animations",t?"1":"0"),t?document.documentElement.classList.remove("no-animations"):document.documentElement.classList.add("no-animations")},[t]),e.jsx(He.Provider,{value:{animations:t,setAnimations:s},children:a})}function cs(){const a=i.useContext(He);if(!a)throw new Error("useSettings must be used within SettingsProvider");return a}function Tt(){var P,A,w,_;const{user:a,logout:t}=M(),s=G(),n=et(),[o,d]=i.useState(!1),[l,u]=i.useState(()=>localStorage.getItem("kp_sidebar_collapsed")==="1"),[c,x]=i.useState(0),[b,y]=i.useState(()=>localStorage.getItem("kp_marketing_open")==="1"),[v,S]=i.useState(()=>localStorage.getItem("kp_tarifs_open")!=="0"),[g,p]=i.useState(0);i.useEffect(()=>{if(!a)return;const j=()=>{C.getKPI().then(U=>x((U==null?void 0:U.total_actifs)||0)).catch(()=>{}),C.getAvisGoogleStats().then(U=>p((U==null?void 0:U.non_repondus)||0)).catch(()=>{})};j();const I=setInterval(j,3e4);return()=>clearInterval(I)},[a]);const k=()=>{const j=!l;u(j),localStorage.setItem("kp_sidebar_collapsed",j?"1":"0"),window.dispatchEvent(new CustomEvent("sidebar-toggle",{detail:{collapsed:j}}))};if(!a)return null;const r=a.target==="tech"?"/tech":"/accueil",m=a.role==="admin",f=[{path:r,label:"Dashboard",icon:it,badge:c},{path:`${r}/clients`,label:"Clients",icon:qe},{path:`${r}/commandes`,label:"Commandes",icon:J},{path:`${r}/attestation`,label:"Attestation",icon:se},{path:`${r}/config`,label:"Configuration",icon:lt},{path:"/suivi",label:"Suivi client",icon:B}],N=j=>n.pathname===j||n.pathname.startsWith(j+"/"),h=j=>{s(j),d(!1)},$=()=>{s(`/login/${a.target}?switch=1`)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:hidden fixed top-0 left-0 right-0 h-14 bg-slate-900 border-b border-white/10 flex items-center px-4 z-40",children:[e.jsx("button",{onClick:()=>d(!0),className:"p-2 -ml-2 text-slate-400 hover:text-white transition-colors",children:e.jsx(rt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2.5 ml-2",children:[e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-7 h-7 rounded-lg object-contain"}),e.jsx("span",{className:"text-white font-display font-bold tracking-tight",children:"KLIKPHONE"})]}),c>0&&e.jsx("span",{className:"ml-auto bg-brand-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:c})]}),o&&e.jsx("div",{className:"lg:hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-40",onClick:()=>d(!1)}),e.jsxs("aside",{className:`
        fixed top-0 left-0 bottom-0 bg-slate-900 flex flex-col z-50
        transition-all duration-300 ease-in-out
        ${l?"w-[68px]":"w-64"}
        ${o?"translate-x-0":"-translate-x-full"} lg:translate-x-0
      `,children:[e.jsxs("div",{className:"h-16 px-4 flex items-center gap-3 border-b border-white/[0.06] shrink-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white p-1 overflow-hidden shrink-0",children:e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-full h-full object-contain"})}),!l&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-white font-display font-bold text-[15px] tracking-tight leading-none",children:"KLIKPHONE"}),e.jsx("p",{className:"text-slate-500 text-[10px] uppercase tracking-[0.15em] mt-0.5",children:"Service aprÃ¨s-vente"})]}),e.jsx("button",{onClick:()=>d(!1),className:"lg:hidden p-1.5 rounded-lg text-slate-500 hover:text-slate-300 hover:bg-white/5 transition-colors",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs("nav",{className:"flex-1 px-2 py-4 space-y-0.5 overflow-y-auto scrollbar-none",children:[!l&&e.jsx("p",{className:"px-3 mb-2 text-[10px] font-semibold text-slate-500 uppercase tracking-widest",children:"Menu"}),f.map(({path:j,label:I,icon:U,badge:D})=>e.jsxs("button",{onClick:()=>h(j),title:l?I:void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                ${l?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                ${N(j)?`bg-brand-600/20 text-brand-300 ${l?"":"border-l-2 border-brand-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(U,{className:`w-[18px] h-[18px] shrink-0 ${N(j)?"text-brand-400":""}`}),!l&&e.jsx("span",{className:"flex-1 text-left",children:I}),!l&&D>0&&e.jsx("span",{className:"bg-brand-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:D}),l&&D>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-brand-500 text-white text-[8px] font-bold w-4 h-4 rounded-full flex items-center justify-center",children:D>9?"9+":D})]},j)),e.jsxs("div",{className:`pt-4 mt-4 border-t border-white/[0.06] ${l?"px-0":""}`,children:[l?e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(xe,{className:"w-4 h-4",style:{color:"#F59E0B"}})}):e.jsxs("button",{onClick:()=>{const j=!v;S(j),localStorage.setItem("kp_tarifs_open",j?"1":"0")},className:"w-full flex items-center justify-between px-3 mb-2 group",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-[0.12em] flex items-center gap-1.5",style:{color:"#F59E0B"},children:[e.jsx(xe,{className:"w-3 h-3"}),"Tarifs"]}),e.jsx(he,{className:`w-3 h-3 transition-transform duration-200 ${v?"rotate-180":""}`,style:{color:"#F59E0B"}})]}),(v||l)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>h(`${r}/tarifs`),title:l?"RÃ©parations":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                    ${l?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                    ${N(`${r}/tarifs`)?`bg-amber-500/20 text-amber-300 ${l?"":"border-l-2 border-amber-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(z,{className:`w-[18px] h-[18px] shrink-0 ${N(`${r}/tarifs`)?"text-amber-400":""}`}),!l&&e.jsx("span",{className:"flex-1 text-left",children:"RÃ©parations"})]}),e.jsxs("button",{onClick:()=>h(`${r}/tarifs-telephones`),title:l?"TÃ©lÃ©phones":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                    ${l?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                    ${N(`${r}/tarifs-telephones`)?`bg-amber-500/20 text-amber-300 ${l?"":"border-l-2 border-amber-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(Y,{className:`w-[18px] h-[18px] shrink-0 ${N(`${r}/tarifs-telephones`)?"text-amber-400":""}`}),!l&&e.jsx("span",{className:"flex-1 text-left",children:"TÃ©lÃ©phones"})]})]})]}),m&&e.jsxs("div",{className:`pt-4 mt-4 border-t border-white/[0.06] ${l?"px-0":""}`,children:[l?e.jsx("div",{className:"flex justify-center mb-1",children:e.jsx(pe,{className:"w-4 h-4 text-brand-400"})}):e.jsxs("button",{onClick:()=>{const j=!b;y(j),localStorage.setItem("kp_marketing_open",j?"1":"0")},className:"w-full flex items-center justify-between px-3 mb-2 group",children:[e.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-[0.12em] text-brand-400 flex items-center gap-1.5",children:[e.jsx(pe,{className:"w-3 h-3"}),"Marketing"]}),e.jsx(he,{className:`w-3 h-3 text-brand-400 transition-transform duration-200 ${b?"rotate-180":""}`})]}),(b||l)&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>h(`${r}/avis-google`),title:l?"Avis Google":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                      ${l?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                      ${N(`${r}/avis-google`)?`bg-brand-600/20 text-brand-300 ${l?"":"border-l-2 border-brand-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(ot,{className:`w-[18px] h-[18px] shrink-0 ${N(`${r}/avis-google`)?"text-brand-400":""}`}),!l&&e.jsx("span",{className:"flex-1 text-left",children:"Avis Google"}),!l&&g>0&&e.jsx("span",{className:"bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:g}),l&&g>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[8px] font-bold w-4 h-4 rounded-full flex items-center justify-center",children:g>9?"9+":g})]}),e.jsxs("button",{onClick:()=>h(`${r}/community`),title:l?"Community Manager":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                      ${l?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                      ${N(`${r}/community`)?`bg-brand-600/20 text-brand-300 ${l?"":"border-l-2 border-brand-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(ae,{className:`w-[18px] h-[18px] shrink-0 ${N(`${r}/community`)?"text-brand-400":""}`}),!l&&e.jsx("span",{className:"flex-1 text-left",children:"Community Manager"})]})]})]}),m&&e.jsxs("div",{className:`pt-4 mt-4 border-t border-white/[0.06] ${l?"px-0":""}`,children:[!l&&e.jsx("p",{className:"px-3 mb-2 text-[10px] font-semibold text-slate-500 uppercase tracking-widest",children:"Administration"}),e.jsxs("button",{onClick:()=>h(`${r}/admin`),title:l?"Admin":void 0,className:`w-full flex items-center gap-3 rounded-lg text-[13px] font-medium transition-all duration-200
                  ${l?"justify-center px-0 py-2.5":"px-3 py-2.5"}
                  ${n.pathname.includes("/admin")?`bg-amber-500/20 text-amber-300 ${l?"":"border-l-2 border-amber-400 pl-[10px]"}`:"text-slate-400 hover:text-slate-200 hover:bg-white/[0.04]"}`,children:[e.jsx(ct,{className:`w-[18px] h-[18px] shrink-0 ${n.pathname.includes("/admin")?"text-amber-400":"text-amber-500/60"}`}),!l&&e.jsx("span",{children:"Admin"})]})]})]}),e.jsx("div",{className:"hidden lg:block px-2 py-2 border-t border-white/[0.06]",children:e.jsxs("button",{onClick:k,className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-slate-500 hover:text-slate-300 hover:bg-white/[0.04] transition-colors text-xs",title:l?"Ouvrir la barre":"RÃ©duire la barre",children:[l?e.jsx(dt,{className:"w-4 h-4"}):e.jsx(ut,{className:"w-4 h-4"}),!l&&e.jsx("span",{children:"RÃ©duire"})]})}),e.jsx("div",{className:"px-2 py-3 border-t border-white/[0.06] shrink-0",children:l?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-brand-600/20 flex items-center justify-center",children:e.jsx("span",{className:"text-brand-300 font-bold text-sm",children:(A=(P=a.utilisateur)==null?void 0:P.charAt(0))==null?void 0:A.toUpperCase()})}),e.jsx("button",{onClick:$,className:"p-2 rounded-lg text-slate-500 hover:text-brand-400 hover:bg-white/5 transition-colors",title:"Changer d'utilisateur",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{t(),s("/")},className:"p-2 rounded-lg text-slate-500 hover:text-rose-400 hover:bg-white/5 transition-colors",title:"DÃ©connexion",children:e.jsx(ge,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"space-y-2 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-brand-600/20 flex items-center justify-center shrink-0",children:e.jsx("span",{className:"text-brand-300 font-bold text-sm",children:(_=(w=a.utilisateur)==null?void 0:w.charAt(0))==null?void 0:_.toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-200 truncate",children:a.utilisateur}),e.jsxs("p",{className:"text-[11px] text-slate-500 capitalize",children:[a.target,a.role?` Â· ${a.role}`:""]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:$,className:"flex-1 flex items-center justify-center gap-1.5 py-1.5 rounded-lg text-[11px] text-slate-400 hover:text-brand-300 hover:bg-white/5 transition-colors",children:[e.jsx(X,{className:"w-3 h-3"})," Changer"]}),e.jsxs("button",{onClick:()=>{t(),s("/")},className:"flex-1 flex items-center justify-center gap-1.5 py-1.5 rounded-lg text-[11px] text-slate-400 hover:text-rose-400 hover:bg-white/5 transition-colors",children:[e.jsx(ge,{className:"w-3 h-3"})," DÃ©connexion"]})]})]})}),!l&&e.jsxs("div",{style:{textAlign:"center",padding:"12px 0",fontSize:10,color:"#A1A1AA"},children:["PropulsÃ© par"," ",e.jsxs("span",{style:{fontWeight:800,fontSize:11},children:[e.jsx("span",{style:{color:"#7C3AED"},children:"Tk"}),e.jsx("span",{style:{color:"#FAFAFA"},children:"S"}),e.jsx("span",{style:{color:"#EC4899"},children:"âˆž"}),e.jsx("span",{style:{color:"#FAFAFA"},children:"26"})]})," ","â€” une solution"," ",e.jsx("span",{style:{fontWeight:700,color:"#7C3AED"},children:"Klik&Dev"})]})]})]})}const Qe=i.createContext(null),Pt={success:ne,error:fe,info:Fe,warning:fe},we={success:"bg-emerald-50 border-emerald-200 text-emerald-800",error:"bg-red-50 border-red-200 text-red-800",info:"bg-blue-50 border-blue-200 text-blue-800",warning:"bg-amber-50 border-amber-200 text-amber-800"},ke={success:"text-emerald-500",error:"text-red-500",info:"text-blue-500",warning:"text-amber-500"};function Rt({toast:a,onDismiss:t}){const[s,n]=i.useState(!1),o=Pt[a.type]||Fe;return i.useEffect(()=>{const d=setTimeout(()=>{n(!0),setTimeout(()=>t(a.id),300)},a.duration||3e3);return()=>clearTimeout(d)},[a,t]),e.jsxs("div",{className:`flex items-start gap-3 px-4 py-3 rounded-xl border shadow-lg transition-all duration-300 ${we[a.type]||we.info} ${s?"opacity-0 translate-x-8":"opacity-100 translate-x-0"}`,style:{animation:"slideInToast 0.3s ease-out"},children:[e.jsx(o,{className:`w-5 h-5 shrink-0 mt-0.5 ${ke[a.type]||ke.info}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[a.title&&e.jsx("p",{className:"font-semibold text-sm",children:a.title}),e.jsx("p",{className:"text-sm",children:a.message})]}),e.jsx("button",{onClick:()=>{n(!0),setTimeout(()=>t(a.id),300)},className:"p-0.5 rounded hover:bg-black/5 transition-colors shrink-0",children:e.jsx(te,{className:"w-4 h-4"})})]})}function Et({children:a}){const[t,s]=i.useState([]);let n=0;const o=i.useCallback((u,c,x={})=>{const b=Date.now()+n++;s(y=>[...y,{id:b,type:u,message:c,...x}])},[]),d=i.useCallback(u=>{s(c=>c.filter(x=>x.id!==u))},[]),l=i.useCallback({success:(u,c)=>o("success",u,c),error:(u,c)=>o("error",u,c),info:(u,c)=>o("info",u,c),warning:(u,c)=>o("warning",u,c)},[o]);return e.jsxs(Qe.Provider,{value:l,children:[a,e.jsx("div",{className:"fixed top-4 right-4 z-[100] flex flex-col gap-2 w-80 pointer-events-none",children:t.map(u=>e.jsx("div",{className:"pointer-events-auto",children:e.jsx(Rt,{toast:u,onDismiss:d})},u.id))}),e.jsx("style",{children:`
        @keyframes slideInToast {
          from { opacity: 0; transform: translateX(100%); }
          to { opacity: 1; transform: translateX(0); }
        }
      `})]})}function ds(){const a=i.useContext(Qe);return a||{success:()=>{},error:()=>{},info:()=>{},warning:()=>{}}}function ce(){try{const a=new(window.AudioContext||window.webkitAudioContext),t=a.createOscillator(),s=a.createGain();t.connect(s),s.connect(a.destination),t.frequency.value=800,t.type="sine",s.gain.setValueAtTime(.3,a.currentTime),s.gain.exponentialRampToValueAtTime(.01,a.currentTime+.3),t.start(a.currentTime),t.stop(a.currentTime+.3)}catch{}}function V(a){try{return!!JSON.parse(localStorage.getItem("kp_chat_muted")||"{}")[a]}catch{return!1}}function Ye(a){try{const t=JSON.parse(localStorage.getItem("kp_chat_muted")||"{}");return t[a]=!t[a],localStorage.setItem("kp_chat_muted",JSON.stringify(t)),t[a]}catch{return!1}}function At({content:a}){const t=G(),s=localStorage.getItem("kp_target")||"accueil";if(!a)return null;let n=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),n=n.replace(/\/tickets\/(\d+)/g,`<a href="/${s}/ticket/$1" class="text-brand-600 underline font-medium hover:text-brand-700" data-ticket-link="$1">Voir ticket #$1</a>`),n=n.replace(/(KP-\d{6})/g,'<span class="text-brand-600 font-mono font-bold bg-brand-50 px-1 rounded">$1</span>'),n=n.replace(/\n/g,"<br/>");const o=d=>{const l=d.target.closest("[data-ticket-link]");l&&(d.preventDefault(),t(`/${s}/ticket/${l.dataset.ticketLink}`))};return e.jsx("div",{onClick:o,className:"prose-sm break-words [&_strong]:font-bold [&_a]:cursor-pointer",dangerouslySetInnerHTML:{__html:n}})}const It=[{icon:"ðŸ“Š",text:"Combien de tickets en cours ?"},{icon:"ðŸ”",text:"Quels tickets sont en attente de diagnostic ?"},{icon:"ðŸ”§",text:"Comment changer l'ecran d'un iPhone 15 ?"},{icon:"ðŸ’°",text:"Quel est le CA du jour ?"},{icon:"ðŸ“±",text:"Quels tickets sont assignes a Marina ?"}];function Xe(a){return a?new Date(a).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}):""}function Ut(a){if(!a)return"ðŸ”§";const t=a.toLowerCase();return t.includes("manager")?"ðŸ‘”":t.includes("accueil")?"ðŸ“‹":"ðŸ”§"}function Lt(){const[a,t]=i.useState([]),[s,n]=i.useState(""),[o,d]=i.useState(!1),[l,u]=i.useState(null),c=i.useRef(null),x=i.useRef(null),b=localStorage.getItem("kp_user")||"Utilisateur",y=localStorage.getItem("kp_role")||"";i.useEffect(()=>{var g;(g=c.current)==null||g.scrollTo({top:c.current.scrollHeight,behavior:"smooth"})},[a,o]);const v=async g=>{var k;const p=(g||s).trim();if(!(!p||o)){t(r=>[...r,{role:"user",content:p}]),n(""),d(!0);try{const r=await C.chatAI(p,b,l,y);u(r.conversation_id),t(m=>[...m,{role:"assistant",content:r.response}])}catch(r){t(m=>[...m,{role:"assistant",content:`Erreur : ${r.message||"connexion impossible"}`}])}finally{d(!1),(k=x.current)==null||k.focus()}}},S=()=>{l&&C.clearAIConversation(l).catch(()=>{}),t([]),u(null)};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{ref:c,className:"flex-1 overflow-y-auto p-4 space-y-3",children:[a.length===0&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-brand-100 flex items-center justify-center mx-auto mb-3",children:e.jsx(mt,{className:"w-7 h-7 text-brand-600"})}),e.jsx("h3",{className:"font-bold text-slate-700 text-sm",children:"Assistant Klikphone"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1 mb-4",children:"Pose-moi une question technique ou sur la base !"}),e.jsx("div",{className:"space-y-1.5",children:It.map((g,p)=>e.jsxs("button",{onClick:()=>v(g.text),className:"block w-full text-left text-xs px-3 py-2 rounded-lg bg-brand-50 text-brand-700 hover:bg-brand-100 transition",children:[g.icon," ",g.text]},p))})]}),a.map((g,p)=>e.jsxs("div",{className:`flex ${g.role==="user"?"justify-end":"justify-start"}`,children:[g.role==="assistant"&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-100 flex items-center justify-center mr-2 mt-1 shrink-0",children:e.jsx(Z,{className:"w-3.5 h-3.5 text-brand-600"})}),e.jsx("div",{className:`max-w-[85%] rounded-2xl px-3.5 py-2.5 text-sm ${g.role==="user"?"bg-brand-600 text-white rounded-br-md":"bg-slate-100 text-slate-700 rounded-bl-md"}`,children:g.role==="user"?g.content:e.jsx(At,{content:g.content})})]},p)),o&&e.jsxs("div",{className:"flex justify-start",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-brand-100 flex items-center justify-center mr-2 mt-1 shrink-0",children:e.jsx(Z,{className:"w-3.5 h-3.5 text-brand-600"})}),e.jsx("div",{className:"bg-slate-100 rounded-2xl px-4 py-3 rounded-bl-md",children:e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]})]}),e.jsxs("div",{className:"border-t border-slate-200 p-3 bg-white",children:[a.length>0&&e.jsxs("button",{onClick:S,className:"flex items-center gap-1 text-[10px] text-slate-400 hover:text-slate-600 mb-2 transition",children:[e.jsx(xt,{className:"w-3 h-3"})," Nouvelle conversation"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:x,value:s,onChange:g=>n(g.target.value),onKeyDown:g=>g.key==="Enter"&&!g.shiftKey&&v(),placeholder:"Pose une question...",className:`flex-1 px-3 py-2 rounded-xl border border-slate-200 text-sm
                       focus:border-brand-400 focus:ring-2 focus:ring-brand-100 outline-none`,disabled:o}),e.jsx("button",{onClick:()=>v(),disabled:o||!s.trim(),className:`px-3 py-2 bg-brand-600 text-white rounded-xl hover:bg-brand-700
                       disabled:opacity-40 transition shrink-0`,children:o?e.jsx(L,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"})})]})]})]})}function Dt({onReadMessages:a}){const[t,s]=i.useState([]),[n,o]=i.useState(""),[d,l]=i.useState(!1),[u,c]=i.useState(()=>V("general")),x=i.useRef(null),b=i.useRef(null),y=i.useRef(0),v=localStorage.getItem("kp_user")||"Utilisateur",S=i.useCallback(async()=>{try{const p=await C.chatTeamMessages(v,"general");if(p.length>y.current&&y.current>0&&!u){const k=p[p.length-1];k&&k.sender!==v&&ce()}y.current=p.length,s(p)}catch{}},[v,u]);i.useEffect(()=>{S();const p=setInterval(S,5e3);return()=>clearInterval(p)},[S]),i.useEffect(()=>{C.chatTeamMarkRead(v).then(()=>a==null?void 0:a()).catch(()=>{})},[t.length,v,a]),i.useEffect(()=>{var p;(p=x.current)==null||p.scrollTo({top:x.current.scrollHeight,behavior:"smooth"})},[t]);const g=async()=>{var k;const p=n.trim();if(!(!p||d)){l(!0);try{await C.chatTeamSend(p,v,"all"),o(""),S()}catch{}l(!1),(k=b.current)==null||k.focus()}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-slate-50",children:[e.jsxs("span",{className:"text-[10px] text-slate-400",children:[t.length," message(s)"]}),e.jsx("button",{onClick:()=>c(Ye("general")),className:"p-1 rounded hover:bg-slate-100 transition-colors",title:u?"Activer le son":"Couper le son",children:u?e.jsx(ze,{className:"w-3.5 h-3.5 text-slate-400"}):e.jsx(Ke,{className:"w-3.5 h-3.5 text-slate-400"})})]}),e.jsxs("div",{ref:x,className:"flex-1 overflow-y-auto p-3 space-y-2.5",children:[t.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Aucun message pour le moment"})]}),t.map(p=>{const k=p.sender===v,r=p.sender_color||"#94a3b8";return e.jsx("div",{className:`flex ${k?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] ${k?"items-end":"items-start"}`,children:[e.jsxs("div",{className:`flex items-center gap-1 text-[10px] mb-0.5 ${k?"justify-end":""} text-slate-400`,children:[e.jsx("span",{className:"w-2 h-2 rounded-full shrink-0",style:{background:r}}),e.jsx("span",{className:"font-medium",children:p.sender}),e.jsx("span",{children:Xe(p.created_at)})]}),e.jsx("div",{className:`rounded-2xl px-3.5 py-2 text-sm ${k?"bg-brand-600 text-white rounded-br-sm":"bg-slate-100 text-slate-700 rounded-bl-sm"}`,children:p.message})]})},p.id)})]}),e.jsxs("div",{className:"border-t border-slate-200 p-3 bg-white flex gap-2",children:[e.jsx("input",{ref:b,value:n,onChange:p=>o(p.target.value),onKeyDown:p=>p.key==="Enter"&&!p.shiftKey&&g(),placeholder:"Message a tout le monde...",className:`flex-1 px-3 py-2 rounded-xl border border-slate-200 text-sm
                     focus:border-brand-400 focus:ring-2 focus:ring-brand-100 outline-none`,disabled:d}),e.jsx("button",{onClick:g,disabled:d||!n.trim(),className:`px-3 py-2 bg-brand-600 text-white rounded-xl hover:bg-brand-700
                     disabled:opacity-40 transition shrink-0`,children:e.jsx(re,{className:"w-4 h-4"})})]})]})}function Ot({onReadMessages:a}){const[t,s]=i.useState(null),[n,o]=i.useState([]),[d,l]=i.useState([]),[u,c]=i.useState(""),[x,b]=i.useState(!1),[y,v]=i.useState(!1),S=i.useRef(null),g=i.useRef(null),p=i.useRef(0),k=localStorage.getItem("kp_user")||"Utilisateur",r=i.useCallback(async()=>{try{const h=await C.chatTeamContacts(k);o(h)}catch{}},[k]);i.useEffect(()=>{r();const h=setInterval(r,5e3);return()=>clearInterval(h)},[r]);const m=i.useCallback(async h=>{try{const $=await C.chatTeamConversation(k,h);if($.length>p.current&&p.current>0&&!V(`private_${h}`)){const P=$[$.length-1];P&&P.sender!==k&&ce()}p.current=$.length,l($)}catch{}},[k]);i.useEffect(()=>{if(!t)return;v(V(`private_${t}`)),p.current=0,m(t),C.chatTeamMarkRead(k,t).then(()=>{a==null||a(),r()}).catch(()=>{});const h=setInterval(()=>m(t),3e3);return()=>clearInterval(h)},[t,m,k,a,r]),i.useEffect(()=>{var h;(h=S.current)==null||h.scrollTo({top:S.current.scrollHeight,behavior:"smooth"})},[d]);const f=async()=>{var $;const h=u.trim();if(!(!h||!t||x)){b(!0);try{await C.chatTeamSend(h,k,t),c(""),m(t)}catch{}b(!1),($=g.current)==null||$.focus()}};if(!t)return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"px-4 py-3 border-b border-slate-100",children:e.jsxs("h3",{className:"font-semibold text-slate-700 text-sm flex items-center gap-1.5",children:[e.jsx(Be,{className:"w-3.5 h-3.5 text-brand-500"}),"Messages prives"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(qe,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Aucun contact"})]}),n.map(h=>e.jsxs("button",{onClick:()=>s(h.name),className:"w-full flex items-center gap-3 px-4 py-3 hover:bg-slate-50 transition border-b border-slate-50",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shrink-0",style:{background:h.color||"#94a3b8"},children:h.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-semibold text-sm text-slate-700",children:[Ut(h.role)," ",h.name]}),e.jsx("span",{className:"text-[10px] text-slate-400",children:h.last_message_time||""})]}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:h.last_message||"Pas de message"})]}),h.unread>0&&e.jsx("span",{className:"bg-red-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center shrink-0",children:h.unread>9?"9+":h.unread})]},h.name))]})]});const N=n.find(h=>h.name===t);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5 border-b border-slate-100 bg-slate-50/50 shrink-0",children:[e.jsx("button",{onClick:()=>{s(null),l([]),p.current=0},className:"text-slate-400 hover:text-slate-600 transition p-0.5",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-xs shrink-0",style:{background:(N==null?void 0:N.color)||"#94a3b8"},children:t.charAt(0).toUpperCase()}),e.jsx("span",{className:"font-semibold text-sm text-slate-700 flex-1",children:t}),e.jsx("button",{onClick:()=>v(Ye(`private_${t}`)),className:"p-1 rounded hover:bg-slate-100 transition-colors",title:y?"Activer le son":"Couper le son",children:y?e.jsx(ze,{className:"w-3.5 h-3.5 text-slate-400"}):e.jsx(Ke,{className:"w-3.5 h-3.5 text-slate-400"})})]}),e.jsxs("div",{ref:S,className:"flex-1 overflow-y-auto p-3 space-y-2",children:[d.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-xs text-slate-400",children:["Commencez une conversation avec ",t]})}),d.map(h=>{const $=h.sender===k;return e.jsx("div",{className:`flex ${$?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"max-w-[80%]",children:[e.jsx("div",{className:`rounded-2xl px-3.5 py-2.5 text-sm ${$?"bg-brand-600 text-white rounded-br-sm":"bg-slate-100 text-slate-700 rounded-bl-sm"}`,children:h.message}),e.jsx("div",{className:`text-[10px] text-slate-300 mt-0.5 ${$?"text-right":""}`,children:Xe(h.created_at)})]})},h.id)})]}),e.jsxs("div",{className:"border-t border-slate-200 p-3 bg-white flex gap-2 shrink-0",children:[e.jsx("input",{ref:g,value:u,onChange:h=>c(h.target.value),onKeyDown:h=>h.key==="Enter"&&!h.shiftKey&&f(),placeholder:`Message a ${t}...`,className:`flex-1 px-3 py-2 rounded-xl border border-slate-200 text-sm
                     focus:border-brand-400 focus:ring-2 focus:ring-brand-100 outline-none`,disabled:x}),e.jsx("button",{onClick:f,disabled:x||!u.trim(),className:`px-3 py-2 bg-brand-600 text-white rounded-xl hover:bg-brand-700
                     disabled:opacity-40 transition shrink-0`,children:e.jsx(re,{className:"w-4 h-4"})})]})]})}function Mt(){const[a,t]=i.useState(!1),[s,n]=i.useState("ai"),[o,d]=i.useState(0),[l,u]=i.useState(0),c=localStorage.getItem("kp_user")||"Utilisateur",x=i.useRef(0);i.useEffect(()=>{const S=()=>{C.chatTeamUnreadTotal(c).then(p=>{const k=(p.general||0)+(p.private||0);k>x.current&&x.current>=0&&!a&&!V("global")&&ce(),x.current=k,d(p.general||0),u(p.private||0)}).catch(()=>{})};S();const g=setInterval(S,8e3);return()=>clearInterval(g)},[c,a]);const b=o+l,y=i.useCallback(()=>d(0),[]),v=i.useCallback(()=>{C.chatTeamUnreadTotal(c).then(S=>u(S.private||0)).catch(()=>{})},[c]);return e.jsxs(e.Fragment,{children:[!a&&e.jsxs("button",{onClick:()=>t(!0),className:`fixed bottom-5 right-5 z-[100] w-14 h-14 rounded-full bg-brand-600 text-white
                     shadow-lg shadow-brand-600/30 hover:bg-brand-700 hover:scale-105
                     transition-all flex items-center justify-center`,children:[e.jsx(be,{className:"w-6 h-6"}),b>0&&e.jsx("span",{className:`absolute -top-1 -right-1 w-5 h-5 rounded-full bg-red-500 text-white
                           text-[10px] font-bold flex items-center justify-center ring-2 ring-white`,children:b>9?"9+":b})]}),a&&e.jsxs("div",{className:`fixed bottom-5 right-5 z-[100] w-[380px] h-[560px] bg-white rounded-2xl
                     shadow-2xl border border-slate-200 flex flex-col overflow-hidden`,style:{animation:"chatSlideUp 250ms ease-out"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-brand-600 text-white shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),e.jsx("span",{className:"font-display font-bold text-sm",children:"Chat Klikphone"})]}),e.jsx("button",{onClick:()=>t(!1),className:"p-1 rounded-lg hover:bg-white/20 transition",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex border-b border-slate-100 shrink-0",children:[e.jsxs("button",{onClick:()=>n("ai"),className:`flex-1 flex items-center justify-center gap-1 py-2.5 text-[11px] font-medium transition ${s==="ai"?"text-brand-600 border-b-2 border-brand-600 bg-brand-50/30":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(Z,{className:"w-3.5 h-3.5"}),"Assistant"]}),e.jsxs("button",{onClick:()=>n("general"),className:`flex-1 flex items-center justify-center gap-1 py-2.5 text-[11px] font-medium transition relative ${s==="general"?"text-brand-600 border-b-2 border-brand-600 bg-brand-50/30":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(ae,{className:"w-3.5 h-3.5"}),"General",o>0&&s!=="general"&&e.jsx("span",{className:"w-4 h-4 rounded-full bg-red-500 text-white text-[9px] font-bold flex items-center justify-center",children:o>9?"9+":o})]}),e.jsxs("button",{onClick:()=>n("private"),className:`flex-1 flex items-center justify-center gap-1 py-2.5 text-[11px] font-medium transition relative ${s==="private"?"text-brand-600 border-b-2 border-brand-600 bg-brand-50/30":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(Be,{className:"w-3.5 h-3.5"}),"Prive",l>0&&s!=="private"&&e.jsx("span",{className:"w-4 h-4 rounded-full bg-red-500 text-white text-[9px] font-bold flex items-center justify-center",children:l>9?"9+":l})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[s==="ai"&&e.jsx(Lt,{}),s==="general"&&e.jsx(Dt,{onReadMessages:y}),s==="private"&&e.jsx(Ot,{onReadMessages:v})]})]}),e.jsx("style",{children:`
        @keyframes chatSlideUp {
          from { opacity: 0; transform: translateY(20px) scale(0.95); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
      `})]})}function qt(){const a=G(),{user:t,loading:s}=M();if(!s&&t){const n=t.target==="tech"?"/tech":"/accueil";return a(n,{replace:!0}),null}return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-brand-900 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-12",children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-20 h-20 rounded-2xl object-contain shadow-xl shadow-brand-600/20"})}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-display font-extrabold text-white text-center tracking-tight mt-3",children:"KLIKPHONE"}),e.jsx("p",{className:"text-brand-300 text-sm font-medium uppercase tracking-[0.2em] mt-1",children:"SpÃ©cialiste Apple & Multimarque"}),e.jsx("p",{className:"text-slate-400 text-sm mt-3 text-center max-w-md",children:"RÃ©paration smartphones, tablettes, PC portables et consoles. DÃ©posez votre appareil ou suivez votre rÃ©paration."}),e.jsxs("div",{className:"mt-10 w-full max-w-sm space-y-3",children:[e.jsxs("button",{onClick:()=>a("/client"),className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-brand-600 hover:bg-brand-700 text-white shadow-lg shadow-brand-600/30 transition-all group hover:-translate-y-0.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-white/10 flex items-center justify-center shrink-0 backdrop-blur-sm",children:e.jsx("img",{src:"/logo_k.png",alt:"",className:"w-6 h-6 object-contain"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-semibold",children:"DÃ©poser un appareil"}),e.jsx("p",{className:"text-sm text-brand-200 mt-0.5",children:"CrÃ©er un ticket de rÃ©paration"})]}),e.jsx(je,{className:"w-5 h-5 text-brand-200 group-hover:translate-x-1 transition-transform"})]}),e.jsxs("button",{onClick:()=>a("/suivi"),className:"w-full flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 text-white transition-all group backdrop-blur-sm hover:-translate-y-0.5",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-white/10 flex items-center justify-center shrink-0",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"font-semibold",children:"Suivre ma rÃ©paration"}),e.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Avec mon numÃ©ro de ticket"})]}),e.jsx(je,{className:"w-5 h-5 text-slate-500 group-hover:translate-x-1 transition-transform"})]})]}),e.jsxs("div",{className:"mt-12 w-full max-w-sm",children:[e.jsx("p",{className:"text-center text-[11px] text-slate-500 uppercase tracking-widest font-medium mb-3",children:"AccÃ¨s staff"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>a("/login/accueil"),className:"flex items-center justify-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10 text-slate-300 text-sm font-medium hover:bg-white/10 transition-all hover:-translate-y-0.5",children:[e.jsx(ht,{className:"w-4 h-4 text-sky-400"})," Accueil"]}),e.jsxs("button",{onClick:()=>a("/login/tech"),className:"flex items-center justify-center gap-2 p-3 rounded-xl bg-white/5 border border-white/10 text-slate-300 text-sm font-medium hover:bg-white/10 transition-all hover:-translate-y-0.5",children:[e.jsx(z,{className:"w-4 h-4 text-violet-400"})," Technicien"]})]})]})]}),e.jsxs("footer",{className:"py-4 text-center text-xs text-slate-600 flex flex-wrap items-center justify-center gap-2 px-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(le,{className:"w-3 h-3"})," 79 Place Saint LÃ©ger, ChambÃ©ry"]}),e.jsx("span",{className:"hidden sm:block",children:"Â·"}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3 h-3"})," 04 79 60 89 22"]})]})]})}function Ft(){const{target:a}=tt(),[t]=Me(),s=t.get("switch")==="1",{login:n,switchUser:o,user:d}=M(),l=G(),[u,c]=i.useState(["","","",""]),[x,b]=i.useState([]),[y,v]=i.useState(!0),[S,g]=i.useState(""),[p,k]=i.useState(""),[r,m]=i.useState(!1),f=[i.useRef(),i.useRef(),i.useRef(),i.useRef()];i.useEffect(()=>{d&&!s&&l(d.target==="tech"?"/tech":"/accueil")},[d,s]),i.useEffect(()=>{var w;s||(w=f[0].current)==null||w.focus()},[s]),i.useEffect(()=>{C.getActiveTeam().then(w=>{const _=w.map(j=>j.nom.trim());b(_),_.length>0&&g(_[0])}).catch(()=>{b(["Utilisateur"]),g("Utilisateur")}).finally(()=>v(!1))},[]);const N=(w,_)=>{var I;if(!/^\d?$/.test(_))return;const j=[...u];j[w]=_,c(j),_&&w<3&&((I=f[w+1].current)==null||I.focus())},h=(w,_)=>{var j;_.key==="Backspace"&&!u[w]&&w>0&&((j=f[w-1].current)==null||j.focus())},$=async w=>{var j;w==null||w.preventDefault();const _=u.join("");if(!(_.length<4)){k(""),m(!0);try{await n(_,a,S),l(a==="tech"?"/tech":"/accueil")}catch(I){k(I.message||"PIN incorrect"),c(["","","",""]),(j=f[0].current)==null||j.focus()}finally{m(!1)}}},P=async()=>{if(S){k(""),m(!0);try{await o(S),l(a==="tech"?"/tech":"/accueil")}catch(w){k(w.message||"Erreur")}finally{m(!1)}}};i.useEffect(()=>{!s&&u.every(w=>w!=="")&&$()},[u]);const A=a==="accueil";return e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("button",{onClick:()=>l(s?-1:"/"),className:"flex items-center gap-2 text-sm text-slate-400 hover:text-slate-600 mb-8 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4"})," Retour"]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200/60 p-8 animate-in",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-white border border-slate-100 p-1.5 overflow-hidden",children:e.jsx("img",{src:"/logo_k.png",alt:"Klikphone",className:"w-full h-full object-contain"})})}),e.jsx("h1",{className:"text-xl font-display font-bold text-center text-slate-900 mb-1",children:s?"Changer d'utilisateur":A?"Espace Accueil":"Espace Technicien"}),e.jsx("p",{className:"text-sm text-slate-400 text-center mb-8",children:s?"SÃ©lectionnez votre profil":"Entrez votre PIN pour continuer"}),s?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Utilisateur"}),y?e.jsx("div",{className:"input flex items-center justify-center",children:e.jsx(L,{className:"w-4 h-4 animate-spin text-slate-400"})}):e.jsx("select",{value:S,onChange:w=>g(w.target.value),className:"input",children:x.map(w=>e.jsx("option",{value:w,children:w},w))})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl px-4 py-2.5 text-sm text-red-600 font-medium text-center animate-in",children:p}),e.jsx("button",{onClick:P,disabled:r||!S,className:`w-full btn text-white shadow-sm ${A?"bg-sky-500 hover:bg-sky-600":"bg-brand-600 hover:bg-brand-700"}`,children:r?e.jsx(L,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4"})," Continuer"]})})]}):e.jsxs("form",{onSubmit:$,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Utilisateur"}),y?e.jsx("div",{className:"input flex items-center justify-center",children:e.jsx(L,{className:"w-4 h-4 animate-spin text-slate-400"})}):e.jsx("select",{value:S,onChange:w=>g(w.target.value),className:"input",children:x.map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Code PIN"}),e.jsx("div",{className:"flex gap-3 justify-center",children:u.map((w,_)=>e.jsx("input",{ref:f[_],type:"password",inputMode:"numeric",maxLength:1,value:w,onChange:j=>N(_,j.target.value),onKeyDown:j=>h(_,j),className:`w-14 h-14 text-center text-2xl font-bold rounded-xl border-2 border-slate-200 bg-slate-50/50
                        focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 focus:bg-white outline-none transition-all`},_))})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl px-4 py-2.5 text-sm text-red-600 font-medium text-center animate-in",children:p}),e.jsx("button",{type:"submit",disabled:r||u.some(w=>!w),className:`w-full btn text-white shadow-sm ${A?"bg-sky-500 hover:bg-sky-600":"bg-brand-600 hover:bg-brand-700"}`,children:r?e.jsx(L,{className:"w-4 h-4 animate-spin"}):"Se connecter"})]})]}),e.jsxs("div",{className:"text-center text-xs text-slate-400 mt-6 space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Klikphone SAV"}),e.jsxs("p",{className:"flex items-center justify-center gap-1.5",children:[e.jsx(le,{className:"w-3 h-3"})," 79 Place Saint LÃ©ger, ChambÃ©ry"]}),e.jsxs("p",{className:"flex items-center justify-center gap-1.5",children:[e.jsx(oe,{className:"w-3 h-3"})," 04 79 60 89 22"]}),e.jsxs("div",{style:{textAlign:"center",padding:"12px 0",fontSize:10,color:"#A1A1AA"},children:["PropulsÃ© par"," ",e.jsxs("span",{style:{fontWeight:800,fontSize:11},children:[e.jsx("span",{style:{color:"#7C3AED"},children:"Tk"}),e.jsx("span",{style:{color:"#18181B"},children:"S"}),e.jsx("span",{style:{color:"#EC4899"},children:"âˆž"}),e.jsx("span",{style:{color:"#18181B"},children:"26"})]})," ","â€” une solution"," ",e.jsx("span",{style:{fontWeight:700,color:"#7C3AED"},children:"Klik&Dev"})]})]})]})})}function Q(a){if(!a)return"â€”";try{return new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return a}}function us(a){if(!a)return"â€”";try{return new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return a}}function q(a){return a==null?"â€”":`${Number(a).toFixed(2)} â‚¬`}const ms=["En attente de diagnostic","En attente de piÃ¨ce","PiÃ¨ce reÃ§ue","En attente d'accord client","En cours de rÃ©paration","RÃ©paration terminÃ©e","Rendu au client","ClÃ´turÃ©"],Bt={"En attente de diagnostic":{bg:"bg-amber-50",text:"text-amber-700",ring:"ring-amber-200/80",dot:"bg-amber-500",color:"#F59E0B"},"En attente de piÃ¨ce":{bg:"bg-violet-50",text:"text-violet-700",ring:"ring-violet-200/80",dot:"bg-violet-500",color:"#8B5CF6"},"PiÃ¨ce reÃ§ue":{bg:"bg-cyan-50",text:"text-cyan-700",ring:"ring-cyan-200/80",dot:"bg-cyan-500",color:"#06B6D4"},"En attente d'accord client":{bg:"bg-orange-50",text:"text-orange-700",ring:"ring-orange-200/80",dot:"bg-orange-500",color:"#F97316"},"En cours de rÃ©paration":{bg:"bg-blue-50",text:"text-blue-700",ring:"ring-blue-200/80",dot:"bg-blue-500",color:"#3B82F6"},"RÃ©paration terminÃ©e":{bg:"bg-emerald-50",text:"text-emerald-700",ring:"ring-emerald-200/80",dot:"bg-emerald-500",color:"#10B981"},"Rendu au client":{bg:"bg-gray-50",text:"text-gray-600",ring:"ring-gray-200/80",dot:"bg-gray-500",color:"#6B7280"},ClÃ´turÃ©:{bg:"bg-slate-100",text:"text-slate-600",ring:"ring-slate-200/80",dot:"bg-slate-800",color:"#1E293B"}},zt={bg:"bg-slate-100",text:"text-slate-500",ring:"ring-slate-200/80",dot:"bg-slate-400",color:"#94A3B8"};function Kt(a){return Bt[a]||zt}function xs(a,t){let s=a.replace(/\D/g,"");return s.startsWith("0")&&(s="33"+s.slice(1)),`https://wa.me/${s}?text=${encodeURIComponent(t)}`}function hs(a,t){return`sms:${a.replace(/\D/g,"")}?body=${encodeURIComponent(t)}`}const Se=i.memo(function({statut:t,size:s="default"}){const n=Kt(t),o=s==="lg"?"px-3.5 py-1.5 text-sm":"px-2.5 py-1 text-xs";return e.jsxs("span",{className:`inline-flex items-center gap-1.5 rounded-full font-semibold ring-1 transition-colors ${o} ${n.bg} ${n.text} ${n.ring}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${n.dot}`}),t]})}),Ce={Diagnostic:{color:"#F59E0B",bg:"#FEF3C7"},Devis:{color:"#3B82F6",bg:"#DBEAFE"},PiÃ¨ce:{color:"#F97316",bg:"#FFEDD5"},RÃ©paration:{color:"#8B5CF6",bg:"#EDE9FE"},TerminÃ©:{color:"#10B981",bg:"#D1FAE5"},Rendu:{color:"#18181B",bg:"#F4F4F5"}},Vt=[{label:"Diagnostic",icon:B},{label:"Devis",icon:se},{label:"RÃ©paration",icon:z},{label:"TerminÃ©",icon:ne},{label:"Rendu",icon:J}],Gt=[{label:"Diagnostic",icon:B},{label:"Devis",icon:se},{label:"PiÃ¨ce",icon:Ve},{label:"RÃ©paration",icon:z},{label:"TerminÃ©",icon:ne},{label:"Rendu",icon:J}],Jt={"En attente de diagnostic":0,"En attente de piÃ¨ce":1,"PiÃ¨ce reÃ§ue":1,"En attente d'accord client":1,"En cours de rÃ©paration":2,"RÃ©paration terminÃ©e":3,"Rendu au client":4,ClÃ´turÃ©:4},Wt={"En attente de diagnostic":0,"En attente d'accord client":1,"En attente de piÃ¨ce":2,"PiÃ¨ce reÃ§ue":2,"En cours de rÃ©paration":3,"RÃ©paration terminÃ©e":4,"Rendu au client":5,ClÃ´turÃ©:5};function Ht({statut:a,hasPiece:t}){const s=t?Gt:Vt,o=(t?Wt:Jt)[a]??-1;return e.jsx("div",{className:"flex items-center justify-between w-full",children:s.map((d,l)=>{const u=d.icon,c=l<=o,x=l===o,b=Ce[d.label],y=c?{backgroundColor:b.color,color:"#fff",...x?{boxShadow:`0 0 0 4px ${b.bg}, 0 4px 12px ${b.color}30`,transform:"scale(1.15)"}:{boxShadow:`0 2px 6px ${b.color}30`}}:{backgroundColor:"#F4F4F5",color:"#D4D4D8"},v={color:c?b.color:"#A1A1AA"},S=l<o?Ce[d.label].color:"#E4E4E7";return e.jsxs("div",{className:"flex items-center flex-1 last:flex-none",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center transition-all",style:y,children:e.jsx(u,{className:"w-4.5 h-4.5"})}),e.jsx("span",{className:"text-[10px] mt-1.5 font-semibold",style:v,children:d.label})]}),l<s.length-1&&e.jsx("div",{className:"flex-1 h-0.5 mx-2 rounded-full transition-colors",style:{backgroundColor:S}})]},l)})})}function Qt({clientId:a,ticketCode:t,compact:s=!1}){const[n,o]=i.useState(null),[d,l]=i.useState(!0),[u,c]=i.useState(!1);if(i.useEffect(()=>{if(!a&&!t)return;l(!0),(a?C.getFidelite(a):C.getFideliteByTicket(t)).then(o).catch(()=>o(null)).finally(()=>l(!1))},[a,t]),d)return e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(L,{className:"w-5 h-5 animate-spin text-violet-400"})});if(!n||!n.active)return null;const{points:x,total_depense:b,palier_film:y,palier_reduction:v,montant_reduction:S,prochaine_recompense:g,recompenses_disponibles:p,historique:k}=n,r=Math.min(x/y*100,100),m=Math.min(x/v*100,100),f=async N=>{if(u)return;const h=a||n._client_id;if(h){c(!0);try{await C.utiliserPoints({client_id:h,type:N});const $=a?await C.getFidelite(a):await C.getFideliteByTicket(t);o($)}catch($){alert($.message||"Erreur")}finally{c(!1)}}};return s?e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-indigo-50 rounded-xl border border-violet-200/60 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-bold text-violet-700 flex items-center gap-1.5",children:[e.jsx("span",{className:"text-base",children:"â­"})," FidÃ©litÃ©"]}),e.jsxs("span",{className:"text-lg font-extrabold text-violet-600",children:[x," pts"]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-0.5",children:[e.jsx("span",{children:"Film verre trempÃ©"}),e.jsxs("span",{children:[Math.min(x,y)," / ",y.toLocaleString()]})]}),e.jsx("div",{className:"w-full h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-violet-600 rounded-full transition-all duration-500",style:{width:`${r}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mb-0.5",children:[e.jsxs("span",{children:["RÃ©duction ",S,"â‚¬"]}),e.jsxs("span",{children:[Math.min(x,v)," / ",v.toLocaleString()]})]}),e.jsx("div",{className:"w-full h-2 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-full transition-all duration-500",style:{width:`${m}%`}})})]}),g.points_restants>0&&e.jsxs("p",{className:"text-center text-[10px] text-slate-500 mt-2",children:["Plus que ",e.jsxs("strong",{className:"text-violet-600",children:[g.points_restants," pts"]})," pour : ",g.type]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-indigo-50 rounded-xl border border-violet-200 p-5",children:[e.jsxs("h3",{className:"text-sm font-bold text-violet-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:"â­"})," Programme FidÃ©litÃ©"]}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-4xl font-extrabold text-violet-600",children:x.toLocaleString()}),e.jsx("div",{className:"text-sm text-slate-500",children:"points fidÃ©litÃ©"}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1",children:["Total dÃ©pensÃ© : ",b.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsx("span",{children:"Film verre trempÃ©"}),e.jsxs("span",{children:[Math.min(x,y).toLocaleString()," / ",y.toLocaleString()," pts"]})]}),e.jsx("div",{className:"w-full h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-violet-600 rounded-full transition-all duration-500",style:{width:`${r}%`}})}),p.film&&a&&e.jsx("button",{onClick:()=>f("film"),disabled:u,className:"mt-2 w-full py-2 bg-violet-600 text-white rounded-lg text-sm font-semibold hover:bg-violet-700 transition disabled:opacity-50",children:u?e.jsx(L,{className:"w-4 h-4 animate-spin mx-auto"}):"Offrir le film verre trempÃ©"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mb-1",children:[e.jsxs("span",{children:["RÃ©duction ",S,"â‚¬"]}),e.jsxs("span",{children:[Math.min(x,v).toLocaleString()," / ",v.toLocaleString()," pts"]})]}),e.jsx("div",{className:"w-full h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-full transition-all duration-500",style:{width:`${m}%`}})}),p.reduction&&a&&e.jsx("button",{onClick:()=>f("reduction"),disabled:u,className:"mt-2 w-full py-2 bg-emerald-600 text-white rounded-lg text-sm font-semibold hover:bg-emerald-700 transition disabled:opacity-50",children:u?e.jsx(L,{className:"w-4 h-4 animate-spin mx-auto"}):`Utiliser la rÃ©duction ${S}â‚¬`})]}),g.points_restants>0&&e.jsxs("div",{className:"text-center text-xs text-slate-500 bg-white/60 rounded-lg p-2 mt-2",children:["Plus que ",e.jsxs("strong",{className:"text-violet-600",children:[g.points_restants," pts"]})," ","pour obtenir : ",g.type]}),k&&k.length>0&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-violet-200/50",children:[e.jsx("p",{className:"text-[10px] font-semibold text-violet-600 uppercase tracking-wider mb-2",children:"DerniÃ¨res opÃ©rations"}),e.jsx("div",{className:"space-y-1",children:k.slice(0,5).map((N,h)=>e.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[e.jsx("span",{className:"text-slate-600 truncate flex-1",children:N.description}),e.jsxs("span",{className:`font-bold ml-2 ${N.points>0?"text-emerald-600":"text-red-500"}`,children:[N.points>0?"+":"",N.points]})]},h))})]})]})}function Yt({ticketCode:a}){const t=i.useRef(null),[s,n]=i.useState(!1),[o,d]=i.useState(null),[l,u]=i.useState(!0),[c,x]=i.useState(!1),[b,y]=i.useState(10),[v,S]=i.useState(!0),g=i.useRef(!1);i.useEffect(()=>{a&&C.getGrattage(a).then(r=>{if(!r.actif){S(!1);return}y(r.frequence||10),r.deja_gratte&&(d({gagnant:!!r.gain,gain:r.gain,gain_label:r.gain_label,deja_gratte:!0}),n(!0),g.current=!0)}).catch(()=>S(!1)).finally(()=>u(!1))},[a]),i.useEffect(()=>{if(l||s||!v)return;const r=t.current;if(!r)return;const m=r.getContext("2d"),f=m.createLinearGradient(0,0,r.width,r.height);f.addColorStop(0,"#C0C0C0"),f.addColorStop(.5,"#D4D4D4"),f.addColorStop(1,"#A8A8A8"),m.fillStyle=f,m.fillRect(0,0,r.width,r.height),m.fillStyle="rgba(255,255,255,0.15)";for(let N=0;N<5;N++)m.fillRect(N*60,0,20,r.height);m.fillStyle="#888",m.font="bold 18px system-ui, sans-serif",m.textAlign="center",m.fillText("GRATTEZ ICI",r.width/2,r.height/2-10),m.font="12px system-ui, sans-serif",m.fillText("Tentez votre chance !",r.width/2,r.height/2+15)},[l,s,v]);const p=i.useCallback(r=>{var D,de,ue,me;if(g.current)return;const m=t.current;if(!m)return;const f=m.getContext("2d"),N=m.getBoundingClientRect(),h=m.width/N.width,$=m.height/N.height,P=r.clientX??((de=(D=r.touches)==null?void 0:D[0])==null?void 0:de.clientX),A=r.clientY??((me=(ue=r.touches)==null?void 0:ue[0])==null?void 0:me.clientY);if(P==null)return;const w=(P-N.left)*h,_=(A-N.top)*$;f.globalCompositeOperation="destination-out",f.beginPath(),f.arc(w,_,25,0,Math.PI*2),f.fill();const j=f.getImageData(0,0,m.width,m.height);let I=0;for(let H=3;H<j.data.length;H+=4)j.data[H]===0&&I++;I/(j.data.length/4)*100>45&&!g.current&&(g.current=!0,k())},[a]),k=async()=>{n(!0);try{const r=await C.gratter(a);d(r)}catch(r){d({gagnant:!1,error:r.message})}};return l?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(L,{className:"w-5 h-5 animate-spin text-violet-400"})}):v?s&&(o!=null&&o.deja_gratte)?e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-slate-200 p-6 text-center",children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Vous avez dÃ©jÃ  grattÃ© ce ticket"}),o.gain&&e.jsxs("p",{className:"text-lg font-bold text-emerald-600 mt-2",children:[o.gain==="film"?"ðŸŽ":"ðŸ’°"," ",o.gain_label]}),!o.gain&&e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Retentez votre chance au prochain passage !"})]}):e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-violet-200 p-6 text-center shadow-lg",children:[e.jsxs("h3",{className:"text-lg font-bold text-violet-700 mb-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸŽ°"})," Tentez votre chance !"]}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Grattez pour dÃ©couvrir si vous avez gagnÃ©"}),e.jsxs("div",{className:"relative inline-block mx-auto rounded-xl overflow-hidden",style:{width:280,height:140},children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{background:s?o!=null&&o.gagnant?"linear-gradient(135deg, #fbbf24, #f59e0b)":"#f1f5f9":"#e2e8f0"},children:s?o!=null&&o.gagnant?e.jsxs("div",{className:"text-center",style:{animation:"bounceIn 0.5s ease-out"},children:[e.jsx("div",{className:"text-4xl mb-1",children:"ðŸŽ‰"}),e.jsx("div",{className:"text-lg font-extrabold text-white",children:"GAGNÃ‰ !"}),e.jsxs("div",{className:"text-sm font-semibold text-white/90",children:[o.gain==="film"?"ðŸŽ":"ðŸ’°"," ",o.gain_label]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-1",children:"ðŸ˜Š"}),e.jsx("div",{className:"text-sm font-semibold text-slate-500",children:"Pas cette fois !"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Retentez au prochain passage"})]}):e.jsx("div",{className:"text-xs text-slate-400",children:"?"})}),!s&&e.jsx("canvas",{ref:t,width:280,height:140,className:"absolute inset-0 cursor-pointer",style:{touchAction:"none"},onMouseDown:()=>x(!0),onMouseUp:()=>x(!1),onMouseLeave:()=>x(!1),onMouseMove:r=>c&&p(r),onTouchStart:()=>x(!0),onTouchEnd:()=>x(!1),onTouchMove:r=>p(r)})]}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-3",children:["1 chance sur ",b," de gagner un film verre trempÃ© ou une rÃ©duction"]}),e.jsx("style",{children:`
        @keyframes bounceIn {
          0% { transform: scale(0.3); opacity: 0; }
          50% { transform: scale(1.05); }
          70% { transform: scale(0.9); }
          100% { transform: scale(1); opacity: 1; }
        }
      `})]}):null}function Xt(){const[a]=Me(),[t,s]=i.useState(a.get("ticket")||a.get("tel")||""),[n,o]=i.useState(null),[d,l]=i.useState([]),[u,c]=i.useState([]),[x,b]=i.useState(""),[y,v]=i.useState(!1),S=r=>/^\+?\d[\d\s.-]{5,}$/.test(r.trim()),g=i.useCallback(async r=>{const m=(r||t).trim();if(m){v(!0),b(""),o(null),l([]);try{if(S(m)){const f=await C.getTicketsByPhone(m.replace(/[\s.-]/g,""));if(f.length===0)b("Aucun ticket trouvÃ© avec ce numÃ©ro.");else if(f.length===1){const N=await C.getTicketByCode(f[0].ticket_code);o(N),C.getPublicCommandes(N.ticket_code).then(c).catch(()=>c([]))}else l(f)}else{const f=await C.getTicketByCode(m.toUpperCase());o(f),C.getPublicCommandes(f.ticket_code).then(c).catch(()=>c([]))}}catch{b("Aucun ticket trouvÃ©.")}finally{v(!1)}}},[t]);i.useEffect(()=>{const r=a.get("ticket")||a.get("tel");r&&g(r)},[]);const p=r=>{r==null||r.preventDefault(),g()},k=async r=>{v(!0);try{const m=await C.getTicketByCode(r);o(m),l([]),C.getPublicCommandes(m.ticket_code).then(c).catch(()=>c([]))}catch{b("Erreur de chargement du ticket.")}finally{v(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-brand-50/30",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8 animate-in",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-brand-600 flex items-center justify-center mx-auto mb-4 shadow-lg shadow-brand-600/20",children:e.jsx(Y,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900",children:"Suivi de rÃ©paration"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Entrez votre code ticket ou numÃ©ro de tÃ©lÃ©phone"})]}),e.jsxs("form",{onSubmit:p,className:"flex gap-2 mb-8",children:[e.jsx("input",{type:"text",value:t,onChange:r=>s(r.target.value),placeholder:"KP-000001 ou 06 12 34 56 78",className:"input flex-1 text-center font-mono text-lg font-bold tracking-wider",autoFocus:!0}),e.jsx("button",{type:"submit",disabled:y,className:"btn-primary px-5",children:e.jsx(B,{className:"w-5 h-5"})})]}),x&&e.jsxs("div",{className:"card p-6 text-center animate-in",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-50 flex items-center justify-center mx-auto mb-3",children:e.jsx(Y,{className:"w-6 h-6 text-red-300"})}),e.jsx("p",{className:"text-red-500 font-medium",children:x})]}),d.length>0&&e.jsxs("div",{className:"card overflow-hidden animate-in mb-5",children:[e.jsx("div",{className:"px-5 py-3 bg-slate-50/80 border-b border-slate-100",children:e.jsxs("p",{className:"text-sm font-semibold text-slate-700",children:[d.length," ticket(s) trouvÃ©(s)"]})}),e.jsx("div",{className:"divide-y divide-slate-100",children:d.map(r=>e.jsxs("button",{onClick:()=>k(r.ticket_code),className:"w-full flex items-center gap-3 px-5 py-3.5 hover:bg-brand-50/40 transition-colors text-left",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-brand-50 flex items-center justify-center shrink-0",children:e.jsx(pt,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-bold text-brand-600 font-mono",children:r.ticket_code}),e.jsxs("p",{className:"text-xs text-slate-500 truncate",children:[r.marque," ",r.modele||r.modele_autre," â€” ",r.panne]})]}),e.jsx(Se,{statut:r.statut})]},r.ticket_code))})]}),n&&e.jsxs("div",{className:"space-y-5 animate-in",children:[e.jsx("div",{className:"card p-5",children:e.jsx(Ht,{statut:n.statut,hasPiece:n.commande_piece===1})}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold font-mono text-brand-600",children:n.ticket_code}),e.jsx(Se,{statut:n.statut})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:"Appareil"}),e.jsxs("p",{className:"font-medium text-slate-800",children:[n.marque," ",n.modele||n.modele_autre]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:"Panne"}),e.jsx("p",{className:"font-medium text-slate-800",children:n.panne})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:"DÃ©posÃ© le"}),e.jsx("p",{className:"font-medium text-slate-800",children:Q(n.date_depot)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:"DerniÃ¨re mise Ã  jour"}),e.jsx("p",{className:"font-medium text-slate-800",children:Q(n.date_maj)})]})]}),n.date_recuperation&&(()=>{const r=new Date(n.date_recuperation),m=!isNaN(r.getTime()),f=new Date;let N="";if(m&&r>f){const $=r-f,P=Math.floor($/864e5),A=Math.floor($%864e5/36e5);N=P>0?`dans ${P}j ${A}h`:`dans ${A}h`}else m&&r<=f&&(N="Date dÃ©passÃ©e");const h=m?r.toLocaleString("fr-FR",{weekday:"long",day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"}):n.date_recuperation;return e.jsxs("div",{className:`mt-4 flex items-center gap-2 p-3 rounded-lg ${m&&r<=f?"bg-red-50 border border-red-100":"bg-blue-50 border border-blue-100"}`,children:[e.jsx(gt,{className:`w-4 h-4 shrink-0 ${m&&r<=f?"text-red-500":"text-blue-500"}`}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:`font-medium ${m&&r<=f?"text-red-600":"text-blue-600"}`,children:"RÃ©cupÃ©ration prÃ©vue : "}),e.jsx("span",{className:`font-bold ${m&&r<=f?"text-red-800":"text-blue-800"}`,children:h}),N&&e.jsxs("span",{className:`ml-2 text-xs font-semibold ${m&&r<=f?"text-red-500":"text-emerald-600"}`,children:["(",N,")"]})]})]})})(),(()=>{let r=[];try{const f=JSON.parse(n.reparation_supp||"[]");Array.isArray(f)&&(r=f.filter(N=>N.label))}catch{}return n.panne_detail||r.length>0?e.jsxs("div",{className:"mt-4 p-3 bg-slate-50 border border-slate-100 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-600 font-semibold mb-2",children:[e.jsx(z,{className:"w-3.5 h-3.5"}),"DÃ©tail rÃ©paration"]}),n.panne_detail&&e.jsx("p",{className:"text-slate-600 text-xs mb-1",children:n.panne_detail}),r.length>0&&e.jsx("p",{className:"text-slate-600 text-xs",children:r.map(f=>f.label).join(" + ")})]}):null})(),(()=>{let r=[];try{const _=JSON.parse(n.reparation_supp||"[]");Array.isArray(_)&&(r=_.filter(j=>j.label))}catch{}let m=[];if(r.length>0)m=r.map(_=>({label:_.label,prix:Number(_.prix||0)}));else{const _=Number(n.devis_estime||0);_>0&&m.push({label:n.panne||"RÃ©paration",prix:_});const j=Number(n.prix_supp||0);n.reparation_supp&&j>0&&m.push({label:n.reparation_supp,prix:j})}const f=m.reduce((_,j)=>_+j.prix,0);if(f<=0)return null;const N=Number(n.acompte||0),h=Number(n.reduction_pourcentage||0),$=Number(n.reduction_montant||0),P=h>0?f*(h/100):$,A=Math.max(0,f-P),w=A-N;return e.jsxs("div",{className:"mt-4 p-3 bg-emerald-50 border border-emerald-100 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-700 font-semibold mb-2",children:[e.jsx(ft,{className:"w-3.5 h-3.5"}),"Tarification"]}),e.jsxs("div",{className:"space-y-1",children:[m.map((_,j)=>e.jsxs("div",{className:"flex justify-between text-slate-700",children:[e.jsx("span",{children:_.label}),e.jsx("span",{className:"font-medium",children:q(_.prix)})]},j)),P>0&&e.jsxs("div",{className:"flex justify-between text-emerald-600 text-xs",children:[e.jsxs("span",{children:["RÃ©duction",h>0?` (${h}%)`:""]}),e.jsxs("span",{children:["- ",q(P)]})]}),e.jsxs("div",{className:"border-t border-emerald-200 pt-1 mt-1 flex justify-between font-bold text-emerald-800",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:q(A)})]}),N>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-slate-500 text-xs",children:[e.jsx("span",{children:"Acompte versÃ©"}),e.jsxs("span",{children:["- ",q(N)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-emerald-900",children:[e.jsx("span",{children:"Reste Ã  payer"}),e.jsx("span",{children:q(w)})]})]})]})]})})(),n.commentaire_client&&e.jsxs("div",{className:"mt-4 p-3 bg-brand-50 border border-brand-100 rounded-lg text-sm text-brand-800",children:[e.jsx("span",{className:"font-semibold",children:"Message :"})," ",n.commentaire_client]})]}),u.map(r=>{const m=r.statut==="ReÃ§ue";return["RÃ©paration terminÃ©e","Rendu au client","ClÃ´turÃ©"].includes(n.statut)?null:m?e.jsxs("div",{className:"card p-5 bg-green-50 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(J,{className:"w-4 h-4 text-green-600"})}),e.jsx("span",{className:"font-bold text-sm text-green-800",children:"PiÃ¨ce reÃ§ue"})]}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:r.piece}),r.date_reception&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["ReÃ§ue le ",Q(r.date_reception)]}),e.jsx("div",{className:"text-xs text-slate-500 mt-2",children:"La rÃ©paration de votre appareil va Ãªtre lancÃ©e rapidement."})]},r.id):e.jsxs("div",{className:"card p-5 bg-amber-50 border border-amber-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(Ve,{className:"w-4 h-4 text-amber-600"})}),e.jsx("span",{className:"font-bold text-sm text-amber-800",children:"PiÃ¨ce en cours d'acheminement"})]}),e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:r.piece}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full ${r.statut==="En attente"?"bg-amber-100 text-amber-700":r.statut==="CommandÃ©e"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:r.statut==="En attente"?"En attente de commande":r.statut==="CommandÃ©e"?"CommandÃ©e":"ExpÃ©diÃ©e"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-2",children:"Nous vous prÃ©viendrons dÃ¨s rÃ©ception pour lancer la rÃ©paration."})]},r.id)}),e.jsx(Qt,{ticketCode:n.ticket_code,compact:!0}),e.jsx(Yt,{ticketCode:n.ticket_code}),e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Une question sur votre rÃ©paration ?"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-lg font-bold text-slate-900",children:[e.jsx(oe,{className:"w-5 h-5 text-brand-600"}),"04 79 60 89 22"]}),e.jsxs("div",{className:"flex items-center justify-center gap-1.5 text-xs text-slate-400 mt-2",children:[e.jsx(le,{className:"w-3 h-3"}),"79 Place Saint LÃ©ger, ChambÃ©ry"]})]})]}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsxs("a",{href:"/",className:"inline-flex items-center gap-2 text-sm text-slate-400 hover:text-slate-600 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4"})," Retour Ã  l'accueil"]}),e.jsxs("div",{style:{textAlign:"center",padding:"12px 0",fontSize:10,color:"#A1A1AA"},children:["PropulsÃ© par"," ",e.jsxs("span",{style:{fontWeight:800,fontSize:11},children:[e.jsx("span",{style:{color:"#7C3AED"},children:"Tk"}),e.jsx("span",{style:{color:"#18181B"},children:"S"}),e.jsx("span",{style:{color:"#EC4899"},children:"âˆž"}),e.jsx("span",{style:{color:"#18181B"},children:"26"})]})," ","â€” une solution"," ",e.jsx("span",{style:{fontWeight:700,color:"#7C3AED"},children:"Klik&Dev"})]})]})]})})}const _e=i.lazy(()=>E(()=>import("./DashboardPage-CSmYZcsg.js"),__vite__mapDeps([0,1,2]))),$e=i.lazy(()=>E(()=>import("./TicketDetailPage-DOfObZcM.js"),__vite__mapDeps([3,1,4,2]))),Zt=i.lazy(()=>E(()=>import("./ClientFormPage-wB5eb53O.js"),__vite__mapDeps([5,1,4,2]))),Te=i.lazy(()=>E(()=>import("./ClientsPage-cFCf56K9.js"),__vite__mapDeps([6,1,2]))),Pe=i.lazy(()=>E(()=>import("./CommandesPage-CIr4MCvp.js"),__vite__mapDeps([7,1,2]))),Re=i.lazy(()=>E(()=>import("./AttestationPage-DngdoRkm.js"),__vite__mapDeps([8,1,2]))),Ee=i.lazy(()=>E(()=>import("./ConfigPage-ClVqHJSa.js"),__vite__mapDeps([9,1,2]))),Ae=i.lazy(()=>E(()=>import("./AdminPage-C-C2INfy.js"),__vite__mapDeps([10,1,2,11]))),Ie=i.lazy(()=>E(()=>import("./TarifsPage-DSre4usB.js"),__vite__mapDeps([12,1,2]))),es=i.lazy(()=>E(()=>import("./DepotPage-VRcDNJ3O.js"),__vite__mapDeps([13,1,4,2]))),Ue=i.lazy(()=>E(()=>import("./AvisGoogle-CKdszBTT.js"),__vite__mapDeps([14,1,2]))),Le=i.lazy(()=>E(()=>import("./CommunityManager-D9SMgY_T.js"),__vite__mapDeps([15,1,2]))),De=i.lazy(()=>E(()=>import("./TarifsTelephonesPage-DLSr287c.js"),__vite__mapDeps([16,1,2]))),Oe=()=>{E(()=>import("./DashboardPage-CSmYZcsg.js"),__vite__mapDeps([0,1,2])),E(()=>import("./TarifsPage-DSre4usB.js"),__vite__mapDeps([12,1,2])),E(()=>import("./ClientsPage-cFCf56K9.js"),__vite__mapDeps([6,1,2]))};typeof window<"u"&&("requestIdleCallback"in window?window.requestIdleCallback(Oe):setTimeout(Oe,2e3));function ts({children:a,allowedTargets:t}){const{user:s,loading:n}=M(),[o,d]=i.useState(()=>localStorage.getItem("kp_sidebar_collapsed")==="1");return i.useEffect(()=>{const l=u=>d(u.detail.collapsed);return window.addEventListener("sidebar-toggle",l),()=>window.removeEventListener("sidebar-toggle",l)},[]),n?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-slate-400 font-medium",children:"Chargement..."})]})}):s?t&&!t.includes(s.target)?e.jsx(K,{to:"/",replace:!0}):e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx(Tt,{}),e.jsx("main",{className:`pt-14 lg:pt-0 min-h-screen transition-all duration-300 ${o?"lg:pl-[68px]":"lg:pl-64"}`,children:a})]}):e.jsx(K,{to:"/",replace:!0})}const R=({children:a,targets:t})=>e.jsx(ts,{allowedTargets:t,children:a});function ss({children:a}){const{user:t,loading:s}=M();return s?null:!t||t.role!=="admin"?e.jsx(K,{to:`/${(t==null?void 0:t.target)||""}`,replace:!0}):a}const O=({children:a,targets:t})=>e.jsx(R,{targets:t,children:e.jsx(ss,{children:a})});function as(){const{user:a}=M();return a?e.jsx(Mt,{}):null}const ns=()=>e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",children:e.jsx("div",{className:"w-6 h-6 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"})});function rs(){return e.jsxs(i.Suspense,{fallback:e.jsx(ns,{}),children:[e.jsxs(at,{children:[e.jsx(T,{path:"/",element:e.jsx(qt,{})}),e.jsx(T,{path:"/login/:target",element:e.jsx(Ft,{})}),e.jsx(T,{path:"/client",element:e.jsx(Zt,{})}),e.jsx(T,{path:"/depot",element:e.jsx(es,{})}),e.jsx(T,{path:"/suivi",element:e.jsx(Xt,{})}),e.jsx(T,{path:"/accueil",element:e.jsx(R,{targets:["accueil"],children:e.jsx(_e,{})})}),e.jsx(T,{path:"/accueil/ticket/:id",element:e.jsx(R,{targets:["accueil"],children:e.jsx($e,{})})}),e.jsx(T,{path:"/accueil/clients",element:e.jsx(R,{targets:["accueil"],children:e.jsx(Te,{})})}),e.jsx(T,{path:"/accueil/commandes",element:e.jsx(R,{targets:["accueil"],children:e.jsx(Pe,{})})}),e.jsx(T,{path:"/accueil/attestation",element:e.jsx(R,{targets:["accueil"],children:e.jsx(Re,{})})}),e.jsx(T,{path:"/accueil/config",element:e.jsx(R,{targets:["accueil"],children:e.jsx(Ee,{})})}),e.jsx(T,{path:"/accueil/tarifs",element:e.jsx(R,{targets:["accueil"],children:e.jsx(Ie,{})})}),e.jsx(T,{path:"/accueil/tarifs-telephones",element:e.jsx(R,{targets:["accueil"],children:e.jsx(De,{})})}),e.jsx(T,{path:"/accueil/avis-google",element:e.jsx(O,{targets:["accueil"],children:e.jsx(Ue,{})})}),e.jsx(T,{path:"/accueil/community",element:e.jsx(O,{targets:["accueil"],children:e.jsx(Le,{})})}),e.jsx(T,{path:"/accueil/admin",element:e.jsx(O,{targets:["accueil"],children:e.jsx(Ae,{})})}),e.jsx(T,{path:"/tech",element:e.jsx(R,{targets:["tech"],children:e.jsx(_e,{})})}),e.jsx(T,{path:"/tech/ticket/:id",element:e.jsx(R,{targets:["tech"],children:e.jsx($e,{})})}),e.jsx(T,{path:"/tech/clients",element:e.jsx(R,{targets:["tech"],children:e.jsx(Te,{})})}),e.jsx(T,{path:"/tech/commandes",element:e.jsx(R,{targets:["tech"],children:e.jsx(Pe,{})})}),e.jsx(T,{path:"/tech/attestation",element:e.jsx(R,{targets:["tech"],children:e.jsx(Re,{})})}),e.jsx(T,{path:"/tech/config",element:e.jsx(R,{targets:["tech"],children:e.jsx(Ee,{})})}),e.jsx(T,{path:"/tech/tarifs",element:e.jsx(R,{targets:["tech"],children:e.jsx(Ie,{})})}),e.jsx(T,{path:"/tech/tarifs-telephones",element:e.jsx(R,{targets:["tech"],children:e.jsx(De,{})})}),e.jsx(T,{path:"/tech/avis-google",element:e.jsx(O,{targets:["tech"],children:e.jsx(Ue,{})})}),e.jsx(T,{path:"/tech/community",element:e.jsx(O,{targets:["tech"],children:e.jsx(Le,{})})}),e.jsx(T,{path:"/tech/admin",element:e.jsx(O,{targets:["tech"],children:e.jsx(Ae,{})})}),e.jsx(T,{path:"*",element:e.jsx(K,{to:"/",replace:!0})})]}),e.jsx(as,{})]})}function is(){return e.jsx(st,{children:e.jsx($t,{children:e.jsx(_t,{children:e.jsx(Et,{children:e.jsx(rs,{})})})})})}ee.createRoot(document.getElementById("root")).render(e.jsx(nt.StrictMode,{children:e.jsx(is,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});export{Qt as F,Ht as P,ms as S,C as a,q as b,ds as c,Se as d,Q as e,us as f,Kt as g,cs as h,e as j,hs as s,M as u,xs as w};
