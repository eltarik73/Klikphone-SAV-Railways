import{u as se,d as te,c as h,j as e,w as ae}from"./index-CciZrgyL.js";import{u as le,r as a}from"./vendor-react-DMwujlca.js";import{U as ne,S as O,am as re,q as U,X as ie,a4 as _,c as ce,C as A,l as oe,F as G,$ as de,N as me,n as ue}from"./vendor-icons-mT05O4Nk.js";function k(m){return(m||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function je(){const{user:m}=se();le();const u=te();m==null||m.target;const[i,T]=a.useState("new"),[c,f]=a.useState(""),[I,w]=a.useState([]),[M,P]=a.useState(!1),[z,C]=a.useState(!1),[r,$]=a.useState(null),y=a.useRef(null),[t,S]=a.useState({nom:"",prenom:"",adresse:"",marque:"",modele:"",imei:"",etat:"",motif:"",compte_rendu:""}),[x,p]=a.useState(""),[j,g]=a.useState(""),[d,B]=a.useState(""),[L,R]=a.useState(!1),[b,D]=a.useState(!1),[H]=a.useState(["Smartphone","Tablette","PC Portable","Console","Autre"]),[o,K]=a.useState("Smartphone"),[W,F]=a.useState([]),[V,N]=a.useState([]),X=["Bon état","Écran cassé","Traces d'oxydation","Très endommagé","Autre"],n=(s,l)=>S(v=>({...v,[s]:l}));a.useEffect(()=>{o&&(h.getMarques(o).then(F).catch(()=>F([])),N([]))},[o]),a.useEffect(()=>{if(!o||!t.marque){N([]);return}h.getModeles(o,t.marque).then(N).catch(()=>N([]))},[o,t.marque]),a.useEffect(()=>{if(i!=="existing"||c.length<2){w([]);return}const s=setTimeout(async()=>{P(!0);try{const l=await h.getClients({search:c,limit:10});w(l),C(!0)}catch{w([])}finally{P(!1)}},300);return()=>clearTimeout(s)},[c,i]),a.useEffect(()=>{const s=l=>{y.current&&!y.current.contains(l.target)&&C(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const J=s=>{$(s),S(l=>({...l,nom:s.nom||"",prenom:s.prenom||""})),p(s.email||""),g(s.telephone||""),f(`${s.prenom||""} ${s.nom||""}`.trim()),C(!1)},q=()=>{$(null),f(""),S(s=>({...s,nom:"",prenom:""})),p(""),g("")},Q=async()=>{R(!0);try{const s=await h.generateAttestation(t);B(s.html),u.success("Attestation générée")}catch{u.error("Erreur génération")}finally{R(!1)}},Y=()=>{if(!d)return;const s=window.open("","_blank");s.document.write(d),s.document.close(),setTimeout(()=>s.print(),300)},Z=async()=>{if(!(!x||!d))try{await h.emailAttestation(t,x),D(!0),u.success("Email envoyé"),setTimeout(()=>D(!1),3e3)}catch{u.error("Erreur envoi email")}},ee=()=>{const s=j||"";if(!s){u.error("Pas de numéro de téléphone");return}const l=`Bonjour ${t.prenom},

Veuillez trouver ci-joint l'attestation de non-réparabilité de votre appareil ${t.marque} ${t.modele}.

Cordialement,
KLIKPHONE - 04 79 60 89 22`;window.open(ae(s,l),"_blank")},E=I.filter(s=>{const l=k(c);return k(s.nom).includes(l)||k(s.prenom).includes(l)||(s.telephone||"").includes(c)});return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 max-w-6xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight",children:"Attestation de non-réparabilité"}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:"Générez un document officiel A4 pour les appareils irréparables"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:e.jsx(ne,{className:"w-4 h-4 text-blue-600"})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Client"})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>{T("existing"),q()},className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-sm font-medium border-2 transition-all
                  ${i==="existing"?"border-brand-500 bg-brand-50 text-brand-700":"border-slate-200 text-slate-600 hover:border-slate-300"}`,children:[e.jsx(O,{className:"w-4 h-4"})," Client existant"]}),e.jsxs("button",{onClick:()=>{T("new"),q()},className:`flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-sm font-medium border-2 transition-all
                  ${i==="new"?"border-brand-500 bg-brand-50 text-brand-700":"border-slate-200 text-slate-600 hover:border-slate-300"}`,children:[e.jsx(re,{className:"w-4 h-4"})," Nouveau client"]})]}),i==="existing"&&e.jsxs("div",{className:"mb-4",ref:y,children:[e.jsx("label",{className:"input-label",children:"Rechercher un client"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{value:c,onChange:s=>f(s.target.value),className:"input pl-9 pr-8",placeholder:"Nom, prénom ou téléphone..."}),M&&e.jsx(U,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 animate-spin"}),r&&e.jsx("button",{onClick:q,className:"absolute right-3 top-1/2 -translate-y-1/2 p-0.5 rounded hover:bg-slate-100",children:e.jsx(ie,{className:"w-3.5 h-3.5 text-slate-400"})})]}),z&&E.length>0&&e.jsx("div",{className:"mt-1 bg-white border border-slate-200 rounded-xl shadow-lg max-h-48 overflow-y-auto z-30 relative",children:E.map(s=>{var l,v;return e.jsxs("button",{onClick:()=>J(s),className:"w-full flex items-center gap-3 px-3 py-2.5 hover:bg-slate-50 transition-colors text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center shrink-0",children:e.jsxs("span",{className:"text-brand-700 font-bold text-xs",children:[(((l=s.prenom)==null?void 0:l[0])||"").toUpperCase(),(((v=s.nom)==null?void 0:v[0])||"").toUpperCase()]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-slate-800 truncate",children:[s.prenom," ",s.nom]}),s.telephone&&e.jsx("p",{className:"text-xs text-slate-400 font-mono",children:s.telephone})]})]},s.id)})}),z&&c.length>=2&&E.length===0&&!M&&e.jsx("div",{className:"mt-1 p-3 bg-slate-50 rounded-lg text-sm text-slate-500 text-center",children:"Aucun client trouvé"}),r&&e.jsxs("div",{className:"mt-2 p-2.5 bg-emerald-50 rounded-lg flex items-center gap-2 text-sm text-emerald-700",children:[e.jsx(_,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{className:"font-medium",children:[r.prenom," ",r.nom]}),r.telephone&&e.jsx("span",{className:"text-emerald-500 font-mono text-xs ml-auto",children:r.telephone})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom *"}),e.jsx("input",{value:t.nom,onChange:s=>n("nom",s.target.value),className:"input",readOnly:i==="existing"&&!!r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prénom *"}),e.jsx("input",{value:t.prenom,onChange:s=>n("prenom",s.target.value),className:"input",readOnly:i==="existing"&&!!r})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"input-label",children:"Adresse"}),e.jsx("input",{value:t.adresse,onChange:s=>n("adresse",s.target.value),className:"input",placeholder:"Rue, code postal, ville"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Téléphone"}),e.jsx("input",{value:j,onChange:s=>g(s.target.value),className:"input font-mono",placeholder:"06 ...",readOnly:i==="existing"&&!!r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email"}),e.jsx("input",{value:x,onChange:s=>p(s.target.value),className:"input",placeholder:"client@email.com",readOnly:i==="existing"&&!!r})]})]})]}),e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center",children:e.jsx(ce,{className:"w-4 h-4 text-brand-600"})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Appareil"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-4",children:H.map(s=>e.jsx("button",{onClick:()=>{K(s),n("marque",""),n("modele","")},className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-colors
                    ${o===s?"bg-brand-600 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,children:s},s))}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Marque *"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:t.marque,onChange:s=>{n("marque",s.target.value),n("modele","")},className:"input appearance-none pr-8",children:[e.jsx("option",{value:"",children:"Sélectionner..."}),W.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(A,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Modèle *"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:t.modele,onChange:s=>n("modele",s.target.value),className:"input appearance-none pr-8",disabled:!t.marque,children:[e.jsx("option",{value:"",children:"Sélectionner..."}),V.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(A,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"IMEI / N° série"}),e.jsx("input",{value:t.imei,onChange:s=>n("imei",s.target.value),className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"État de l'appareil"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:t.etat,onChange:s=>n("etat",s.target.value),className:"input appearance-none pr-8",children:[e.jsx("option",{value:"",children:"Sélectionner..."}),X.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(A,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"})]})]})]})]}),e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-red-500"})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Diagnostic"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"input-label",children:"Motif de non-réparabilité *"}),e.jsx("textarea",{value:t.motif,onChange:s=>n("motif",s.target.value),className:"input min-h-[80px] resize-none",placeholder:"Expliquez pourquoi l'appareil ne peut pas être réparé..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Compte-rendu technique"}),e.jsx("textarea",{value:t.compte_rendu,onChange:s=>n("compte_rendu",s.target.value),className:"input min-h-[100px] resize-none",placeholder:"Détails techniques : tests effectués, composants vérifiés..."})]})]}),e.jsxs("button",{onClick:Q,disabled:L||!t.nom||!t.marque||!t.modele||!t.motif,className:"btn-primary w-full justify-center py-3 text-base",children:[L?e.jsx(U,{className:"w-5 h-5 animate-spin"}):e.jsx(G,{className:"w-5 h-5"}),"Générer l'attestation"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"px-5 py-3 bg-slate-50 border-b border-slate-100",children:e.jsx("h3",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider",children:"Aperçu du document"})}),d?e.jsx("iframe",{srcDoc:d,className:"w-full h-[750px] border-0",title:"Aperçu attestation"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[500px] text-center px-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-slate-100 flex items-center justify-center mb-4",children:e.jsx(G,{className:"w-8 h-8 text-slate-300"})}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Aucun aperçu"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:'Remplissez le formulaire et cliquez sur "Générer"'})]})]}),d&&e.jsxs("div",{className:"card p-5 space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800 mb-3",children:"Actions"}),e.jsxs("button",{onClick:Y,className:"btn-primary w-full justify-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"})," Imprimer (A4)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:x,onChange:s=>p(s.target.value),className:"input flex-1",placeholder:"Email du client"}),e.jsxs("button",{onClick:Z,disabled:!x||b,className:`btn-primary shrink-0 ${b?"bg-emerald-600 hover:bg-emerald-700":""}`,children:[b?e.jsx(_,{className:"w-4 h-4"}):e.jsx(me,{className:"w-4 h-4"}),b?"Envoyé":"Email"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"tel",value:j,onChange:s=>g(s.target.value),className:"input flex-1 font-mono",placeholder:"Tél du client"}),e.jsxs("button",{onClick:ee,disabled:!j,className:"btn-whatsapp shrink-0",children:[e.jsx(ue,{className:"w-4 h-4"})," WhatsApp"]})]})]})]})]})]})}export{je as default};
