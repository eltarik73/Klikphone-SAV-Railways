import{a as J,j as e,c as o,i as j}from"./index-YtI8KFVX.js";import{r as c}from"./vendor-react-DWtYaMjq.js";import{f as y,R as K,aI as $,ab as G,a6 as v,a5 as E,p as I,a8 as N,s as F,ag as W,Q as X,a2 as T}from"./vendor-icons-CUXb3u1C.js";function Y({note:r}){return e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(a=>e.jsx(y,{className:`w-3.5 h-3.5 ${a<=r?"text-amber-400 fill-amber-400":"text-zinc-200"}`},a))})}function L(r){return r?new Date(r).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}):""}function Z(r){if(!r)return"?";const a=r.trim().split(/\s+/);return a.length>=2?(a[0][0]+a[1][0]).toUpperCase():a[0].substring(0,2).toUpperCase()}function ne(){var S,R;const{data:r,loading:a,mutate:M}=J("avis-google",async()=>{const[s,t]=await Promise.all([o.getAvisGoogle(),o.getAvisGoogleStats()]);return{avis:s,stats:t}},{tags:["marketing"],ttl:12e4}),P=(r==null?void 0:r.avis)??[],n=(r==null?void 0:r.stats)??null,[i,q]=c.useState("all"),[p,w]=c.useState(!1),[d,z]=c.useState(null),[U,h]=c.useState(null),[C,x]=c.useState(""),[g,m]=c.useState(null);async function B(){w(!0);try{await o.syncAvisGoogle(),j("marketing")}catch(s){console.error("Erreur synchronisation:",s)}finally{w(!1)}}async function k(s){z(s);try{const t=await o.genererReponseAvis(s),u=t.ia_suggestion||t.suggestion||t.reponse;M(l=>l&&{...l,avis:l.avis.map(f=>f.id===s?{...f,ia_suggestion:u}:f)})}catch(t){console.error("Erreur génération IA:",t)}finally{z(null)}}async function O(s,t){try{await o.publierReponseAvis(s,{reponse_texte:t,reponse_par:localStorage.getItem("kp_user")||"Accueil"}),j("marketing")}catch(u){console.error("Erreur publication:",u)}}function Q(s,t){h(s),x(t||"")}async function V(s){try{await o.updateReponseAvis(s,{reponse_texte:C}),h(null),x(""),j("marketing")}catch(t){console.error("Erreur mise à jour:",t)}}function D(s){k(s)}async function b(s,t){try{await navigator.clipboard.writeText(s),m(t),setTimeout(()=>m(null),2e3)}catch{const l=document.createElement("textarea");l.value=s,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),m(t),setTimeout(()=>m(null),2e3)}}function _(){window.open("https://business.google.com/","_blank")}const A=P.filter(s=>i==="all"?!0:i==="pending"?!s.repondu:i==="5"?s.note===5:i==="4"?s.note===4:i==="3"?s.note<=3:!0),H=[{key:"all",label:"Tous"},{key:"pending",label:"Non répondus"},{key:"5",label:"5★"},{key:"4",label:"4★"},{key:"3",label:"≤3★"}];return e.jsxs("div",{className:"min-h-screen bg-zinc-50 pb-20",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 sticky top-0 z-20",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-100 flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-zinc-900",children:"Avis Google"}),e.jsx("p",{className:"text-xs text-zinc-500",children:n?`${n.total||0} avis · Note moyenne ${((S=n.note_moyenne)==null?void 0:S.toFixed(1))||"—"}/5`:"Chargement..."})]})]}),e.jsxs("button",{onClick:B,disabled:p,className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-violet-600 hover:bg-violet-700 text-white text-sm font-medium transition-colors disabled:opacity-50",children:[e.jsx(K,{className:`w-4 h-4 ${p?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:p?"Synchronisation...":"Synchroniser"})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-6",children:a?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"w-10 h-10 border-2 border-violet-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-sm text-zinc-500",children:"Chargement des avis..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-3 right-3 w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center",children:e.jsx(y,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"})}),e.jsxs("p",{className:"text-2xl font-extrabold text-zinc-900",children:[((R=n==null?void 0:n.note_moyenne)==null?void 0:R.toFixed(1))||"—",e.jsx("span",{className:"text-sm font-medium text-zinc-400",children:"/5"})]}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Note moyenne"})]}),e.jsxs("div",{className:"rounded-2xl border border-violet-200 bg-violet-50 p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-3 right-3 w-8 h-8 rounded-full bg-violet-100 flex items-center justify-center",children:e.jsx($,{className:"w-4 h-4 text-violet-600"})}),e.jsx("p",{className:"text-2xl font-extrabold text-zinc-900",children:(n==null?void 0:n.total)||0}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Total avis"})]}),e.jsxs("div",{className:"rounded-2xl border border-orange-200 bg-orange-50 p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-3 right-3 w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(G,{className:"w-4 h-4 text-orange-500"})}),e.jsx("p",{className:"text-2xl font-extrabold text-zinc-900",children:(n==null?void 0:n.non_repondus)||0}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Non répondus"})]}),e.jsxs("div",{className:"rounded-2xl border border-emerald-200 bg-emerald-50 p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-3 right-3 w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(v,{className:"w-4 h-4 text-emerald-500"})}),e.jsx("p",{className:"text-2xl font-extrabold text-zinc-900",children:(n==null?void 0:n.taux_reponse)!=null?`${n.taux_reponse}%`:"—"}),e.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Taux de réponse"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 px-4 py-3 rounded-xl bg-blue-50 border border-blue-200",children:[e.jsx(E,{className:"w-4 h-4 text-blue-500 mt-0.5 shrink-0"}),e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx("span",{className:"font-semibold",children:"Comment ça marche :"}),' Générez une réponse IA, modifiez-la si besoin, puis cliquez "Approuver & Publier". La réponse sera copiée et Google ouvert pour la coller.']})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-none pb-0.5",children:H.map(s=>e.jsx("button",{onClick:()=>q(s.key),className:`px-4 py-2 rounded-lg text-xs font-medium whitespace-nowrap transition-all ${i===s.key?"bg-zinc-900 text-white shadow-sm":"bg-white border border-slate-200 text-zinc-600 hover:bg-zinc-100"}`,children:s.label},s.key))}),A.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx($,{className:"w-12 h-12 text-zinc-300 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-500 text-sm",children:"Aucun avis trouvé"}),e.jsx("p",{className:"text-zinc-400 text-xs mt-1",children:"Modifiez vos filtres ou synchronisez les avis"})]}):e.jsx("div",{className:"space-y-4",children:A.map(s=>e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-bold shrink-0 ${s.note>=4?"bg-gradient-to-br from-violet-500 to-purple-600":"bg-gradient-to-br from-orange-400 to-red-500"}`,children:Z(s.auteur)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm text-zinc-900",children:s.auteur||"Anonyme"}),e.jsx(Y,{note:s.note}),e.jsx("span",{className:"text-xs text-zinc-400",children:L(s.date)})]}),e.jsx("div",{className:"mt-1",children:s.repondu?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:[e.jsx(v,{className:"w-3 h-3"}),"Répondu"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded-full bg-orange-50 text-orange-600 border border-orange-200",children:[e.jsx(G,{className:"w-3 h-3"}),"En attente"]})})]})]}),s.texte&&e.jsxs("p",{className:"mt-3 text-sm text-zinc-700 italic leading-relaxed",children:["« ",s.texte," »"]}),!s.repondu&&e.jsxs("div",{className:"mt-4",children:[!s.ia_suggestion&&e.jsxs("button",{onClick:()=>k(s.id),disabled:d===s.id,className:"flex items-center gap-2 px-4 py-2 rounded-xl border-2 border-violet-300 text-violet-700 text-sm font-medium hover:bg-violet-50 transition-colors disabled:opacity-50",children:[e.jsx(I,{className:`w-4 h-4 ${d===s.id?"animate-pulse":""}`}),d===s.id?"Génération en cours...":"Générer réponse IA"]}),s.ia_suggestion&&e.jsxs("div",{className:"mt-3 rounded-xl bg-purple-50 border-l-4 border-violet-500 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(I,{className:"w-4 h-4 text-violet-600"}),e.jsx("span",{className:"text-xs font-semibold text-violet-700",children:"Réponse IA suggérée"})]}),e.jsx("p",{className:"text-sm text-zinc-700 leading-relaxed",children:s.ia_suggestion}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsx("button",{onClick:async()=>{await b(s.ia_suggestion,`approve-${s.id}`),await O(s.id,s.ia_suggestion),_()},className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-medium transition-colors",children:g===`approve-${s.id}`?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-3.5 h-3.5"})," Copié ! Ouvrir Google..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3.5 h-3.5"})," Approuver & Publier"]})}),e.jsxs("button",{onClick:()=>Q(s.id,s.ia_suggestion),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg border-2 border-violet-300 text-violet-700 text-xs font-medium hover:bg-violet-50 transition-colors",children:[e.jsx(W,{className:"w-3.5 h-3.5"}),"Modifier"]}),e.jsxs("button",{onClick:()=>D(s.id),disabled:d===s.id,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-zinc-300 text-zinc-600 text-xs font-medium hover:bg-zinc-50 transition-colors disabled:opacity-50",children:[e.jsx(X,{className:`w-3.5 h-3.5 ${d===s.id?"animate-spin":""}`}),"Régénérer"]}),e.jsx("button",{onClick:()=>b(s.ia_suggestion,`copy-${s.id}`),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-zinc-300 text-zinc-600 text-xs font-medium hover:bg-zinc-50 transition-colors",children:g===`copy-${s.id}`?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-3.5 h-3.5 text-emerald-500"})," Copié !"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3.5 h-3.5"})," Copier"]})})]})]})]}),s.repondu&&s.reponse_texte&&e.jsxs("div",{className:"mt-4 rounded-xl bg-green-50 border border-green-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(v,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-xs font-semibold text-emerald-700",children:"Réponse publiée"})]}),e.jsx("p",{className:"text-sm text-zinc-700 leading-relaxed",children:s.reponse_texte}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-zinc-400",children:[s.reponse_date&&e.jsx("span",{children:L(s.reponse_date)}),s.reponse_par&&e.jsxs("span",{children:["· par ",s.reponse_par]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>b(s.reponse_texte,`pub-${s.id}`),className:"flex items-center gap-1 text-xs font-medium text-zinc-500 hover:text-zinc-700 transition-colors",children:g===`pub-${s.id}`?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-3 h-3 text-emerald-500"})," Copié"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3 h-3"})," Copier"]})}),e.jsxs("button",{onClick:_,className:"flex items-center gap-1 text-xs font-medium text-violet-500 hover:text-violet-700 transition-colors",children:[e.jsx(E,{className:"w-3 h-3"})," Voir sur Google"]})]})]}),U===s.id&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("textarea",{value:C,onChange:t=>x(t.target.value),rows:4,className:"w-full rounded-xl border border-slate-200 bg-zinc-50 p-3 text-sm text-zinc-800 focus:outline-none focus:ring-2 focus:ring-violet-500/30 focus:border-violet-400 transition-all resize-none",placeholder:"Modifier la réponse..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>V(s.id),className:"flex items-center gap-1.5 px-4 py-2 rounded-xl bg-violet-600 hover:bg-violet-700 text-white text-sm font-medium transition-colors",children:[e.jsx(F,{className:"w-3.5 h-3.5"}),"Sauvegarder"]}),e.jsx("button",{onClick:()=>{h(null),x("")},className:"px-4 py-2 rounded-xl border border-zinc-300 text-zinc-600 text-sm font-medium hover:bg-zinc-50 transition-colors",children:"Annuler"})]})]})]},s.id))})]})})]})}export{ne as default};
