import{c as A,j as n,w as ur,s as pr,d as mr,u as xr,a as xl,g as Ee,i as me,b as Q,e as fl,P as gl,F as hl,S as bl,h as gn}from"./index-CREAv5lR.js";import{r as b,u as fr,h as H,i as vl,a as gr,c as Nl}from"./vendor-react-DWtYaMjq.js";import{P as jl}from"./PatternGrid-Cv_ZFI8s.js";import{a2 as Is,a3 as yl,a4 as hr,F as br,X as te,a5 as vr,a6 as wl,s as Mt,C as On,o as $t,a0 as Ft,a7 as Cl,a8 as Dl,a9 as Sl,aa as _e,n as Ae,ab as Nr,W as Ge,ac as Il,m as We,ad as jr,ae as El,af as Al,_ as Fe,I as Pl,r as _l,c as hn,A as Et,G as Es,ag as As,ah as Rl,q as bn,P as At,ai as Bt,N as be,aj as Pt,ak as Ps,Z as kl,al as Tl,L as _s,a as Ol,z as Bl,$ as Ll,x as Ml}from"./vendor-icons-BFVyu274.js";import{i as $l,c as yr,b as Rs,P as Fl,a as Gl,d as Wl,e as Vl}from"./vendor-charts-O0jNFQnY.js";const ks=[{type:"client",label:"Client",desc:"Re√ßu de d√©p√¥t",icon:Is},{type:"staff",label:"Atelier",desc:"Fiche technicien",icon:yl},{type:"combined",label:"Double",desc:"Client + Atelier",icon:hr},{type:"devis",label:"Devis",desc:"Devis d√©taill√©",icon:br},{type:"recu",label:"Re√ßu",desc:"Re√ßu de paiement",icon:Is}],Ts=new Set(["devis","recu"]);function Ul({open:e,onClose:t,ticketId:s,ticketCode:r,clientTel:a,clientEmail:l}){const[o,i]=b.useState("client"),c=b.useRef(null),[p,m]=b.useState(!0),[u,d]=b.useState(!1),[f,v]=b.useState(!1),[j,y]=b.useState(!1),[D,R]=b.useState(null),[L,P]=b.useState(!1),O=A.getPrintUrl(s,o),S=ks.find(M=>M.type===o),_=Ts.has(o),k=_&&L;b.useEffect(()=>(e?(i("client"),P(!1),R(null),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[e]),b.useEffect(()=>{e&&(m(!0),P(!1))},[o]),b.useEffect(()=>{e&&m(!0)},[L]),b.useEffect(()=>{if(!D)return;const M=setTimeout(()=>R(null),4e3);return()=>clearTimeout(M)},[D]);const Y=async()=>{d(!0);try{const ce=await(await fetch(O)).text(),fe=window.open("","_blank");if(!fe){window.open(O,"_blank");return}fe.document.write(ce),fe.document.close(),fe.focus(),setTimeout(()=>{fe.print()},300)}catch{window.open(O,"_blank")}finally{d(!1)}},I=()=>{window.open(O,"_blank")},F=()=>{window.open(A.getPdfUrl(s,o),"_blank")},W=()=>k?A.getSharePdfUrl(s,o):A.getSharePrintUrl(s,o),ie=()=>{if(!a)return;const M=W(),ce=`Bonjour, voici votre ${(S==null?void 0:S.desc)||"document"} pour le ticket ${r}.

${M.trim()}`;window.open(ur(a,ce),"_blank"),v(!1)},U=()=>{if(!a)return;const M=W(),ce=`Klikphone - ${(S==null?void 0:S.desc)||"document"} ${r}
${M.trim()}`;window.open(pr(a,ce),"_blank"),v(!1)},xe=async()=>{if(l){y(!0);try{const M=await A.sendDocument(s,o,l);M.status==="ok"?(v(!1),R({type:"success",message:`Email envoy√© avec succ√®s √† ${l}`})):R({type:"error",message:M.detail||"Erreur lors de l'envoi de l'email"})}catch{R({type:"error",message:"Erreur lors de l'envoi de l'email"})}finally{y(!1)}}};return e?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 transition-opacity",onClick:t}),n.jsxs("div",{className:"fixed inset-y-0 right-0 w-full sm:w-[520px] lg:w-[600px] bg-white shadow-2xl z-50 flex flex-col animate-in",style:{animationName:"slideInRight",animationDuration:"300ms"},children:[n.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-slate-100 shrink-0",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-base font-display font-bold text-slate-900",children:"Impression"}),n.jsxs("p",{className:"text-xs text-slate-400 mt-0.5",children:["Ticket ",r]})]}),n.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors",children:n.jsx(te,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex gap-1 px-5 py-3 border-b border-slate-100 overflow-x-auto scrollbar-none shrink-0 bg-slate-50/50",children:ks.map(({type:M,label:ce,icon:fe})=>n.jsxs("button",{onClick:()=>{i(M),m(!0)},className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap transition-all ${o===M?"bg-brand-600 text-white shadow-sm shadow-brand-600/25":"text-slate-500 hover:bg-white hover:text-slate-700 hover:shadow-sm"}`,children:[n.jsx(fe,{className:"w-3.5 h-3.5"}),ce,n.jsx("span",{className:`text-[9px] px-1 py-0.5 rounded ${o===M?"bg-white/20":"bg-slate-200 text-slate-500"}`,children:o===M&&L&&Ts.has(M)?"A4":"80mm"})]},M))}),n.jsxs("div",{className:"flex-1 relative bg-slate-100 overflow-hidden",children:[n.jsxs("div",{className:"absolute top-3 left-3 z-10 flex items-center gap-2",children:[n.jsx("span",{className:"text-[10px] font-semibold px-2 py-1 rounded-md shadow-sm bg-slate-800 text-white",children:k?"PDF A4":"THERMIQUE 80mm"}),_&&n.jsx("button",{onClick:()=>{P(!L),m(!0)},className:`text-[10px] font-semibold px-2 py-1 rounded-md shadow-sm transition-colors ${L?"bg-brand-600 text-white":"bg-white text-slate-600 border border-slate-200"}`,children:L?"Passer en 80mm":"Passer en A4"})]}),p&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-100 z-10",children:n.jsxs("div",{className:"flex flex-col items-center gap-3",children:[n.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Chargement de l'aper√ßu..."})]})}),n.jsx("div",{className:"h-full overflow-auto flex justify-center pt-4 pb-8",children:n.jsx("div",{className:`bg-white shadow-xl rounded-lg overflow-hidden shrink-0 ${k?"w-[480px]":"w-[320px]"}`,children:n.jsx("iframe",{ref:c,src:k?A.getPdfUrl(s,o):O,className:"w-full h-full border-0",style:{minHeight:"600px"},title:`Aper√ßu ${S==null?void 0:S.label}`,onLoad:()=>m(!1)})})})]}),n.jsxs("div",{className:"px-5 py-4 border-t border-slate-100 bg-white shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:Y,disabled:u,className:`flex-1 justify-center ${k?"btn-ghost border border-slate-200":"btn-primary shadow-lg shadow-brand-600/20"}`,children:[n.jsx(vr,{className:"w-4 h-4"}),u?"Ouverture...":"Imprimer 80mm"]}),_&&n.jsxs("button",{onClick:F,className:`${k?"btn-primary shadow-lg shadow-brand-600/20":"btn-ghost border border-slate-200"} flex-1 justify-center`,children:[n.jsx(wl,{className:"w-4 h-4"}),"PDF A4"]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>v(!f),className:"btn-ghost border border-slate-200 px-3 gap-1",children:[n.jsx(Mt,{className:"w-4 h-4"}),n.jsx(On,{className:"w-3 h-3"})]}),f&&n.jsxs("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-white rounded-lg shadow-xl border border-slate-200 py-1 z-50",children:[n.jsxs("button",{onClick:ie,disabled:!a,className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:opacity-40",children:[n.jsx($t,{className:"w-4 h-4 text-green-600"}),"WhatsApp"]}),n.jsxs("button",{onClick:U,disabled:!a,className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:opacity-40",children:[n.jsx(Mt,{className:"w-4 h-4 text-blue-600"}),"SMS"]}),n.jsxs("button",{onClick:xe,disabled:!l||j,className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:opacity-40",children:[n.jsx(Ft,{className:"w-4 h-4 text-red-500"}),j?"Envoi...":k?"Email (PDF)":"Email"]})]})]}),n.jsx("button",{onClick:I,className:"btn-ghost border border-slate-200 px-3",title:"Ouvrir dans un nouvel onglet",children:n.jsx(Cl,{className:"w-4 h-4"})})]}),n.jsx("p",{className:"text-[10px] text-slate-400 text-center mt-2",children:k?"Document PDF format A4 professionnel":"Format optimis√© pour imprimante thermique 80mm"})]})]}),D&&n.jsx("div",{className:"fixed inset-x-0 bottom-24 z-[60] flex justify-center pointer-events-none",children:n.jsxs("div",{className:`pointer-events-auto flex items-center gap-3 px-5 py-3 rounded-xl shadow-2xl border transition-all ${D.type==="success"?"bg-emerald-600 border-emerald-700 text-white":"bg-red-600 border-red-700 text-white"}`,style:{animation:"toastIn 300ms ease-out"},children:[D.type==="success"?n.jsx(Dl,{className:"w-5 h-5 shrink-0"}):n.jsx(Sl,{className:"w-5 h-5 shrink-0"}),n.jsx("span",{className:"text-sm font-semibold",children:D.message}),n.jsx("button",{onClick:()=>R(null),className:"ml-2 p-0.5 rounded hover:bg-white/20",children:n.jsx(te,{className:"w-4 h-4"})})]})}),n.jsx("style",{children:`
        @keyframes slideInRight {
          from { transform: translateX(100%); }
          to { transform: translateX(0); }
        }
        @keyframes toastIn {
          from { transform: translateY(20px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
      `})]}):null}const Hl=[{id:1,label:"Appareil recu",message:"Bonjour {prenom}, votre {appareil} a bien ete pris en charge sous le numero {code}. Nous vous tiendrons informe de l'avancement. Klikphone 04 79 60 89 22"},{id:2,label:"Diagnostic en cours",message:"Bonjour {prenom}, le diagnostic de votre {appareil} est en cours. Nous reviendrons vers vous rapidement. Klikphone"},{id:3,label:"Devis a valider",message:"Bonjour {prenom}, le devis pour votre {appareil} est de {montant} EUR. Merci de nous confirmer votre accord. Klikphone 04 79 60 89 22"},{id:4,label:"En cours de reparation",message:"Bonjour {prenom}, la reparation de votre {appareil} est en cours. Klikphone"},{id:5,label:"Attente piece",message:"Bonjour {prenom}, nous sommes en attente d'une piece pour votre {appareil}. Nous vous previendrons des reception. Klikphone"},{id:6,label:"Appareil pret",message:"Bonjour {prenom}, votre {appareil} est pret ! Vous pouvez venir le recuperer a la boutique. Montant : {montant} EUR. Klikphone 79 Place Saint Leger, Chambery"},{id:7,label:"Commande arrivee",message:"Bonjour {prenom}, la piece commandee pour votre {appareil} est arrivee. Nous lancons la reparation. Klikphone 04 79 60 89 22"},{id:8,label:"Non reparable",message:"Bonjour {prenom}, malheureusement votre {appareil} n'est pas reparable. Vous pouvez passer recuperer votre appareil en boutique. Klikphone"},{id:9,label:"Rappel RDV",message:"Bonjour {prenom}, nous vous rappelons votre rendez-vous demain pour votre {appareil}. Klikphone 79 Place Saint Leger, Chambery"},{id:10,label:"Personnalise",message:""}],zl={1:"üì±",2:"üîç",3:"üìã",4:"üîß",5:"‚è≥",6:"‚úÖ",7:"üì¶",8:"‚ùå",9:"üìÖ",10:"‚úèÔ∏è"};function ql({ticket:e,onMessageSent:t}){const s=mr(),{user:r}=xr(),[a,l]=b.useState(Hl),[o,i]=b.useState(null),[c,p]=b.useState(""),[m,u]=b.useState(null);b.useEffect(()=>{A.getMessageTemplates().then(I=>{I&&I.length>0&&l(I)}).catch(()=>{})},[]);const d=e,f=d.modele_autre||`${d.marque||""} ${d.modele||""}`.trim()||"appareil",v=parseFloat(d.tarif_final)||parseFloat(d.devis_estime)||0,j=parseFloat(d.reduction_pourcentage)||0,y=parseFloat(d.reduction_montant)||0,D=j>0?v*(j/100):y,R=Math.max(0,v-D),L=I=>I.replace(/\{prenom\}/g,d.client_prenom||"").replace(/\{nom\}/g,d.client_nom||"").replace(/\{appareil\}/g,f).replace(/\{code\}/g,d.ticket_code||"").replace(/\{montant\}/g,String(R)).replace(/\{adresse\}/g,"79 Place Saint Leger, 73000 Chambery").replace(/\{horaires\}/g,"Lundi-Samedi 10h-19h").replace(/\{tel_boutique\}/g,"04 79 60 89 22"),P=a.find(I=>I.id===o),O=o===10,S=O?c:P?L(P.message):"",_=(I,F)=>{let W=I.replace(/[\s\-\.]/g,"");W.startsWith("0")&&(W="33"+W.substring(1)),!W.startsWith("+")&&!W.startsWith("33")&&(W="33"+W),W=W.replace("+",""),window.open(`https://wa.me/${W}?text=${encodeURIComponent(F)}`,"_blank")},k=(I,F)=>{window.open(`sms:${I}?body=${encodeURIComponent(F)}`,"_blank")},Y=async I=>{if(!S.trim()){s.error("Message vide");return}u(I);try{const F=d.client_tel,W=d.client_email;if(I==="whatsapp"){if(!F){s.error("Pas de telephone");return}_(F,S)}else if(I==="sms"){if(!F){s.error("Pas de telephone");return}k(F,S)}else if(I==="email"){if(!W){s.error("Ce client n'a pas d'adresse email");return}const M=await A.envoyerEmail(W,`Klikphone SAV - ${d.ticket_code}`,S);if(M.status!=="ok"){s.error(M.message||"Erreur d'envoi email");return}}const ie=(r==null?void 0:r.utilisateur)||"Accueil",xe=`[${P?P.label:"Message"}] ${S.substring(0,120)}${S.length>120?"...":""}`;await A.logMessage(d.id,ie,xe,I),s.success(I==="email"?"Email envoy√© avec succ√®s":`Message ${I} envoy√©`),t&&t()}catch(F){s.error(F.message||"Erreur envoi"),console.error(F)}finally{u(null)}};return n.jsxs("div",{className:"card p-5",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center",children:n.jsx($t,{className:"w-4 h-4 text-green-600"})}),n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Messages"})]}),n.jsx("div",{className:"grid grid-cols-2 gap-1.5 mb-3",children:a.map(I=>n.jsxs("button",{onClick:()=>i(I.id===o?null:I.id),className:`text-left px-2.5 py-2 rounded-lg text-xs font-medium transition-all border ${o===I.id?"bg-brand-50 border-brand-300 text-brand-700 shadow-sm":"bg-white border-slate-150 text-slate-600 hover:bg-slate-50 hover:border-slate-200"}`,children:[n.jsx("span",{className:"mr-1",children:zl[I.id]||"üí¨"}),I.label]},I.id))}),o&&n.jsxs("div",{className:"animate-in",children:[O?n.jsx("textarea",{value:c,onChange:I=>p(I.target.value),placeholder:"Tapez votre message...",rows:3,className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 mb-3"}):n.jsx("div",{className:"p-3 bg-slate-50 rounded-lg text-sm text-slate-700 leading-relaxed mb-3 border border-slate-100",children:S}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>Y("whatsapp"),disabled:!!m,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-green-500 hover:bg-green-600 text-white text-xs font-bold transition-colors disabled:opacity-50",children:[m==="whatsapp"?n.jsx(_e,{className:"w-3.5 h-3.5"}):n.jsx($t,{className:"w-3.5 h-3.5"}),"WhatsApp"]}),n.jsxs("button",{onClick:()=>Y("sms"),disabled:!!m,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold border border-slate-200 transition-colors disabled:opacity-50",children:[m==="sms"?n.jsx(_e,{className:"w-3.5 h-3.5"}):n.jsx(Mt,{className:"w-3.5 h-3.5"}),"SMS"]}),n.jsxs("button",{onClick:()=>Y("email"),disabled:!!m,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold border border-slate-200 transition-colors disabled:opacity-50",children:[m==="email"?n.jsx(_e,{className:"w-3.5 h-3.5"}):n.jsx(Ft,{className:"w-3.5 h-3.5"}),"Email"]})]})]})]})}function Kl({ticket:e,visible:t}){const[s,r]=b.useState(0),a=(e==null?void 0:e.statut)==="En cours de r√©paration"&&(e==null?void 0:e.reparation_debut)&&!(e!=null&&e.reparation_fin),l=(e==null?void 0:e.reparation_duree)||0,o=!a&&l>0;if(b.useEffect(()=>{if(!a||!e.reparation_debut)return;const d=e.reparation_debut,f=new Date(d.endsWith("Z")||d.includes("+")?d:d+"Z").getTime(),v=()=>r(Math.floor((Date.now()-f)/1e3));v();const j=setInterval(v,1e3);return()=>clearInterval(j)},[a,e==null?void 0:e.reparation_debut]),!t||!a&&!o)return null;const i=a?l+s:l,c=Math.floor(i/3600),p=Math.floor(i%3600/60),m=i%60,u=c>0?`${c}h ${String(p).padStart(2,"0")}min`:`${p}min ${String(m).padStart(2,"0")}s`;return n.jsxs("div",{className:`mt-3 px-4 py-3 rounded-xl flex items-center justify-between ${o?"bg-emerald-50 border border-emerald-200":"bg-violet-50/60 border border-violet-200/60"}`,children:[n.jsxs("div",{className:"flex items-center gap-2.5",children:[n.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${o?"bg-emerald-100":"bg-violet-100"}`,children:o?n.jsx(Ae,{className:"w-4 h-4 text-emerald-600"}):n.jsx(Nr,{className:"w-4 h-4 text-violet-600"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-wider",children:o?"R√©par√© en":"Temps de r√©paration"}),n.jsx("div",{className:`text-lg font-extrabold font-mono tracking-wide ${o?"text-emerald-600":"text-violet-600"}`,children:u})]})]}),n.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[11px] font-bold ${o?"bg-emerald-100 text-emerald-600":"bg-violet-100 text-violet-600"}`,children:[a&&n.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse"}),o?"TERMIN√â":"EN COURS"]})]})}function Yl(e){if(!e)return null;const t=e.trim(),s=new Date(t);if(!isNaN(s.getTime())&&t.length>=8)return s;const r=t.match(/^(\d{1,2})[/.-](\d{1,2})[/.-](\d{2,4})(?:\s+(\d{1,2})[h:](\d{2}))?/);if(r){const i=r[3].length===2?"20"+r[3]:r[3],c=new Date(`${i}-${r[2].padStart(2,"0")}-${r[1].padStart(2,"0")}T${(r[4]||"18").padStart(2,"0")}:${r[5]||"00"}:00`);if(!isNaN(c.getTime()))return c}const a=t.toLowerCase(),l=new Date;if(a==="demain"){const i=new Date(l);return i.setDate(i.getDate()+1),i.setHours(18,0,0,0),i}if(a==="aujourd'hui"||a==="aujourdhui"||a==="ce soir"){const i=new Date(l);return i.setHours(18,0,0,0),i}const o={lundi:1,mardi:2,mercredi:3,jeudi:4,vendredi:5,samedi:6,dimanche:0};for(const[i,c]of Object.entries(o))if(a.includes(i)){const p=new Date(l),m=(c-p.getDay()+7)%7||7;return p.setDate(p.getDate()+m),p.setHours(18,0,0,0),p}return null}function Jl(e){const t=Math.abs(e),s=Math.floor(t/36e5),r=Math.floor(t%36e5/6e4);if(s>=24){const a=Math.floor(s/24),l=s%24;return`${a}j ${l}h`}return`${s}h${String(r).padStart(2,"0")}`}function Xl({dateStr:e,visible:t}){const[s,r]=b.useState(()=>new Date);if(b.useEffect(()=>{const c=setInterval(()=>r(new Date),6e4);return()=>clearInterval(c)},[]),!t||!e)return null;const a=Yl(e);if(!a)return null;const l=a-s,o=l<0,i=l>0&&l<2*36e5;return n.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-bold ${o?"bg-red-50 text-red-600":i?"bg-amber-50 text-amber-600":"bg-emerald-50 text-emerald-600"}`,children:[o?"D√©pass√© ":"dans ",Jl(l)]})}function Ql(e){if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t}function Zl(e){const t=Math.abs(e),s=Math.floor(t/36e5);if(s>=24)return`${Math.floor(s/24)}j ${s%24}h`;const r=Math.floor(t%36e5/6e4);return`${s}h${String(r).padStart(2,"0")}`}function Os({queue:e,currentTicketId:t,basePath:s,isTech:r,onClose:a,navigate:l}){return n.jsx("div",{className:"space-y-1.5",children:e.map((o,i)=>{const c=o.id===t,p=o.statut==="En cours de r√©paration",m=Ql(o.date_recuperation),d=m?m-new Date:null,f=d!==null&&d<0,v=d!==null&&d>0&&d<6*36e5,j=Ee(o.statut);return n.jsx("button",{onClick:()=>{a(),l(`${s}/ticket/${o.id}`)},className:`w-full text-left p-3 rounded-xl transition-all ${c?"bg-violet-50 ring-2 ring-violet-400":p?"bg-blue-50/50 hover:bg-blue-50":"hover:bg-slate-50"}`,children:n.jsxs("div",{className:"flex items-start gap-2.5",children:[n.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center shrink-0 text-[10px] font-extrabold ${p?"bg-violet-600 text-white":i===0?"bg-red-500 text-white":"bg-slate-200 text-slate-500"}`,children:p?n.jsx(Il,{className:"w-3 h-3 fill-current"}):i+1}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-400 font-mono",children:o.ticket_code}),n.jsxs("span",{className:"text-[13px] font-bold text-slate-800 truncate",children:[o.client_prenom," ",o.client_nom]}),v&&n.jsx("span",{className:"shrink-0 bg-red-50 text-red-500 text-[9px] font-extrabold px-1.5 py-0.5 rounded uppercase",children:"Urgent"})]}),n.jsxs("div",{className:"text-[12px] text-slate-500 truncate mb-1",children:[o.modele||o.marque," ",o.panne?`‚Ä¢ ${o.panne}`:""]}),n.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[!r&&o.technicien_assigne&&n.jsx("span",{className:"text-[10px] text-slate-400",children:o.technicien_assigne}),n.jsx("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded-full",style:{backgroundColor:j.color+"15",color:j.color},children:o.statut}),d!==null&&n.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${f?"bg-red-50 text-red-500":v?"bg-amber-50 text-amber-600":"bg-emerald-50 text-emerald-600"}`,children:f?n.jsxs(n.Fragment,{children:[n.jsx(We,{className:"w-2.5 h-2.5 inline"})," D√©pass√©"]}):n.jsxs(n.Fragment,{children:[n.jsx(jr,{className:"w-2.5 h-2.5 inline"})," ",Zl(d)]})})]})]})]})},o.id)})})}function eo({open:e,onClose:t,currentTicketId:s,basePath:r,user:a,inline:l}){const o=fr(),i=(a==null?void 0:a.target)==="tech",c=i?a.utilisateur:null,[p,m]=b.useState(!1),{data:u,loading:d}=xl(e?`queue:repair:${c||"all"}`:null,()=>A.getRepairQueue(c),{tags:["tickets"],ttl:15e3});if(b.useEffect(()=>{if(!e||l)return;const v=j=>j.key==="Escape"&&t();return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[e,t,l]),!e)return null;const f=u||[];return l?n.jsxs("div",{className:"card overflow-hidden",children:[n.jsxs("button",{onClick:()=>m(v=>!v),className:"w-full px-5 py-4 bg-gradient-to-r from-slate-800 to-slate-900 flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2.5",children:[n.jsx(Ge,{className:"w-4 h-4 text-white/80"}),n.jsx("span",{className:"text-white text-sm font-bold",children:i?"Mes r√©parations":"File d'attente"}),f.length>0&&n.jsx("span",{className:"bg-amber-400 text-slate-900 text-[11px] font-extrabold px-2 py-0.5 rounded-full",children:f.length})]}),n.jsx(On,{className:`w-4 h-4 text-white/60 transition-transform duration-200 ${p?"-rotate-90":""}`})]}),!p&&n.jsx("div",{className:"p-3 max-h-[500px] overflow-y-auto",children:d?n.jsx("div",{className:"flex items-center justify-center py-8",children:n.jsx("div",{className:"w-5 h-5 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"})}):f.length===0?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Ge,{className:"w-7 h-7 text-slate-300 mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-slate-400 font-medium",children:"Aucune r√©paration en attente"})]}):n.jsx(Os,{queue:f,currentTicketId:s,basePath:r,isTech:i,onClose:()=>{},navigate:o})}),!p&&n.jsx("div",{className:"px-5 py-2.5 border-t border-slate-100 text-[11px] text-slate-400 text-center",children:i?"Vos tickets assign√©s en cours":"Tous les tickets en attente de traitement"})]}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-40",onClick:t}),n.jsxs("div",{className:"fixed inset-y-0 right-0 w-full sm:w-[400px] bg-white shadow-2xl z-50 flex flex-col animate-in",children:[n.jsxs("div",{className:"px-5 py-4 bg-gradient-to-r from-slate-800 to-slate-900 flex items-center justify-between shrink-0",children:[n.jsxs("div",{className:"flex items-center gap-2.5",children:[n.jsx(Ge,{className:"w-4 h-4 text-white/80"}),n.jsx("span",{className:"text-white text-sm font-bold",children:i?"Mes r√©parations":"File d'attente"}),f.length>0&&n.jsx("span",{className:"bg-amber-400 text-slate-900 text-[11px] font-extrabold px-2 py-0.5 rounded-full",children:f.length})]}),n.jsx("button",{onClick:t,className:"text-white/60 hover:text-white transition-colors",children:n.jsx(te,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:d?n.jsx("div",{className:"flex items-center justify-center py-12",children:n.jsx("div",{className:"w-6 h-6 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"})}):f.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Ge,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-slate-400 font-medium",children:"Aucune r√©paration en attente"})]}):n.jsx(Os,{queue:f,currentTicketId:s,basePath:r,isTech:i,onClose:t,navigate:o})}),n.jsx("div",{className:"px-5 py-3 border-t border-slate-100 text-[11px] text-slate-400 text-center shrink-0",children:i?"Vos tickets assign√©s en cours":"Tous les tickets en attente de traitement"})]})]})}const Bs={client:{label:"Client"},device:{label:"Appareil"},dates:{label:"Dates"},reparation:{label:"R√©paration & Tarifs"},status:{label:"Statut"},queue:{label:"File d'attente"},messages:{label:"Messages"},notes:{label:"Notes internes"},fidelite:{label:"Fid√©lit√©"}};function _t({icon:e,label:t,desc:s,value:r,onChange:a,activeColor:l}){const o=r?l||"bg-emerald-500":"bg-slate-300";return n.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-100 last:border-b-0",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-slate-800",children:[typeof e=="string"?n.jsx("span",{className:"text-sm",children:e}):n.jsx(e,{className:"w-4 h-4 text-slate-500 shrink-0"}),t]}),n.jsx("div",{className:"text-[11px] text-slate-400 mt-0.5 ml-6",children:s})]}),n.jsx("button",{onClick:a,className:`relative w-11 h-6 rounded-full transition-colors duration-200 shrink-0 ml-3 ${o}`,children:n.jsx("div",{className:`absolute top-1 w-4 h-4 rounded-full bg-white shadow-sm transition-all duration-200 ${r?"left-6":"left-1"}`})})]})}function to({open:e,onClose:t,prefs:s,onPrefsChange:r,layout:a,onResetLayout:l,editMode:o,onToggleEditMode:i}){if(!e)return null;const c=p=>{r({...s,[p]:!s[p]})};return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-40",onClick:t}),n.jsxs("div",{className:"fixed inset-y-0 right-0 w-full sm:w-[340px] bg-white shadow-2xl z-50 flex flex-col animate-in",children:[n.jsxs("div",{className:"px-5 py-4 border-b border-slate-200 flex items-center justify-between shrink-0",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-base font-extrabold text-slate-800",children:"Personnaliser"}),n.jsx("div",{className:"text-[11px] text-slate-400 mt-0.5",children:"Tes pr√©f√©rences d'affichage"})]}),n.jsx("button",{onClick:t,className:"w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors",children:n.jsx(te,{className:"w-4 h-4 text-slate-500"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n.jsxs("div",{className:"px-5 py-4 border-b border-slate-100",children:[n.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2",children:"Widgets"}),n.jsx(_t,{icon:Nr,label:"Timer de r√©paration",desc:"Chrono du temps pass√© sur la r√©paration",value:s.timer,onChange:()=>c("timer")}),n.jsx(_t,{icon:jr,label:"Compte √† rebours",desc:"Temps restant avant r√©cup√©ration",value:s.countdown,onChange:()=>c("countdown")}),n.jsx(_t,{icon:El,label:"File d'attente",desc:"Widget avec les prochaines r√©parations",value:s.queue,onChange:()=>c("queue")})]}),n.jsxs("div",{className:"px-5 py-4 border-b border-slate-100",children:[n.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2",children:"Disposition"}),n.jsx(_t,{icon:Al,label:"Mode √©dition",desc:"D√©placer les widgets entre colonnes",value:o,onChange:()=>{i(),t()},activeColor:"bg-blue-500"}),o&&n.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-blue-50 border border-blue-200",children:[n.jsx("div",{className:"text-xs font-semibold text-blue-600",children:"Mode √©dition activ√©"}),n.jsx("div",{className:"text-[11px] text-slate-500 mt-0.5",children:"Glisse les widgets sur la page. D√©sactive quand c'est bon."})]})]}),a&&n.jsxs("div",{className:"px-5 py-4",children:[n.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3",children:"Position des widgets"}),n.jsxs("div",{className:"mb-3",children:[n.jsx("div",{className:"text-[10px] font-bold text-blue-500 mb-1.5",children:"Colonne gauche"}),n.jsx("div",{className:"space-y-1",children:a.left.map(p=>{var m;return n.jsx("div",{className:"flex items-center gap-2 px-2.5 py-1.5 rounded-md bg-blue-50/50 text-xs font-medium text-slate-700",children:((m=Bs[p])==null?void 0:m.label)||p},p)})})]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("div",{className:"text-[10px] font-bold text-violet-500 mb-1.5",children:"Colonne droite"}),n.jsx("div",{className:"space-y-1",children:a.right.map(p=>{var m;return n.jsx("div",{className:"flex items-center gap-2 px-2.5 py-1.5 rounded-md bg-violet-50/50 text-xs font-medium text-slate-700",children:((m=Bs[p])==null?void 0:m.label)||p},p)})})]}),n.jsxs("button",{onClick:()=>{l(),t()},className:"flex items-center justify-center gap-1.5 w-full px-3 py-2 rounded-lg bg-slate-100 text-slate-600 text-xs font-semibold hover:bg-slate-200 transition-colors",children:[n.jsx(Fe,{className:"w-3.5 h-3.5"})," R√©initialiser la disposition"]})]})]}),n.jsx("div",{className:"px-5 py-3 border-t border-slate-100 bg-emerald-50/50 shrink-0",children:n.jsxs("div",{className:"flex items-start gap-2",children:[n.jsx(Pl,{className:"w-3.5 h-3.5 text-emerald-500 shrink-0 mt-0.5"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-[11px] font-semibold text-emerald-700",children:"Les donn√©es sont toujours enregistr√©es"}),n.jsx("div",{className:"text-[10px] text-slate-500 mt-0.5",children:"M√™me si un widget est masqu√©, les donn√©es sont sauvegard√©es pour le reporting."})]})]})})]})]})}function vn({text:e,query:t}){if(!t||!e)return e||"";const s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(${s})`,"gi");return e.split(r).map((l,o)=>r.test(l)?n.jsx("mark",{className:"bg-amber-100 font-bold rounded-sm px-0.5",children:l},o):l)}function no({suggestion:e,query:t,categorie:s}){var r,a;return s==="client"?n.jsxs("div",{className:"flex items-center gap-2.5",children:[n.jsxs("div",{className:"w-8 h-8 rounded-lg bg-blue-50 text-blue-500 flex items-center justify-center text-xs font-bold shrink-0",children:[(r=e.prenom)==null?void 0:r[0],(a=e.nom)==null?void 0:a[0]]}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-800 truncate",children:n.jsx(vn,{text:`${e.prenom} ${e.nom}`,query:t})}),n.jsx("div",{className:"text-[11px] text-slate-400",children:e.telephone})]})]}):s==="modele"?n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"text-sm text-slate-800 truncate",children:n.jsx(vn,{text:e.value,query:t})}),e.marque&&n.jsx("span",{className:"text-[10px] font-semibold text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded shrink-0",children:e.marque})]}):n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("span",{className:"text-sm text-slate-800 truncate",children:n.jsx(vn,{text:e.value,query:t})}),e.count>1&&n.jsxs("span",{className:"text-[9px] font-bold text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded shrink-0",children:["√ó",e.count]})]})}function Ls({label:e,placeholder:t,categorie:s,value:r,onChange:a,onSelect:l,icon:o,renderSuggestion:i,enabled:c=!0,className:p=""}){const[m,u]=b.useState([]),[d,f]=b.useState(!1),[v,j]=b.useState(!1),[y,D]=b.useState(-1),R=b.useRef(null),L=b.useRef(null);b.useEffect(()=>{const _=k=>{R.current&&!R.current.contains(k.target)&&f(!1)};return document.addEventListener("mousedown",_),()=>document.removeEventListener("mousedown",_)},[]);const P=b.useCallback(_=>{if(a(_),D(-1),L.current&&clearTimeout(L.current),!c||_.length<1){u([]),f(!1);return}L.current=setTimeout(async()=>{j(!0);try{const k=await A.searchAutocomplete(s,_,8);u(k),f(k.length>0)}catch{u([])}j(!1)},200)},[s,c,a]),O=_=>{d&&(_.key==="ArrowDown"?(_.preventDefault(),D(k=>Math.min(k+1,m.length-1))):_.key==="ArrowUp"?(_.preventDefault(),D(k=>Math.max(k-1,0))):_.key==="Enter"&&y>=0?(_.preventDefault(),S(m[y])):_.key==="Escape"&&f(!1))},S=_=>{const k=_.value||`${_.prenom} ${_.nom}`;a(k),l==null||l(_),f(!1),u([])};return c?n.jsxs("div",{ref:R,className:"relative",children:[e&&n.jsxs("label",{className:"input-label",children:[o&&n.jsx("span",{className:"mr-1",children:o}),e]}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"text",value:r||"",onChange:_=>P(_.target.value),onKeyDown:O,onFocus:()=>m.length>0&&f(!0),placeholder:t,className:`input ${d?"ring-2 ring-blue-500 border-blue-500":""} ${p}`}),v&&n.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:n.jsx(_l,{className:"w-4 h-4 text-blue-500 animate-spin"})})]}),d&&m.length>0&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-xl border border-slate-200 shadow-lg max-h-[320px] overflow-y-auto z-20",children:m.map((_,k)=>n.jsx("div",{onClick:()=>S(_),onMouseEnter:()=>D(k),className:`px-3 py-2.5 cursor-pointer transition-colors ${k===y?"bg-blue-50":"hover:bg-slate-50"} ${k<m.length-1?"border-b border-slate-50":""}`,children:i?i(_,k,r):n.jsx(no,{suggestion:_,query:r,categorie:s})},k))}),d&&m.length===0&&!v&&(r||"").length>=1&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-xl border border-slate-200 shadow-md px-3 py-2.5 z-20",children:n.jsxs("span",{className:"text-sm text-slate-400",children:['Aucun r√©sultat pour "',r,'"']})})]}):n.jsxs("div",{children:[e&&n.jsxs("label",{className:"input-label",children:[o&&n.jsx("span",{className:"mr-1",children:o}),e]}),n.jsx("input",{type:"text",value:r||"",onChange:_=>a(_.target.value),placeholder:t,className:`input ${p}`})]})}var ue=function(t){var s=t.top,r=t.right,a=t.bottom,l=t.left,o=r-l,i=a-s,c={top:s,right:r,bottom:a,left:l,width:o,height:i,x:l,y:s,center:{x:(r+l)/2,y:(a+s)/2}};return c},Bn=function(t,s){return{top:t.top-s.top,left:t.left-s.left,bottom:t.bottom+s.bottom,right:t.right+s.right}},Ms=function(t,s){return{top:t.top+s.top,left:t.left+s.left,bottom:t.bottom-s.bottom,right:t.right-s.right}},so=function(t,s){return{top:t.top+s.y,left:t.left+s.x,bottom:t.bottom+s.y,right:t.right+s.x}},Nn={top:0,right:0,bottom:0,left:0},Ln=function(t){var s=t.borderBox,r=t.margin,a=r===void 0?Nn:r,l=t.border,o=l===void 0?Nn:l,i=t.padding,c=i===void 0?Nn:i,p=ue(Bn(s,a)),m=ue(Ms(s,o)),u=ue(Ms(m,c));return{marginBox:p,borderBox:ue(s),paddingBox:m,contentBox:u,margin:a,border:o,padding:c}},ae=function(t){var s=t.slice(0,-2),r=t.slice(-2);if(r!=="px")return 0;var a=Number(s);return isNaN(a)&&$l(),a},ro=function(){return{x:window.pageXOffset,y:window.pageYOffset}},Gt=function(t,s){var r=t.borderBox,a=t.border,l=t.margin,o=t.padding,i=so(r,s);return Ln({borderBox:i,border:a,margin:l,padding:o})},Wt=function(t,s){return s===void 0&&(s=ro()),Gt(t,s)},wr=function(t,s){var r={top:ae(s.marginTop),right:ae(s.marginRight),bottom:ae(s.marginBottom),left:ae(s.marginLeft)},a={top:ae(s.paddingTop),right:ae(s.paddingRight),bottom:ae(s.paddingBottom),left:ae(s.paddingLeft)},l={top:ae(s.borderTopWidth),right:ae(s.borderRightWidth),bottom:ae(s.borderBottomWidth),left:ae(s.borderLeftWidth)};return Ln({borderBox:t,margin:r,padding:a,border:l})},Cr=function(t){var s=t.getBoundingClientRect(),r=window.getComputedStyle(t);return wr(s,r)},st=function(t){var s=[],r=null,a=function(){for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];s=i,!r&&(r=requestAnimationFrame(function(){r=null,t.apply(void 0,s)}))};return a.cancel=function(){r&&(cancelAnimationFrame(r),r=null)},a};function Vt(){return Vt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)({}).hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},Vt.apply(null,arguments)}function Dr(e,t){}Dr.bind(null,"warn");Dr.bind(null,"error");function ve(){}function ao(e,t){return{...e,...t}}function le(e,t,s){const r=t.map(a=>{const l=ao(s,a.options);return e.addEventListener(a.eventName,a.fn,l),function(){e.removeEventListener(a.eventName,a.fn,l)}});return function(){r.forEach(l=>{l()})}}const lo="Invariant failed";class Ut extends Error{}Ut.prototype.toString=function(){return this.message};function w(e,t){throw new Ut(lo)}class oo extends H.Component{constructor(...t){super(...t),this.callbacks=null,this.unbind=ve,this.onWindowError=s=>{const r=this.getCallbacks();r.isDragging()&&r.tryAbort(),s.error instanceof Ut&&s.preventDefault()},this.getCallbacks=()=>{if(!this.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return this.callbacks},this.setCallbacks=s=>{this.callbacks=s}}componentDidMount(){this.unbind=le(window,[{eventName:"error",fn:this.onWindowError}])}componentDidCatch(t){if(t instanceof Ut){this.setState({});return}throw t}componentWillUnmount(){this.unbind()}render(){return this.props.children(this.setCallbacks)}}const io=`
  Press space bar to start a drag.
  When dragging you can use the arrow keys to move the item around and escape to cancel.
  Some screen readers may require you to be in focus mode or to use your pass through key
`,Ht=e=>e+1,co=e=>`
  You have lifted an item in position ${Ht(e.source.index)}
`,Sr=(e,t)=>{const s=e.droppableId===t.droppableId,r=Ht(e.index),a=Ht(t.index);return s?`
      You have moved the item from position ${r}
      to position ${a}
    `:`
    You have moved the item from position ${r}
    in list ${e.droppableId}
    to list ${t.droppableId}
    in position ${a}
  `},Ir=(e,t,s)=>t.droppableId===s.droppableId?`
      The item ${e}
      has been combined with ${s.draggableId}`:`
      The item ${e}
      in list ${t.droppableId}
      has been combined with ${s.draggableId}
      in list ${s.droppableId}
    `,uo=e=>{const t=e.destination;if(t)return Sr(e.source,t);const s=e.combine;return s?Ir(e.draggableId,e.source,s):"You are over an area that cannot be dropped on"},$s=e=>`
  The item has returned to its starting position
  of ${Ht(e.index)}
`,po=e=>{if(e.reason==="CANCEL")return`
      Movement cancelled.
      ${$s(e.source)}
    `;const t=e.destination,s=e.combine;return t?`
      You have dropped the item.
      ${Sr(e.source,t)}
    `:s?`
      You have dropped the item.
      ${Ir(e.draggableId,e.source,s)}
    `:`
    The item has been dropped while not over a drop area.
    ${$s(e.source)}
  `},Lt={dragHandleUsageInstructions:io,onDragStart:co,onDragUpdate:uo,onDragEnd:po};function mo(e,t){return!!(e===t||Number.isNaN(e)&&Number.isNaN(t))}function Er(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!mo(e[s],t[s]))return!1;return!0}function $(e,t){const s=b.useState(()=>({inputs:t,result:e()}))[0],r=b.useRef(!0),a=b.useRef(s),o=r.current||!!(t&&a.current.inputs&&Er(t,a.current.inputs))?a.current:{inputs:t,result:e()};return b.useEffect(()=>{r.current=!1,a.current=o},[o]),o.result}function E(e,t){return $(()=>e,t)}const K={x:0,y:0},J=(e,t)=>({x:e.x+t.x,y:e.y+t.y}),ne=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),Ne=(e,t)=>e.x===t.x&&e.y===t.y,ze=e=>({x:e.x!==0?-e.x:0,y:e.y!==0?-e.y:0}),Re=(e,t,s=0)=>e==="x"?{x:t,y:s}:{x:s,y:t},rt=(e,t)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),Fs=(e,t)=>Math.min(...t.map(s=>rt(e,s))),Ar=e=>t=>({x:e(t.x),y:e(t.y)});var xo=(e,t)=>{const s=ue({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return s.width<=0||s.height<=0?null:s};const dt=(e,t)=>({top:e.top+t.y,left:e.left+t.x,bottom:e.bottom+t.y,right:e.right+t.x}),Gs=e=>[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.left,y:e.bottom},{x:e.right,y:e.bottom}],fo={top:0,right:0,bottom:0,left:0},go=(e,t)=>t?dt(e,t.scroll.diff.displacement):e,ho=(e,t,s)=>s&&s.increasedBy?{...e,[t.end]:e[t.end]+s.increasedBy[t.line]}:e,bo=(e,t)=>t&&t.shouldClipSubject?xo(t.pageMarginBox,e):ue(e);var Ve=({page:e,withPlaceholder:t,axis:s,frame:r})=>{const a=go(e.marginBox,r),l=ho(a,s,t),o=bo(l,r);return{page:e,withPlaceholder:t,active:o}},Mn=(e,t)=>{e.frame||w();const s=e.frame,r=ne(t,s.scroll.initial),a=ze(r),l={...s,scroll:{initial:s.scroll.initial,current:t,diff:{value:r,displacement:a},max:s.scroll.max}},o=Ve({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:l});return{...e,frame:l,subject:o}};function q(e,t=Er){let s=null;function r(...a){if(s&&s.lastThis===this&&t(a,s.lastArgs))return s.lastResult;const l=e.apply(this,a);return s={lastResult:l,lastArgs:a,lastThis:this},l}return r.clear=function(){s=null},r}const Pr=q(e=>e.reduce((t,s)=>(t[s.descriptor.id]=s,t),{})),_r=q(e=>e.reduce((t,s)=>(t[s.descriptor.id]=s,t),{})),Jt=q(e=>Object.values(e)),vo=q(e=>Object.values(e));var qe=q((e,t)=>vo(t).filter(r=>e===r.descriptor.droppableId).sort((r,a)=>r.descriptor.index-a.descriptor.index));function $n(e){return e.at&&e.at.type==="REORDER"?e.at.destination:null}function Xt(e){return e.at&&e.at.type==="COMBINE"?e.at.combine:null}var Qt=q((e,t)=>t.filter(s=>s.descriptor.id!==e.descriptor.id)),No=({isMovingForward:e,draggable:t,destination:s,insideDestination:r,previousImpact:a})=>{if(!s.isCombineEnabled||!$n(a))return null;function o(f){const v={type:"COMBINE",combine:{draggableId:f,droppableId:s.descriptor.id}};return{...a,at:v}}const i=a.displaced.all,c=i.length?i[0]:null;if(e)return c?o(c):null;const p=Qt(t,r);if(!c){if(!p.length)return null;const f=p[p.length-1];return o(f.descriptor.id)}const m=p.findIndex(f=>f.descriptor.id===c);m===-1&&w();const u=m-1;if(u<0)return null;const d=p[u];return o(d.descriptor.id)},Ke=(e,t)=>e.descriptor.droppableId===t.descriptor.id;const Rr={point:K,value:0},at={invisible:{},visible:{},all:[]},jo={displaced:at,displacedBy:Rr,at:null};var oe=(e,t)=>s=>e<=s&&s<=t,kr=e=>{const t=oe(e.top,e.bottom),s=oe(e.left,e.right);return r=>{if(t(r.top)&&t(r.bottom)&&s(r.left)&&s(r.right))return!0;const l=t(r.top)||t(r.bottom),o=s(r.left)||s(r.right);if(l&&o)return!0;const c=r.top<e.top&&r.bottom>e.bottom,p=r.left<e.left&&r.right>e.right;return c&&p?!0:c&&o||p&&l}},yo=e=>{const t=oe(e.top,e.bottom),s=oe(e.left,e.right);return r=>t(r.top)&&t(r.bottom)&&s(r.left)&&s(r.right)};const Fn={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},Tr={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"};var wo=e=>t=>{const s=oe(t.top,t.bottom),r=oe(t.left,t.right);return a=>e===Fn?s(a.top)&&s(a.bottom):r(a.left)&&r(a.right)};const Co=(e,t)=>{const s=t.frame?t.frame.scroll.diff.displacement:K;return dt(e,s)},Do=(e,t,s)=>t.subject.active?s(t.subject.active)(e):!1,So=(e,t,s)=>s(t)(e),Gn=({target:e,destination:t,viewport:s,withDroppableDisplacement:r,isVisibleThroughFrameFn:a})=>{const l=r?Co(e,t):e;return Do(l,t,a)&&So(l,s,a)},Io=e=>Gn({...e,isVisibleThroughFrameFn:kr}),Or=e=>Gn({...e,isVisibleThroughFrameFn:yo}),Eo=e=>Gn({...e,isVisibleThroughFrameFn:wo(e.destination.axis)}),Ao=(e,t,s)=>{if(typeof s=="boolean")return s;if(!t)return!0;const{invisible:r,visible:a}=t;if(r[e])return!1;const l=a[e];return l?l.shouldAnimate:!0};function Po(e,t){const s=e.page.marginBox,r={top:t.point.y,right:0,bottom:0,left:t.point.x};return ue(Bn(s,r))}function lt({afterDragging:e,destination:t,displacedBy:s,viewport:r,forceShouldAnimate:a,last:l}){return e.reduce(function(i,c){const p=Po(c,s),m=c.descriptor.id;if(i.all.push(m),!Io({target:p,destination:t,viewport:r,withDroppableDisplacement:!0}))return i.invisible[c.descriptor.id]=!0,i;const d=Ao(m,l,a),f={draggableId:m,shouldAnimate:d};return i.visible[m]=f,i},{all:[],visible:{},invisible:{}})}function _o(e,t){if(!e.length)return 0;const s=e[e.length-1].descriptor.index;return t.inHomeList?s:s+1}function Ws({insideDestination:e,inHomeList:t,displacedBy:s,destination:r}){const a=_o(e,{inHomeList:t});return{displaced:at,displacedBy:s,at:{type:"REORDER",destination:{droppableId:r.descriptor.id,index:a}}}}function zt({draggable:e,insideDestination:t,destination:s,viewport:r,displacedBy:a,last:l,index:o,forceShouldAnimate:i}){const c=Ke(e,s);if(o==null)return Ws({insideDestination:t,inHomeList:c,displacedBy:a,destination:s});const p=t.find(v=>v.descriptor.index===o);if(!p)return Ws({insideDestination:t,inHomeList:c,displacedBy:a,destination:s});const m=Qt(e,t),u=t.indexOf(p),d=m.slice(u);return{displaced:lt({afterDragging:d,destination:s,displacedBy:a,last:l,viewport:r.frame,forceShouldAnimate:i}),displacedBy:a,at:{type:"REORDER",destination:{droppableId:s.descriptor.id,index:o}}}}function je(e,t){return!!t.effected[e]}var Ro=({isMovingForward:e,destination:t,draggables:s,combine:r,afterCritical:a})=>{if(!t.isCombineEnabled)return null;const l=r.draggableId,i=s[l].descriptor.index;return je(l,a)?e?i:i-1:e?i+1:i},ko=({isMovingForward:e,isInHomeList:t,insideDestination:s,location:r})=>{if(!s.length)return null;const a=r.index,l=e?a+1:a-1,o=s[0].descriptor.index,i=s[s.length-1].descriptor.index,c=t?i:i+1;return l<o||l>c?null:l},To=({isMovingForward:e,isInHomeList:t,draggable:s,draggables:r,destination:a,insideDestination:l,previousImpact:o,viewport:i,afterCritical:c})=>{const p=o.at;if(p||w(),p.type==="REORDER"){const u=ko({isMovingForward:e,isInHomeList:t,location:p.destination,insideDestination:l});return u==null?null:zt({draggable:s,insideDestination:l,destination:a,viewport:i,last:o.displaced,displacedBy:o.displacedBy,index:u})}const m=Ro({isMovingForward:e,destination:a,displaced:o.displaced,draggables:r,combine:p.combine,afterCritical:c});return m==null?null:zt({draggable:s,insideDestination:l,destination:a,viewport:i,last:o.displaced,displacedBy:o.displacedBy,index:m})},Oo=({displaced:e,afterCritical:t,combineWith:s,displacedBy:r})=>{const a=!!(e.visible[s]||e.invisible[s]);return je(s,t)?a?K:ze(r.point):a?r.point:K},Bo=({afterCritical:e,impact:t,draggables:s})=>{const r=Xt(t);r||w();const a=r.draggableId,l=s[a].page.borderBox.center,o=Oo({displaced:t.displaced,afterCritical:e,combineWith:a,displacedBy:t.displacedBy});return J(l,o)};const Br=(e,t)=>t.margin[e.start]+t.borderBox[e.size]/2,Lo=(e,t)=>t.margin[e.end]+t.borderBox[e.size]/2,Wn=(e,t,s)=>t[e.crossAxisStart]+s.margin[e.crossAxisStart]+s.borderBox[e.crossAxisSize]/2,Vs=({axis:e,moveRelativeTo:t,isMoving:s})=>Re(e.line,t.marginBox[e.end]+Br(e,s),Wn(e,t.marginBox,s)),Us=({axis:e,moveRelativeTo:t,isMoving:s})=>Re(e.line,t.marginBox[e.start]-Lo(e,s),Wn(e,t.marginBox,s)),Mo=({axis:e,moveInto:t,isMoving:s})=>Re(e.line,t.contentBox[e.start]+Br(e,s),Wn(e,t.contentBox,s));var $o=({impact:e,draggable:t,draggables:s,droppable:r,afterCritical:a})=>{const l=qe(r.descriptor.id,s),o=t.page,i=r.axis;if(!l.length)return Mo({axis:i,moveInto:r.page,isMoving:o});const{displaced:c,displacedBy:p}=e,m=c.all[0];if(m){const d=s[m];if(je(m,a))return Us({axis:i,moveRelativeTo:d.page,isMoving:o});const f=Gt(d.page,p.point);return Us({axis:i,moveRelativeTo:f,isMoving:o})}const u=l[l.length-1];if(u.descriptor.id===t.descriptor.id)return o.borderBox.center;if(je(u.descriptor.id,a)){const d=Gt(u.page,ze(a.displacedBy.point));return Vs({axis:i,moveRelativeTo:d,isMoving:o})}return Vs({axis:i,moveRelativeTo:u.page,isMoving:o})},An=(e,t)=>{const s=e.frame;return s?J(t,s.scroll.diff.displacement):t};const Fo=({impact:e,draggable:t,droppable:s,draggables:r,afterCritical:a})=>{const l=t.page.borderBox.center,o=e.at;return!s||!o?l:o.type==="REORDER"?$o({impact:e,draggable:t,draggables:r,droppable:s,afterCritical:a}):Bo({impact:e,draggables:r,afterCritical:a})};var Zt=e=>{const t=Fo(e),s=e.droppable;return s?An(s,t):t},Lr=(e,t)=>{const s=ne(t,e.scroll.initial),r=ze(s);return{frame:ue({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:s,displacement:r}}}};function Hs(e,t){return e.map(s=>t[s])}function Go(e,t){for(let s=0;s<t.length;s++){const r=t[s].visible[e];if(r)return r}return null}var Wo=({impact:e,viewport:t,destination:s,draggables:r,maxScrollChange:a})=>{const l=Lr(t,J(t.scroll.current,a)),o=s.frame?Mn(s,J(s.frame.scroll.current,a)):s,i=e.displaced,c=lt({afterDragging:Hs(i.all,r),destination:s,displacedBy:e.displacedBy,viewport:l.frame,last:i,forceShouldAnimate:!1}),p=lt({afterDragging:Hs(i.all,r),destination:o,displacedBy:e.displacedBy,viewport:t.frame,last:i,forceShouldAnimate:!1}),m={},u={},d=[i,c,p];return i.all.forEach(v=>{const j=Go(v,d);if(j){u[v]=j;return}m[v]=!0}),{...e,displaced:{all:i.all,invisible:m,visible:u}}},Vo=(e,t)=>J(e.scroll.diff.displacement,t),Vn=({pageBorderBoxCenter:e,draggable:t,viewport:s})=>{const r=Vo(s,e),a=ne(r,t.page.borderBox.center);return J(t.client.borderBox.center,a)},Mr=({draggable:e,destination:t,newPageBorderBoxCenter:s,viewport:r,withDroppableDisplacement:a,onlyOnMainAxis:l=!1})=>{const o=ne(s,e.page.borderBox.center),c={target:dt(e.page.borderBox,o),destination:t,withDroppableDisplacement:a,viewport:r};return l?Eo(c):Or(c)},Uo=({isMovingForward:e,draggable:t,destination:s,draggables:r,previousImpact:a,viewport:l,previousPageBorderBoxCenter:o,previousClientSelection:i,afterCritical:c})=>{if(!s.isEnabled)return null;const p=qe(s.descriptor.id,r),m=Ke(t,s),u=No({isMovingForward:e,draggable:t,destination:s,insideDestination:p,previousImpact:a})||To({isMovingForward:e,isInHomeList:m,draggable:t,draggables:r,destination:s,insideDestination:p,previousImpact:a,viewport:l,afterCritical:c});if(!u)return null;const d=Zt({impact:u,draggable:t,droppable:s,draggables:r,afterCritical:c});if(Mr({draggable:t,destination:s,newPageBorderBoxCenter:d,viewport:l.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0}))return{clientSelection:Vn({pageBorderBoxCenter:d,draggable:t,viewport:l}),impact:u,scrollJumpRequest:null};const v=ne(d,o),j=Wo({impact:u,viewport:l,destination:s,draggables:r,maxScrollChange:v});return{clientSelection:i,impact:j,scrollJumpRequest:v}};const Z=e=>{const t=e.subject.active;return t||w(),t};var Ho=({isMovingForward:e,pageBorderBoxCenter:t,source:s,droppables:r,viewport:a})=>{const l=s.subject.active;if(!l)return null;const o=s.axis,i=oe(l[o.start],l[o.end]),c=Jt(r).filter(m=>m!==s).filter(m=>m.isEnabled).filter(m=>!!m.subject.active).filter(m=>kr(a.frame)(Z(m))).filter(m=>{const u=Z(m);return e?l[o.crossAxisEnd]<u[o.crossAxisEnd]:u[o.crossAxisStart]<l[o.crossAxisStart]}).filter(m=>{const u=Z(m),d=oe(u[o.start],u[o.end]);return i(u[o.start])||i(u[o.end])||d(l[o.start])||d(l[o.end])}).sort((m,u)=>{const d=Z(m)[o.crossAxisStart],f=Z(u)[o.crossAxisStart];return e?d-f:f-d}).filter((m,u,d)=>Z(m)[o.crossAxisStart]===Z(d[0])[o.crossAxisStart]);if(!c.length)return null;if(c.length===1)return c[0];const p=c.filter(m=>oe(Z(m)[o.start],Z(m)[o.end])(t[o.line]));return p.length===1?p[0]:p.length>1?p.sort((m,u)=>Z(m)[o.start]-Z(u)[o.start])[0]:c.sort((m,u)=>{const d=Fs(t,Gs(Z(m))),f=Fs(t,Gs(Z(u)));return d!==f?d-f:Z(m)[o.start]-Z(u)[o.start]})[0]};const zs=(e,t)=>{const s=e.page.borderBox.center;return je(e.descriptor.id,t)?ne(s,t.displacedBy.point):s},zo=(e,t)=>{const s=e.page.borderBox;return je(e.descriptor.id,t)?dt(s,ze(t.displacedBy.point)):s};var qo=({pageBorderBoxCenter:e,viewport:t,destination:s,insideDestination:r,afterCritical:a})=>r.filter(o=>Or({target:zo(o,a),destination:s,viewport:t.frame,withDroppableDisplacement:!0})).sort((o,i)=>{const c=rt(e,An(s,zs(o,a))),p=rt(e,An(s,zs(i,a)));return c<p?-1:p<c?1:o.descriptor.index-i.descriptor.index})[0]||null,ut=q(function(t,s){const r=s[t.line];return{value:r,point:Re(t.line,r)}});const Ko=(e,t,s)=>{const r=e.axis;if(e.descriptor.mode==="virtual")return Re(r.line,t[r.line]);const a=e.subject.page.contentBox[r.size],c=qe(e.descriptor.id,s).reduce((p,m)=>p+m.client.marginBox[r.size],0)+t[r.line]-a;return c<=0?null:Re(r.line,c)},$r=(e,t)=>({...e,scroll:{...e.scroll,max:t}}),Fr=(e,t,s)=>{const r=e.frame;Ke(t,e)&&w(),e.subject.withPlaceholder&&w();const a=ut(e.axis,t.displaceBy).point,l=Ko(e,a,s),o={placeholderSize:a,increasedBy:l,oldFrameMaxScroll:e.frame?e.frame.scroll.max:null};if(!r){const m=Ve({page:e.subject.page,withPlaceholder:o,axis:e.axis,frame:e.frame});return{...e,subject:m}}const i=l?J(r.scroll.max,l):r.scroll.max,c=$r(r,i),p=Ve({page:e.subject.page,withPlaceholder:o,axis:e.axis,frame:c});return{...e,subject:p,frame:c}},Yo=e=>{const t=e.subject.withPlaceholder;t||w();const s=e.frame;if(!s){const o=Ve({page:e.subject.page,axis:e.axis,frame:null,withPlaceholder:null});return{...e,subject:o}}const r=t.oldFrameMaxScroll;r||w();const a=$r(s,r),l=Ve({page:e.subject.page,axis:e.axis,frame:a,withPlaceholder:null});return{...e,subject:l,frame:a}};var Jo=({previousPageBorderBoxCenter:e,moveRelativeTo:t,insideDestination:s,draggable:r,draggables:a,destination:l,viewport:o,afterCritical:i})=>{if(!t){if(s.length)return null;const u={displaced:at,displacedBy:Rr,at:{type:"REORDER",destination:{droppableId:l.descriptor.id,index:0}}},d=Zt({impact:u,draggable:r,droppable:l,draggables:a,afterCritical:i}),f=Ke(r,l)?l:Fr(l,r,a);return Mr({draggable:r,destination:f,newPageBorderBoxCenter:d,viewport:o.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0})?u:null}const c=e[l.axis.line]<=t.page.borderBox.center[l.axis.line],p=(()=>{const u=t.descriptor.index;return t.descriptor.id===r.descriptor.id||c?u:u+1})(),m=ut(l.axis,r.displaceBy);return zt({draggable:r,insideDestination:s,destination:l,viewport:o,displacedBy:m,last:at,index:p})},Xo=({isMovingForward:e,previousPageBorderBoxCenter:t,draggable:s,isOver:r,draggables:a,droppables:l,viewport:o,afterCritical:i})=>{const c=Ho({isMovingForward:e,pageBorderBoxCenter:t,source:r,droppables:l,viewport:o});if(!c)return null;const p=qe(c.descriptor.id,a),m=qo({pageBorderBoxCenter:t,viewport:o,destination:c,insideDestination:p,afterCritical:i}),u=Jo({previousPageBorderBoxCenter:t,destination:c,draggable:s,draggables:a,moveRelativeTo:m,insideDestination:p,viewport:o,afterCritical:i});if(!u)return null;const d=Zt({impact:u,draggable:s,droppable:c,draggables:a,afterCritical:i});return{clientSelection:Vn({pageBorderBoxCenter:d,draggable:s,viewport:o}),impact:u,scrollJumpRequest:null}},se=e=>{const t=e.at;return t?t.type==="REORDER"?t.destination.droppableId:t.combine.droppableId:null};const Qo=(e,t)=>{const s=se(e);return s?t[s]:null};var Zo=({state:e,type:t})=>{const s=Qo(e.impact,e.dimensions.droppables),r=!!s,a=e.dimensions.droppables[e.critical.droppable.id],l=s||a,o=l.axis.direction,i=o==="vertical"&&(t==="MOVE_UP"||t==="MOVE_DOWN")||o==="horizontal"&&(t==="MOVE_LEFT"||t==="MOVE_RIGHT");if(i&&!r)return null;const c=t==="MOVE_DOWN"||t==="MOVE_RIGHT",p=e.dimensions.draggables[e.critical.draggable.id],m=e.current.page.borderBoxCenter,{draggables:u,droppables:d}=e.dimensions;return i?Uo({isMovingForward:c,previousPageBorderBoxCenter:m,draggable:p,destination:l,draggables:u,viewport:e.viewport,previousClientSelection:e.current.client.selection,previousImpact:e.impact,afterCritical:e.afterCritical}):Xo({isMovingForward:c,previousPageBorderBoxCenter:m,draggable:p,isOver:l,draggables:u,droppables:d,viewport:e.viewport,afterCritical:e.afterCritical})};function Pe(e){return e.phase==="DRAGGING"||e.phase==="COLLECTING"}function Gr(e){const t=oe(e.top,e.bottom),s=oe(e.left,e.right);return function(a){return t(a.y)&&s(a.x)}}function ei(e,t){return e.left<t.right&&e.right>t.left&&e.top<t.bottom&&e.bottom>t.top}function ti({pageBorderBox:e,draggable:t,candidates:s}){const r=t.page.borderBox.center,a=s.map(l=>{const o=l.axis,i=Re(l.axis.line,e.center[o.line],l.page.borderBox.center[o.crossAxisLine]);return{id:l.descriptor.id,distance:rt(r,i)}}).sort((l,o)=>o.distance-l.distance);return a[0]?a[0].id:null}function ni({pageBorderBox:e,draggable:t,droppables:s}){const r=Jt(s).filter(a=>{if(!a.isEnabled)return!1;const l=a.subject.active;if(!l||!ei(e,l))return!1;if(Gr(l)(e.center))return!0;const o=a.axis,i=l.center[o.crossAxisLine],c=e[o.crossAxisStart],p=e[o.crossAxisEnd],m=oe(l[o.crossAxisStart],l[o.crossAxisEnd]),u=m(c),d=m(p);return!u&&!d?!0:u?c<i:p>i});return r.length?r.length===1?r[0].descriptor.id:ti({pageBorderBox:e,draggable:t,candidates:r}):null}const Wr=(e,t)=>ue(dt(e,t));var si=(e,t)=>{const s=e.frame;return s?Wr(t,s.scroll.diff.value):t};function Vr({displaced:e,id:t}){return!!(e.visible[t]||e.invisible[t])}function ri({draggable:e,closest:t,inHomeList:s}){return t?s&&t.descriptor.index>e.descriptor.index?t.descriptor.index-1:t.descriptor.index:null}var ai=({pageBorderBoxWithDroppableScroll:e,draggable:t,destination:s,insideDestination:r,last:a,viewport:l,afterCritical:o})=>{const i=s.axis,c=ut(s.axis,t.displaceBy),p=c.value,m=e[i.start],u=e[i.end],f=Qt(t,r).find(j=>{const y=j.descriptor.id,D=j.page.borderBox.center[i.line],R=je(y,o),L=Vr({displaced:a,id:y});return R?L?u<=D:m<D-p:L?u<=D+p:m<D})||null,v=ri({draggable:t,closest:f,inHomeList:Ke(t,s)});return zt({draggable:t,insideDestination:r,destination:s,viewport:l,last:a,displacedBy:c,index:v})};const li=4;var oi=({draggable:e,pageBorderBoxWithDroppableScroll:t,previousImpact:s,destination:r,insideDestination:a,afterCritical:l})=>{if(!r.isCombineEnabled)return null;const o=r.axis,i=ut(r.axis,e.displaceBy),c=i.value,p=t[o.start],m=t[o.end],d=Qt(e,a).find(v=>{const j=v.descriptor.id,y=v.page.borderBox,R=y[o.size]/li,L=je(j,l),P=Vr({displaced:s.displaced,id:j});return L?P?m>y[o.start]+R&&m<y[o.end]-R:p>y[o.start]-c+R&&p<y[o.end]-c-R:P?m>y[o.start]+c+R&&m<y[o.end]+c-R:p>y[o.start]+R&&p<y[o.end]-R});return d?{displacedBy:i,displaced:s.displaced,at:{type:"COMBINE",combine:{draggableId:d.descriptor.id,droppableId:r.descriptor.id}}}:null},Ur=({pageOffset:e,draggable:t,draggables:s,droppables:r,previousImpact:a,viewport:l,afterCritical:o})=>{const i=Wr(t.page.borderBox,e),c=ni({pageBorderBox:i,draggable:t,droppables:r});if(!c)return jo;const p=r[c],m=qe(p.descriptor.id,s),u=si(p,i);return oi({pageBorderBoxWithDroppableScroll:u,draggable:t,previousImpact:a,destination:p,insideDestination:m,afterCritical:o})||ai({pageBorderBoxWithDroppableScroll:u,draggable:t,destination:p,insideDestination:m,last:a.displaced,viewport:l,afterCritical:o})},Un=(e,t)=>({...e,[t.descriptor.id]:t});const ii=({previousImpact:e,impact:t,droppables:s})=>{const r=se(e),a=se(t);if(!r||r===a)return s;const l=s[r];if(!l.subject.withPlaceholder)return s;const o=Yo(l);return Un(s,o)};var ci=({draggable:e,draggables:t,droppables:s,previousImpact:r,impact:a})=>{const l=ii({previousImpact:r,impact:a,droppables:s}),o=se(a);if(!o)return l;const i=s[o];if(Ke(e,i)||i.subject.withPlaceholder)return l;const c=Fr(i,e,t);return Un(l,c)},tt=({state:e,clientSelection:t,dimensions:s,viewport:r,impact:a,scrollJumpRequest:l})=>{const o=r||e.viewport,i=s||e.dimensions,c=t||e.current.client.selection,p=ne(c,e.initial.client.selection),m={offset:p,selection:c,borderBoxCenter:J(e.initial.client.borderBoxCenter,p)},u={selection:J(m.selection,o.scroll.current),borderBoxCenter:J(m.borderBoxCenter,o.scroll.current),offset:J(m.offset,o.scroll.diff.value)},d={client:m,page:u};if(e.phase==="COLLECTING")return{...e,dimensions:i,viewport:o,current:d};const f=i.draggables[e.critical.draggable.id],v=a||Ur({pageOffset:u.offset,draggable:f,draggables:i.draggables,droppables:i.droppables,previousImpact:e.impact,viewport:o,afterCritical:e.afterCritical}),j=ci({draggable:f,impact:v,previousImpact:e.impact,draggables:i.draggables,droppables:i.droppables});return{...e,current:d,dimensions:{draggables:i.draggables,droppables:j},impact:v,viewport:o,scrollJumpRequest:l||null,forceShouldAnimate:l?!1:null}};function di(e,t){return e.map(s=>t[s])}var Hr=({impact:e,viewport:t,draggables:s,destination:r,forceShouldAnimate:a})=>{const l=e.displaced,o=di(l.all,s),i=lt({afterDragging:o,destination:r,displacedBy:e.displacedBy,viewport:t.frame,forceShouldAnimate:a,last:l});return{...e,displaced:i}},zr=({impact:e,draggable:t,droppable:s,draggables:r,viewport:a,afterCritical:l})=>{const o=Zt({impact:e,draggable:t,draggables:r,droppable:s,afterCritical:l});return Vn({pageBorderBoxCenter:o,draggable:t,viewport:a})},qr=({state:e,dimensions:t,viewport:s})=>{e.movementMode!=="SNAP"&&w();const r=e.impact,a=s||e.viewport,l=t||e.dimensions,{draggables:o,droppables:i}=l,c=o[e.critical.draggable.id],p=se(r);p||w();const m=i[p],u=Hr({impact:r,viewport:a,destination:m,draggables:o}),d=zr({impact:u,draggable:c,droppable:m,draggables:o,viewport:a,afterCritical:e.afterCritical});return tt({impact:u,clientSelection:d,state:e,dimensions:l,viewport:a})},ui=e=>({index:e.index,droppableId:e.droppableId}),Kr=({draggable:e,home:t,draggables:s,viewport:r})=>{const a=ut(t.axis,e.displaceBy),l=qe(t.descriptor.id,s),o=l.indexOf(e);o===-1&&w();const i=l.slice(o+1),c=i.reduce((d,f)=>(d[f.descriptor.id]=!0,d),{}),p={inVirtualList:t.descriptor.mode==="virtual",displacedBy:a,effected:c};return{impact:{displaced:lt({afterDragging:i,destination:t,displacedBy:a,last:null,viewport:r.frame,forceShouldAnimate:!1}),displacedBy:a,at:{type:"REORDER",destination:ui(e.descriptor)}},afterCritical:p}},pi=(e,t)=>({draggables:e.draggables,droppables:Un(e.droppables,t)}),mi=({draggable:e,offset:t,initialWindowScroll:s})=>{const r=Gt(e.client,t),a=Wt(r,s);return{...e,placeholder:{...e.placeholder,client:r},client:r,page:a}},xi=e=>{const t=e.frame;return t||w(),t},fi=({additions:e,updatedDroppables:t,viewport:s})=>{const r=s.scroll.diff.value;return e.map(a=>{const l=a.descriptor.droppableId,o=t[l],c=xi(o).scroll.diff.value,p=J(r,c);return mi({draggable:a,offset:p,initialWindowScroll:s.scroll.initial})})},gi=({state:e,published:t})=>{const s=t.modified.map(D=>{const R=e.dimensions.droppables[D.droppableId];return Mn(R,D.scroll)}),r={...e.dimensions.droppables,...Pr(s)},a=_r(fi({additions:t.additions,updatedDroppables:r,viewport:e.viewport})),l={...e.dimensions.draggables,...a};t.removals.forEach(D=>{delete l[D]});const o={droppables:r,draggables:l},i=se(e.impact),c=i?o.droppables[i]:null,p=o.draggables[e.critical.draggable.id],m=o.droppables[e.critical.droppable.id],{impact:u,afterCritical:d}=Kr({draggable:p,home:m,draggables:l,viewport:e.viewport}),f=c&&c.isCombineEnabled?e.impact:u,v=Ur({pageOffset:e.current.page.offset,draggable:o.draggables[e.critical.draggable.id],draggables:o.draggables,droppables:o.droppables,previousImpact:f,viewport:e.viewport,afterCritical:d}),j={...e,phase:"DRAGGING",impact:v,onLiftImpact:u,dimensions:o,afterCritical:d,forceShouldAnimate:!1};return e.phase==="COLLECTING"?j:{...j,phase:"DROP_PENDING",reason:e.reason,isWaiting:!1}};const Pn=e=>e.movementMode==="SNAP",jn=(e,t,s)=>{const r=pi(e.dimensions,t);return!Pn(e)||s?tt({state:e,dimensions:r}):qr({state:e,dimensions:r})};function yn(e){return e.isDragging&&e.movementMode==="SNAP"?{...e,scrollJumpRequest:null}:e}const qs={phase:"IDLE",completed:null,shouldFlush:!1};var hi=(e=qs,t)=>{if(t.type==="FLUSH")return{...qs,shouldFlush:!0};if(t.type==="INITIAL_PUBLISH"){e.phase!=="IDLE"&&w();const{critical:s,clientSelection:r,viewport:a,dimensions:l,movementMode:o}=t.payload,i=l.draggables[s.draggable.id],c=l.droppables[s.droppable.id],p={selection:r,borderBoxCenter:i.client.borderBox.center,offset:K},m={client:p,page:{selection:J(p.selection,a.scroll.initial),borderBoxCenter:J(p.selection,a.scroll.initial),offset:J(p.selection,a.scroll.diff.value)}},u=Jt(l.droppables).every(j=>!j.isFixedOnPage),{impact:d,afterCritical:f}=Kr({draggable:i,home:c,draggables:l.draggables,viewport:a});return{phase:"DRAGGING",isDragging:!0,critical:s,movementMode:o,dimensions:l,initial:m,current:m,isWindowScrollAllowed:u,impact:d,afterCritical:f,onLiftImpact:d,viewport:a,scrollJumpRequest:null,forceShouldAnimate:null}}if(t.type==="COLLECTION_STARTING")return e.phase==="COLLECTING"||e.phase==="DROP_PENDING"?e:(e.phase!=="DRAGGING"&&w(),{...e,phase:"COLLECTING"});if(t.type==="PUBLISH_WHILE_DRAGGING")return e.phase==="COLLECTING"||e.phase==="DROP_PENDING"||w(),gi({state:e,published:t.payload});if(t.type==="MOVE"){if(e.phase==="DROP_PENDING")return e;Pe(e)||w();const{client:s}=t.payload;return Ne(s,e.current.client.selection)?e:tt({state:e,clientSelection:s,impact:Pn(e)?e.impact:null})}if(t.type==="UPDATE_DROPPABLE_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="COLLECTING")return yn(e);Pe(e)||w();const{id:s,newScroll:r}=t.payload,a=e.dimensions.droppables[s];if(!a)return e;const l=Mn(a,r);return jn(e,l,!1)}if(t.type==="UPDATE_DROPPABLE_IS_ENABLED"){if(e.phase==="DROP_PENDING")return e;Pe(e)||w();const{id:s,isEnabled:r}=t.payload,a=e.dimensions.droppables[s];a||w(),a.isEnabled===r&&w();const l={...a,isEnabled:r};return jn(e,l,!0)}if(t.type==="UPDATE_DROPPABLE_IS_COMBINE_ENABLED"){if(e.phase==="DROP_PENDING")return e;Pe(e)||w();const{id:s,isCombineEnabled:r}=t.payload,a=e.dimensions.droppables[s];a||w(),a.isCombineEnabled===r&&w();const l={...a,isCombineEnabled:r};return jn(e,l,!0)}if(t.type==="MOVE_BY_WINDOW_SCROLL"){if(e.phase==="DROP_PENDING"||e.phase==="DROP_ANIMATING")return e;Pe(e)||w(),e.isWindowScrollAllowed||w();const s=t.payload.newScroll;if(Ne(e.viewport.scroll.current,s))return yn(e);const r=Lr(e.viewport,s);return Pn(e)?qr({state:e,viewport:r}):tt({state:e,viewport:r})}if(t.type==="UPDATE_VIEWPORT_MAX_SCROLL"){if(!Pe(e))return e;const s=t.payload.maxScroll;if(Ne(s,e.viewport.scroll.max))return e;const r={...e.viewport,scroll:{...e.viewport.scroll,max:s}};return{...e,viewport:r}}if(t.type==="MOVE_UP"||t.type==="MOVE_DOWN"||t.type==="MOVE_LEFT"||t.type==="MOVE_RIGHT"){if(e.phase==="COLLECTING"||e.phase==="DROP_PENDING")return e;e.phase!=="DRAGGING"&&w();const s=Zo({state:e,type:t.type});return s?tt({state:e,impact:s.impact,clientSelection:s.clientSelection,scrollJumpRequest:s.scrollJumpRequest}):e}if(t.type==="DROP_PENDING"){const s=t.payload.reason;return e.phase!=="COLLECTING"&&w(),{...e,phase:"DROP_PENDING",isWaiting:!0,reason:s}}if(t.type==="DROP_ANIMATE"){const{completed:s,dropDuration:r,newHomeClientOffset:a}=t.payload;return e.phase==="DRAGGING"||e.phase==="DROP_PENDING"||w(),{phase:"DROP_ANIMATING",completed:s,dropDuration:r,newHomeClientOffset:a,dimensions:e.dimensions}}if(t.type==="DROP_COMPLETE"){const{completed:s}=t.payload;return{phase:"IDLE",completed:s,shouldFlush:!1}}return e};function G(e,t){return e instanceof Object&&"type"in e&&e.type===t}const bi=e=>({type:"BEFORE_INITIAL_CAPTURE",payload:e}),vi=e=>({type:"LIFT",payload:e}),Ni=e=>({type:"INITIAL_PUBLISH",payload:e}),ji=e=>({type:"PUBLISH_WHILE_DRAGGING",payload:e}),yi=()=>({type:"COLLECTION_STARTING",payload:null}),wi=e=>({type:"UPDATE_DROPPABLE_SCROLL",payload:e}),Ci=e=>({type:"UPDATE_DROPPABLE_IS_ENABLED",payload:e}),Di=e=>({type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:e}),Yr=e=>({type:"MOVE",payload:e}),Si=e=>({type:"MOVE_BY_WINDOW_SCROLL",payload:e}),Ii=e=>({type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:e}),Ei=()=>({type:"MOVE_UP",payload:null}),Ai=()=>({type:"MOVE_DOWN",payload:null}),Pi=()=>({type:"MOVE_RIGHT",payload:null}),_i=()=>({type:"MOVE_LEFT",payload:null}),Hn=()=>({type:"FLUSH",payload:null}),Ri=e=>({type:"DROP_ANIMATE",payload:e}),zn=e=>({type:"DROP_COMPLETE",payload:e}),Jr=e=>({type:"DROP",payload:e}),ki=e=>({type:"DROP_PENDING",payload:e}),Xr=()=>({type:"DROP_ANIMATION_FINISHED",payload:null});var Ti=e=>({getState:t,dispatch:s})=>r=>a=>{if(!G(a,"LIFT")){r(a);return}const{id:l,clientSelection:o,movementMode:i}=a.payload,c=t();c.phase==="DROP_ANIMATING"&&s(zn({completed:c.completed})),t().phase!=="IDLE"&&w(),s(Hn()),s(bi({draggableId:l,movementMode:i}));const m={draggableId:l,scrollOptions:{shouldPublishImmediately:i==="SNAP"}},{critical:u,dimensions:d,viewport:f}=e.startPublishing(m);s(Ni({critical:u,dimensions:d,clientSelection:o,movementMode:i,viewport:f}))},Oi=e=>()=>t=>s=>{G(s,"INITIAL_PUBLISH")&&e.dragging(),G(s,"DROP_ANIMATE")&&e.dropping(s.payload.completed.result.reason),(G(s,"FLUSH")||G(s,"DROP_COMPLETE"))&&e.resting(),t(s)};const qn={outOfTheWay:"cubic-bezier(0.2, 0, 0, 1)",drop:"cubic-bezier(.2,1,.1,1)"},ot={opacity:{drop:0,combining:.7},scale:{drop:.75}},Qr={outOfTheWay:.2,minDropTime:.33,maxDropTime:.55},Ie=`${Qr.outOfTheWay}s ${qn.outOfTheWay}`,nt={fluid:`opacity ${Ie}`,snap:`transform ${Ie}, opacity ${Ie}`,drop:e=>{const t=`${e}s ${qn.drop}`;return`transform ${t}, opacity ${t}`},outOfTheWay:`transform ${Ie}`,placeholder:`height ${Ie}, width ${Ie}, margin ${Ie}`},Ks=e=>Ne(e,K)?void 0:`translate(${e.x}px, ${e.y}px)`,_n={moveTo:Ks,drop:(e,t)=>{const s=Ks(e);if(s)return t?`${s} scale(${ot.scale.drop})`:s}},{minDropTime:Rn,maxDropTime:Zr}=Qr,Bi=Zr-Rn,Ys=1500,Li=.6;var Mi=({current:e,destination:t,reason:s})=>{const r=rt(e,t);if(r<=0)return Rn;if(r>=Ys)return Zr;const a=r/Ys,l=Rn+Bi*a,o=s==="CANCEL"?l*Li:l;return Number(o.toFixed(2))},$i=({impact:e,draggable:t,dimensions:s,viewport:r,afterCritical:a})=>{const{draggables:l,droppables:o}=s,i=se(e),c=i?o[i]:null,p=o[t.descriptor.droppableId],m=zr({impact:e,draggable:t,draggables:l,afterCritical:a,droppable:c||p,viewport:r});return ne(m,t.client.borderBox.center)},Fi=({draggables:e,reason:t,lastImpact:s,home:r,viewport:a,onLiftImpact:l})=>!s.at||t!=="DROP"?{impact:Hr({draggables:e,impact:l,destination:r,viewport:a,forceShouldAnimate:!0}),didDropInsideDroppable:!1}:s.at.type==="REORDER"?{impact:s,didDropInsideDroppable:!0}:{impact:{...s,displaced:at},didDropInsideDroppable:!0};const Gi=({getState:e,dispatch:t})=>s=>r=>{if(!G(r,"DROP")){s(r);return}const a=e(),l=r.payload.reason;if(a.phase==="COLLECTING"){t(ki({reason:l}));return}if(a.phase==="IDLE")return;a.phase==="DROP_PENDING"&&a.isWaiting&&w(),a.phase==="DRAGGING"||a.phase==="DROP_PENDING"||w();const i=a.critical,c=a.dimensions,p=c.draggables[a.critical.draggable.id],{impact:m,didDropInsideDroppable:u}=Fi({reason:l,lastImpact:a.impact,afterCritical:a.afterCritical,onLiftImpact:a.onLiftImpact,home:a.dimensions.droppables[a.critical.droppable.id],viewport:a.viewport,draggables:a.dimensions.draggables}),d=u?$n(m):null,f=u?Xt(m):null,v={index:i.draggable.index,droppableId:i.droppable.id},j={draggableId:p.descriptor.id,type:p.descriptor.type,source:v,reason:l,mode:a.movementMode,destination:d,combine:f},y=$i({impact:m,draggable:p,dimensions:c,viewport:a.viewport,afterCritical:a.afterCritical}),D={critical:a.critical,afterCritical:a.afterCritical,result:j,impact:m};if(!(!Ne(a.current.client.offset,y)||!!j.combine)){t(zn({completed:D}));return}const L=Mi({current:a.current.client.offset,destination:y,reason:l});t(Ri({newHomeClientOffset:y,dropDuration:L,completed:D}))};var ea=()=>({x:window.pageXOffset,y:window.pageYOffset});function Wi(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:t=>{t.target!==window&&t.target!==window.document||e()}}}function Vi({onWindowScroll:e}){function t(){e(ea())}const s=st(t),r=Wi(s);let a=ve;function l(){return a!==ve}function o(){l()&&w(),a=le(window,[r])}function i(){l()||w(),s.cancel(),a(),a=ve}return{start:o,stop:i,isActive:l}}const Ui=e=>G(e,"DROP_COMPLETE")||G(e,"DROP_ANIMATE")||G(e,"FLUSH"),Hi=e=>{const t=Vi({onWindowScroll:s=>{e.dispatch(Si({newScroll:s}))}});return s=>r=>{!t.isActive()&&G(r,"INITIAL_PUBLISH")&&t.start(),t.isActive()&&Ui(r)&&t.stop(),s(r)}};var zi=e=>{let t=!1,s=!1;const r=setTimeout(()=>{s=!0}),a=l=>{t||s||(t=!0,e(l),clearTimeout(r))};return a.wasCalled=()=>t,a},qi=()=>{const e=[],t=a=>{const l=e.findIndex(i=>i.timerId===a);l===-1&&w();const[o]=e.splice(l,1);o.callback()};return{add:a=>{const l=setTimeout(()=>t(l)),o={timerId:l,callback:a};e.push(o)},flush:()=>{if(!e.length)return;const a=[...e];e.length=0,a.forEach(l=>{clearTimeout(l.timerId),l.callback()})}}};const Ki=(e,t)=>e==null&&t==null?!0:e==null||t==null?!1:e.droppableId===t.droppableId&&e.index===t.index,Yi=(e,t)=>e==null&&t==null?!0:e==null||t==null?!1:e.draggableId===t.draggableId&&e.droppableId===t.droppableId,Ji=(e,t)=>{if(e===t)return!0;const s=e.draggable.id===t.draggable.id&&e.draggable.droppableId===t.draggable.droppableId&&e.draggable.type===t.draggable.type&&e.draggable.index===t.draggable.index,r=e.droppable.id===t.droppable.id&&e.droppable.type===t.droppable.type;return s&&r},Qe=(e,t)=>{t()},Rt=(e,t)=>({draggableId:e.draggable.id,type:e.droppable.type,source:{droppableId:e.droppable.id,index:e.draggable.index},mode:t});function wn(e,t,s,r){if(!e){s(r(t));return}const a=zi(s);e(t,{announce:a}),a.wasCalled()||s(r(t))}var Xi=(e,t)=>{const s=qi();let r=null;const a=(u,d)=>{r&&w(),Qe("onBeforeCapture",()=>{const f=e().onBeforeCapture;f&&f({draggableId:u,mode:d})})},l=(u,d)=>{r&&w(),Qe("onBeforeDragStart",()=>{const f=e().onBeforeDragStart;f&&f(Rt(u,d))})},o=(u,d)=>{r&&w();const f=Rt(u,d);r={mode:d,lastCritical:u,lastLocation:f.source,lastCombine:null},s.add(()=>{Qe("onDragStart",()=>wn(e().onDragStart,f,t,Lt.onDragStart))})},i=(u,d)=>{const f=$n(d),v=Xt(d);r||w();const j=!Ji(u,r.lastCritical);j&&(r.lastCritical=u);const y=!Ki(r.lastLocation,f);y&&(r.lastLocation=f);const D=!Yi(r.lastCombine,v);if(D&&(r.lastCombine=v),!j&&!y&&!D)return;const R={...Rt(u,r.mode),combine:v,destination:f};s.add(()=>{Qe("onDragUpdate",()=>wn(e().onDragUpdate,R,t,Lt.onDragUpdate))})},c=()=>{r||w(),s.flush()},p=u=>{r||w(),r=null,Qe("onDragEnd",()=>wn(e().onDragEnd,u,t,Lt.onDragEnd))};return{beforeCapture:a,beforeStart:l,start:o,update:i,flush:c,drop:p,abort:()=>{if(!r)return;const u={...Rt(r.lastCritical,r.mode),combine:null,destination:null,reason:"CANCEL"};p(u)}}},Qi=(e,t)=>{const s=Xi(e,t);return r=>a=>l=>{if(G(l,"BEFORE_INITIAL_CAPTURE")){s.beforeCapture(l.payload.draggableId,l.payload.movementMode);return}if(G(l,"INITIAL_PUBLISH")){const i=l.payload.critical;s.beforeStart(i,l.payload.movementMode),a(l),s.start(i,l.payload.movementMode);return}if(G(l,"DROP_COMPLETE")){const i=l.payload.completed.result;s.flush(),a(l),s.drop(i);return}if(a(l),G(l,"FLUSH")){s.abort();return}const o=r.getState();o.phase==="DRAGGING"&&s.update(o.critical,o.impact)}};const Zi=e=>t=>s=>{if(!G(s,"DROP_ANIMATION_FINISHED")){t(s);return}const r=e.getState();r.phase!=="DROP_ANIMATING"&&w(),e.dispatch(zn({completed:r.completed}))},ec=e=>{let t=null,s=null;function r(){s&&(cancelAnimationFrame(s),s=null),t&&(t(),t=null)}return a=>l=>{if((G(l,"FLUSH")||G(l,"DROP_COMPLETE")||G(l,"DROP_ANIMATION_FINISHED"))&&r(),a(l),!G(l,"DROP_ANIMATE"))return;const o={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){e.getState().phase==="DROP_ANIMATING"&&e.dispatch(Xr())}};s=requestAnimationFrame(()=>{s=null,t=le(window,[o])})}};var tc=e=>()=>t=>s=>{(G(s,"DROP_COMPLETE")||G(s,"FLUSH")||G(s,"DROP_ANIMATE"))&&e.stopPublishing(),t(s)},nc=e=>{let t=!1;return()=>s=>r=>{if(G(r,"INITIAL_PUBLISH")){t=!0,e.tryRecordFocus(r.payload.critical.draggable.id),s(r),e.tryRestoreFocusRecorded();return}if(s(r),!!t){if(G(r,"FLUSH")){t=!1,e.tryRestoreFocusRecorded();return}if(G(r,"DROP_COMPLETE")){t=!1;const a=r.payload.completed.result;a.combine&&e.tryShiftRecord(a.draggableId,a.combine.draggableId),e.tryRestoreFocusRecorded()}}}};const sc=e=>G(e,"DROP_COMPLETE")||G(e,"DROP_ANIMATE")||G(e,"FLUSH");var rc=e=>t=>s=>r=>{if(sc(r)){e.stop(),s(r);return}if(G(r,"INITIAL_PUBLISH")){s(r);const a=t.getState();a.phase!=="DRAGGING"&&w(),e.start(a);return}s(r),e.scroll(t.getState())};const ac=e=>t=>s=>{if(t(s),!G(s,"PUBLISH_WHILE_DRAGGING"))return;const r=e.getState();r.phase==="DROP_PENDING"&&(r.isWaiting||e.dispatch(Jr({reason:r.reason})))},lc=Vl;var oc=({dimensionMarshal:e,focusMarshal:t,styleMarshal:s,getResponders:r,announce:a,autoScroller:l})=>Gl(hi,lc(Wl(Oi(s),tc(e),Ti(e),Gi,Zi,ec,ac,rc(l),Hi,nc(t),Qi(r,a))));const Cn=()=>({additions:{},removals:{},modified:{}});function ic({registry:e,callbacks:t}){let s=Cn(),r=null;const a=()=>{r||(t.collectionStarting(),r=requestAnimationFrame(()=>{r=null;const{additions:c,removals:p,modified:m}=s,u=Object.keys(c).map(v=>e.draggable.getById(v).getDimension(K)).sort((v,j)=>v.descriptor.index-j.descriptor.index),d=Object.keys(m).map(v=>{const y=e.droppable.getById(v).callbacks.getScrollWhileDragging();return{droppableId:v,scroll:y}}),f={additions:u,removals:Object.keys(p),modified:d};s=Cn(),t.publish(f)}))};return{add:c=>{const p=c.descriptor.id;s.additions[p]=c,s.modified[c.descriptor.droppableId]=!0,s.removals[p]&&delete s.removals[p],a()},remove:c=>{const p=c.descriptor;s.removals[p.id]=!0,s.modified[p.droppableId]=!0,s.additions[p.id]&&delete s.additions[p.id],a()},stop:()=>{r&&(cancelAnimationFrame(r),r=null,s=Cn())}}}var ta=({scrollHeight:e,scrollWidth:t,height:s,width:r})=>{const a=ne({x:t,y:e},{x:r,y:s});return{x:Math.max(0,a.x),y:Math.max(0,a.y)}},na=()=>{const e=document.documentElement;return e||w(),e},sa=()=>{const e=na();return ta({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight})},cc=()=>{const e=ea(),t=sa(),s=e.y,r=e.x,a=na(),l=a.clientWidth,o=a.clientHeight,i=r+l,c=s+o;return{frame:ue({top:s,left:r,right:i,bottom:c}),scroll:{initial:e,current:e,max:t,diff:{value:K,displacement:K}}}},dc=({critical:e,scrollOptions:t,registry:s})=>{const r=cc(),a=r.scroll.current,l=e.droppable,o=s.droppable.getAllByType(l.type).map(m=>m.callbacks.getDimensionAndWatchScroll(a,t)),i=s.draggable.getAllByType(e.draggable.type).map(m=>m.getDimension(a));return{dimensions:{draggables:_r(i),droppables:Pr(o)},critical:e,viewport:r}};function Js(e,t,s){return!(s.descriptor.id===t.id||s.descriptor.type!==t.type||e.droppable.getById(s.descriptor.droppableId).descriptor.mode!=="virtual")}var uc=(e,t)=>{let s=null;const r=ic({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),a=(d,f)=>{e.droppable.exists(d)||w(),s&&t.updateDroppableIsEnabled({id:d,isEnabled:f})},l=(d,f)=>{s&&(e.droppable.exists(d)||w(),t.updateDroppableIsCombineEnabled({id:d,isCombineEnabled:f}))},o=(d,f)=>{s&&(e.droppable.exists(d)||w(),t.updateDroppableScroll({id:d,newScroll:f}))},i=(d,f)=>{s&&e.droppable.getById(d).callbacks.scroll(f)},c=()=>{if(!s)return;r.stop();const d=s.critical.droppable;e.droppable.getAllByType(d.type).forEach(f=>f.callbacks.dragStopped()),s.unsubscribe(),s=null},p=d=>{s||w();const f=s.critical.draggable;d.type==="ADDITION"&&Js(e,f,d.value)&&r.add(d.value),d.type==="REMOVAL"&&Js(e,f,d.value)&&r.remove(d.value)};return{updateDroppableIsEnabled:a,updateDroppableIsCombineEnabled:l,scrollDroppable:i,updateDroppableScroll:o,startPublishing:d=>{s&&w();const f=e.draggable.getById(d.draggableId),v=e.droppable.getById(f.descriptor.droppableId),j={draggable:f.descriptor,droppable:v.descriptor},y=e.subscribe(p);return s={critical:j,unsubscribe:y},dc({critical:j,registry:e,scrollOptions:d.scrollOptions})},stopPublishing:c}},ra=(e,t)=>e.phase==="IDLE"?!0:e.phase!=="DROP_ANIMATING"||e.completed.result.draggableId===t?!1:e.completed.result.reason==="DROP",pc=e=>{window.scrollBy(e.x,e.y)};const mc=q(e=>Jt(e).filter(t=>!(!t.isEnabled||!t.frame))),xc=(e,t)=>mc(t).find(r=>(r.frame||w(),Gr(r.frame.pageMarginBox)(e)))||null;var fc=({center:e,destination:t,droppables:s})=>{if(t){const a=s[t];return a.frame?a:null}return xc(e,s)};const it={startFromPercentage:.25,maxScrollAtPercentage:.05,maxPixelScroll:28,ease:e=>e**2,durationDampening:{stopDampeningAt:1200,accelerateAt:360},disabled:!1};var gc=(e,t,s=()=>it)=>{const r=s(),a=e[t.size]*r.startFromPercentage,l=e[t.size]*r.maxScrollAtPercentage;return{startScrollingFrom:a,maxScrollValueAt:l}},aa=({startOfRange:e,endOfRange:t,current:s})=>{const r=t-e;return r===0?0:(s-e)/r},Kn=1,hc=(e,t,s=()=>it)=>{const r=s();if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return r.maxPixelScroll;if(e===t.startScrollingFrom)return Kn;const l=1-aa({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),o=r.maxPixelScroll*r.ease(l);return Math.ceil(o)},bc=(e,t,s)=>{const r=s(),a=r.durationDampening.accelerateAt,l=r.durationDampening.stopDampeningAt,o=t,i=l,p=Date.now()-o;if(p>=l)return e;if(p<a)return Kn;const m=aa({startOfRange:a,endOfRange:i,current:p}),u=e*r.ease(m);return Math.ceil(u)},Xs=({distanceToEdge:e,thresholds:t,dragStartTime:s,shouldUseTimeDampening:r,getAutoScrollerOptions:a})=>{const l=hc(e,t,a);return l===0?0:r?Math.max(bc(l,s,a),Kn):l},Qs=({container:e,distanceToEdges:t,dragStartTime:s,axis:r,shouldUseTimeDampening:a,getAutoScrollerOptions:l})=>{const o=gc(e,r,l);return t[r.end]<t[r.start]?Xs({distanceToEdge:t[r.end],thresholds:o,dragStartTime:s,shouldUseTimeDampening:a,getAutoScrollerOptions:l}):-1*Xs({distanceToEdge:t[r.start],thresholds:o,dragStartTime:s,shouldUseTimeDampening:a,getAutoScrollerOptions:l})},vc=({container:e,subject:t,proposedScroll:s})=>{const r=t.height>e.height,a=t.width>e.width;return!a&&!r?s:a&&r?null:{x:a?0:s.x,y:r?0:s.y}};const Nc=Ar(e=>e===0?0:e);var la=({dragStartTime:e,container:t,subject:s,center:r,shouldUseTimeDampening:a,getAutoScrollerOptions:l})=>{const o={top:r.y-t.top,right:t.right-r.x,bottom:t.bottom-r.y,left:r.x-t.left},i=Qs({container:t,distanceToEdges:o,dragStartTime:e,axis:Fn,shouldUseTimeDampening:a,getAutoScrollerOptions:l}),c=Qs({container:t,distanceToEdges:o,dragStartTime:e,axis:Tr,shouldUseTimeDampening:a,getAutoScrollerOptions:l}),p=Nc({x:c,y:i});if(Ne(p,K))return null;const m=vc({container:t,subject:s,proposedScroll:p});return m?Ne(m,K)?null:m:null};const jc=Ar(e=>e===0?0:e>0?1:-1),Yn=(()=>{const e=(t,s)=>t<0?t:t>s?t-s:0;return({current:t,max:s,change:r})=>{const a=J(t,r),l={x:e(a.x,s.x),y:e(a.y,s.y)};return Ne(l,K)?null:l}})(),oa=({max:e,current:t,change:s})=>{const r={x:Math.max(t.x,e.x),y:Math.max(t.y,e.y)},a=jc(s),l=Yn({max:r,current:t,change:a});return!l||a.x!==0&&l.x===0||a.y!==0&&l.y===0},Jn=(e,t)=>oa({current:e.scroll.current,max:e.scroll.max,change:t}),yc=(e,t)=>{if(!Jn(e,t))return null;const s=e.scroll.max,r=e.scroll.current;return Yn({current:r,max:s,change:t})},Xn=(e,t)=>{const s=e.frame;return s?oa({current:s.scroll.current,max:s.scroll.max,change:t}):!1},wc=(e,t)=>{const s=e.frame;return!s||!Xn(e,t)?null:Yn({current:s.scroll.current,max:s.scroll.max,change:t})};var Cc=({viewport:e,subject:t,center:s,dragStartTime:r,shouldUseTimeDampening:a,getAutoScrollerOptions:l})=>{const o=la({dragStartTime:r,container:e.frame,subject:t,center:s,shouldUseTimeDampening:a,getAutoScrollerOptions:l});return o&&Jn(e,o)?o:null},Dc=({droppable:e,subject:t,center:s,dragStartTime:r,shouldUseTimeDampening:a,getAutoScrollerOptions:l})=>{const o=e.frame;if(!o)return null;const i=la({dragStartTime:r,container:o.pageMarginBox,subject:t,center:s,shouldUseTimeDampening:a,getAutoScrollerOptions:l});return i&&Xn(e,i)?i:null},Zs=({state:e,dragStartTime:t,shouldUseTimeDampening:s,scrollWindow:r,scrollDroppable:a,getAutoScrollerOptions:l})=>{const o=e.current.page.borderBoxCenter,c=e.dimensions.draggables[e.critical.draggable.id].page.marginBox;if(e.isWindowScrollAllowed){const u=e.viewport,d=Cc({dragStartTime:t,viewport:u,subject:c,center:o,shouldUseTimeDampening:s,getAutoScrollerOptions:l});if(d){r(d);return}}const p=fc({center:o,destination:se(e.impact),droppables:e.dimensions.droppables});if(!p)return;const m=Dc({dragStartTime:t,droppable:p,subject:c,center:o,shouldUseTimeDampening:s,getAutoScrollerOptions:l});m&&a(p.descriptor.id,m)},Sc=({scrollWindow:e,scrollDroppable:t,getAutoScrollerOptions:s=()=>it})=>{const r=st(e),a=st(t);let l=null;const o=p=>{l||w();const{shouldUseTimeDampening:m,dragStartTime:u}=l;Zs({state:p,scrollWindow:r,scrollDroppable:a,dragStartTime:u,shouldUseTimeDampening:m,getAutoScrollerOptions:s})};return{start:p=>{l&&w();const m=Date.now();let u=!1;const d=()=>{u=!0};Zs({state:p,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:d,scrollDroppable:d,getAutoScrollerOptions:s}),l={dragStartTime:m,shouldUseTimeDampening:u},u&&o(p)},stop:()=>{l&&(r.cancel(),a.cancel(),l=null)},scroll:o}},Ic=({move:e,scrollDroppable:t,scrollWindow:s})=>{const r=(i,c)=>{const p=J(i.current.client.selection,c);e({client:p})},a=(i,c)=>{if(!Xn(i,c))return c;const p=wc(i,c);if(!p)return t(i.descriptor.id,c),null;const m=ne(c,p);return t(i.descriptor.id,m),ne(c,m)},l=(i,c,p)=>{if(!i||!Jn(c,p))return p;const m=yc(c,p);if(!m)return s(p),null;const u=ne(p,m);return s(u),ne(p,u)};return i=>{const c=i.scrollJumpRequest;if(!c)return;const p=se(i.impact);p||w();const m=a(i.dimensions.droppables[p],c);if(!m)return;const u=i.viewport,d=l(i.isWindowScrollAllowed,u,m);d&&r(i,d)}},Ec=({scrollDroppable:e,scrollWindow:t,move:s,getAutoScrollerOptions:r})=>{const a=Sc({scrollWindow:t,scrollDroppable:e,getAutoScrollerOptions:r}),l=Ic({move:s,scrollWindow:t,scrollDroppable:e});return{scroll:c=>{if(!(r().disabled||c.phase!=="DRAGGING")){if(c.movementMode==="FLUID"){a.scroll(c);return}c.scrollJumpRequest&&l(c)}},start:a.start,stop:a.stop}};const Ue="data-rfd",He=(()=>{const e=`${Ue}-drag-handle`;return{base:e,draggableId:`${e}-draggable-id`,contextId:`${e}-context-id`}})(),kn=(()=>{const e=`${Ue}-draggable`;return{base:e,contextId:`${e}-context-id`,id:`${e}-id`}})(),Ac=(()=>{const e=`${Ue}-droppable`;return{base:e,contextId:`${e}-context-id`,id:`${e}-id`}})(),er={contextId:`${Ue}-scroll-container-context-id`},Pc=e=>t=>`[${t}="${e}"]`,Ze=(e,t)=>e.map(s=>{const r=s.styles[t];return r?`${s.selector} { ${r} }`:""}).join(" "),_c="pointer-events: none;";var Rc=e=>{const t=Pc(e),s=(()=>{const i=`
      cursor: -webkit-grab;
      cursor: grab;
    `;return{selector:t(He.contextId),styles:{always:`
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: rgba(0,0,0,0);
          touch-action: manipulation;
        `,resting:i,dragging:_c,dropAnimating:i}}})(),r=(()=>{const i=`
      transition: ${nt.outOfTheWay};
    `;return{selector:t(kn.contextId),styles:{dragging:i,dropAnimating:i,userCancel:i}}})(),a={selector:t(Ac.contextId),styles:{always:"overflow-anchor: none;"}},o=[r,s,a,{selector:"body",styles:{dragging:`
        cursor: grabbing;
        cursor: -webkit-grabbing;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        overflow-anchor: none;
      `}}];return{always:Ze(o,"always"),resting:Ze(o,"resting"),dragging:Ze(o,"dragging"),dropAnimating:Ze(o,"dropAnimating"),userCancel:Ze(o,"userCancel")}};const re=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?b.useLayoutEffect:b.useEffect,Dn=()=>{const e=document.querySelector("head");return e||w(),e},tr=e=>{const t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.type="text/css",t};function kc(e,t){const s=$(()=>Rc(e),[e]),r=b.useRef(null),a=b.useRef(null),l=E(q(u=>{const d=a.current;d||w(),d.textContent=u}),[]),o=E(u=>{const d=r.current;d||w(),d.textContent=u},[]);re(()=>{!r.current&&!a.current||w();const u=tr(t),d=tr(t);return r.current=u,a.current=d,u.setAttribute(`${Ue}-always`,e),d.setAttribute(`${Ue}-dynamic`,e),Dn().appendChild(u),Dn().appendChild(d),o(s.always),l(s.resting),()=>{const f=v=>{const j=v.current;j||w(),Dn().removeChild(j),v.current=null};f(r),f(a)}},[t,o,l,s.always,s.resting,e]);const i=E(()=>l(s.dragging),[l,s.dragging]),c=E(u=>{if(u==="DROP"){l(s.dropAnimating);return}l(s.userCancel)},[l,s.dropAnimating,s.userCancel]),p=E(()=>{a.current&&l(s.resting)},[l,s.resting]);return $(()=>({dragging:i,dropping:c,resting:p}),[i,c,p])}function ia(e,t){return Array.from(e.querySelectorAll(t))}var ca=e=>e&&e.ownerDocument&&e.ownerDocument.defaultView?e.ownerDocument.defaultView:window;function en(e){return e instanceof ca(e).HTMLElement}function Tc(e,t){const s=`[${He.contextId}="${e}"]`,r=ia(document,s);if(!r.length)return null;const a=r.find(l=>l.getAttribute(He.draggableId)===t);return!a||!en(a)?null:a}function Oc(e){const t=b.useRef({}),s=b.useRef(null),r=b.useRef(null),a=b.useRef(!1),l=E(function(d,f){const v={id:d,focus:f};return t.current[d]=v,function(){const y=t.current;y[d]!==v&&delete y[d]}},[]),o=E(function(d){const f=Tc(e,d);f&&f!==document.activeElement&&f.focus()},[e]),i=E(function(d,f){s.current===d&&(s.current=f)},[]),c=E(function(){r.current||a.current&&(r.current=requestAnimationFrame(()=>{r.current=null;const d=s.current;d&&o(d)}))},[o]),p=E(function(d){s.current=null;const f=document.activeElement;f&&f.getAttribute(He.draggableId)===d&&(s.current=d)},[]);return re(()=>(a.current=!0,function(){a.current=!1;const d=r.current;d&&cancelAnimationFrame(d)}),[]),$(()=>({register:l,tryRecordFocus:p,tryRestoreFocusRecorded:c,tryShiftRecord:i}),[l,p,c,i])}function Bc(){const e={draggables:{},droppables:{}},t=[];function s(u){return t.push(u),function(){const f=t.indexOf(u);f!==-1&&t.splice(f,1)}}function r(u){t.length&&t.forEach(d=>d(u))}function a(u){return e.draggables[u]||null}function l(u){const d=a(u);return d||w(),d}const o={register:u=>{e.draggables[u.descriptor.id]=u,r({type:"ADDITION",value:u})},update:(u,d)=>{const f=e.draggables[d.descriptor.id];f&&f.uniqueId===u.uniqueId&&(delete e.draggables[d.descriptor.id],e.draggables[u.descriptor.id]=u)},unregister:u=>{const d=u.descriptor.id,f=a(d);f&&u.uniqueId===f.uniqueId&&(delete e.draggables[d],e.droppables[u.descriptor.droppableId]&&r({type:"REMOVAL",value:u}))},getById:l,findById:a,exists:u=>!!a(u),getAllByType:u=>Object.values(e.draggables).filter(d=>d.descriptor.type===u)};function i(u){return e.droppables[u]||null}function c(u){const d=i(u);return d||w(),d}const p={register:u=>{e.droppables[u.descriptor.id]=u},unregister:u=>{const d=i(u.descriptor.id);d&&u.uniqueId===d.uniqueId&&delete e.droppables[u.descriptor.id]},getById:c,findById:i,exists:u=>!!i(u),getAllByType:u=>Object.values(e.droppables).filter(d=>d.descriptor.type===u)};function m(){e.draggables={},e.droppables={},t.length=0}return{draggable:o,droppable:p,subscribe:s,clean:m}}function Lc(){const e=$(Bc,[]);return b.useEffect(()=>function(){e.clean()},[e]),e}var Qn=H.createContext(null),qt=()=>{const e=document.body;return e||w(),e};const Mc={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},$c=e=>`rfd-announcement-${e}`;function Fc(e){const t=$(()=>$c(e),[e]),s=b.useRef(null);return b.useEffect(function(){const l=document.createElement("div");return s.current=l,l.id=t,l.setAttribute("aria-live","assertive"),l.setAttribute("aria-atomic","true"),Vt(l.style,Mc),qt().appendChild(l),function(){setTimeout(function(){const c=qt();c.contains(l)&&c.removeChild(l),l===s.current&&(s.current=null)})}},[t]),E(a=>{const l=s.current;if(l){l.textContent=a;return}},[])}const Gc={separator:"::"};function Zn(e,t=Gc){const s=H.useId();return $(()=>`${e}${t.separator}${s}`,[t.separator,e,s])}function Wc({contextId:e,uniqueId:t}){return`rfd-hidden-text-${e}-${t}`}function Vc({contextId:e,text:t}){const s=Zn("hidden-text",{separator:"-"}),r=$(()=>Wc({contextId:e,uniqueId:s}),[s,e]);return b.useEffect(function(){const l=document.createElement("div");return l.id=r,l.textContent=t,l.style.display="none",qt().appendChild(l),function(){const i=qt();i.contains(l)&&i.removeChild(l)}},[r,t]),r}var tn=H.createContext(null);function da(e){const t=b.useRef(e);return b.useEffect(()=>{t.current=e}),t}function Uc(){let e=null;function t(){return!!e}function s(o){return o===e}function r(o){e&&w();const i={abandon:o};return e=i,i}function a(){e||w(),e=null}function l(){e&&(e.abandon(),a())}return{isClaimed:t,isActive:s,claim:r,release:a,tryAbandon:l}}function ct(e){return e.phase==="IDLE"||e.phase==="DROP_ANIMATING"?!1:e.isDragging}const Hc=9,zc=13,es=27,ua=32,qc=33,Kc=34,Yc=35,Jc=36,Xc=37,Qc=38,Zc=39,ed=40,td={[zc]:!0,[Hc]:!0};var pa=e=>{td[e.keyCode]&&e.preventDefault()};const nn=(()=>{const e="visibilitychange";return typeof document>"u"?e:[e,`ms${e}`,`webkit${e}`,`moz${e}`,`o${e}`].find(r=>`on${r}`in document)||e})(),ma=0,nr=5;function nd(e,t){return Math.abs(t.x-e.x)>=nr||Math.abs(t.y-e.y)>=nr}const sr={type:"IDLE"};function sd({cancel:e,completed:t,getPhase:s,setPhase:r}){return[{eventName:"mousemove",fn:a=>{const{button:l,clientX:o,clientY:i}=a;if(l!==ma)return;const c={x:o,y:i},p=s();if(p.type==="DRAGGING"){a.preventDefault(),p.actions.move(c);return}p.type!=="PENDING"&&w();const m=p.point;if(!nd(m,c))return;a.preventDefault();const u=p.actions.fluidLift(c);r({type:"DRAGGING",actions:u})}},{eventName:"mouseup",fn:a=>{const l=s();if(l.type!=="DRAGGING"){e();return}a.preventDefault(),l.actions.drop({shouldBlockNextClick:!0}),t()}},{eventName:"mousedown",fn:a=>{s().type==="DRAGGING"&&a.preventDefault(),e()}},{eventName:"keydown",fn:a=>{if(s().type==="PENDING"){e();return}if(a.keyCode===es){a.preventDefault(),e();return}pa(a)}},{eventName:"resize",fn:e},{eventName:"scroll",options:{passive:!0,capture:!1},fn:()=>{s().type==="PENDING"&&e()}},{eventName:"webkitmouseforcedown",fn:a=>{const l=s();if(l.type==="IDLE"&&w(),l.actions.shouldRespectForcePress()){e();return}a.preventDefault()}},{eventName:nn,fn:e}]}function rd(e){const t=b.useRef(sr),s=b.useRef(ve),r=$(()=>({eventName:"mousedown",fn:function(u){if(u.defaultPrevented||u.button!==ma||u.ctrlKey||u.metaKey||u.shiftKey||u.altKey)return;const d=e.findClosestDraggableId(u);if(!d)return;const f=e.tryGetLock(d,o,{sourceEvent:u});if(!f)return;u.preventDefault();const v={x:u.clientX,y:u.clientY};s.current(),p(f,v)}}),[e]),a=$(()=>({eventName:"webkitmouseforcewillbegin",fn:m=>{if(m.defaultPrevented)return;const u=e.findClosestDraggableId(m);if(!u)return;const d=e.findOptionsForDraggable(u);d&&(d.shouldRespectForcePress||e.canGetLock(u)&&m.preventDefault())}}),[e]),l=E(function(){const u={passive:!1,capture:!0};s.current=le(window,[a,r],u)},[a,r]),o=E(()=>{t.current.type!=="IDLE"&&(t.current=sr,s.current(),l())},[l]),i=E(()=>{const m=t.current;o(),m.type==="DRAGGING"&&m.actions.cancel({shouldBlockNextClick:!0}),m.type==="PENDING"&&m.actions.abort()},[o]),c=E(function(){const u={capture:!0,passive:!1},d=sd({cancel:i,completed:o,getPhase:()=>t.current,setPhase:f=>{t.current=f}});s.current=le(window,d,u)},[i,o]),p=E(function(u,d){t.current.type!=="IDLE"&&w(),t.current={type:"PENDING",point:d,actions:u},c()},[c]);re(function(){return l(),function(){s.current()}},[l])}function ad(){}const ld={[Kc]:!0,[qc]:!0,[Jc]:!0,[Yc]:!0};function od(e,t){function s(){t(),e.cancel()}function r(){t(),e.drop()}return[{eventName:"keydown",fn:a=>{if(a.keyCode===es){a.preventDefault(),s();return}if(a.keyCode===ua){a.preventDefault(),r();return}if(a.keyCode===ed){a.preventDefault(),e.moveDown();return}if(a.keyCode===Qc){a.preventDefault(),e.moveUp();return}if(a.keyCode===Zc){a.preventDefault(),e.moveRight();return}if(a.keyCode===Xc){a.preventDefault(),e.moveLeft();return}if(ld[a.keyCode]){a.preventDefault();return}pa(a)}},{eventName:"mousedown",fn:s},{eventName:"mouseup",fn:s},{eventName:"click",fn:s},{eventName:"touchstart",fn:s},{eventName:"resize",fn:s},{eventName:"wheel",fn:s,options:{passive:!0}},{eventName:nn,fn:s}]}function id(e){const t=b.useRef(ad),s=$(()=>({eventName:"keydown",fn:function(l){if(l.defaultPrevented||l.keyCode!==ua)return;const o=e.findClosestDraggableId(l);if(!o)return;const i=e.tryGetLock(o,m,{sourceEvent:l});if(!i)return;l.preventDefault();let c=!0;const p=i.snapLift();t.current();function m(){c||w(),c=!1,t.current(),r()}t.current=le(window,od(p,m),{capture:!0,passive:!1})}}),[e]),r=E(function(){const l={passive:!1,capture:!0};t.current=le(window,[s],l)},[s]);re(function(){return r(),function(){t.current()}},[r])}const Sn={type:"IDLE"},cd=120,dd=.15;function ud({cancel:e,getPhase:t}){return[{eventName:"orientationchange",fn:e},{eventName:"resize",fn:e},{eventName:"contextmenu",fn:s=>{s.preventDefault()}},{eventName:"keydown",fn:s=>{if(t().type!=="DRAGGING"){e();return}s.keyCode===es&&s.preventDefault(),e()}},{eventName:nn,fn:e}]}function pd({cancel:e,completed:t,getPhase:s}){return[{eventName:"touchmove",options:{capture:!1},fn:r=>{const a=s();if(a.type!=="DRAGGING"){e();return}a.hasMoved=!0;const{clientX:l,clientY:o}=r.touches[0],i={x:l,y:o};r.preventDefault(),a.actions.move(i)}},{eventName:"touchend",fn:r=>{const a=s();if(a.type!=="DRAGGING"){e();return}r.preventDefault(),a.actions.drop({shouldBlockNextClick:!0}),t()}},{eventName:"touchcancel",fn:r=>{if(s().type!=="DRAGGING"){e();return}r.preventDefault(),e()}},{eventName:"touchforcechange",fn:r=>{const a=s();a.type==="IDLE"&&w();const l=r.touches[0];if(!l||!(l.force>=dd))return;const i=a.actions.shouldRespectForcePress();if(a.type==="PENDING"){i&&e();return}if(i){if(a.hasMoved){r.preventDefault();return}e();return}r.preventDefault()}},{eventName:nn,fn:e}]}function md(e){const t=b.useRef(Sn),s=b.useRef(ve),r=E(function(){return t.current},[]),a=E(function(f){t.current=f},[]),l=$(()=>({eventName:"touchstart",fn:function(f){if(f.defaultPrevented)return;const v=e.findClosestDraggableId(f);if(!v)return;const j=e.tryGetLock(v,i,{sourceEvent:f});if(!j)return;const y=f.touches[0],{clientX:D,clientY:R}=y,L={x:D,y:R};s.current(),u(j,L)}}),[e]),o=E(function(){const f={capture:!0,passive:!1};s.current=le(window,[l],f)},[l]),i=E(()=>{const d=t.current;d.type!=="IDLE"&&(d.type==="PENDING"&&clearTimeout(d.longPressTimerId),a(Sn),s.current(),o())},[o,a]),c=E(()=>{const d=t.current;i(),d.type==="DRAGGING"&&d.actions.cancel({shouldBlockNextClick:!0}),d.type==="PENDING"&&d.actions.abort()},[i]),p=E(function(){const f={capture:!0,passive:!1},v={cancel:c,completed:i,getPhase:r},j=le(window,pd(v),f),y=le(window,ud(v),f);s.current=function(){j(),y()}},[c,r,i]),m=E(function(){const f=r();f.type!=="PENDING"&&w();const v=f.actions.fluidLift(f.point);a({type:"DRAGGING",actions:v,hasMoved:!1})},[r,a]),u=E(function(f,v){r().type!=="IDLE"&&w();const j=setTimeout(m,cd);a({type:"PENDING",point:v,actions:f,longPressTimerId:j}),p()},[p,r,a,m]);re(function(){return o(),function(){s.current();const v=r();v.type==="PENDING"&&(clearTimeout(v.longPressTimerId),a(Sn))}},[r,o,a]),re(function(){return le(window,[{eventName:"touchmove",fn:()=>{},options:{capture:!1,passive:!1}}])},[])}const xd=["input","button","textarea","select","option","optgroup","video","audio"];function xa(e,t){if(t==null)return!1;if(xd.includes(t.tagName.toLowerCase()))return!0;const r=t.getAttribute("contenteditable");return r==="true"||r===""?!0:t===e?!1:xa(e,t.parentElement)}function fd(e,t){const s=t.target;return en(s)?xa(e,s):!1}var gd=e=>ue(e.getBoundingClientRect()).center;function hd(e){return e instanceof ca(e).Element}const bd=(()=>{const e="matches";return typeof document>"u"?e:[e,"msMatchesSelector","webkitMatchesSelector"].find(r=>r in Element.prototype)||e})();function fa(e,t){return e==null?null:e[bd](t)?e:fa(e.parentElement,t)}function vd(e,t){return e.closest?e.closest(t):fa(e,t)}function Nd(e){return`[${He.contextId}="${e}"]`}function jd(e,t){const s=t.target;if(!hd(s))return null;const r=Nd(e),a=vd(s,r);return!a||!en(a)?null:a}function yd(e,t){const s=jd(e,t);return s?s.getAttribute(He.draggableId):null}function wd(e,t){const s=`[${kn.contextId}="${e}"]`,a=ia(document,s).find(l=>l.getAttribute(kn.id)===t);return!a||!en(a)?null:a}function Cd(e){e.preventDefault()}function kt({expected:e,phase:t,isLockActive:s,shouldWarn:r}){return!(!s()||e!==t)}function ga({lockAPI:e,store:t,registry:s,draggableId:r}){if(e.isClaimed())return!1;const a=s.draggable.findById(r);return!(!a||!a.options.isEnabled||!ra(t.getState(),r))}function Dd({lockAPI:e,contextId:t,store:s,registry:r,draggableId:a,forceSensorStop:l,sourceEvent:o}){if(!ga({lockAPI:e,store:s,registry:r,draggableId:a}))return null;const c=r.draggable.getById(a),p=wd(t,c.descriptor.id);if(!p||o&&!c.options.canDragInteractiveElements&&fd(p,o))return null;const m=e.claim(l||ve);let u="PRE_DRAG";function d(){return c.options.shouldRespectForcePress}function f(){return e.isActive(m)}function v(O,S){kt({expected:O,phase:u,isLockActive:f,shouldWarn:!0})&&s.dispatch(S())}const j=v.bind(null,"DRAGGING");function y(O){function S(){e.release(),u="COMPLETED"}u!=="PRE_DRAG"&&(S(),w()),s.dispatch(vi(O.liftActionArgs)),u="DRAGGING";function _(k,Y={shouldBlockNextClick:!1}){if(O.cleanup(),Y.shouldBlockNextClick){const I=le(window,[{eventName:"click",fn:Cd,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(I)}S(),s.dispatch(Jr({reason:k}))}return{isActive:()=>kt({expected:"DRAGGING",phase:u,isLockActive:f,shouldWarn:!1}),shouldRespectForcePress:d,drop:k=>_("DROP",k),cancel:k=>_("CANCEL",k),...O.actions}}function D(O){const S=st(k=>{j(()=>Yr({client:k}))});return{...y({liftActionArgs:{id:a,clientSelection:O,movementMode:"FLUID"},cleanup:()=>S.cancel(),actions:{move:S}}),move:S}}function R(){const O={moveUp:()=>j(Ei),moveRight:()=>j(Pi),moveDown:()=>j(Ai),moveLeft:()=>j(_i)};return y({liftActionArgs:{id:a,clientSelection:gd(p),movementMode:"SNAP"},cleanup:ve,actions:O})}function L(){kt({expected:"PRE_DRAG",phase:u,isLockActive:f,shouldWarn:!0})&&e.release()}return{isActive:()=>kt({expected:"PRE_DRAG",phase:u,isLockActive:f,shouldWarn:!1}),shouldRespectForcePress:d,fluidLift:D,snapLift:R,abort:L}}const Sd=[rd,id,md];function Id({contextId:e,store:t,registry:s,customSensors:r,enableDefaultSensors:a}){const l=[...a?Sd:[],...r||[]],o=b.useState(()=>Uc())[0],i=E(function(y,D){ct(y)&&!ct(D)&&o.tryAbandon()},[o]);re(function(){let y=t.getState();return t.subscribe(()=>{const R=t.getState();i(y,R),y=R})},[o,t,i]),re(()=>o.tryAbandon,[o.tryAbandon]);const c=E(j=>ga({lockAPI:o,registry:s,store:t,draggableId:j}),[o,s,t]),p=E((j,y,D)=>Dd({lockAPI:o,registry:s,contextId:e,store:t,draggableId:j,forceSensorStop:y||null,sourceEvent:D&&D.sourceEvent?D.sourceEvent:null}),[e,o,s,t]),m=E(j=>yd(e,j),[e]),u=E(j=>{const y=s.draggable.findById(j);return y?y.options:null},[s.draggable]),d=E(function(){o.isClaimed()&&(o.tryAbandon(),t.getState().phase!=="IDLE"&&t.dispatch(Hn()))},[o,t]),f=E(()=>o.isClaimed(),[o]),v=$(()=>({canGetLock:c,tryGetLock:p,findClosestDraggableId:m,findOptionsForDraggable:u,tryReleaseLock:d,isLockClaimed:f}),[c,p,m,u,d,f]);for(let j=0;j<l.length;j++)l[j](v)}const Ed=e=>({onBeforeCapture:t=>{const s=()=>{e.onBeforeCapture&&e.onBeforeCapture(t)};gr.flushSync(s)},onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onDragUpdate:e.onDragUpdate}),Ad=e=>({...it,...e.autoScrollerOptions,durationDampening:{...it.durationDampening,...e.autoScrollerOptions}});function et(e){return e.current||w(),e.current}function Pd(e){const{contextId:t,setCallbacks:s,sensors:r,nonce:a,dragHandleUsageInstructions:l}=e,o=b.useRef(null),i=da(e),c=E(()=>Ed(i.current),[i]),p=E(()=>Ad(i.current),[i]),m=Fc(t),u=Vc({contextId:t,text:l}),d=kc(t,a),f=E(I=>{et(o).dispatch(I)},[]),v=$(()=>Rs({publishWhileDragging:ji,updateDroppableScroll:wi,updateDroppableIsEnabled:Ci,updateDroppableIsCombineEnabled:Di,collectionStarting:yi},f),[f]),j=Lc(),y=$(()=>uc(j,v),[j,v]),D=$(()=>Ec({scrollWindow:pc,scrollDroppable:y.scrollDroppable,getAutoScrollerOptions:p,...Rs({move:Yr},f)}),[y.scrollDroppable,f,p]),R=Oc(t),L=$(()=>oc({announce:m,autoScroller:D,dimensionMarshal:y,focusMarshal:R,getResponders:c,styleMarshal:d}),[m,D,y,R,c,d]);o.current=L;const P=E(()=>{const I=et(o);I.getState().phase!=="IDLE"&&I.dispatch(Hn())},[]),O=E(()=>{const I=et(o).getState();return I.phase==="DROP_ANIMATING"?!0:I.phase==="IDLE"?!1:I.isDragging},[]),S=$(()=>({isDragging:O,tryAbort:P}),[O,P]);s(S);const _=E(I=>ra(et(o).getState(),I),[]),k=E(()=>Pe(et(o).getState()),[]),Y=$(()=>({marshal:y,focus:R,contextId:t,canLift:_,isMovementAllowed:k,dragHandleUsageInstructionsId:u,registry:j}),[t,y,u,R,_,k,j]);return Id({contextId:t,store:L,registry:j,customSensors:r||null,enableDefaultSensors:e.enableDefaultSensors!==!1}),b.useEffect(()=>P,[P]),H.createElement(tn.Provider,{value:Y},H.createElement(Fl,{context:Qn,store:L},e.children))}function _d(){return H.useId()}function Rd(e){const t=_d(),s=e.dragHandleUsageInstructions||Lt.dragHandleUsageInstructions;return H.createElement(oo,null,r=>H.createElement(Pd,{nonce:e.nonce,contextId:t,setCallbacks:r,dragHandleUsageInstructions:s,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd,autoScrollerOptions:e.autoScrollerOptions},e.children))}const rr={dragging:5e3,dropAnimating:4500},kd=(e,t)=>t?nt.drop(t.duration):e?nt.snap:nt.fluid,Td=(e,t)=>{if(e)return t?ot.opacity.drop:ot.opacity.combining},Od=e=>e.forceShouldAnimate!=null?e.forceShouldAnimate:e.mode==="SNAP";function Bd(e){const s=e.dimension.client,{offset:r,combineWith:a,dropping:l}=e,o=!!a,i=Od(e),c=!!l,p=c?_n.drop(r,o):_n.moveTo(r);return{position:"fixed",top:s.marginBox.top,left:s.marginBox.left,boxSizing:"border-box",width:s.borderBox.width,height:s.borderBox.height,transition:kd(i,l),transform:p,opacity:Td(o,c),zIndex:c?rr.dropAnimating:rr.dragging,pointerEvents:"none"}}function Ld(e){return{transform:_n.moveTo(e.offset),transition:e.shouldAnimateDisplacement?void 0:"none"}}function Md(e){return e.type==="DRAGGING"?Bd(e):Ld(e)}function $d(e,t,s=K){const r=window.getComputedStyle(t),a=t.getBoundingClientRect(),l=wr(a,r),o=Wt(l,s),i={client:l,tagName:t.tagName.toLowerCase(),display:r.display},c={x:l.marginBox.width,y:l.marginBox.height};return{descriptor:e,placeholder:i,displaceBy:c,client:l,page:o}}function Fd(e){const t=Zn("draggable"),{descriptor:s,registry:r,getDraggableRef:a,canDragInteractiveElements:l,shouldRespectForcePress:o,isEnabled:i}=e,c=$(()=>({canDragInteractiveElements:l,shouldRespectForcePress:o,isEnabled:i}),[l,i,o]),p=E(f=>{const v=a();return v||w(),$d(s,v,f)},[s,a]),m=$(()=>({uniqueId:t,descriptor:s,options:c,getDimension:p}),[s,p,c,t]),u=b.useRef(m),d=b.useRef(!0);re(()=>(r.draggable.register(u.current),()=>r.draggable.unregister(u.current)),[r.draggable]),re(()=>{if(d.current){d.current=!1;return}const f=u.current;u.current=m,r.draggable.update(m,f)},[m,r.draggable])}var ts=H.createContext(null);function Kt(e){const t=b.useContext(e);return t||w(),t}function Gd(e){e.preventDefault()}const Wd=e=>{const t=b.useRef(null),s=E((S=null)=>{t.current=S},[]),r=E(()=>t.current,[]),{contextId:a,dragHandleUsageInstructionsId:l,registry:o}=Kt(tn),{type:i,droppableId:c}=Kt(ts),p=$(()=>({id:e.draggableId,index:e.index,type:i,droppableId:c}),[e.draggableId,e.index,i,c]),{children:m,draggableId:u,isEnabled:d,shouldRespectForcePress:f,canDragInteractiveElements:v,isClone:j,mapped:y,dropAnimationFinished:D}=e;if(!j){const S=$(()=>({descriptor:p,registry:o,getDraggableRef:r,canDragInteractiveElements:v,shouldRespectForcePress:f,isEnabled:d}),[p,o,r,v,f,d]);Fd(S)}const R=$(()=>d?{tabIndex:0,role:"button","aria-describedby":l,"data-rfd-drag-handle-draggable-id":u,"data-rfd-drag-handle-context-id":a,draggable:!1,onDragStart:Gd}:null,[a,l,u,d]),L=E(S=>{y.type==="DRAGGING"&&y.dropping&&S.propertyName==="transform"&&gr.flushSync(D)},[D,y]),P=$(()=>{const S=Md(y),_=y.type==="DRAGGING"&&y.dropping?L:void 0;return{innerRef:s,draggableProps:{"data-rfd-draggable-context-id":a,"data-rfd-draggable-id":u,style:S,onTransitionEnd:_},dragHandleProps:R}},[a,R,u,y,L,s]),O=$(()=>({draggableId:p.id,type:p.type,source:{index:p.index,droppableId:p.droppableId}}),[p.droppableId,p.id,p.index,p.type]);return H.createElement(H.Fragment,null,m(P,y.snapshot,O))};var ha=(e,t)=>e===t,ba=e=>{const{combine:t,destination:s}=e;return s?s.droppableId:t?t.droppableId:null};const Vd=e=>e.combine?e.combine.draggableId:null,Ud=e=>e.at&&e.at.type==="COMBINE"?e.at.combine.draggableId:null;function Hd(){const e=q((a,l)=>({x:a,y:l})),t=q((a,l,o=null,i=null,c=null)=>({isDragging:!0,isClone:l,isDropAnimating:!!c,dropAnimation:c,mode:a,draggingOver:o,combineWith:i,combineTargetFor:null})),s=q((a,l,o,i,c=null,p=null,m=null)=>({mapped:{type:"DRAGGING",dropping:null,draggingOver:c,combineWith:p,mode:l,offset:a,dimension:o,forceShouldAnimate:m,snapshot:t(l,i,c,p,null)}}));return(a,l)=>{if(ct(a)){if(a.critical.draggable.id!==l.draggableId)return null;const o=a.current.client.offset,i=a.dimensions.draggables[l.draggableId],c=se(a.impact),p=Ud(a.impact),m=a.forceShouldAnimate;return s(e(o.x,o.y),a.movementMode,i,l.isClone,c,p,m)}if(a.phase==="DROP_ANIMATING"){const o=a.completed;if(o.result.draggableId!==l.draggableId)return null;const i=l.isClone,c=a.dimensions.draggables[l.draggableId],p=o.result,m=p.mode,u=ba(p),d=Vd(p),v={duration:a.dropDuration,curve:qn.drop,moveTo:a.newHomeClientOffset,opacity:d?ot.opacity.drop:null,scale:d?ot.scale.drop:null};return{mapped:{type:"DRAGGING",offset:a.newHomeClientOffset,dimension:c,dropping:v,draggingOver:u,combineWith:d,mode:m,forceShouldAnimate:null,snapshot:t(m,i,u,d,v)}}}return null}}function va(e=null){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}const zd={mapped:{type:"SECONDARY",offset:K,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:va(null)}};function qd(){const e=q((o,i)=>({x:o,y:i})),t=q(va),s=q((o,i=null,c)=>({mapped:{type:"SECONDARY",offset:o,combineTargetFor:i,shouldAnimateDisplacement:c,snapshot:t(i)}})),r=o=>o?s(K,o,!0):null,a=(o,i,c,p)=>{const m=c.displaced.visible[o],u=!!(p.inVirtualList&&p.effected[o]),d=Xt(c),f=d&&d.draggableId===o?i:null;if(!m){if(!u)return r(f);if(c.displaced.invisible[o])return null;const y=ze(p.displacedBy.point),D=e(y.x,y.y);return s(D,f,!0)}if(u)return r(f);const v=c.displacedBy.point,j=e(v.x,v.y);return s(j,f,m.shouldAnimate)};return(o,i)=>{if(ct(o))return o.critical.draggable.id===i.draggableId?null:a(i.draggableId,o.critical.draggable.id,o.impact,o.afterCritical);if(o.phase==="DROP_ANIMATING"){const c=o.completed;return c.result.draggableId===i.draggableId?null:a(i.draggableId,c.result.draggableId,c.impact,c.afterCritical)}return null}}const Kd=()=>{const e=Hd(),t=qd();return(r,a)=>e(r,a)||t(r,a)||zd},Yd={dropAnimationFinished:Xr},Jd=yr(Kd,Yd,null,{context:Qn,areStatePropsEqual:ha})(Wd);function Na(e){return Kt(ts).isUsingCloneFor===e.draggableId&&!e.isClone?null:H.createElement(Jd,e)}function Xd(e){const t=typeof e.isDragDisabled=="boolean"?!e.isDragDisabled:!0,s=!!e.disableInteractiveElementBlocking,r=!!e.shouldRespectForcePress;return H.createElement(Na,Vt({},e,{isClone:!1,isEnabled:t,canDragInteractiveElements:s,shouldRespectForcePress:r}))}const ja=e=>t=>e===t,Qd=ja("scroll"),Zd=ja("auto"),ar=(e,t)=>t(e.overflowX)||t(e.overflowY),eu=e=>{const t=window.getComputedStyle(e),s={overflowX:t.overflowX,overflowY:t.overflowY};return ar(s,Qd)||ar(s,Zd)},tu=()=>!1,ya=e=>e==null?null:e===document.body?tu()?e:null:e===document.documentElement?null:eu(e)?e:ya(e.parentElement);var Tn=e=>({x:e.scrollLeft,y:e.scrollTop});const wa=e=>e?window.getComputedStyle(e).position==="fixed"?!0:wa(e.parentElement):!1;var nu=e=>{const t=ya(e),s=wa(e);return{closestScrollable:t,isFixedOnPage:s}},su=({descriptor:e,isEnabled:t,isCombineEnabled:s,isFixedOnPage:r,direction:a,client:l,page:o,closest:i})=>{const c=(()=>{if(!i)return null;const{scrollSize:d,client:f}=i,v=ta({scrollHeight:d.scrollHeight,scrollWidth:d.scrollWidth,height:f.paddingBox.height,width:f.paddingBox.width});return{pageMarginBox:i.page.marginBox,frameClient:f,scrollSize:d,shouldClipSubject:i.shouldClipSubject,scroll:{initial:i.scroll,current:i.scroll,max:v,diff:{value:K,displacement:K}}}})(),p=a==="vertical"?Fn:Tr,m=Ve({page:o,withPlaceholder:null,axis:p,frame:c});return{descriptor:e,isCombineEnabled:s,isFixedOnPage:r,axis:p,isEnabled:t,client:l,page:o,frame:c,subject:m}};const ru=(e,t)=>{const s=Cr(e);if(!t||e!==t)return s;const r=s.paddingBox.top-t.scrollTop,a=s.paddingBox.left-t.scrollLeft,l=r+t.scrollHeight,o=a+t.scrollWidth,c=Bn({top:r,right:o,bottom:l,left:a},s.border);return Ln({borderBox:c,margin:s.margin,border:s.border,padding:s.padding})};var au=({ref:e,descriptor:t,env:s,windowScroll:r,direction:a,isDropDisabled:l,isCombineEnabled:o,shouldClipSubject:i})=>{const c=s.closestScrollable,p=ru(e,c),m=Wt(p,r),u=(()=>{if(!c)return null;const f=Cr(c),v={scrollHeight:c.scrollHeight,scrollWidth:c.scrollWidth};return{client:f,page:Wt(f,r),scroll:Tn(c),scrollSize:v,shouldClipSubject:i}})();return su({descriptor:t,isEnabled:!l,isCombineEnabled:o,isFixedOnPage:s.isFixedOnPage,direction:a,client:p,page:m,closest:u})};const lu={passive:!1},ou={passive:!0};var lr=e=>e.shouldPublishImmediately?lu:ou;const Tt=e=>e&&e.env.closestScrollable||null;function iu(e){const t=b.useRef(null),s=Kt(tn),r=Zn("droppable"),{registry:a,marshal:l}=s,o=da(e),i=$(()=>({id:e.droppableId,type:e.type,mode:e.mode}),[e.droppableId,e.mode,e.type]),c=b.useRef(i),p=$(()=>q((P,O)=>{t.current||w();const S={x:P,y:O};l.updateDroppableScroll(i.id,S)}),[i.id,l]),m=E(()=>{const P=t.current;return!P||!P.env.closestScrollable?K:Tn(P.env.closestScrollable)},[]),u=E(()=>{const P=m();p(P.x,P.y)},[m,p]),d=$(()=>st(u),[u]),f=E(()=>{const P=t.current,O=Tt(P);if(P&&O||w(),P.scrollOptions.shouldPublishImmediately){u();return}d()},[d,u]),v=E((P,O)=>{t.current&&w();const S=o.current,_=S.getDroppableRef();_||w();const k=nu(_),Y={ref:_,descriptor:i,env:k,scrollOptions:O};t.current=Y;const I=au({ref:_,descriptor:i,env:k,windowScroll:P,direction:S.direction,isDropDisabled:S.isDropDisabled,isCombineEnabled:S.isCombineEnabled,shouldClipSubject:!S.ignoreContainerClipping}),F=k.closestScrollable;return F&&(F.setAttribute(er.contextId,s.contextId),F.addEventListener("scroll",f,lr(Y.scrollOptions))),I},[s.contextId,i,f,o]),j=E(()=>{const P=t.current,O=Tt(P);return P&&O||w(),Tn(O)},[]),y=E(()=>{const P=t.current;P||w();const O=Tt(P);t.current=null,O&&(d.cancel(),O.removeAttribute(er.contextId),O.removeEventListener("scroll",f,lr(P.scrollOptions)))},[f,d]),D=E(P=>{const O=t.current;O||w();const S=Tt(O);S||w(),S.scrollTop+=P.y,S.scrollLeft+=P.x},[]),R=$(()=>({getDimensionAndWatchScroll:v,getScrollWhileDragging:j,dragStopped:y,scroll:D}),[y,v,j,D]),L=$(()=>({uniqueId:r,descriptor:i,callbacks:R}),[R,i,r]);re(()=>(c.current=L.descriptor,a.droppable.register(L),()=>{t.current&&y(),a.droppable.unregister(L)}),[R,i,y,L,l,a.droppable]),re(()=>{t.current&&l.updateDroppableIsEnabled(c.current.id,!e.isDropDisabled)},[e.isDropDisabled,l]),re(()=>{t.current&&l.updateDroppableIsCombineEnabled(c.current.id,e.isCombineEnabled)},[e.isCombineEnabled,l])}function In(){}const or={width:0,height:0,margin:fo},cu=({isAnimatingOpenOnMount:e,placeholder:t,animate:s})=>e||s==="close"?or:{height:t.client.borderBox.height,width:t.client.borderBox.width,margin:t.client.margin},du=({isAnimatingOpenOnMount:e,placeholder:t,animate:s})=>{const r=cu({isAnimatingOpenOnMount:e,placeholder:t,animate:s});return{display:t.display,boxSizing:"border-box",width:r.width,height:r.height,marginTop:r.margin.top,marginRight:r.margin.right,marginBottom:r.margin.bottom,marginLeft:r.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:s!=="none"?nt.placeholder:null}},uu=e=>{const t=b.useRef(null),s=E(()=>{t.current&&(clearTimeout(t.current),t.current=null)},[]),{animate:r,onTransitionEnd:a,onClose:l,contextId:o}=e,[i,c]=b.useState(e.animate==="open");b.useEffect(()=>i?r!=="open"?(s(),c(!1),In):t.current?In:(t.current=setTimeout(()=>{t.current=null,c(!1)}),s):In,[r,i,s]);const p=E(u=>{u.propertyName==="height"&&(a(),r==="close"&&l())},[r,l,a]),m=du({isAnimatingOpenOnMount:i,animate:e.animate,placeholder:e.placeholder});return H.createElement(e.placeholder.tagName,{style:m,"data-rfd-placeholder-context-id":o,onTransitionEnd:p,ref:e.innerRef})};var pu=H.memo(uu);class mu extends H.PureComponent{constructor(...t){super(...t),this.state={isVisible:!!this.props.on,data:this.props.on,animate:this.props.shouldAnimate&&this.props.on?"open":"none"},this.onClose=()=>{this.state.animate==="close"&&this.setState({isVisible:!1})}}static getDerivedStateFromProps(t,s){return t.shouldAnimate?t.on?{isVisible:!0,data:t.on,animate:"open"}:s.isVisible?{isVisible:!0,data:s.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:!!t.on,data:t.on,animate:"none"}}render(){if(!this.state.isVisible)return null;const t={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(t)}}const xu=e=>{const t=b.useContext(tn);t||w();const{contextId:s,isMovementAllowed:r}=t,a=b.useRef(null),l=b.useRef(null),{children:o,droppableId:i,type:c,mode:p,direction:m,ignoreContainerClipping:u,isDropDisabled:d,isCombineEnabled:f,snapshot:v,useClone:j,updateViewportMaxScroll:y,getContainerForClone:D}=e,R=E(()=>a.current,[]),L=E((F=null)=>{a.current=F},[]);E(()=>l.current,[]);const P=E((F=null)=>{l.current=F},[]),O=E(()=>{r()&&y({maxScroll:sa()})},[r,y]);iu({droppableId:i,type:c,mode:p,direction:m,isDropDisabled:d,isCombineEnabled:f,ignoreContainerClipping:u,getDroppableRef:R});const S=$(()=>H.createElement(mu,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},({onClose:F,data:W,animate:ie})=>H.createElement(pu,{placeholder:W,onClose:F,innerRef:P,animate:ie,contextId:s,onTransitionEnd:O})),[s,O,e.placeholder,e.shouldAnimatePlaceholder,P]),_=$(()=>({innerRef:L,placeholder:S,droppableProps:{"data-rfd-droppable-id":i,"data-rfd-droppable-context-id":s}}),[s,i,S,L]),k=j?j.dragging.draggableId:null,Y=$(()=>({droppableId:i,type:c,isUsingCloneFor:k}),[i,k,c]);function I(){if(!j)return null;const{dragging:F,render:W}=j,ie=H.createElement(Na,{draggableId:F.draggableId,index:F.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},(U,xe)=>W(U,xe,F));return vl.createPortal(ie,D())}return H.createElement(ts.Provider,{value:Y},o(_,v),I())};function fu(){return document.body||w(),document.body}const ir={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:fu},Ca=e=>{let t={...e},s;for(s in ir)e[s]===void 0&&(t={...t,[s]:ir[s]});return t},En=(e,t)=>e===t.droppable.type,cr=(e,t)=>t.draggables[e.draggable.id],gu=()=>{const e={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},t={...e,shouldAnimatePlaceholder:!1},s=q(l=>({draggableId:l.id,type:l.type,source:{index:l.index,droppableId:l.droppableId}})),r=q((l,o,i,c,p,m)=>{const u=p.descriptor.id;if(p.descriptor.droppableId===l){const v=m?{render:m,dragging:s(p.descriptor)}:null,j={isDraggingOver:i,draggingOverWith:i?u:null,draggingFromThisWith:u,isUsingPlaceholder:!0};return{placeholder:p.placeholder,shouldAnimatePlaceholder:!1,snapshot:j,useClone:v}}if(!o)return t;if(!c)return e;const f={isDraggingOver:i,draggingOverWith:u,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:p.placeholder,shouldAnimatePlaceholder:!0,snapshot:f,useClone:null}});return(l,o)=>{const i=Ca(o),c=i.droppableId,p=i.type,m=!i.isDropDisabled,u=i.renderClone;if(ct(l)){const d=l.critical;if(!En(p,d))return t;const f=cr(d,l.dimensions),v=se(l.impact)===c;return r(c,m,v,v,f,u)}if(l.phase==="DROP_ANIMATING"){const d=l.completed;if(!En(p,d.critical))return t;const f=cr(d.critical,l.dimensions);return r(c,m,ba(d.result)===c,se(d.impact)===c,f,u)}if(l.phase==="IDLE"&&l.completed&&!l.shouldFlush){const d=l.completed;if(!En(p,d.critical))return t;const f=se(d.impact)===c,v=!!(d.impact.at&&d.impact.at.type==="COMBINE"),j=d.critical.droppable.id===c;return f?v?e:t:j?e:t}return t}},hu={updateViewportMaxScroll:Ii},bu=yr(gu,hu,(e,t,s)=>({...Ca(s),...e,...t}),{context:Qn,areStatePropsEqual:ha})(xu);function Da({status:e}){return e==="saving"?n.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-amber-600 font-medium",children:[n.jsx("div",{className:"w-3 h-3 border-2 border-amber-500 border-t-transparent rounded-full animate-spin"})," Enregistrement..."]}):e==="saved"?n.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-emerald-600 font-medium",children:[n.jsx(_e,{className:"w-3 h-3"})," Enregistr√©"]}):e==="error"?n.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-red-500 font-medium",children:[n.jsx(We,{className:"w-3 h-3"})," Erreur"]}):null}function dr({title:e,icon:t,iconBg:s,iconColor:r,editing:a,onEdit:l,onCancel:o,children:i,viewContent:c,autoSaveStatus:p}){return n.jsxs("div",{className:"card p-5",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:`w-8 h-8 rounded-lg ${s} flex items-center justify-center`,children:n.jsx(t,{className:`w-4 h-4 ${r}`})}),n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:e}),a&&n.jsx(Da,{status:p})]}),a?n.jsxs("button",{onClick:o,className:"btn-ghost text-xs px-2.5 py-1.5",children:[n.jsx(te,{className:"w-3.5 h-3.5"})," Fermer"]}):n.jsx("button",{onClick:l,className:"btn-ghost p-1.5",title:"Modifier",children:n.jsx(Bt,{className:"w-3.5 h-3.5"})})]}),a?i:c]})}const Yt={left:["client","device","dates","messages","notes"],right:["reparation","status","queue","fidelite"]},Ot=new Set([...Yt.left,...Yt.right]);function Eu(){const{id:e}=Nl(),t=fr(),{user:s}=xr(),r=mr(),a=(s==null?void 0:s.target)==="tech"?"/tech":"/accueil",l=(s==null?void 0:s.target)==="tech",[o,i]=b.useState(null),[c,p]=b.useState(!0),[m,u]=b.useState(!1),[d,f]=b.useState(""),[v,j]=b.useState(!0),[y,D]=b.useState(!1),[R,L]=b.useState(!1),[P,O]=b.useState(!1),[S,_]=b.useState(!1),[k,Y]=b.useState(!1),[I,F]=b.useState({}),[W,ie]=b.useState({}),[U,xe]=b.useState({}),[M,ce]=b.useState([]),[fe,ns]=b.useState(!1),[Sa,pt]=b.useState(!1),[sn,ke]=b.useState(!1),[ye,ss]=b.useState(""),[mt,Ia]=b.useState([]),[Ea,rs]=b.useState(!1),[Ye,Aa]=b.useState(0),[xt,rn]=b.useState([]),[vu,Nu]=b.useState(""),[ju,yu]=b.useState(!1),[Pa,ft]=b.useState(!1),[_a,Te]=b.useState(!1),[Ra,gt]=b.useState(!1),[ht,an]=b.useState(Yt),[we,as]=b.useState(!1),[bt,ls]=b.useState({timer:!0,countdown:!0,queue:!0}),[ka,os]=b.useState(!1),[is,Ta]=b.useState(!0),[ln,vt]=b.useState([]),[Oa,Oe]=b.useState(!1),[ee,Be]=b.useState({description:"",fournisseur:"",reference:"",prix:"",notes:""}),[Ba,on]=b.useState(!1),[cn,cs]=b.useState(""),[ds,dn]=b.useState(""),[us,ps]=b.useState(!1),[La,Ma]=b.useState(!1),[$a,Je]=b.useState(!1),[Le,Nt]=b.useState({panne:"",panne_detail:""}),[ms,xs]=b.useState(!1),[Fa,Ce]=b.useState(null),[Ga,De]=b.useState(null),[Wa,Se]=b.useState(null),jt=b.useRef(null),yt=b.useRef(null),wt=b.useRef(null),fs=x=>{try{if(x.reparation_supp&&x.reparation_supp.startsWith("["))return JSON.parse(x.reparation_supp)}catch{}const N=[];return x.panne&&N.push({label:x.panne,prix:x.devis_estime||0}),x.reparation_supp&&N.push({label:x.reparation_supp,prix:x.prix_supp||0}),N.length>0?N:[{label:"",prix:0}]},X=b.useCallback(async()=>{p(!0);try{const[x,N,T]=await Promise.all([A.getTicket(e),A.getPartsByTicket(e).catch(()=>[]),A.getNotes(e).catch(()=>[])]);i(x),vt(N||[]),rn(T||[]),F({categorie:x.categorie||"",marque:x.marque||"",modele:x.modele||"",modele_autre:x.modele_autre||"",imei:x.imei||"",panne:x.panne||"",panne_detail:x.panne_detail||"",pin:x.pin||"",pattern:x.pattern||"",notes_client:x.notes_client||""}),ie({nom:x.client_nom||"",prenom:x.client_prenom||"",telephone:x.client_tel||"",email:x.client_email||"",societe:x.client_societe||""}),xe({devis_estime:x.devis_estime||"",tarif_final:x.tarif_final||"",acompte:x.acompte||"",technicien_assigne:x.technicien_assigne||"",type_ecran:x.type_ecran||"",date_recuperation:x.date_recuperation||"",reduction_montant:x.reduction_montant||"",reduction_pourcentage:x.reduction_pourcentage||"",commande_piece:x.commande_piece||0}),ce(fs(x)),rs(!!(x.attention||(x.notes_internes||"").includes("[ATTENTION]")))}catch(x){console.error(x)}finally{p(!1)}},[e]);b.useEffect(()=>{X()},[X]);const Va=b.useCallback(async()=>{try{const x=await A.getNotes(e);rn(x||[])}catch{rn([])}},[e]);b.useEffect(()=>{Promise.all([A.getActiveTeam().catch(()=>[]),A.getConfig().catch(()=>[]),A.getCaisseConfig().catch(()=>({}))]).then(([x,N,T])=>{Ia(x||[]);const g=Array.isArray(N)?N:[],C=g.find(V=>V.cle==="tva");C&&Aa(parseFloat(C.valeur)||0);const B=g.find(V=>V.cle==="AFFICHER_AUTOCOMPLETION");B&&Ta(B.valeur!=="false"),Ma((T==null?void 0:T.CAISSE_ENABLED)==="1")})},[]),b.useEffect(()=>{if(s!=null&&s.utilisateur){try{const x=localStorage.getItem(`kp_layout_${s.utilisateur}`);if(x){const N=JSON.parse(x);if(N.left&&N.right){const T=[...N.left,...N.right],g=N.left.filter(z=>Ot.has(z)),C=N.right.filter(z=>Ot.has(z)),B=new Set(T.filter(z=>Ot.has(z))),V=[...Ot].filter(z=>!B.has(z));an({left:g,right:[...C,...V]})}}}catch{}try{const x=localStorage.getItem(`kp_prefs_${s.utilisateur}`);x&&ls(N=>({...N,...JSON.parse(x)}))}catch{}}},[s==null?void 0:s.utilisateur]);const Ua=x=>{an(x),s!=null&&s.utilisateur&&localStorage.setItem(`kp_layout_${s.utilisateur}`,JSON.stringify(x))},Ha=()=>{s!=null&&s.utilisateur&&(localStorage.removeItem(`kp_layout_${s.utilisateur}`),an(Yt),r.success("Layout r√©initialis√©"))},za=x=>{ls(x),s!=null&&s.utilisateur&&localStorage.setItem(`kp_prefs_${s.utilisateur}`,JSON.stringify(x))},qa=x=>{const{source:N,destination:T}=x;if(!T||N.droppableId===T.droppableId&&N.index===T.index)return;const g=N.droppableId,C=T.droppableId,B={left:[...ht.left],right:[...ht.right]};if(g===C){const V=B[g],[z]=V.splice(N.index,1);V.splice(T.index,0,z)}else{const V=B[g],z=B[C],[$e]=V.splice(N.index,1);z.splice(T.index,0,$e)}Ua(B)},gs=b.useCallback(async x=>{Ce("saving");try{await A.updateTicket(e,x),me("tickets"),x.panne&&A.learnTerm("panne",x.panne).catch(()=>{}),x.panne_detail&&A.learnTerm("detail_panne",x.panne_detail).catch(()=>{}),Ce("saved");const N=await A.getTicket(e);i(N),setTimeout(()=>Ce(null),2e3)}catch{Ce("error"),setTimeout(()=>Ce(null),3e3)}},[e]),hs=b.useCallback(async(x,N)=>{De("saving");try{await A.updateClient(N,x),me("clients","tickets"),De("saved");const T=await A.getTicket(e);i(T),setTimeout(()=>De(null),2e3)}catch{De("error"),setTimeout(()=>De(null),3e3)}},[e]),bs=b.useCallback(async(x,N)=>{Se("saving");try{const T=N.reduce((fn,ml)=>fn+(parseFloat(ml.prix)||0),0),g=JSON.stringify(N.filter(fn=>fn.label));let C=parseFloat(x.reduction_montant)||0;const B=parseFloat(x.reduction_pourcentage)||0;B>0&&(C=T*(B/100));const V=parseFloat(x.tarif_final)||T-C||null,z={...x,devis_estime:parseFloat(x.devis_estime)||null,tarif_final:V,acompte:parseFloat(x.acompte)||null,reduction_montant:C||null,reduction_pourcentage:B||null,reparation_supp:g,prix_supp:T};await A.updateTicket(e,z),me("tickets"),Se("saved");const $e=await A.getTicket(e);i($e),setTimeout(()=>Se(null),2e3)}catch{Se("error"),setTimeout(()=>Se(null),3e3)}},[e]),Ka=b.useCallback(x=>{clearTimeout(jt.current),Ce(null),jt.current=setTimeout(()=>gs(x),1500)},[gs]),Ya=b.useCallback(x=>{clearTimeout(yt.current),De(null),yt.current=setTimeout(()=>hs(x,o==null?void 0:o.client_id),1500)},[hs,o==null?void 0:o.client_id]),vs=b.useCallback((x,N)=>{clearTimeout(wt.current),Se(null),wt.current=setTimeout(()=>bs(x,N),1500)},[bs]);b.useEffect(()=>()=>{clearTimeout(jt.current),clearTimeout(yt.current),clearTimeout(wt.current)},[]);const de=x=>{const N={...I,...x};F(N),Ka(N)},Xe=x=>{const N={...W,...x};ie(N),Ya(N)},pe=x=>{const N={...U,...x};xe(N),vs(N,M)},Ct=x=>{ce(x),vs(U,x)},Ja=async()=>{if(ee.description.trim())try{await A.createPart({ticket_id:o.id,ticket_code:o.ticket_code,description:ee.description,fournisseur:ee.fournisseur,reference:ee.reference,prix:ee.prix?parseFloat(ee.prix):null,notes:ee.notes}),me("commandes"),Oe(!1),Be({description:"",fournisseur:"",reference:"",prix:"",notes:""});const x=await A.getPartsByTicket(o.id);vt(x||[]),r.success("Commande cr√©√©e")}catch{r.error("Erreur cr√©ation commande")}},Xa=async(x,N)=>{try{await A.updatePart(x,{statut:N}),me("commandes");const T=await A.getPartsByTicket(o.id);vt(T||[]),r.success(`Statut ‚Üí ${N}`),N==="Re√ßue"&&await X()}catch{r.error("Erreur changement statut commande")}},Qa=async x=>{if(confirm("Supprimer cette commande ?"))try{await A.deletePart(x),me("commandes");const N=await A.getPartsByTicket(o.id);vt(N||[]),r.success("Commande supprim√©e")}catch{r.error("Erreur suppression commande")}},Za=async x=>{if(x==="Rendu au client"){if(o.telephone_pret&&!o.telephone_pret_rendu){ft(!0);return}Te(!0);return}try{await A.changeStatus(e,x),me("tickets"),await X(),r.success(`Statut chang√© : ${x}`)}catch{r.error("Erreur changement de statut")}},el=async()=>{try{await A.updateTicket(e,{telephone_pret_rendu:1}),ft(!1),Te(!0)}catch{r.error("Erreur")}},tl=async()=>{try{await A.updateTicket(e,{paye:1}),await A.changeStatus(e,"Rendu au client"),await A.changeStatus(e,"Cl√¥tur√©"),me("tickets"),Te(!1),await X(),r.success("Ticket cl√¥tur√©")}catch{r.error("Erreur")}},nl=async()=>{try{await A.changeStatus(e,"Rendu au client"),me("tickets"),Te(!1),await X(),r.success("Attention : ticket non pay√©")}catch{r.error("Erreur")}},Ns=async()=>{if(cn!=="caramail"){dn("Code incorrect");return}ps(!0);try{await A.deleteTicket(e),r.success("Ticket supprim√©"),t(a)}catch{r.error("Erreur lors de la suppression"),ps(!1)}},js=async()=>{if(d.trim())try{const x=v?"[INTERNE]":"[CLIENT]";await A.addNote(e,`${x} ${d}`),f(""),await X(),r.success("Note ajout√©e")}catch{r.error("Erreur ajout de note")}},sl=async()=>{const x=prompt("Message de la note importante :");if(!(!x||!x.trim()))try{await A.addPrivateNote(e,(s==null?void 0:s.utilisateur)||"Accueil",x.trim(),!0),await A.updateTicket(e,{attention:x.trim()}),await X(),r.success("Note importante ajout√©e")}catch{r.error("Erreur ajout attention")}},un=async()=>{try{const x=await A.togglePaye(e);me("tickets"),gt(!1),await X(),r.success(x.paye?"Marqu√© pay√©":"Marqu√© non pay√©")}catch{r.error("Erreur toggle pay√©")}},Me=(x,N)=>{const T=Math.max(0,(parseFloat(U[x])||0)+N).toString();pe({[x]:T})},rl=()=>{navigator.clipboard.writeText(o.ticket_code),D(!0),setTimeout(()=>D(!1),2e3)},al=async()=>{const x=o;if(!x)return;const N=M.filter(g=>g.label),T=`R√©paration ${x.marque||""} ${x.modele||x.modele_autre||""} - ${N.map(g=>g.label).join(" + ")}`.trim();try{const g=await A.envoyerCaisse({ticket_id:x.id,ticket_code:x.ticket_code,nom:x.client_nom||"",prenom:x.client_prenom||"",telephone:x.client_tel||"",email:x.client_email||"",description:T,montant:It});g.result==="OK"?(r.success(g.message||"Vente envoy√©e en caisse"),X()):r.error(g.message||"Erreur caisse")}catch(g){r.error(g.message||"Erreur envoi en caisse")}},ll=()=>{if(!o)return"";const x=o,N=x.modele_autre||`${x.marque||""} ${x.modele||""}`.trim()||"appareil",T=M.filter(B=>B.label),g=T.reduce((B,V)=>B+(parseFloat(V.prix)||0),0),C=T.map(B=>`- ${B.label} : ${parseFloat(B.prix||0).toFixed(2)} EUR`).join(`
`);return`Bonjour ${x.client_prenom||""}, suite au diagnostic de votre ${N}, voici le d√©tail des r√©parations n√©cessaires :

${C}

Total : ${g.toFixed(2)} EUR

Merci de nous confirmer votre accord pour lancer la r√©paration.
Klikphone 04 79 60 89 22`},ol=()=>{ss(ll()),pt(!0)},pn=async x=>{if(!ye.trim()){r.error("Message vide");return}ke(!0);try{const N=o.client_tel,T=o.client_email;if(x==="whatsapp"){if(!N){r.error("Pas de t√©l√©phone"),ke(!1);return}window.open(ur(N,ye),"_blank")}else if(x==="sms"){if(!N){r.error("Pas de t√©l√©phone"),ke(!1);return}window.open(pr(N,ye),"_blank")}else if(x==="email"){if(!T){r.error("Ce client n'a pas d'adresse email"),ke(!1);return}const B=await A.envoyerEmail(T,`Klikphone SAV - Accord ${o.ticket_code}`,ye);if(B.status!=="ok"){r.error(B.message||"Erreur d'envoi email"),ke(!1);return}}await A.changeStatus(e,"En attente d'accord client");const g=(s==null?void 0:s.utilisateur)||"Accueil",C=`[Demande accord] ${ye.substring(0,120)}${ye.length>120?"...":""}`;await A.logMessage(e,g,C,x),pt(!1),await X(),r.success("Demande d'accord envoy√©e")}catch{r.error("Erreur envoi de la demande")}finally{ke(!1)}},ys=async x=>{try{if(x){await A.changeStatus(e,"En cours de r√©paration");const N=(s==null?void 0:s.utilisateur)||"Accueil";await A.addPrivateNote(e,N,"Accord client re√ßu ‚Äî r√©paration lanc√©e"),r.success("Ticket en cours de r√©paration")}else{await A.changeStatus(e,"R√©paration termin√©e");const N=(s==null?void 0:s.utilisateur)||"Accueil";await A.addPrivateNote(e,N,"Client a refus√© la r√©paration"),r.success("Ticket marqu√© non r√©parable")}await X()}catch{r.error("Erreur changement de statut")}},il=async()=>{if(!Le.panne.trim()){r.error("Veuillez d√©crire la panne");return}xs(!0);try{const x=await A.createRetourSAV(h.id,h.client_id,{categorie:h.categorie||"",marque:h.marque||"",modele:h.modele||"",modele_autre:h.modele_autre||"",imei:h.imei||"",panne:Le.panne,panne_detail:Le.panne_detail,pin:h.pin||"",pattern:h.pattern||""});r.success(`Retour SAV cr√©√© : ${x.ticket_code}`),Je(!1),Nt({panne:"",panne_detail:""}),t(`${a}/ticket/${x.id}`)}catch(x){r.error(x.message||"Erreur cr√©ation retour SAV")}finally{xs(!1)}},cl=()=>{Ct([...M,{label:"",prix:0}])},dl=x=>{Ct(M.filter((N,T)=>T!==x))},ws=(x,N,T)=>{Ct(M.map((g,C)=>C===x?{...g,[N]:T}:g))},Cs=(x,N)=>{Ct(M.map((T,g)=>g===x?{...T,prix:Math.max(0,(parseFloat(T.prix)||0)+N)}:T))},Dt=M.reduce((x,N)=>x+(parseFloat(N.prix)||0),0),ul=parseFloat(U.reduction_montant)||0,St=parseFloat(U.reduction_pourcentage)||0,mn=St>0?Dt*(St/100):ul,xn=parseFloat(U.tarif_final)||Dt-mn,Ds=Ye>0?xn*(Ye/100):0,It=xn+Ds,ge=It-(parseFloat(U.acompte)||0);if(c)return n.jsx("div",{className:"flex items-center justify-center py-20",children:n.jsxs("div",{className:"flex flex-col items-center gap-3",children:[n.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"}),n.jsx("p",{className:"text-sm text-slate-400",children:"Chargement..."})]})});if(!o)return n.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[n.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center mb-4",children:n.jsx(hn,{className:"w-7 h-7 text-slate-300"})}),n.jsx("p",{className:"text-slate-500 font-medium",children:"Ticket non trouv√©"}),n.jsxs("button",{onClick:()=>t(a),className:"btn-secondary mt-4",children:[n.jsx(Et,{className:"w-4 h-4"})," Retour au dashboard"]})]});const h=o,Ss=h.modele_autre||`${h.marque||""} ${h.modele||""}`.trim(),he=[];h.notes_internes&&h.notes_internes.split(`
`).filter(Boolean).forEach(x=>{x.includes("[INTERNE]");const N=x.includes("[CLIENT]"),T=x.includes("[ATTENTION]"),g=x.replace(/\[(INTERNE|CLIENT|ATTENTION)\]\s*/g,""),C=g.match(/^\[(\d{2}\/\d{2}\/?\d{0,4}\s?\d{2}:\d{2})\]\s*/),B=C?C[1]:"",V=C?g.replace(C[0],""):g;he.push({type:T?"attention":N?"client":"internal",text:V,timestamp:B,raw:x})}),h.historique&&h.historique.split(`
`).filter(Boolean).forEach(x=>{const N=x.match(/^\[(\d{2}\/\d{2}\s?\d{2}:\d{2})\]\s*/),T=N?N[1]:"",g=N?x.replace(N[0],""):x;he.push({type:"history",text:g,timestamp:T,raw:x})}),he.reverse();const pl=x=>{var N,T;switch(x){case"client":return n.jsx(dr,{title:"Client",icon:As,iconBg:"bg-blue-50",iconColor:"text-blue-600",editing:P,autoSaveStatus:Ga,onEdit:()=>O(!0),onCancel:()=>{clearTimeout(yt.current),O(!1),De(null),ie({nom:h.client_nom||"",prenom:h.client_prenom||"",telephone:h.client_tel||"",email:h.client_email||"",societe:h.client_societe||""})},viewContent:n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-11 h-11 rounded-full bg-brand-100 flex items-center justify-center shrink-0",children:n.jsxs("span",{className:"text-brand-700 font-bold text-sm",children:[(((N=h.client_prenom)==null?void 0:N[0])||"").toUpperCase(),(((T=h.client_nom)==null?void 0:T[0])||"").toUpperCase()]})}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("p",{className:"text-base font-bold text-slate-900 truncate",children:[h.client_prenom||""," ",h.client_nom||""]}),h.client_societe&&n.jsx("p",{className:"text-xs text-slate-500",children:h.client_societe})]})]}),n.jsxs("div",{className:"space-y-2",children:[h.client_tel&&n.jsxs("a",{href:`tel:${h.client_tel}`,className:"flex items-center gap-2.5 text-sm text-slate-600 hover:text-brand-600 transition-colors",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center shrink-0",children:n.jsx(Ml,{className:"w-4 h-4 text-slate-500"})}),n.jsx("span",{className:"font-mono text-xs",children:h.client_tel})]}),h.client_email&&n.jsxs("a",{href:`mailto:${h.client_email}`,className:"flex items-center gap-2.5 text-sm text-slate-600 hover:text-brand-600 transition-colors",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center shrink-0",children:n.jsx(Ft,{className:"w-4 h-4 text-slate-500"})}),n.jsx("span",{className:"text-xs truncate",children:h.client_email})]})]}),!h.est_retour_sav&&h.statut!=="En attente de diagnostic"&&n.jsx("div",{className:"mt-4 pt-4 border-t border-slate-100",children:n.jsxs("button",{onClick:()=>{Nt({panne:"",panne_detail:""}),Je(!0)},className:"w-full flex items-center justify-center gap-2 py-2 px-3 rounded-lg bg-red-50 hover:bg-red-100 text-red-600 text-xs font-bold border border-red-200 transition-colors",children:[n.jsx(Fe,{className:"w-3.5 h-3.5"})," Retour SAV"]})}),n.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100",children:n.jsx("p",{className:"text-[10px] text-slate-400 text-center",children:"Messages dans le bloc Messages ci-dessous"})})]}),children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Pr√©nom"}),n.jsx("input",{value:W.prenom,onChange:g=>Xe({prenom:g.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Nom"}),n.jsx("input",{value:W.nom,onChange:g=>Xe({nom:g.target.value}),className:"input"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"T√©l√©phone"}),n.jsx("input",{value:W.telephone,onChange:g=>Xe({telephone:g.target.value}),className:"input font-mono"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Email"}),n.jsx("input",{value:W.email,onChange:g=>Xe({email:g.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Soci√©t√©"}),n.jsx("input",{value:W.societe,onChange:g=>Xe({societe:g.target.value}),className:"input"})]})]})});case"device":return n.jsx(dr,{title:"Appareil",icon:hn,iconBg:"bg-brand-50",iconColor:"text-brand-600",editing:R,autoSaveStatus:Fa,onEdit:()=>L(!0),onCancel:()=>{clearTimeout(jt.current),L(!1),Ce(null),F({categorie:h.categorie||"",marque:h.marque||"",modele:h.modele||"",modele_autre:h.modele_autre||"",imei:h.imei||"",panne:h.panne||"",panne_detail:h.panne_detail||"",pin:h.pin||"",pattern:h.pattern||"",notes_client:h.notes_client||""})},viewContent:n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-4 text-sm",children:[{label:"Cat√©gorie",value:h.categorie},{label:"Marque",value:h.marque},{label:"Mod√®le",value:(h.modele&&h.modele!=="Autre"?h.modele:h.modele_autre)||h.modele||"‚Äî"},{label:"Panne",value:h.panne},{label:"IMEI / N¬∞ s√©rie",value:h.imei,mono:!0},{label:"D√©tail panne",value:h.panne_detail}].map(({label:g,value:C,mono:B})=>n.jsxs("div",{children:[n.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:g}),n.jsx("p",{className:`font-medium text-slate-800 ${B?"font-mono text-xs":""}`,children:C||"‚Äî"})]},g))}),(h.pin||h.pattern)&&n.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 flex flex-wrap gap-6",children:[h.pin&&n.jsxs("div",{children:[n.jsxs("p",{className:"text-slate-400 text-xs mb-1 flex items-center gap-1",children:[n.jsx(_s,{className:"w-3 h-3"})," Code PIN"]}),n.jsx("p",{className:"text-lg font-bold font-mono text-slate-800 tracking-widest",children:h.pin})]}),h.pattern&&n.jsxs("div",{children:[n.jsxs("p",{className:"text-slate-400 text-xs mb-1 flex items-center gap-1",children:[n.jsx(Ll,{className:"w-3 h-3"})," Pattern"]}),n.jsx(jl,{value:h.pattern,readOnly:!0,size:120})]})]}),h.notes_client&&n.jsxs("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-100 rounded-lg text-sm text-amber-800",children:[n.jsx("span",{className:"font-semibold",children:"Note client :"})," ",h.notes_client]})]}),children:n.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Cat√©gorie"}),n.jsx("input",{value:I.categorie,onChange:g=>de({categorie:g.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Marque"}),n.jsx("input",{value:I.marque,onChange:g=>de({marque:g.target.value}),className:"input"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Mod√®le"}),n.jsx("input",{value:I.modele,onChange:g=>de({modele:g.target.value}),className:"input"})]}),n.jsx("div",{children:n.jsx(Ls,{label:"Panne",categorie:"panne",value:I.panne,onChange:g=>de({panne:g}),onSelect:g=>de({panne:g.value}),enabled:is,placeholder:"√âcran cass√©, Batterie..."})}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"IMEI"}),n.jsx("input",{value:I.imei,onChange:g=>de({imei:g.target.value}),className:"input font-mono"})]}),n.jsx("div",{children:n.jsx(Ls,{label:"D√©tail panne",categorie:"detail_panne",value:I.panne_detail,onChange:g=>de({panne_detail:g}),onSelect:g=>de({panne_detail:g.value}),enabled:is,placeholder:"D√©tails suppl√©mentaires..."})}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Code PIN"}),n.jsx("input",{value:I.pin,onChange:g=>de({pin:g.target.value}),className:"input font-mono tracking-widest",maxLength:10})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Pattern"}),n.jsx("input",{value:I.pattern,onChange:g=>de({pattern:g.target.value}),className:"input font-mono",placeholder:"1-5-9-6-3"})]}),n.jsxs("div",{className:"col-span-2 sm:col-span-3",children:[n.jsx("label",{className:"input-label",children:"Note client"}),n.jsx("textarea",{value:I.notes_client,onChange:g=>de({notes_client:g.target.value}),className:"input resize-none",rows:2})]})]})});case"dates":return n.jsxs("div",{className:"card p-5",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center",children:n.jsx(Bl,{className:"w-4 h-4 text-slate-500"})}),n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Dates"})]}),n.jsxs("div",{className:"space-y-3 text-sm",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-slate-500",children:"D√©p√¥t"}),n.jsx("span",{className:"font-medium text-slate-800",children:gn(h.date_depot)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-slate-500",children:"Mise √† jour"}),n.jsx("span",{className:"font-medium text-slate-800",children:gn(h.date_maj)})]}),h.date_cloture&&n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-slate-500",children:"Cl√¥ture"}),n.jsx("span",{className:"font-medium text-slate-800",children:gn(h.date_cloture)})]}),h.date_recuperation&&n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-slate-500",children:"R√©cup√©ration"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"font-medium text-slate-800",children:h.date_recuperation}),n.jsx(Xl,{dateStr:h.date_recuperation,visible:bt.countdown})]})]})]})]});case"messages":return n.jsx(ql,{ticket:h,onMessageSent:()=>Va()});case"notes":return n.jsxs("div",{className:"card p-5",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-50 flex items-center justify-center",children:n.jsx(br,{className:"w-4 h-4 text-amber-600"})}),n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Notes internes"}),n.jsx("span",{className:"text-[10px] text-slate-400",children:`${[...xt,...he.filter(C=>C.type==="internal"||C.type==="client"||C.type==="attention")].length} note(s)`})]}),n.jsxs("button",{onClick:sl,className:"btn-ghost text-xs gap-1 text-red-500 hover:bg-red-50",title:"Ajouter flag attention",children:[n.jsx(Tl,{className:"w-3.5 h-3.5"})," Attention"]})]}),n.jsxs("div",{className:"flex gap-2 mb-4",children:[n.jsxs("div",{className:"flex-1 flex gap-2",children:[n.jsx("button",{onClick:()=>j(!v),className:`shrink-0 p-2.5 rounded-lg border transition-colors ${v?"bg-slate-50 border-slate-200 text-slate-500":"bg-blue-50 border-blue-200 text-blue-500"}`,title:v?"Note interne":"Note visible client",children:v?n.jsx(_s,{className:"w-4 h-4"}):n.jsx(Ol,{className:"w-4 h-4"})}),n.jsx("input",{type:"text",value:d,onChange:g=>f(g.target.value),onKeyDown:g=>g.key==="Enter"&&js(),placeholder:v?"Note interne...":"Note visible par le client...",className:"input flex-1"})]}),n.jsx("button",{onClick:js,className:"btn-primary px-3",children:n.jsx(be,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"max-h-80 overflow-y-auto divide-y divide-slate-100",children:[xt.map(g=>{var $e;const C=g.type_note||"note",B=C==="whatsapp"?{bg:"bg-green-100 text-green-700",label:"WhatsApp"}:C==="sms"?{bg:"bg-blue-100 text-blue-700",label:"SMS"}:C==="email"?{bg:"bg-amber-100 text-amber-700",label:"Email"}:null,V=($e=g.auteur)==null?void 0:$e.toLowerCase().includes("tech"),z=g.important?"text-red-600 font-semibold":B?"text-slate-600":V?"text-blue-600":"text-emerald-600";return n.jsxs("div",{className:"flex items-start gap-2 py-1.5",children:[B&&n.jsx("span",{className:`text-[9px] font-bold px-1.5 py-0.5 rounded uppercase tracking-wider shrink-0 mt-0.5 ${B.bg}`,children:B.label}),!B&&C==="note"&&n.jsx("span",{className:"text-[9px] font-bold px-1.5 py-0.5 rounded bg-blue-50 text-blue-600 uppercase tracking-wider shrink-0 mt-0.5",children:g.auteur||"Note"}),n.jsx("span",{className:`text-sm flex-1 min-w-0 ${z}`,children:g.contenu}),n.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap shrink-0 mt-0.5",children:g.date_creation?new Date(g.date_creation).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]},`db-${g.id}`)}),he.filter(g=>g.type!=="history").map((g,C)=>{const B=g.type==="attention"?"text-red-600 font-semibold":g.type==="internal"?"text-blue-600":"text-emerald-600";return n.jsxs("div",{className:"flex items-start gap-2 py-1.5",children:[n.jsx("span",{className:`text-sm flex-1 min-w-0 ${B}`,children:g.text}),g.timestamp&&n.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap shrink-0 mt-0.5",children:g.timestamp})]},`tl-${C}`)}),xt.length===0&&he.filter(g=>g.type!=="history").length===0&&n.jsx("p",{className:"text-xs text-slate-400 text-center py-3",children:"Aucune note"})]}),he.filter(g=>g.type==="history").length>0&&n.jsxs("div",{className:"mt-4 pt-3 border-t border-slate-100",children:[n.jsx("p",{className:"text-[10px] text-slate-400 uppercase tracking-wider mb-2",children:"Historique"}),n.jsxs("div",{className:"relative max-h-48 overflow-y-auto pl-4",children:[n.jsx("div",{className:"absolute left-[9px] top-2 bottom-2 w-0.5 bg-slate-200"}),n.jsx("div",{className:"space-y-0.5",children:he.filter(g=>g.type==="history").map((g,C)=>n.jsxs("div",{className:"relative flex items-start gap-3 py-1.5 px-2 rounded-lg hover:bg-slate-50 transition-colors",children:[n.jsx("div",{className:"absolute -left-4 top-3 w-2 h-2 rounded-full bg-brand-400 z-10"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-xs text-slate-500",children:g.text}),g.timestamp&&n.jsx("span",{className:"text-[10px] text-slate-400",children:g.timestamp})]})]},C))})]})]})]});case"reparation":return n.jsxs("div",{className:"card p-5",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-50 flex items-center justify-center",children:n.jsx(Ge,{className:"w-4 h-4 text-emerald-600"})}),n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"R√©paration & Tarifs"})]}),!S&&n.jsx("button",{onClick:()=>_(!0),className:"btn-ghost p-1.5",title:"Modifier",children:n.jsx(Bt,{className:"w-3.5 h-3.5"})}),S&&n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(Da,{status:Wa}),n.jsxs("button",{onClick:()=>{clearTimeout(wt.current),_(!1),Se(null),xe({devis_estime:h.devis_estime||"",tarif_final:h.tarif_final||"",acompte:h.acompte||"",technicien_assigne:h.technicien_assigne||"",type_ecran:h.type_ecran||"",date_recuperation:h.date_recuperation||"",reduction_montant:h.reduction_montant||"",reduction_pourcentage:h.reduction_pourcentage||"",commande_piece:h.commande_piece||0}),ce(fs(h))},className:"btn-ghost text-xs px-2.5 py-1.5",children:[n.jsx(te,{className:"w-3.5 h-3.5"})," Fermer"]})]})]}),n.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-xl border border-slate-100",children:[n.jsx("div",{className:"text-[11px] text-slate-400 uppercase tracking-wider mb-2",children:"Technicien assign√©"}),l&&!k?n.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{var C,B;const g=mt.find(V=>h.technicien_assigne===V.nom||(h.technicien_assigne||"").startsWith(V.nom+" "));return g?n.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:g.couleur||"#94a3b8"},children:((C=h.technicien_assigne)==null?void 0:C.charAt(0))||"?"}):n.jsx("div",{className:"w-7 h-7 rounded-lg bg-slate-300 flex items-center justify-center text-white text-xs font-bold",children:((B=h.technicien_assigne)==null?void 0:B.charAt(0))||"?"})})(),n.jsx("span",{className:"text-sm font-semibold text-slate-800",children:h.technicien_assigne||"Non assign√©"}),n.jsx("button",{onClick:()=>Y(!0),className:"text-slate-400 hover:text-brand-600 ml-auto",children:n.jsx(Bt,{className:"w-3.5 h-3.5"})})]}):n.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const g=mt.find(C=>(h.technicien_assigne||"")===C.nom);return n.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:(g==null?void 0:g.couleur)||"#94a3b8"},children:(h.technicien_assigne||k||"?").charAt(0)})})(),mt.length>0?n.jsxs("select",{value:h.technicien_assigne||"",onChange:async g=>{const C=g.target.value;if(C)try{await A.updateTicket(e,{technicien_assigne:C}),await X(),r.success(`Assign√© √† ${C}`),Y(!1)}catch{r.error("Erreur assignation")}},className:"flex-1 px-3 py-1.5 rounded-lg border border-slate-200 text-sm font-semibold bg-white",children:[n.jsx("option",{value:"",children:"‚Äî Non assign√© ‚Äî"}),mt.map(g=>n.jsxs("option",{value:g.nom,children:[g.nom,g.role?` (${g.role})`:""]},g.id))]}):n.jsx("input",{type:"text",value:U.technicien_assigne,onChange:g=>pe({technicien_assigne:g.target.value}),className:"flex-1 input text-sm",placeholder:"Nom du technicien"})]}),h.personne_charge&&n.jsxs("p",{className:"text-[10px] text-slate-400 mt-2",children:["Prise en charge : ",n.jsx("span",{className:"font-medium text-slate-600",children:h.personne_charge})]})]}),S?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("label",{className:"input-label mb-0",children:"Lignes de r√©paration"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:!!U.commande_piece,onChange:g=>pe({commande_piece:g.target.checked?1:0}),className:"w-3.5 h-3.5 rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),n.jsxs("span",{className:"text-xs font-medium text-amber-700",children:[n.jsx(At,{className:"w-3 h-3 inline mr-0.5"}),"Pi√®ce √† commander"]})]}),n.jsxs("button",{onClick:()=>Oe(!0),className:"text-xs font-medium text-brand-600 hover:text-brand-800 flex items-center gap-0.5",children:[n.jsx(be,{className:"w-3 h-3"})," Commander"]}),n.jsxs("button",{onClick:cl,className:"btn-ghost text-xs px-2 py-1",children:[n.jsx(be,{className:"w-3 h-3"})," Ajouter"]})]})]}),n.jsx("div",{className:"space-y-2",children:M.map((g,C)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{value:g.label,onChange:B=>ws(C,"label",B.target.value),className:"input flex-1",placeholder:"Description r√©paration"}),n.jsxs("div",{className:"relative w-28 shrink-0",children:[n.jsx("input",{type:"number",step:"0.01",value:g.prix,onChange:B=>ws(C,"prix",B.target.value),className:"input text-right pr-7",placeholder:"0"}),n.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]}),n.jsx("button",{onClick:()=>Cs(C,-5),className:"btn-ghost p-1.5 shrink-0",children:n.jsx(Pt,{className:"w-3 h-3"})}),n.jsx("button",{onClick:()=>Cs(C,5),className:"btn-ghost p-1.5 shrink-0",children:n.jsx(be,{className:"w-3 h-3"})}),M.length>1&&n.jsx("button",{onClick:()=>dl(C),className:"btn-ghost p-1.5 shrink-0 text-red-400 hover:text-red-600",children:n.jsx(bn,{className:"w-3 h-3"})})]},C))}),n.jsxs("div",{className:"text-right mt-2",children:[n.jsx("span",{className:"text-xs text-slate-400",children:"Total :"}),n.jsx("span",{className:"text-sm font-bold text-slate-800 ml-2",children:Q(Dt)})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Devis estim√©"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>Me("devis_estime",-5),className:"btn-ghost p-1.5 shrink-0",children:n.jsx(Pt,{className:"w-3 h-3"})}),n.jsxs("div",{className:"relative flex-1",children:[n.jsx("input",{type:"number",step:"0.01",value:U.devis_estime,onChange:g=>pe({devis_estime:g.target.value}),className:"input text-center pr-7"}),n.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]}),n.jsx("button",{onClick:()=>Me("devis_estime",5),className:"btn-ghost p-1.5 shrink-0",children:n.jsx(be,{className:"w-3 h-3"})})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Tarif final"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>Me("tarif_final",-5),className:"btn-ghost p-1.5 shrink-0",children:n.jsx(Pt,{className:"w-3 h-3"})}),n.jsxs("div",{className:"relative flex-1",children:[n.jsx("input",{type:"number",step:"0.01",value:U.tarif_final,onChange:g=>pe({tarif_final:g.target.value}),className:"input text-center pr-7",placeholder:Dt||""}),n.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]}),n.jsx("button",{onClick:()=>Me("tarif_final",5),className:"btn-ghost p-1.5 shrink-0",children:n.jsx(be,{className:"w-3 h-3"})})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Acompte"}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{onClick:()=>Me("acompte",-5),className:"btn-ghost p-1.5 shrink-0",children:n.jsx(Pt,{className:"w-3 h-3"})}),n.jsxs("div",{className:"relative flex-1",children:[n.jsx("input",{type:"number",step:"0.01",value:U.acompte,onChange:g=>pe({acompte:g.target.value}),className:"input text-center pr-7"}),n.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]}),n.jsx("button",{onClick:()=>Me("acompte",5),className:"btn-ghost p-1.5 shrink-0",children:n.jsx(be,{className:"w-3 h-3"})})]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"input-label flex items-center gap-1",children:[n.jsx(Ps,{className:"w-3 h-3"})," R√©duction (%)"]}),n.jsx("input",{type:"number",step:"1",min:"0",max:"100",value:U.reduction_pourcentage,onChange:g=>pe({reduction_pourcentage:g.target.value,reduction_montant:""}),className:"input",placeholder:"0"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"R√©duction (‚Ç¨)"}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"number",step:"0.01",value:U.reduction_montant,onChange:g=>pe({reduction_montant:g.target.value,reduction_pourcentage:""}),className:"input pr-7",placeholder:"0"}),n.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Qualit√© √©cran"}),n.jsxs("select",{value:U.type_ecran,onChange:g=>pe({type_ecran:g.target.value}),className:"input",children:[n.jsx("option",{value:"",children:"‚Äî"}),n.jsx("option",{value:"Original",children:"Original (OEM)"}),n.jsx("option",{value:"Original reconditionn√©",children:"Original reconditionn√©"}),n.jsx("option",{value:"Compatible Premium",children:"Compatible Premium"}),n.jsx("option",{value:"Compatible",children:"Compatible"}),n.jsx("option",{value:"OLED",children:"OLED"}),n.jsx("option",{value:"OLED Premium",children:"OLED Premium"}),n.jsx("option",{value:"Incell",children:"Incell"}),n.jsx("option",{value:"LCD",children:"LCD"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Date r√©cup√©ration"}),n.jsx("input",{type:"datetime-local",value:U.date_recuperation,onChange:g=>pe({date_recuperation:g.target.value}),className:"input"})]})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"mb-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[n.jsxs("div",{className:"text-[11px] font-bold text-amber-800 uppercase tracking-wider mb-2 flex items-center justify-between",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(At,{className:"w-3 h-3"})," Pi√®ce(s) command√©e(s) (",ln.length,")"]}),n.jsxs("button",{onClick:()=>Oe(!0),className:"text-[10px] font-semibold text-brand-600 hover:text-brand-800 flex items-center gap-0.5",children:[n.jsx(be,{className:"w-3 h-3"})," Ajouter"]})]}),ln.length===0&&n.jsx("p",{className:"text-xs text-amber-600 italic py-1",children:"Aucune commande de pi√®ce"}),ln.map(g=>n.jsx("div",{className:"py-2 border-b border-amber-100 last:border-0",children:n.jsxs("div",{className:"flex items-start justify-between gap-2",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"text-sm font-semibold text-slate-700",children:g.description}),g.reference&&n.jsxs("div",{className:"text-[10px] text-slate-400 font-mono",children:["R√©f: ",g.reference]}),g.notes&&n.jsx("div",{className:"text-xs text-slate-500",children:g.notes}),g.fournisseur&&n.jsxs("div",{className:"text-xs text-slate-400",children:["Fournisseur : ",g.fournisseur]})]}),n.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[g.prix>0&&n.jsx("span",{className:"text-xs font-bold text-slate-700",children:Q(g.prix)}),n.jsxs("select",{value:g.statut||"En attente",onChange:C=>Xa(g.id,C.target.value),className:`text-[10px] font-bold px-1.5 py-0.5 rounded-full border-0 cursor-pointer appearance-none pr-4 ${g.statut==="Panier"?"bg-slate-100 text-slate-700":g.statut==="En attente"?"bg-amber-100 text-amber-700":g.statut==="Command√©e"?"bg-blue-100 text-blue-700":g.statut==="Re√ßu"?"bg-green-100 text-green-700":g.statut==="En r√©paration"?"bg-indigo-100 text-indigo-700":g.statut==="Donn√© au client"?"bg-purple-100 text-purple-700":g.statut==="Cl√¥tur√©"?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"}`,style:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 2px center"},children:[n.jsx("option",{value:"Panier",children:"Panier"}),n.jsx("option",{value:"En attente",children:"En attente"}),n.jsx("option",{value:"Command√©e",children:"Command√©e"}),n.jsx("option",{value:"Re√ßu",children:"Re√ßu"}),n.jsx("option",{value:"En r√©paration",children:"En r√©paration"}),n.jsx("option",{value:"Donn√© au client",children:"Donn√© au client"}),n.jsx("option",{value:"Cl√¥tur√©",children:"Cl√¥tur√©"})]}),n.jsx("button",{onClick:()=>Qa(g.id),className:"p-0.5 text-red-400 hover:text-red-600",title:"Supprimer",children:n.jsx(bn,{className:"w-3 h-3"})})]})]})},g.id))]}),n.jsxs("div",{className:"mb-3",children:[M.filter(g=>g.label).map((g,C)=>n.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-50 last:border-0",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-sm font-medium text-slate-700",children:g.label}),h.type_ecran&&C===0&&n.jsx("span",{className:"text-[10px] font-semibold text-violet-600 bg-violet-50 px-2 py-0.5 rounded",children:h.type_ecran})]}),n.jsx("span",{className:"text-sm font-bold text-slate-800",children:Q(g.prix)})]},C)),M.filter(g=>g.label).length===0&&n.jsx("p",{className:"text-sm text-slate-400 italic py-2",children:"Aucune r√©paration enregistr√©e"})]}),mn>0&&n.jsxs("div",{className:"flex justify-between py-1 text-sm text-emerald-600",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Ps,{className:"w-3 h-3"})," R√©duction",St>0?` (${St}%)`:""]}),n.jsxs("span",{className:"font-medium",children:["- ",Q(mn)]})]}),n.jsxs("div",{className:"border-t border-slate-200 mt-2 pt-2 space-y-1",children:[n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{className:"text-slate-500",children:Ye>0?"Sous-total HT":"Tarif final"}),n.jsx("span",{className:"font-semibold text-slate-800",children:Q(xn)})]}),Ye>0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsxs("span",{className:"text-slate-500",children:["TVA (",Ye,"%)"]}),n.jsx("span",{className:"font-medium text-slate-600",children:Q(Ds)})]}),n.jsxs("div",{className:"flex justify-between text-sm font-bold border-t border-slate-200 pt-2",children:[n.jsx("span",{className:"text-slate-800",children:"Total TTC"}),n.jsx("span",{className:"text-slate-900",children:Q(It)})]})]}),n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{className:"text-slate-500",children:"Acompte vers√©"}),n.jsxs("span",{className:"font-medium text-slate-800",children:["- ",h.acompte?Q(h.acompte):"0,00 ‚Ç¨"]})]})]}),h.paye?n.jsxs("div",{className:"mt-3 px-4 py-3 rounded-xl bg-gradient-to-r from-emerald-100 to-green-100 border border-emerald-300 text-center",children:[n.jsx("span",{className:"font-extrabold text-emerald-700 text-[15px]",children:"PAY√â"}),n.jsx("div",{className:"text-xs text-emerald-600 mt-0.5",children:"Reste √† payer : 0,00 ‚Ç¨"})]}):ge>0?n.jsxs("div",{className:"flex justify-between mt-3 px-4 py-3 rounded-xl bg-gradient-to-r from-red-50 to-orange-50 border border-red-200",children:[n.jsx("span",{className:"font-extrabold text-red-600 text-[15px]",children:"RESTE √Ä PAYER"}),n.jsx("span",{className:"font-extrabold text-red-600 text-[15px]",children:Q(ge)})]}):null,n.jsxs("div",{className:"flex gap-2 mt-3 flex-wrap",children:[n.jsxs("button",{onClick:()=>{h.paye?confirm("D√©marquer comme non pay√© ?")&&un():gt(!0)},className:`px-3 py-2 rounded-lg text-xs font-semibold transition-colors ${h.paye?"bg-emerald-500 text-white":"bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-100"}`,children:[n.jsx(Ae,{className:"w-3.5 h-3.5 inline mr-1"}),h.paye?"Pay√© ‚úì":"Marquer pay√©"]}),h.paye&&n.jsx("button",{onClick:()=>{confirm("Annuler le paiement ?")&&un()},className:"px-3 py-2 rounded-lg text-xs font-medium text-slate-400 hover:text-red-500 border border-slate-200 hover:border-red-200 transition-colors",children:"Annuler paiement"}),La&&n.jsxs("button",{onClick:al,className:"px-3 py-2 rounded-lg bg-amber-500 text-white text-xs font-semibold hover:bg-amber-600",children:[n.jsx(kl,{className:"w-3.5 h-3.5 inline mr-1"}),"Envoyer en caisse"]}),n.jsxs("button",{onClick:ol,className:"px-3 py-2 rounded-lg bg-orange-50 text-orange-600 text-xs font-semibold border border-orange-200 hover:bg-orange-100",children:[n.jsx(We,{className:"w-3.5 h-3.5 inline mr-1"}),"Accord client"]})]})]})]});case"status":return n.jsxs("div",{className:"card p-5",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:Ee(h.statut).color+"20"},children:n.jsx(On,{className:"w-4 h-4",style:{color:Ee(h.statut).color}})}),n.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Changer le statut"})]}),n.jsx("select",{value:h.statut,onChange:g=>Za(g.target.value),className:"w-full py-3 px-4 text-base font-semibold rounded-xl border-2 transition-colors cursor-pointer appearance-none bg-no-repeat",style:{borderColor:Ee(h.statut).color,color:Ee(h.statut).color,backgroundColor:Ee(h.statut).color+"10",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='${encodeURIComponent(Ee(h.statut).color)}' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E")`,backgroundPosition:"right 12px center",backgroundSize:"20px"},children:bl.map(g=>n.jsx("option",{value:g,children:g},g))}),h.statut==="En attente d'accord client"&&n.jsxs("div",{className:"mt-3 p-3 bg-orange-50 border border-orange-200 rounded-xl space-y-2",children:[n.jsx("p",{className:"text-[11px] font-semibold text-orange-700 uppercase tracking-wider",children:"R√©ponse du client"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>ys(!0),className:"flex-1 py-2 px-3 rounded-lg bg-emerald-50 text-emerald-700 text-xs font-bold border border-emerald-200 hover:bg-emerald-100 transition-colors",children:[n.jsx(_e,{className:"w-3.5 h-3.5 inline mr-1"}),"Client a valid√©"]}),n.jsxs("button",{onClick:()=>ys(!1),className:"flex-1 py-2 px-3 rounded-lg bg-red-50 text-red-600 text-xs font-bold border border-red-200 hover:bg-red-100 transition-colors",children:[n.jsx(te,{className:"w-3.5 h-3.5 inline mr-1"}),"Client a refus√©"]})]})]}),n.jsx(Kl,{ticket:h,visible:bt.timer})]});case"queue":return bt.queue?n.jsx(eo,{open:!0,onClose:()=>{},currentTicketId:parseInt(e),basePath:a,user:s,inline:!0}):null;case"fidelite":return h.client_id&&!l?n.jsx(hl,{clientId:h.client_id}):null;default:return null}};return n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsx("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 text-white px-4 sm:px-6 lg:px-8 py-8 sm:py-10 -mx-4 sm:-mx-6 lg:-mx-8 -mt-4 sm:-mt-6 lg:-mt-8 mb-6",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-1.5 text-slate-400 hover:text-white transition-colors mb-5 -ml-1",children:[n.jsx(Et,{className:"w-4 h-4"}),n.jsx("span",{className:"text-xs font-medium",children:"Retour"})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-5",children:[n.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h1",{className:"text-2xl sm:text-3xl font-display font-bold text-white font-mono tracking-tight",children:h.ticket_code}),n.jsx("button",{onClick:rl,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",title:"Copier le code",children:y?n.jsx(_e,{className:"w-4 h-4 text-emerald-400"}):n.jsx(hr,{className:"w-4 h-4 text-slate-400"})}),h.est_retour_sav&&n.jsxs("span",{className:"px-2.5 py-1 rounded-full bg-red-500/20 text-red-300 text-xs font-bold flex items-center gap-1",children:[n.jsx(Fe,{className:"w-3.5 h-3.5"})," SAV"]}),h.source==="distance"&&n.jsxs("span",{className:"px-2.5 py-1 rounded-full bg-indigo-500/20 text-indigo-300 text-xs font-bold flex items-center gap-1",children:[n.jsx(Es,{className:"w-3.5 h-3.5"})," Distance"]}),h.paye&&n.jsxs("span",{className:"px-2.5 py-1 rounded-full bg-emerald-500/20 text-emerald-300 text-xs font-bold flex items-center gap-1",children:[n.jsx(Ae,{className:"w-3.5 h-3.5"})," Pay√©"]})]}),n.jsxs("div",{className:"text-sm text-slate-300 flex flex-wrap items-center gap-x-2 gap-y-1",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(As,{className:"w-3.5 h-3.5 text-slate-500"})," ",h.client_prenom||""," ",h.client_nom||""]}),n.jsx("span",{className:"text-slate-600",children:"‚Ä¢"}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(hn,{className:"w-3.5 h-3.5 text-slate-500"})," ",Ss||"‚Äî"]}),n.jsx("span",{className:"text-slate-600",children:"‚Ä¢"}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Ge,{className:"w-3.5 h-3.5 text-slate-500"}),M.filter(x=>x.label).length>0?M.filter(x=>x.label).map(x=>x.label).join(" + "):h.panne||"‚Äî"]}),n.jsx("span",{className:"text-slate-600",children:"‚Ä¢"}),n.jsx("span",{className:"font-semibold text-emerald-400",children:Q(It||0)}),h.paye&&n.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-300 px-2 py-0.5 rounded-full",children:"Pay√©"}),!h.paye&&ge>0&&n.jsxs("span",{className:"text-xs bg-amber-500/20 text-amber-300 px-2 py-0.5 rounded-full",children:["Reste ",Q(ge)]})]}),h.client_tel&&n.jsx("a",{href:`tel:${h.client_tel}`,className:"text-sm text-slate-400 hover:text-white font-mono transition-colors",children:h.client_tel})]}),n.jsxs("div",{className:"flex sm:flex-col items-center sm:items-end gap-3 shrink-0",children:[n.jsx(fl,{statut:h.statut,size:"lg"}),n.jsxs("button",{onClick:()=>ns(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-slate-300 hover:text-white text-sm font-medium transition-colors",children:[n.jsx(vr,{className:"w-4 h-4"})," Imprimer"]})]})]})]})}),h.est_retour_sav&&n.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 px-4 sm:px-6 lg:px-8 py-3 -mx-4 sm:-mx-6 lg:-mx-8 mb-2",children:n.jsxs("div",{className:"max-w-7xl mx-auto flex items-center gap-3",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-red-100 flex items-center justify-center shrink-0",children:n.jsx(Fe,{className:"w-4 h-4 text-red-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-bold text-red-800",children:"RETOUR SAV"}),n.jsxs("p",{className:"text-xs text-red-600",children:["Prise en charge garantie ‚Äî Montant : 0,00 ‚Ç¨",h.ticket_original&&n.jsxs(n.Fragment,{children:[" ‚Äî Ticket original : ",n.jsx("button",{onClick:()=>t(`${a}/ticket/${h.ticket_original.id}`),className:"font-mono font-bold underline hover:text-red-800",children:h.ticket_original.ticket_code})," (",h.ticket_original.statut,")"]})]})]})]})}),h.retours_sav&&h.retours_sav.length>0&&n.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-500 px-4 sm:px-6 lg:px-8 py-3 -mx-4 sm:-mx-6 lg:-mx-8 mb-2",children:n.jsxs("div",{className:"max-w-7xl mx-auto flex items-start gap-3",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center shrink-0 mt-0.5",children:n.jsx(We,{className:"w-4 h-4 text-amber-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("p",{className:"text-sm font-bold text-amber-800",children:[h.retours_sav.length," retour",h.retours_sav.length>1?"s":""," SAV li√©",h.retours_sav.length>1?"s":""]}),n.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:h.retours_sav.map(x=>n.jsxs("button",{onClick:()=>t(`${a}/ticket/${x.id}`),className:"text-xs font-mono font-bold text-amber-700 bg-amber-100 hover:bg-amber-200 px-2 py-1 rounded-lg transition-colors",children:[x.ticket_code," ",n.jsxs("span",{className:"font-normal",children:["(",x.statut,")"]})]},x.id))})]})]})}),h.statut==="Pr√©-enregistr√©"&&h.source==="distance"&&n.jsx("div",{className:"bg-indigo-50 border-l-4 border-indigo-500 px-4 sm:px-6 lg:px-8 py-3 -mx-4 sm:-mx-6 lg:-mx-8 mb-2",children:n.jsxs("div",{className:"max-w-7xl mx-auto flex items-center gap-3",children:[n.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-100 flex items-center justify-center shrink-0",children:n.jsx(Es,{className:"w-4 h-4 text-indigo-600"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-bold text-indigo-800",children:"D√©p√¥t √† distance ‚Äî En attente de validation"}),n.jsx("p",{className:"text-xs text-indigo-600",children:"Le client a pr√©-enregistr√© cet appareil en ligne"})]}),n.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[n.jsxs("button",{onClick:async()=>{try{await A.validerDepot(h.id),r.success("D√©p√¥t valid√© ‚Äî passage en diagnostic"),X()}catch(x){r.error(x.message)}},className:"btn-primary text-xs px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700",children:[n.jsx(_e,{className:"w-3.5 h-3.5"})," Valider"]}),n.jsxs("button",{onClick:()=>{const x=prompt("Motif du refus :");x!==null&&A.refuserDepot(h.id,x||"Non pr√©cis√©").then(()=>{r.success("D√©p√¥t refus√©"),X()}).catch(N=>r.error(N.message))},className:"btn-ghost text-xs px-3 py-1.5 text-red-600 hover:bg-red-50",children:[n.jsx(te,{className:"w-3.5 h-3.5"})," Refuser"]})]})]})}),Sa&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>pt(!1)}),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-in max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-100 flex items-center justify-center",children:n.jsx(We,{className:"w-5 h-5 text-orange-600"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Demande d'accord client"}),n.jsxs("p",{className:"text-sm text-slate-500",children:[h.ticket_code," ‚Äî ",h.client_prenom," ",h.client_nom]})]}),n.jsx("button",{onClick:()=>pt(!1),className:"ml-auto btn-ghost p-1.5",children:n.jsx(te,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-xl mb-4",children:[n.jsx("div",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-2",children:"R√©capitulatif des r√©parations"}),M.filter(x=>x.label).map((x,N)=>n.jsxs("div",{className:"flex justify-between py-1.5 border-b border-slate-100 last:border-0",children:[n.jsxs("span",{className:"text-sm text-slate-700",children:[x.label,h.type_ecran&&N===0&&n.jsx("span",{className:"text-[10px] font-semibold text-violet-600 bg-violet-50 px-1.5 py-0.5 rounded ml-2",children:h.type_ecran})]}),n.jsx("span",{className:"text-sm font-bold text-slate-800",children:Q(x.prix)})]},N)),n.jsxs("div",{className:"flex justify-between pt-2 mt-1 border-t border-slate-300",children:[n.jsx("span",{className:"text-sm font-bold text-slate-900",children:"Total"}),n.jsx("span",{className:"text-sm font-bold text-emerald-700",children:Q(M.filter(x=>x.label).reduce((x,N)=>x+(parseFloat(N.prix)||0),0))})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"text-xs font-semibold text-slate-600 mb-1 block",children:"Message au client"}),n.jsx("textarea",{value:ye,onChange:x=>ss(x.target.value),rows:7,className:"w-full px-3 py-2.5 rounded-xl border border-slate-200 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>pn("whatsapp"),disabled:sn,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-green-500 hover:bg-green-600 text-white text-xs font-bold transition-colors disabled:opacity-50",children:[n.jsx($t,{className:"w-3.5 h-3.5"})," WhatsApp"]}),n.jsxs("button",{onClick:()=>pn("sms"),disabled:sn,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold border border-slate-200 transition-colors disabled:opacity-50",children:[n.jsx(Mt,{className:"w-3.5 h-3.5"})," SMS"]}),n.jsxs("button",{onClick:()=>pn("email"),disabled:sn,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold border border-slate-200 transition-colors disabled:opacity-50",children:[n.jsx(Ft,{className:"w-3.5 h-3.5"})," Email"]})]})]})})]}),Pa&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>ft(!1)}),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-in",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center",children:n.jsx(Rl,{className:"w-5 h-5 text-amber-600"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"T√©l√©phone de pr√™t"}),n.jsx("p",{className:"text-sm text-slate-500",children:"Ce client a un t√©l√©phone de pr√™t !"})]})]}),n.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl mb-4",children:[n.jsxs("p",{className:"text-sm font-semibold text-amber-800",children:["T√©l√©phone pr√™t√© : ",o.telephone_pret]}),o.telephone_pret_imei&&n.jsxs("p",{className:"text-xs text-amber-600 font-mono mt-1",children:["IMEI : ",o.telephone_pret_imei]}),n.jsx("p",{className:"text-xs text-amber-700 mt-2 font-medium",children:"Pensez √† r√©cup√©rer le t√©l√©phone de pr√™t avant de rendre l'appareil au client !"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>ft(!1),className:"btn-ghost flex-1",children:"Annuler"}),n.jsx("button",{onClick:el,className:"btn-primary flex-1",children:"T√©l√©phone r√©cup√©r√©, rendre au client"})]})]})})]}),_a&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>Te(!1)}),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-in",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center",children:n.jsx(Ae,{className:"w-5 h-5 text-emerald-600"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Rendu au client"}),n.jsx("p",{className:"text-sm text-slate-500",children:"Le client a-t-il r√©gl√© ?"})]})]}),ge>0&&n.jsxs("div",{className:"p-4 bg-gradient-to-br from-emerald-50 to-green-50 border border-emerald-200 rounded-xl mb-5 text-center",children:[n.jsx("p",{className:"text-xs text-emerald-600 font-medium mb-1",children:"Reste √† payer"}),n.jsx("p",{className:"text-2xl font-extrabold text-emerald-700",children:Q(ge)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("button",{onClick:tl,className:"w-full py-3 px-4 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-bold transition-colors flex items-center justify-center gap-2",children:[n.jsx(Ae,{className:"w-4 h-4"})," Oui, pay√©"]}),n.jsxs("button",{onClick:nl,className:"w-full py-3 px-4 rounded-xl bg-red-50 hover:bg-red-100 text-red-600 text-sm font-bold border border-red-200 transition-colors flex items-center justify-center gap-2",children:[n.jsx(te,{className:"w-4 h-4"})," Non, pas pay√©"]}),n.jsxs("button",{onClick:()=>Te(!1),className:"w-full py-2.5 px-4 rounded-xl text-slate-400 hover:text-slate-600 text-sm font-medium transition-colors flex items-center justify-center gap-1",children:[n.jsx(Et,{className:"w-3.5 h-3.5"})," Annuler"]})]})]})})]}),Ra&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>gt(!1)}),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-in",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center",children:n.jsx(Ae,{className:"w-5 h-5 text-emerald-600"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Confirmer le paiement"}),n.jsx("p",{className:"text-sm text-slate-500",children:"Le client a-t-il bien r√©gl√© ?"})]})]}),ge>0&&n.jsxs("div",{className:"p-4 bg-gradient-to-br from-emerald-50 to-green-50 border border-emerald-200 rounded-xl mb-5 text-center",children:[n.jsx("p",{className:"text-xs text-emerald-600 font-medium mb-1",children:"Reste √† payer"}),n.jsx("p",{className:"text-2xl font-extrabold text-emerald-700",children:Q(ge)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("button",{onClick:un,className:"w-full py-3 px-4 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-bold transition-colors flex items-center justify-center gap-2",children:[n.jsx(Ae,{className:"w-4 h-4"})," Oui, confirmer le paiement"]}),n.jsxs("button",{onClick:()=>gt(!1),className:"w-full py-2.5 px-4 rounded-xl text-slate-400 hover:text-slate-600 text-sm font-medium transition-colors flex items-center justify-center gap-1",children:[n.jsx(Et,{className:"w-3.5 h-3.5"})," Annuler"]})]})]})})]}),Ba&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>on(!1)}),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-in",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center",children:n.jsx(bn,{className:"w-5 h-5 text-red-600"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Supprimer le ticket"}),n.jsx("p",{className:"text-sm text-slate-500",children:h.ticket_code})]})]}),n.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Cette action est irr√©versible. Toutes les donn√©es li√©es (notes, commandes, historique) seront supprim√©es."}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"input-label",children:"Code administrateur"}),n.jsx("input",{type:"password",value:cn,onChange:x=>{cs(x.target.value),dn("")},onKeyDown:x=>x.key==="Enter"&&Ns(),className:"input",placeholder:"Entrez le code admin",autoFocus:!0}),ds&&n.jsx("p",{className:"text-xs text-red-500 mt-1 font-medium",children:ds})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>on(!1),className:"btn-ghost flex-1",children:"Annuler"}),n.jsx("button",{onClick:Ns,disabled:us||!cn,className:"flex-1 py-2.5 px-4 rounded-xl bg-red-600 hover:bg-red-700 text-white text-sm font-semibold transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:us?"Suppression...":"Supprimer"})]})]})})]}),Oa&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:()=>Oe(!1)}),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-5 animate-in",onClick:x=>x.stopPropagation(),children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"text-base font-bold text-slate-800 flex items-center gap-2",children:[n.jsx(At,{className:"w-4 h-4 text-amber-600"})," Commander une pi√®ce"]}),n.jsx("button",{onClick:()=>Oe(!1),className:"btn-ghost p-1.5",children:n.jsx(te,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"D√©signation *"}),n.jsx("input",{value:ee.description,onChange:x=>Be(N=>({...N,description:x.target.value})),className:"input",placeholder:"Ex: √âcran iPhone 15 Pro Max...",autoFocus:!0})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Fournisseur"}),n.jsx("input",{value:ee.fournisseur,onChange:x=>Be(N=>({...N,fournisseur:x.target.value})),className:"input",placeholder:"Mobilax, iPartsBuy..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"R√©f√©rence"}),n.jsx("input",{value:ee.reference,onChange:x=>Be(N=>({...N,reference:x.target.value})),className:"input font-mono",placeholder:"REF-001"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Prix estim√© (‚Ç¨)"}),n.jsx("input",{type:"number",step:"0.01",value:ee.prix,onChange:x=>Be(N=>({...N,prix:x.target.value})),className:"input",placeholder:"0.00"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Notes"}),n.jsx("input",{value:ee.notes,onChange:x=>Be(N=>({...N,notes:x.target.value})),className:"input",placeholder:"Qualit√©, couleur..."})]})]})]}),n.jsxs("div",{className:"flex gap-2 mt-5 pt-3 border-t border-slate-100",children:[n.jsx("button",{onClick:()=>Oe(!1),className:"btn-ghost flex-1",children:"Annuler"}),n.jsxs("button",{onClick:Ja,disabled:!ee.description.trim(),className:"btn-primary flex-1",children:[n.jsx(At,{className:"w-4 h-4"})," Cr√©er la commande"]})]})]})})]}),$a&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>Je(!1)}),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-in",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center",children:n.jsx(Fe,{className:"w-5 h-5 text-red-600"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Retour SAV"}),n.jsxs("p",{className:"text-sm text-slate-500",children:["Cr√©er un ticket li√© √† ",h.ticket_code]})]}),n.jsx("button",{onClick:()=>Je(!1),className:"ml-auto btn-ghost p-1.5",children:n.jsx(te,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"p-3 bg-slate-50 border border-slate-200 rounded-xl mb-4",children:[n.jsx("div",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Ticket original"}),n.jsxs("div",{className:"text-sm font-bold text-slate-800",children:[h.ticket_code," ‚Äî ",Ss]}),n.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:[h.panne," ",h.panne_detail?`(${h.panne_detail})`:""]})]}),n.jsxs("div",{className:"space-y-3 mb-5",children:[n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"Motif du retour SAV *"}),n.jsx("input",{value:Le.panne,onChange:x=>Nt(N=>({...N,panne:x.target.value})),className:"input",placeholder:"Ex: M√™me panne r√©apparue, √©cran d√©coll√©...",autoFocus:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"input-label",children:"D√©tail"}),n.jsx("textarea",{value:Le.panne_detail,onChange:x=>Nt(N=>({...N,panne_detail:x.target.value})),className:"input",rows:3,placeholder:"Pr√©cisions compl√©mentaires..."})]})]}),n.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-xl mb-4",children:n.jsxs("p",{className:"text-xs text-red-700 font-medium",children:["Ce ticket sera marqu√© comme retour SAV et li√© au ticket ",h.ticket_code,". Le montant sera de 0,00 ‚Ç¨ (prise en charge garantie)."]})}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{onClick:()=>Je(!1),className:"btn-ghost flex-1",children:"Annuler"}),n.jsx("button",{onClick:il,disabled:ms||!Le.panne.trim(),className:"flex-1 py-2.5 px-4 rounded-xl bg-red-600 hover:bg-red-700 text-white text-sm font-semibold transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:ms?"Cr√©ation...":n.jsxs(n.Fragment,{children:[n.jsx(Fe,{className:"w-4 h-4"})," Cr√©er le retour SAV"]})})]})]})})]}),n.jsxs("div",{className:"px-4 sm:px-6 lg:px-8",children:[(()=>{const x=xt.filter(N=>N.important);return!Ea&&x.length===0?null:(x.length>0&&x[0],n.jsxs("div",{className:"flex items-start gap-3 p-4 mb-5 rounded-xl bg-red-50 border border-red-200 shadow-sm animate-in",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500 flex items-center justify-center shrink-0",children:n.jsx(We,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[n.jsx("p",{className:"text-sm font-bold text-red-800",children:"Note importante"}),x.map(N=>n.jsx("p",{className:"text-sm text-red-700",children:N.contenu.replace(/^\[ATTENTION\]\s*‚ö†?\s*/i,"")},N.id)),x.length===0&&h.attention&&n.jsx("p",{className:"text-sm text-red-700",children:h.attention})]}),n.jsx("button",{onClick:()=>rs(!1),className:"shrink-0 p-1 rounded-lg text-red-300 hover:text-red-600 hover:bg-red-100 transition-colors",children:n.jsx(te,{className:"w-4 h-4"})})]}))})(),n.jsx("div",{className:"card p-5 mb-6",children:n.jsx(gl,{statut:h.statut,hasPiece:h.commande_piece===1})}),n.jsx("div",{className:"flex items-center gap-2 mb-5",children:n.jsxs("button",{onClick:()=>os(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors",children:[n.jsx(Bt,{className:"w-3.5 h-3.5"})," Personnaliser"]})}),we&&n.jsxs("div",{className:"flex items-center justify-between p-3 mb-5 rounded-xl bg-blue-50 border-2 border-dashed border-blue-300",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-blue-600 text-sm font-bold",children:"Mode √©dition activ√©"}),n.jsx("span",{className:"text-slate-500 text-xs",children:"‚Äî Glisse les widgets par ‚†ø"})]}),n.jsx("button",{onClick:()=>as(!1),className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-bold hover:bg-blue-700 transition-colors",children:"Terminer"})]}),n.jsx(Rd,{onDragEnd:qa,children:n.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-[55fr_45fr] gap-5",children:["left","right"].map(x=>n.jsx(bu,{droppableId:x,isDropDisabled:!we,children:(N,T)=>n.jsxs("div",{ref:N.innerRef,...N.droppableProps,className:`space-y-5 min-h-[200px] rounded-xl p-1 transition-colors duration-200 ${T.isDraggingOver?x==="left"?"bg-blue-50/40 ring-2 ring-dashed ring-blue-300":"bg-violet-50/40 ring-2 ring-dashed ring-violet-300":""}`,children:[ht[x].map((g,C)=>{const B=pl(g);return B?n.jsx(Xd,{draggableId:g,index:C,isDragDisabled:!we,children:(V,z)=>n.jsxs("div",{ref:V.innerRef,...V.draggableProps,className:`relative transition-all ${z.isDragging?"shadow-2xl shadow-blue-500/25 rotate-[1.5deg] z-50 opacity-90":""} ${we&&!z.isDragging?"ring-2 ring-dashed ring-slate-200":""} rounded-xl`,children:[we&&n.jsx("div",{...V.dragHandleProps,className:"absolute -top-2.5 right-3 z-10",children:n.jsx("span",{className:"flex items-center justify-center w-7 h-7 rounded-lg bg-blue-100 text-blue-600 text-[16px] cursor-grab active:cursor-grabbing shadow-sm animate-wiggle select-none",children:"‚†ø"})}),!we&&n.jsx("div",{...V.dragHandleProps,className:"hidden"}),B]})},g):null}),N.placeholder]})},x))})})]}),n.jsx("div",{className:"mt-10 mb-4 text-center",children:n.jsx("button",{onClick:()=>{on(!0),cs(""),dn("")},className:"text-xs text-slate-400 hover:text-red-500 transition-colors",children:"Supprimer ce ticket"})}),n.jsx(Ul,{open:fe,onClose:()=>ns(!1),ticketId:e,ticketCode:h.ticket_code,clientTel:h.client_tel,clientEmail:h.client_email}),n.jsx(to,{open:ka,onClose:()=>os(!1),prefs:bt,onPrefsChange:za,layout:ht,onResetLayout:Ha,editMode:we,onToggleEditMode:()=>as(x=>!x)})]})}export{Eu as default};
