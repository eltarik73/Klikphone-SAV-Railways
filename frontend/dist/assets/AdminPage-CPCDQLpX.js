import{j as e,a as me,c as d}from"./index-CiVRGsEJ.js";import{r as p}from"./vendor-react-DMwujlca.js";import{L as ue,ap as he,aq as pe,ar as fe,as as je,d as re,U as be,k as ge,y as ye,at as ve,w as Ne}from"./vendor-icons-CffLNJII.js";import{R as v,B as _,C as S,X as C,Y as B,T as N,L as te,a as z,b as se,P as we,c as ke,d as Ae,e as ae}from"./vendor-charts-DNuyOzTe.js";const L=["#7C3AED","#3B82F6","#10B981","#F59E0B","#EF4444","#EC4899","#06B6D4","#8B5CF6","#F97316","#6366F1"],le="#7C3AED",Se="#3B82F6",I="#10B981",ie="#F59E0B",Ce=[{label:"7j",value:7},{label:"14j",value:14},{label:"30j",value:30}],Be=[{label:"Aujourd'hui",value:"today"},{label:"7 jours",value:"7d"},{label:"14 jours",value:"14d"},{label:"1 mois",value:"30d"},{label:"3 mois",value:"90d"},{label:"12 mois",value:"365d"},{label:"Personnalisé",value:"custom"}],O="kp_admin_auth";function w(l){return l==null?"0,00 €":Number(l).toLocaleString("fr-FR",{minimumFractionDigits:2})+" €"}function ne(l){if(!l&&l!==0)return"—";const n=Math.floor(l),i=Math.round((l-n)*60);return n===0?`${i}min`:`${n}h ${i}min`}function f(l){return l.toISOString().split("T")[0]}function Le(l,n,i){const r=new Date,o=f(r);switch(l){case"today":return{date_start:o,date_end:o};case"7d":return{date_start:f(new Date(r-7*864e5)),date_end:o};case"14d":return{date_start:f(new Date(r-14*864e5)),date_end:o};case"30d":return{date_start:f(new Date(r-30*864e5)),date_end:o};case"90d":return{date_start:f(new Date(r-90*864e5)),date_end:o};case"365d":return{date_start:f(new Date(r-365*864e5)),date_end:o};case"custom":return{date_start:n||o,date_end:i||o};default:return{date_start:f(new Date(r-30*864e5)),date_end:o}}}function T({active:l,payload:n,label:i}){return!l||!n||!n.length?null:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 shadow-xl text-xs",children:[e.jsx("p",{className:"text-slate-400 mb-1 font-medium",children:i}),n.map((r,o)=>e.jsxs("p",{className:"font-semibold",style:{color:r.color||r.fill||"#fff"},children:[r.name,": ",typeof r.value=="number"&&r.value%1!==0?r.value.toFixed(1):r.value]},o))]})}function _e(){return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"w-8 h-8 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"})})}function u({text:l}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-slate-500",children:[e.jsx(re,{className:"w-8 h-8 text-slate-600 mb-2"}),e.jsx("p",{className:"text-sm",children:l||"Aucune donnée disponible"})]})}function h({title:l,children:n,className:i=""}){return e.jsxs("div",{className:`bg-slate-800 rounded-xl border border-slate-700/50 p-5 ${i}`,children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-4",children:l}),n]})}function ze({taux:l,envoyes:n,acceptes:i}){const o=Math.PI*70,x=l/100*o,c=l>=70?I:l>=40?ie:"#EF4444";return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("svg",{width:"160",height:"100",viewBox:"0 0 160 100",children:[e.jsx("path",{d:"M 10 90 A 70 70 0 0 1 150 90",fill:"none",stroke:"#334155",strokeWidth:"10",strokeLinecap:"round"}),e.jsx("path",{d:"M 10 90 A 70 70 0 0 1 150 90",fill:"none",stroke:c,strokeWidth:"10",strokeLinecap:"round",strokeDasharray:`${x} ${o}`}),e.jsxs("text",{x:"80",y:"75",textAnchor:"middle",fill:"white",fontSize:"28",fontWeight:"bold",children:[l,"%"]})]}),e.jsxs("div",{className:"flex gap-6 mt-3 text-xs text-slate-400",children:[e.jsxs("span",{children:["Envoyés : ",e.jsx("strong",{className:"text-white",children:n})]}),e.jsxs("span",{children:["Acceptés : ",e.jsx("strong",{className:"text-emerald-400",children:i})]})]})]})}function Te({period:l,setPeriod:n,customStart:i,setCustomStart:r,customEnd:o,setCustomEnd:x}){return e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"flex bg-slate-800 rounded-lg p-0.5 border border-slate-700/50 flex-wrap",children:Be.map(({label:c,value:m})=>e.jsx("button",{onClick:()=>n(m),className:`px-2.5 py-1.5 rounded-md text-[11px] font-medium transition-all whitespace-nowrap ${l===m?"bg-violet-600 text-white shadow-sm":"text-slate-400 hover:text-white"}`,children:c},m))}),l==="custom"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:i,onChange:c=>r(c.target.value),className:"px-2.5 py-1.5 rounded-lg bg-slate-800 border border-slate-700 text-white text-xs focus:outline-none focus:ring-2 focus:ring-violet-500/40"}),e.jsx("span",{className:"text-slate-500 text-xs",children:"→"}),e.jsx("input",{type:"date",value:o,onChange:c=>x(c.target.value),className:"px-2.5 py-1.5 rounded-lg bg-slate-800 border border-slate-700 text-white text-xs focus:outline-none focus:ring-2 focus:ring-violet-500/40"})]})]})}function Re({onLogin:l}){const[n,i]=p.useState(""),[r,o]=p.useState(""),[x,c]=p.useState(""),[m,R]=p.useState(!1),M=async s=>{if(s.preventDefault(),!(!n||!r)){c(""),R(!0);try{const j=await d.adminLogin(n,r);if(j.success||j.token){const E={token:j.token,ts:Date.now()};localStorage.setItem(O,JSON.stringify(E)),l(E)}else c("Identifiants incorrects")}catch(j){c(j.message||"Erreur de connexion")}finally{R(!1)}}};return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-sm",children:[e.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700/50 shadow-2xl p-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"w-14 h-14 rounded-xl bg-violet-600/20 flex items-center justify-center",children:e.jsx(ue,{className:"w-7 h-7 text-violet-400"})})}),e.jsx("h1",{className:"text-xl font-display font-bold text-white text-center mb-1",children:"Administration"}),e.jsx("p",{className:"text-sm text-slate-400 text-center mb-8",children:"Accès réservé aux administrateurs"}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1.5",children:"Identifiant"}),e.jsx("input",{type:"text",value:n,onChange:s=>i(s.target.value),className:"w-full px-3.5 py-2.5 rounded-lg bg-slate-900 border border-slate-700 text-white text-sm placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500/40 focus:border-violet-500 transition-all",placeholder:"Votre identifiant",autoComplete:"username"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-slate-400 mb-1.5",children:"Mot de passe"}),e.jsx("input",{type:"password",value:r,onChange:s=>o(s.target.value),className:"w-full px-3.5 py-2.5 rounded-lg bg-slate-900 border border-slate-700 text-white text-sm placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-violet-500/40 focus:border-violet-500 transition-all",placeholder:"••••••••",autoComplete:"current-password"})]}),x&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg px-3 py-2 text-sm text-red-400 text-center",children:x}),e.jsx("button",{type:"submit",disabled:m||!n||!r,className:"w-full py-2.5 rounded-lg bg-violet-600 hover:bg-violet-500 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm font-semibold shadow-lg shadow-violet-600/25 transition-all",children:m?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"})," Connexion..."]}):"Se connecter"})]})]}),e.jsx("p",{className:"text-center text-xs text-slate-600 mt-6",children:"Klikphone SAV — Administration"})]})})}function Ee({onLogout:l}){var Y;const[n,i]=p.useState(7),[r,o]=p.useState("30d"),[x,c]=p.useState(f(new Date(Date.now()-30*864e5))),[m,R]=p.useState(f(new Date)),M=p.useMemo(()=>`admin:${r}:${x}:${m}:${n}`,[r,x,m,n]),{data:s,loading:j,isRevalidating:E}=me(M,async()=>{const t=Le(r,x,m),[a,y,g,A,$,G,X,Q,xe,Z,ee]=await Promise.all([d.getAdminOverview(t).catch(()=>null),d.getAdminReparationsParTech(n,t).catch(()=>null),d.getAdminAffluenceHeure(t).catch(()=>[]),d.getAdminAffluenceJour(t).catch(()=>[]),d.getAdminRepartitionMarques(t).catch(()=>[]),d.getAdminRepartitionPannes(t).catch(()=>[]),d.getAdminEvolutionCA(t).catch(()=>[]),d.getAdminTempsReparation(t).catch(()=>[]),d.getAdminTauxConversion(t).catch(()=>null),d.getAdminTopClients(t).catch(()=>[]),d.getAdminPerformanceTech().catch(()=>[])]);return{overview:a,repParTech:y,affluenceHeure:Array.isArray(g)?g:[],affluenceJour:Array.isArray(A)?A:[],marques:Array.isArray($)?$:[],pannes:Array.isArray(G)?G:[],evolutionCA:Array.isArray(X)?X:[],tempsRep:Array.isArray(Q)?Q:[],conversion:xe,topClients:Array.isArray(Z)?Z:[],techPerf:Array.isArray(ee)?ee:[]}},{tags:["admin"],ttl:12e4}),b=(s==null?void 0:s.overview)??null,k=(s==null?void 0:s.repParTech)??null,P=(s==null?void 0:s.affluenceHeure)??[],q=(s==null?void 0:s.affluenceJour)??[],D=(s==null?void 0:s.marques)??[],H=(s==null?void 0:s.pannes)??[],J=(s==null?void 0:s.evolutionCA)??[],F=(s==null?void 0:s.tempsRep)??[],K=(s==null?void 0:s.conversion)??null,U=(s==null?void 0:s.topClients)??[],V=(s==null?void 0:s.techPerf)??[],W=!j&&!s&&!E?"Erreur lors du chargement des données":"",oe=t=>{i(t)},ce=b?[{label:"CA du jour",value:w(b.ca_jour),sub:"payés",icon:he,color:"text-emerald-400",bg:"bg-emerald-500/10"},{label:"CA du mois",value:w(b.ca_mois),sub:"payés",icon:pe,color:"text-violet-400",bg:"bg-violet-500/10"},{label:"CA potentiel",value:w(b.ca_potentiel),sub:"devis en cours",icon:fe,color:"text-amber-400",bg:"bg-amber-500/10"},{label:"Répar. du jour",value:b.reparations_jour,sub:"terminées",icon:je,color:"text-blue-400",bg:"bg-blue-500/10"},{label:"Répar. du mois",value:b.reparations_mois,sub:"clôturées",icon:re,color:"text-cyan-400",bg:"bg-cyan-500/10"},{label:"Ticket moyen",value:w(b.ticket_moyen),sub:"CA/réparation",icon:be,color:"text-pink-400",bg:"bg-pink-500/10"}]:[],de=P.reduce((t,a)=>a.moyenne>((t==null?void 0:t.moyenne)||0)?a:t,null);return e.jsxs("div",{className:"min-h-screen bg-slate-900",children:[e.jsx("div",{className:"sticky top-0 z-30 bg-slate-900/95 backdrop-blur-sm border-b border-slate-800",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-white tracking-tight",children:"Administration"}),e.jsx("p",{className:"text-sm text-slate-400 mt-0.5",children:"Tableau de bord analytique"})]}),e.jsxs("button",{onClick:l,className:"flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800 border border-slate-700/50 transition-all",children:[e.jsx(ge,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Déconnexion"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-slate-500 shrink-0"}),e.jsx(Te,{period:r,setPeriod:o,customStart:x,setCustomStart:c,customEnd:m,setCustomEnd:R})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[W&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg px-4 py-3 text-sm text-red-400",children:W}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Vue d'ensemble"}),j&&!b?e.jsx(_e,{}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:ce.map(({label:t,value:a,sub:y,icon:g,color:A,bg:$})=>e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700/50 p-4 hover:border-slate-600 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[10px] font-medium text-slate-500 uppercase tracking-wider",children:t}),e.jsx("div",{className:`w-8 h-8 rounded-lg ${$} flex items-center justify-center`,children:e.jsx(g,{className:`w-4 h-4 ${A}`})})]}),e.jsx("p",{className:"text-xl font-bold text-white tracking-tight",children:a}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5",children:y})]},t))})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider",children:"Réparations par technicien"}),e.jsx("div",{className:"flex bg-slate-800 rounded-lg p-0.5 border border-slate-700/50",children:Ce.map(({label:t,value:a})=>e.jsx("button",{onClick:()=>oe(a),className:`px-3 py-1 rounded-md text-xs font-medium transition-all ${n===a?"bg-violet-600 text-white shadow-sm":"text-slate-400 hover:text-white"}`,children:t},a))})]}),e.jsx(h,{title:`Réparations par technicien (${n} derniers jours)`,children:(Y=k==null?void 0:k.data)!=null&&Y.length?e.jsx(v,{width:"100%",height:300,children:e.jsxs(_,{data:k.data,children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(C,{dataKey:"jour",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},label:{value:"Jour",position:"insideBottom",offset:-5,style:{fill:"#64748B",fontSize:11}}}),e.jsx(B,{tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},allowDecimals:!1,label:{value:"Réparations",angle:-90,position:"insideLeft",style:{fill:"#64748B",fontSize:11}}}),e.jsx(N,{content:e.jsx(T,{})}),e.jsx(te,{wrapperStyle:{fontSize:11,color:"#94A3B8"}}),k.techniciens.map((t,a)=>e.jsx(z,{dataKey:t.nom,stackId:"a",fill:t.couleur||L[a%L.length],radius:a===k.techniciens.length-1?[4,4,0,0]:[0,0,0,0]},t.nom))]})}):e.jsx(u,{text:"Aucune réparation sur la période"})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Affluence"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(h,{title:"Affluence par heure",children:P.length?e.jsx(v,{width:"100%",height:280,children:e.jsxs(_,{data:P,children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(C,{dataKey:"heure",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},label:{value:"Heure",position:"insideBottom",offset:-5,style:{fill:"#64748B",fontSize:11}}}),e.jsx(B,{tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},label:{value:"Dépôts moyens",angle:-90,position:"insideLeft",style:{fill:"#64748B",fontSize:11}}}),e.jsx(N,{content:e.jsx(T,{})}),e.jsx(z,{dataKey:"moyenne",name:"Moyenne/jour",radius:[4,4,0,0],maxBarSize:28,children:P.map((t,a)=>e.jsx(se,{fill:t===de?"#A78BFA":le},a))})]})}):e.jsx(u,{text:"Aucune donnée d'affluence"})}),e.jsx(h,{title:"Affluence par jour de la semaine",children:q.length?e.jsx(v,{width:"100%",height:280,children:e.jsxs(_,{data:q,layout:"vertical",children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"#334155",horizontal:!1}),e.jsx(C,{type:"number",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},label:{value:"Dépôts moyens",position:"insideBottom",offset:-5,style:{fill:"#64748B",fontSize:11}}}),e.jsx(B,{type:"category",dataKey:"jour",tick:{fontSize:11,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},width:80}),e.jsx(N,{content:e.jsx(T,{})}),e.jsx(z,{dataKey:"moyenne",name:"Moyenne/semaine",fill:I,radius:[0,4,4,0],maxBarSize:24})]})}):e.jsx(u,{text:"Aucune donnée d'affluence"})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Analyses"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(h,{title:"Répartition par marque",children:D.length?e.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-4",children:[e.jsx(v,{width:"100%",height:250,children:e.jsxs(we,{children:[e.jsx(ke,{data:D,cx:"50%",cy:"50%",innerRadius:55,outerRadius:90,paddingAngle:3,dataKey:"count",nameKey:"marque",children:D.map((t,a)=>e.jsx(se,{fill:L[a%L.length]},a))}),e.jsx(N,{content:e.jsx(T,{})})]})}),e.jsx("div",{className:"flex flex-wrap gap-x-4 gap-y-2 justify-center lg:flex-col lg:gap-y-1.5",children:D.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shrink-0",style:{backgroundColor:L[a%L.length]}}),e.jsx("span",{className:"text-xs text-slate-300",children:t.marque}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[t.pct,"% (",t.count,")"]})]},a))})]}):e.jsx(u,{})}),e.jsx(h,{title:"Top 10 types de panne",children:H.length?e.jsx(v,{width:"100%",height:300,children:e.jsxs(_,{data:H,layout:"vertical",children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"#334155",horizontal:!1}),e.jsx(C,{type:"number",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},allowDecimals:!1,label:{value:"Nombre de tickets",position:"insideBottom",offset:-5,style:{fill:"#64748B",fontSize:11}}}),e.jsx(B,{type:"category",dataKey:"panne",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},width:130}),e.jsx(N,{content:e.jsx(T,{})}),e.jsx(z,{dataKey:"count",name:"Tickets",fill:Se,radius:[0,4,4,0],maxBarSize:20})]})}):e.jsx(u,{})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Évolution du chiffre d'affaires"}),e.jsx(h,{title:"CA encaissé vs CA potentiel (12 derniers mois)",children:J.length?e.jsx(v,{width:"100%",height:320,children:e.jsxs(Ae,{data:J,children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(C,{dataKey:"mois",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},label:{value:"Mois",position:"insideBottom",offset:-5,style:{fill:"#64748B",fontSize:11}}}),e.jsx(B,{tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},tickFormatter:t=>`${t}€`,label:{value:"Chiffre d'affaires (€)",angle:-90,position:"insideLeft",offset:10,style:{fill:"#64748B",fontSize:11}}}),e.jsx(N,{content:({active:t,payload:a,label:y})=>!t||!a?null:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 shadow-xl text-xs",children:[e.jsx("p",{className:"text-slate-400 mb-1 font-medium",children:y}),a.map((g,A)=>e.jsxs("p",{style:{color:g.color},className:"font-semibold",children:[g.name," : ",w(g.value)]},A))]})}),e.jsx(te,{wrapperStyle:{fontSize:11}}),e.jsx(ae,{type:"monotone",dataKey:"ca_encaisse",name:"CA encaissé",stroke:I,strokeWidth:2.5,dot:{r:3},activeDot:{r:5}}),e.jsx(ae,{type:"monotone",dataKey:"ca_potentiel",name:"CA potentiel",stroke:ie,strokeWidth:2.5,dot:{r:3},activeDot:{r:5},strokeDasharray:"5 5"})]})}):e.jsx(u,{text:"Aucune donnée d'évolution"})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Temps moyen de réparation"}),e.jsx(h,{title:"Durée moyenne par type de panne",children:F.length?e.jsx(v,{width:"100%",height:Math.max(250,F.length*35),children:e.jsxs(_,{data:F,layout:"vertical",children:[e.jsx(S,{strokeDasharray:"3 3",stroke:"#334155",horizontal:!1}),e.jsx(C,{type:"number",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},label:{value:"Heures",position:"insideBottom",offset:-5,style:{fill:"#64748B",fontSize:11}}}),e.jsx(B,{type:"category",dataKey:"panne",tick:{fontSize:10,fill:"#94A3B8"},tickLine:!1,axisLine:{stroke:"#334155"},width:130}),e.jsx(N,{content:({active:t,payload:a,label:y})=>!t||!(a!=null&&a.length)?null:e.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 shadow-xl text-xs",children:[e.jsx("p",{className:"text-slate-400 mb-1 font-medium",children:y}),e.jsx("p",{className:"text-violet-400 font-semibold",children:ne(a[0].value)}),e.jsxs("p",{className:"text-slate-500",children:[a[0].payload.nb," réparations"]})]})}),e.jsx(z,{dataKey:"temps_moyen_heures",name:"Temps moyen",fill:le,radius:[0,4,4,0],maxBarSize:20})]})}):e.jsx(u,{text:"Pas assez de données"})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Performance"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(h,{title:"Taux de conversion devis",children:K?e.jsx(ze,{taux:K.taux,envoyes:K.devis_envoyes,acceptes:K.devis_acceptes}):e.jsx(u,{text:"Aucune donnée"})}),e.jsx(h,{title:"Performance techniciens",className:"lg:col-span-2",children:V.length?e.jsx("div",{className:"overflow-x-auto -mx-5 px-5",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700",children:[e.jsx("th",{className:"text-left text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Technicien"}),e.jsx("th",{className:"text-center text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Répar."}),e.jsx("th",{className:"text-center text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Temps moy."}),e.jsx("th",{className:"text-right text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"CA"})]})}),e.jsx("tbody",{children:V.map((t,a)=>e.jsxs("tr",{className:"border-b border-slate-700/30 hover:bg-slate-700/20 transition-colors",children:[e.jsx("td",{className:"py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-violet-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] font-bold text-violet-400",children:(t.technicien||"?")[0].toUpperCase()})}),e.jsx("span",{className:"text-sm font-medium text-white",children:t.technicien})]})}),e.jsx("td",{className:"py-2.5 text-center text-sm text-slate-300",children:t.reparations}),e.jsx("td",{className:"py-2.5 text-center text-sm text-slate-300",children:ne((t.temps_moyen_minutes||0)/60)}),e.jsx("td",{className:"py-2.5 text-right text-sm font-semibold text-emerald-400",children:w(t.ca_genere)})]},a))})]})}):e.jsx(u,{text:"Aucune donnée"})})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4",children:"Top clients fidèles"}),e.jsx(h,{title:"Top 10 clients par nombre de réparations",children:U.length?e.jsx("div",{className:"overflow-x-auto -mx-5 px-5",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700",children:[e.jsx("th",{className:"text-left text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"#"}),e.jsx("th",{className:"text-left text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Client"}),e.jsx("th",{className:"text-left text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Téléphone"}),e.jsx("th",{className:"text-center text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"Réparations"}),e.jsx("th",{className:"text-right text-[10px] font-semibold text-slate-500 uppercase tracking-wider py-2",children:"CA total"})]})}),e.jsx("tbody",{children:U.map((t,a)=>e.jsxs("tr",{className:"border-b border-slate-700/30 hover:bg-slate-700/20 transition-colors",children:[e.jsx("td",{className:"py-2.5 text-sm text-slate-500 font-medium",children:a+1}),e.jsx("td",{className:"py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-500/20 flex items-center justify-center",children:e.jsx(ve,{className:"w-3.5 h-3.5 text-blue-400"})}),e.jsx("span",{className:"text-sm font-medium text-white",children:t.nom})]})}),e.jsx("td",{className:"py-2.5",children:e.jsxs("span",{className:"flex items-center gap-1.5 text-sm text-slate-400",children:[e.jsx(Ne,{className:"w-3 h-3"})," ",t.tel||"—"]})}),e.jsx("td",{className:"py-2.5 text-center",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-violet-500/20 text-violet-300",children:t.nb_reparations})}),e.jsx("td",{className:"py-2.5 text-right text-sm font-semibold text-emerald-400",children:w(t.ca_total)})]},a))})]})}):e.jsx(u,{text:"Aucun client récurrent"})})]}),e.jsx("div",{className:"pt-4 pb-8 text-center",children:e.jsx("p",{className:"text-xs text-slate-600",children:"Klikphone SAV — Panneau d'administration"})})]})]})}function Me(){const[l,n]=p.useState(()=>{try{const i=localStorage.getItem(O);return i?JSON.parse(i):null}catch{return null}});return l?e.jsx(Ee,{onLogout:()=>{localStorage.removeItem(O),n(null)}}):e.jsx(Re,{onLogin:i=>n(i)})}export{Me as default};
