import{u as se,a as v,j as e}from"./index-D0nULZW-.js";import{r as l}from"./vendor-react-DMwujlca.js";import{p as te,h as Q,P as ae,n as re,T as le,a as ne,aM as oe,C as ie,b as J,K as de,J as ce,e as xe}from"./vendor-icons-DnXwj2oL.js";const me={Apple:"#333333",Samsung:"#1428A0",Xiaomi:"#FF6900",Google:"#4285F4",Huawei:"#CF0A2C",Honor:"#00AAEE",Oppo:"#1A8A36",OnePlus:"#EB0028",Motorola:"#5C2D91",Nothing:"#FFFFFF",Realme:"#F5C518"},U={"Grade A":{bg:"bg-emerald-500/20",text:"text-emerald-400",border:"border-emerald-500/30"},"Grade A+":{bg:"bg-emerald-500/20",text:"text-emerald-400",border:"border-emerald-500/30"},"Grade B":{bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},"Grade B+":{bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},"Grade C":{bg:"bg-orange-500/20",text:"text-orange-400",border:"border-orange-500/30"},Neuf:{bg:"bg-blue-500/20",text:"text-blue-400",border:"border-blue-500/30"}},F=[{value:"prix_asc",label:"Prix croissant"},{value:"prix_desc",label:"Prix decroissant"},{value:"marque",label:"Marque A-Z"},{value:"nouveautes",label:"Nouveautes"}];function ue(o){if(!o)return null;const a=new Date(o);if(isNaN(a.getTime()))return null;const i=String(a.getDate()).padStart(2,"0"),d=String(a.getMonth()+1).padStart(2,"0"),t=String(a.getHours()).padStart(2,"0"),g=String(a.getMinutes()).padStart(2,"0");return`${i}/${d} a ${t}:${g}`}function k(o){return o==null?"":Number(o).toFixed(2).replace(".",",")+" €"}function he(o){return o?U[o]||U.Neuf:null}function y(){return e.jsx("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-5 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-700/50"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-7 w-16 bg-slate-700/50 rounded"}),e.jsx("div",{className:"h-4 w-24 bg-slate-700/50 rounded"})]})]})})}function be(){return e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden animate-pulse",children:[e.jsx("div",{className:"h-48 bg-slate-900/80"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-3 w-16 bg-slate-700/50 rounded"}),e.jsx("div",{className:"h-5 w-3/4 bg-slate-700/50 rounded"}),e.jsx("div",{className:"h-3 w-1/2 bg-slate-700/50 rounded"}),e.jsx("div",{className:"h-7 w-24 bg-slate-700/50 rounded mt-2"}),e.jsx("div",{className:"h-3 w-32 bg-slate-700/50 rounded"})]})]})}function S({icon:o,value:a,label:i,color:d}){return e.jsx("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-5 transition-all hover:border-slate-600/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{backgroundColor:d+"20"},children:e.jsx(o,{className:"w-6 h-6",style:{color:d}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:a??"-"}),e.jsx("p",{className:"text-sm text-slate-400",children:i})]})]})})}const pe=l.memo(function({phone:a}){const i=a.grade||(a.type_produit==="Neuf"?"Neuf":null),d=he(i),t=a.en_stock!==!1&&a.en_stock!==0;return e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden transition-shadow duration-200 hover:border-amber-500/30 hover:shadow-lg hover:shadow-amber-500/5 group",children:[e.jsxs("div",{className:"relative h-48 bg-slate-900 flex items-center justify-center overflow-hidden",children:[a.image_url?e.jsx("img",{src:a.image_url,alt:a.modele||"Telephone",className:"h-full w-full object-contain p-4 group-hover:scale-105 transition-transform duration-200",loading:"lazy",onError:g=>{var N;g.target.style.display="none",(N=g.target.nextElementSibling)==null||N.classList.remove("hidden")}}):null,e.jsxs("div",{className:`flex flex-col items-center justify-center text-slate-600 ${a.image_url?"hidden":""}`,children:[e.jsx(J,{className:"w-16 h-16 mb-2"}),e.jsx("span",{className:"text-xs text-slate-600",children:"Pas d'image"})]}),d&&e.jsx("span",{className:`absolute top-3 left-3 text-[10px] font-bold px-2.5 py-1 rounded-lg ${d.bg} ${d.text} ${d.border} border backdrop-blur-sm`,children:i==="Neuf"?"NEUF":i.toUpperCase()}),e.jsx("div",{className:"absolute top-3 right-3",children:t?e.jsxs("span",{className:"flex items-center gap-1.5 text-[10px] font-semibold px-2.5 py-1 rounded-lg bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 backdrop-blur-sm",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"}),"En stock"]}):e.jsxs("span",{className:"flex items-center gap-1.5 text-[10px] font-semibold px-2.5 py-1 rounded-lg bg-red-500/20 text-red-400 border border-red-500/30 backdrop-blur-sm",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-400"}),"Rupture"]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-slate-500 mb-1",children:a.marque||"Marque inconnue"}),e.jsx("h3",{className:"text-sm font-bold text-white leading-tight mb-1.5 line-clamp-2",children:a.modele||"Modele inconnu"}),e.jsx("p",{className:"text-xs text-slate-400 mb-3",children:[a.stockage,a.couleur].filter(Boolean).join(" · ")||" "}),e.jsx("p",{className:"text-xl font-extrabold text-amber-500 mb-2",children:a.prix_vente!=null?k(a.prix_vente):"Prix sur demande"}),a.prix_fournisseur!=null&&e.jsxs("p",{className:"text-xs text-slate-600 line-through mb-2",children:["Fournisseur : ",k(a.prix_fournisseur)]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[e.jsx(xe,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[11px]",children:"Garantie 12 mois"})]})]})]})});function ge({checked:o,onChange:a,label:i}){return e.jsxs("label",{className:"flex items-center gap-2.5 cursor-pointer select-none",children:[e.jsx("div",{onClick:()=>a(!o),className:`relative w-10 h-[22px] rounded-full transition-colors duration-200 ${o?"bg-amber-500":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-[2px] w-[18px] h-[18px] rounded-full bg-white shadow-sm transition-transform duration-200 ${o?"translate-x-[20px]":"translate-x-[2px]"}`})}),e.jsx("span",{className:"text-sm text-slate-400",children:i})]})}function Ne(){const{user:o}=se(),a=(o==null?void 0:o.role)==="admin",[i,d]=l.useState([]),[t,g]=l.useState(null),[N,X]=l.useState([]),[$,A]=l.useState(!0),[Z,q]=l.useState(!0),[w,B]=l.useState(!1),[h,R]=l.useState(""),[x,C]=l.useState(""),[b,M]=l.useState(""),[p,O]=l.useState(!0),[m,D]=l.useState("prix_asc"),[j,_]=l.useState(!1),[c,f]=l.useState(1),[u,G]=l.useState(1),[L,I]=l.useState(0),V=24,P=l.useCallback(async()=>{q(!0);try{const[s,r]=await Promise.all([v.getTelephoneStats(),v.getTelephoneMarques()]);g(s),X(r||[])}catch(s){console.error("Erreur chargement stats telephones:",s)}finally{q(!1)}},[]),E=l.useCallback(async(s=c)=>{A(!0);try{const r={page:s,limit:V};x&&(r.marque=x),h&&(r.type_produit=h),p&&(r.en_stock=!0),b.trim()&&(r.search=b.trim()),m&&(r.tri=m);const n=await v.getTelephonesCatalogue(r);if(n&&n.items)d(n.items),G(n.total_pages||1),I(n.total||0);else{const K=Array.isArray(n)?n:[];d(K),G(1),I(K.length)}}catch(r){console.error("Erreur chargement telephones:",r),d([])}finally{A(!1)}},[c,x,h,p,b,m]);l.useEffect(()=>{P()},[P]);const z=l.useRef({selectedBrand:x,typeProduit:h,enStockOnly:p,searchQuery:b,sortBy:m});l.useEffect(()=>{const s=z.current;s.selectedBrand!==x||s.typeProduit!==h||s.enStockOnly!==p||s.searchQuery!==b||s.sortBy!==m?(z.current={selectedBrand:x,typeProduit:h,enStockOnly:p,searchQuery:b,sortBy:m},f(1),E(1)):E(c)},[x,h,p,b,m,c]);async function W(){if(!w){B(!0);try{await v.syncTelephones();let s=0;for(;s<120;){await new Promise(r=>setTimeout(r,5e3)),s++;try{if(!(await v.getSyncStatus()).running)break}catch{break}}f(1),await Promise.all([P(),E(1)])}catch(s){console.error("Erreur sync telephones:",s)}finally{B(!1)}}}l.useEffect(()=>{if(!j)return;function s(){_(!1)}return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[j]);const[T,H]=l.useState("");l.useEffect(()=>{const s=setTimeout(()=>{M(T)},400);return()=>clearTimeout(s)},[T]);const Y=[{value:"",label:"Tous"},{value:"neuf",label:"Neufs"},{value:"occasion",label:"Occasion"}],ee=F.find(s=>s.value===m)||F[0];return e.jsxs("div",{className:"min-h-screen bg-slate-900 pb-12",children:[e.jsx("div",{className:"bg-slate-900 border-b border-slate-800",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tarifs Telephones"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Telephones neufs et reconditionnes — Garantie 12 mois"})]}),e.jsxs("div",{className:"flex flex-col items-end shrink-0",children:[a&&e.jsxs("button",{onClick:W,disabled:w,className:"flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-semibold text-white transition-all disabled:opacity-60 shadow-lg",style:{background:"linear-gradient(135deg, #F59E0B, #D97706)"},children:[w?e.jsx(te,{className:"w-4 h-4 animate-spin"}):e.jsx(Q,{className:"w-4 h-4"}),w?"Synchronisation...":"Synchroniser"]}),(t==null?void 0:t.derniere_sync)&&e.jsxs("p",{className:"text-[11px] text-slate-500 mt-1.5",children:["Derniere sync : ",ue(t.derniere_sync)]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mt-6",children:Z?e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx(y,{}),e.jsx(y,{}),e.jsx(y,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{icon:ae,value:(t==null?void 0:t.total)??0,label:"Total modeles",color:"#8B5CF6"}),e.jsx(S,{icon:re,value:(t==null?void 0:t.en_stock)??0,label:"En stock",color:"#10B981"}),e.jsx(S,{icon:le,value:(t==null?void 0:t.neufs)??0,label:"Neufs",color:"#3B82F6"}),e.jsx(S,{icon:Q,value:(t==null?void 0:t.reconditionnes)??0,label:"Reconditionnes",color:"#F97316"})]})}),e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 shrink-0",children:Y.map(s=>e.jsx("button",{onClick:()=>R(s.value),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${h===s.value?"bg-amber-500 text-white shadow-lg shadow-amber-500/20":"border border-slate-600 text-slate-400 hover:border-slate-500 hover:text-slate-300"}`,children:s.label},s.value))}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-none pb-1",children:[e.jsx("button",{onClick:()=>C(""),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-all ${x===""?"bg-amber-500 text-white":"border border-slate-600 text-slate-400 hover:border-slate-500 hover:text-slate-300"}`,children:"Toutes marques"}),N.map(s=>{const r=me[s.marque]||"#8B5CF6",n=x===s.marque;return e.jsxs("button",{onClick:()=>C(n?"":s.marque),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-all border ${n?"text-white shadow-lg":"border-slate-600 text-slate-400 hover:border-slate-500 hover:text-slate-300"}`,style:n?{backgroundColor:r,borderColor:r}:void 0,children:[s.marque,s.nb_en_stock!=null&&e.jsxs("span",{className:`ml-1.5 text-[10px] ${n?"opacity-75":"text-slate-500"}`,children:["(",s.nb_en_stock,")"]})]},s.marque)})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ne,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",placeholder:"Rechercher un telephone...",value:T,onChange:s=>H(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-slate-800/70 border border-slate-700/50 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/30 focus:border-amber-500/50 transition-all"})]}),e.jsx(ge,{checked:p,onChange:O,label:"En stock"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:s=>{s.stopPropagation(),_(!j)},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-slate-800/70 border border-slate-700/50 text-sm text-slate-300 hover:border-slate-600 transition-all whitespace-nowrap",children:[e.jsx(oe,{className:"w-4 h-4 text-slate-500"}),ee.label,e.jsx(ie,{className:`w-4 h-4 text-slate-500 transition-transform ${j?"rotate-180":""}`})]}),j&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-48 bg-slate-800 border border-slate-700 rounded-xl shadow-2xl shadow-black/40 z-30 overflow-hidden",children:F.map(s=>e.jsx("button",{onClick:r=>{r.stopPropagation(),D(s.value),_(!1)},className:`w-full text-left px-4 py-2.5 text-sm transition-colors ${m===s.value?"bg-amber-500/10 text-amber-400 font-medium":"text-slate-300 hover:bg-slate-700/50"}`,children:s.label},s.value))})]})]})]}),e.jsx("div",{className:"mt-8",children:$?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:8}).map((s,r)=>e.jsx(be,{},r))}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-24 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-slate-800/50 border border-slate-700/50 flex items-center justify-center mb-6",children:e.jsx(J,{className:"w-10 h-10 text-slate-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-300 mb-2",children:"Aucun telephone trouve"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-md",children:"Essayez de modifier vos filtres ou lancez une synchronisation pour importer les derniers telephones disponibles."}),e.jsx("button",{onClick:()=>{R(""),C(""),H(""),M(""),O(!0),D("prix_asc"),f(1)},className:"mt-6 px-5 py-2.5 rounded-xl border border-slate-600 text-sm text-slate-400 hover:border-slate-500 hover:text-slate-300 transition-all",children:"Reinitialiser les filtres"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:i.filter(s=>s.modele&&s.modele.trim()&&s.prix_vente&&s.prix_vente>0&&s.marque&&s.marque.trim()).map((s,r)=>e.jsx(pe,{phone:s},s.id||r))})}),!$&&i.length>0&&e.jsxs("div",{className:"mt-8 flex flex-col items-center gap-4",children:[u>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>f(s=>Math.max(1,s-1)),disabled:c===1,className:"p-2 rounded-lg bg-slate-800/70 border border-slate-700/50 text-slate-400 hover:text-white hover:border-slate-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx(de,{className:"w-4 h-4"})}),Array.from({length:Math.min(u,7)},(s,r)=>{let n;return u<=7||c<=4?n=r+1:c>=u-3?n=u-6+r:n=c-3+r,e.jsx("button",{onClick:()=>f(n),className:`w-9 h-9 rounded-lg text-sm font-medium transition-colors ${c===n?"bg-amber-500 text-white shadow-lg shadow-amber-500/20":"bg-slate-800/70 border border-slate-700/50 text-slate-400 hover:text-white hover:border-slate-600"}`,children:n},n)}),e.jsx("button",{onClick:()=>f(s=>Math.min(u,s+1)),disabled:c===u,className:"p-2 rounded-lg bg-slate-800/70 border border-slate-700/50 text-slate-400 hover:text-white hover:border-slate-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[L," telephone",L>1?"s":"",u>1?` · Page ${c}/${u}`:"",t!=null&&t.nb_marques?` · ${t.nb_marques} marques`:"",(t==null?void 0:t.prix_min)!=null&&(t==null?void 0:t.prix_max)!=null?` · ${k(t.prix_min)} → ${k(t.prix_max)}`:""]})]})]})]})}export{Ne as default};
