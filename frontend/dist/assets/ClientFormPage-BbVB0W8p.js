import{c as re,a as c,j as e}from"./index-5YFw6LH3.js";import{u as ie,d as ce,r as t}from"./vendor-react-DMwujlca.js";import{P as oe}from"./PatternGrid-aMzuwF_t.js";import{A as M,a2 as de,b as W,P as S,j as me,m as J,e as xe,a1 as H,q as ue,s as pe}from"./vendor-icons-DnXwj2oL.js";const he=["client","appareil","modele","panne","securite","confirmation"],be=["client","appareil","panne","confirmation"],K={client:"Client",appareil:"Appareil",modele:"Modèle",panne:"Panne",securite:"Sécurité",confirmation:"Confirmation"},je={...K,panne:"Commande"},ge=d=>/^(?:0|\+33\s?)[1-9](?:[\s.-]?\d{2}){4}$/.test(d.replace(/\s/g,"").length>=10?d:"")||/^\d{10,14}$/.test(d.replace(/[\s.-]/g,"")),fe=d=>!d||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d);function ye(){const d=ie(),[$]=ce(),Q=re(),[m,v]=t.useState(0),[z,I]=t.useState(!1),[j,O]=t.useState(null),[u,P]=t.useState({}),[N,q]=t.useState(null),[Y,A]=t.useState([]),[Z,k]=t.useState([]),[X,E]=t.useState([]),[ee,D]=t.useState([]),[s,p]=t.useState({nom:"",prenom:"",telephone:"",email:"",societe:"",categorie:"",marque:"",modele:"",modele_autre:"",panne:"",panne_detail:"",pin:"",pattern:"",notes_client:"",imei:""}),[x,T]=t.useState(!1),[h,V]=t.useState(""),[C,R]=t.useState(""),[w,F]=t.useState(""),[b,L]=t.useState(""),r=s.categorie==="Commande",g=r?be:he,U=r?je:K,o=g[m]||"client",f=m===g.length-2,y=o==="confirmation",B=()=>{p({nom:"",prenom:"",telephone:"",email:"",societe:"",categorie:"",marque:"",modele:"",modele_autre:"",panne:"",panne_detail:"",pin:"",pattern:"",notes_client:"",imei:""}),T(!1),V(""),R(""),F(""),L(""),O(null),v(0),P({}),q(null),A([]),k([]),E([]),D([]),c.getCategories().then(A).catch(()=>{}),c.getPannes().then(D).catch(()=>{})};t.useEffect(()=>{if(!y||!j)return;q(10);const a=setInterval(()=>{q(n=>n<=1?(clearInterval(a),B(),null):n-1)},1e3);return()=>clearInterval(a)},[y,j]),t.useEffect(()=>{c.getCategories().then(A).catch(()=>{}),c.getPannes().then(D).catch(()=>{});const a=$.get("client_id"),n=$.get("tel");a&&n&&(p(i=>({...i,telephone:n})),c.getClient(parseInt(a)).then(i=>{p(ne=>({...ne,nom:i.nom||"",prenom:i.prenom||"",telephone:i.telephone||n,email:i.email||"",societe:i.societe||""}))}).catch(()=>{}))},[]),t.useEffect(()=>{s.categorie&&(c.getMarques(s.categorie).then(k).catch(()=>k([])),p(a=>({...a,marque:"",modele:"",modele_autre:""})))},[s.categorie]),t.useEffect(()=>{s.categorie&&s.marque&&(c.getModeles(s.categorie,s.marque).then(E).catch(()=>E([])),p(a=>({...a,modele:"",modele_autre:""})))},[s.marque]);const l=(a,n)=>{p(i=>({...i,[a]:n})),P(i=>({...i,[a]:void 0}))},ae=()=>{const a={};return o==="client"&&(s.nom.trim()||(a.nom="Le nom est requis"),s.telephone.trim()?ge(s.telephone)||(a.telephone="Numéro invalide (10 chiffres min.)"):a.telephone="Le téléphone est requis",s.email&&!fe(s.email)&&(a.email="Email invalide")),o==="modele"&&(s.marque==="Autre"||s.modele==="Autre")&&!s.modele_autre.trim()&&(a.modele_autre="Veuillez préciser le modèle"),P(a),Object.keys(a).length===0},se=async()=>{I(!0);try{const a=await c.createOrGetClient({nom:s.nom,prenom:s.prenom,telephone:s.telephone,email:s.email,societe:s.societe}),n=await c.createTicket({client_id:a.id,categorie:s.categorie,marque:s.marque,modele:s.marque==="Autre"||s.modele==="Autre"?"":s.modele,modele_autre:s.marque==="Autre"||s.modele==="Autre"?s.modele_autre:"",panne:r||x&&h?"Pièce à commander":s.panne,panne_detail:r?s.panne_detail:x&&h?`${h}${C?" — "+C:""}`:s.panne_detail,pin:s.pin,pattern:s.pattern,notes_client:s.notes_client,commande_piece:r||x?1:0});r?await c.createPartAuto({ticket_id:n.id,description:s.panne_detail.trim(),fournisseur:w||"",prix:b?parseFloat(b):null,notes:s.notes_client||""}):x&&h&&await c.createPartAuto({ticket_id:n.id,description:h,fournisseur:w||"",prix:b?parseFloat(b):null,notes:C||""}),O(n.ticket_code),v(g.length-1)}catch(a){Q.error(a.message||"Erreur lors de la création du ticket")}finally{I(!1)}},te=()=>{switch(o){case"client":return s.nom&&s.telephone;case"appareil":return s.categorie;case"modele":return s.marque&&(s.marque!=="Autre"&&s.modele!=="Autre"||s.modele_autre.trim());case"panne":return r?s.panne_detail.trim():s.panne||x;case"securite":return!0;default:return!0}},le=()=>{ae()&&(f?se():v(a=>a+1))},G=()=>{m===0?d("/"):v(a=>a-1)},_=({field:a})=>u[a]?e.jsx("p",{className:"text-xs text-red-500 mt-1",children:u[a]}):null;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-brand-50/30",children:e.jsxs("div",{className:"depot-form w-[90%] lg:max-w-2xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("button",{onClick:G,className:"btn-ghost p-3",children:e.jsx(M,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-display font-bold text-slate-900",children:"Déposer un appareil"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["Étape ",m+1," sur ",g.length," — ",U[o]]})]})]}),e.jsx("div",{className:"flex gap-1.5 mb-8",children:g.map((a,n)=>e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`h-2.5 rounded-full transition-all duration-500 ${n<m?"bg-brand-500":n===m?"bg-brand-400":"bg-slate-200"}`}),e.jsx("p",{className:`text-xs font-semibold mt-1.5 text-center ${n<=m?"text-brand-600":"text-slate-400"}`,children:U[a]})]},a))}),o==="client"&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-sky-50 flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Vos coordonnées"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Informations de contact"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom *"}),e.jsx("input",{value:s.nom,onChange:a=>l("nom",a.target.value),className:`input ${u.nom?"border-red-300 focus:border-red-500 focus:ring-red-500/20":""}`,placeholder:"Dupont"}),e.jsx(_,{field:"nom"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prénom"}),e.jsx("input",{value:s.prenom,onChange:a=>l("prenom",a.target.value),className:"input",placeholder:"Jean"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Téléphone *"}),e.jsx("input",{type:"tel",value:s.telephone,onChange:a=>l("telephone",a.target.value),className:`input ${u.telephone?"border-red-300 focus:border-red-500 focus:ring-red-500/20":""}`,placeholder:"06 XX XX XX XX"}),e.jsx(_,{field:"telephone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email"}),e.jsx("input",{type:"email",value:s.email,onChange:a=>l("email",a.target.value),className:`input ${u.email?"border-red-300 focus:border-red-500 focus:ring-red-500/20":""}`,placeholder:"optionnel"}),e.jsx(_,{field:"email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Société"}),e.jsx("input",{value:s.societe,onChange:a=>l("societe",a.target.value),className:"input",placeholder:"optionnel"})]})]}),o==="appareil"&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-50 flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Type d'appareil"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Sélectionnez la catégorie"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Y.map(a=>e.jsx("button",{onClick:()=>l("categorie",a),className:`p-5 rounded-xl text-base font-semibold border-2 transition-all text-left
                    ${s.categorie===a?"border-brand-500 bg-brand-50 text-brand-700 shadow-sm shadow-brand-500/10":"border-slate-200 hover:border-slate-300 text-slate-700"}`,children:a},a))})]}),o==="modele"&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-brand-50 flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Marque & modèle"}),e.jsx("p",{className:"text-xs text-slate-400",children:s.categorie})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Marque *"}),e.jsxs("select",{value:s.marque,onChange:a=>l("marque",a.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Sélectionner..."}),Z.map(a=>e.jsx("option",{value:a,children:a},a)),e.jsx("option",{value:"Autre",children:"Autre"})]})]}),s.marque&&s.marque!=="Autre"&&X.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Modèle"}),e.jsxs("select",{value:s.modele,onChange:a=>l("modele",a.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Sélectionner..."}),X.map(a=>e.jsx("option",{value:a,children:a},a)),e.jsx("option",{value:"Autre",children:"Autre"})]})]}),(s.marque==="Autre"||s.modele==="Autre")&&e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Préciser marque / modèle *"}),e.jsx("input",{value:s.modele_autre,onChange:a=>l("modele_autre",a.target.value),className:`input ${u.modele_autre?"border-red-300 focus:border-red-500 focus:ring-red-500/20":""}`,placeholder:"Ex: Samsung Galaxy S24",autoFocus:!0}),e.jsx(_,{field:"modele_autre"})]})]}),o==="panne"&&e.jsxs("div",{className:"card p-6 space-y-4 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center",children:r?e.jsx(S,{className:"w-5 h-5 text-amber-600"}):e.jsx(me,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:r?"Détail commande":"Le problème"}),e.jsx("p",{className:"text-xs text-slate-400",children:r?"Décrivez la pièce à commander":"Décrivez la panne"})]})]}),r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-100 rounded-lg text-sm text-amber-700 flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 shrink-0"}),'La panne sera automatiquement définie comme "Pièce à commander"']}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Pièce à commander *"}),e.jsx("input",{value:s.panne_detail,onChange:a=>l("panne_detail",a.target.value),className:"input",placeholder:"Ex: Écran OLED iPhone 14 Pro, Nappe Face ID...",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Détails supplémentaires (référence, couleur, capacité...)"}),e.jsx("textarea",{value:s.notes_client,onChange:a=>l("notes_client",a.target.value),className:"input min-h-[80px] resize-none",placeholder:"Précisions sur la pièce, référence exacte, couleur, capacité..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Fournisseur"}),e.jsx("input",{value:w,onChange:a=>F(a.target.value),className:"input",placeholder:"Ex: Utopya, MobileParts..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prix estimé (€)"}),e.jsx("input",{type:"number",step:"0.01",value:b,onChange:a=>L(a.target.value),className:"input",placeholder:"0.00"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Type de panne *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:ee.map(a=>e.jsx("button",{onClick:()=>l("panne",a),className:`p-4 rounded-xl text-sm font-semibold border-2 transition-all text-left
                          ${s.panne===a?"border-brand-500 bg-brand-50 text-brand-700":"border-slate-200 hover:border-slate-300 text-slate-700"}`,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Détails supplémentaires"}),e.jsx("textarea",{value:s.panne_detail,onChange:a=>l("panne_detail",a.target.value),className:"input min-h-[80px] resize-none",placeholder:"Décrivez plus précisément le problème..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Notes"}),e.jsx("textarea",{value:s.notes_client,onChange:a=>l("notes_client",a.target.value),className:"input min-h-[60px] resize-none",placeholder:"Informations complémentaires (accessoires, état cosmétique...)"})]}),e.jsx("div",{className:"border-t border-slate-100 pt-4",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:a=>T(a.target.checked),className:"w-6 h-6 rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),e.jsx(S,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-base font-semibold text-amber-700",children:"Pièce à commander"})]})}),x&&e.jsxs("div",{className:"p-5 bg-amber-50 border border-amber-200 rounded-xl space-y-4 animate-in",children:[e.jsxs("div",{className:"text-sm font-bold text-amber-800 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"})," Détail de la commande"]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600 font-semibold",children:"Pièce à commander *"}),e.jsx("input",{value:h,onChange:a=>V(a.target.value),placeholder:"Ex: Écran OLED iPhone 14 Pro, Nappe Face ID...",className:"w-full px-5 py-4 rounded-xl border border-slate-200 text-base mt-1.5",style:{fontSize:"16px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600 font-semibold",children:"Détails / Commentaire"}),e.jsx("textarea",{value:C,onChange:a=>R(a.target.value),placeholder:"Précisions sur la pièce, référence, couleur, capacité...",rows:2,className:"w-full px-5 py-4 rounded-xl border border-slate-200 text-base mt-1.5 resize-none",style:{fontSize:"16px"}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600 font-semibold",children:"Fournisseur"}),e.jsx("input",{value:w,onChange:a=>F(a.target.value),placeholder:"Ex: Utopya, MobileParts...",className:"w-full px-5 py-4 rounded-xl border border-slate-200 text-base mt-1.5",style:{fontSize:"16px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600 font-semibold",children:"Prix estimé"}),e.jsx("input",{type:"number",value:b,onChange:a=>L(a.target.value),placeholder:"0.00",className:"w-full px-5 py-4 rounded-xl border border-slate-200 text-base mt-1.5",style:{fontSize:"16px"}})]})]})]})]})]}),o==="securite"&&e.jsxs("div",{className:"card p-6 space-y-5 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-50 flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Codes d'accès"}),e.jsx("p",{className:"text-xs text-slate-400",children:"Optionnel — nécessaire pour le diagnostic"})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-100 rounded-lg p-3 text-sm text-amber-700",children:"Ces informations sont confidentielles et nécessaires uniquement pour le diagnostic de votre appareil."}),e.jsxs("div",{children:[e.jsxs("label",{className:"input-label flex items-center gap-1.5",children:[e.jsx(J,{className:"w-3 h-3"})," Code PIN / Mot de passe"]}),e.jsx("input",{type:"text",value:s.pin,onChange:a=>l("pin",a.target.value),className:"input text-center text-lg font-mono tracking-widest",placeholder:"••••"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"input-label flex items-center gap-1.5",children:[e.jsx(xe,{className:"w-3 h-3"})," Schéma de déverrouillage"]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(oe,{value:s.pattern,onChange:a=>l("pattern",a),size:200})})]})]}),y&&j&&e.jsxs("div",{className:"card p-8 text-center animate-in",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-emerald-50 flex items-center justify-center mx-auto mb-6",children:e.jsx(H,{className:"w-10 h-10 text-emerald-500"})}),e.jsx("h2",{className:"text-2xl font-display font-bold text-slate-900 mb-2",children:"Merci pour votre confiance !"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Votre numéro de ticket :"}),e.jsx("div",{className:"bg-brand-50 rounded-xl py-4 px-6 mb-4 border border-brand-100",children:e.jsx("p",{className:"text-4xl font-bold font-mono text-brand-600 tracking-wider",children:j})}),e.jsxs("p",{className:"text-sm text-slate-400 mb-6",children:["Conservez ce code pour suivre l'avancement de votre ",r?"commande":"réparation","."]}),N!==null&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mb-2",children:e.jsx("div",{className:"bg-brand-500 h-1.5 rounded-full transition-all duration-1000",style:{width:`${N/10*100}%`}})}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Retour automatique dans ",N," seconde",N>1?"s":"","..."]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>d(`/suivi?ticket=${j}`),className:"btn-primary w-full",children:[e.jsx(ue,{className:"w-4 h-4"})," Suivre ma ",r?"commande":"réparation"]}),e.jsxs("button",{onClick:B,className:"btn-secondary w-full",children:[e.jsx(M,{className:"w-4 h-4"})," Nouveau dépôt"]})]})]}),!y&&e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs("button",{onClick:G,className:"btn-secondary flex-1 py-4 text-lg",children:[e.jsx(M,{className:"w-5 h-5"})," Retour"]}),e.jsxs("button",{onClick:le,disabled:z||!te(),className:`flex-[2] py-4 text-lg ${f?"btn-primary bg-emerald-600 hover:bg-emerald-700":"btn-primary"}`,children:[z?"Envoi...":f?"Confirmer le dépôt":"Suivant",!f&&e.jsx(pe,{className:"w-5 h-5"}),f&&e.jsx(H,{className:"w-5 h-5"})]})]})]})})}export{ye as default};
