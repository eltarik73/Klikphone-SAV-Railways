import{u as G,a as I,j as e,b as Q,f as N,c as i,i as g}from"./index-B6yYN6ZK.js";import{u as U,r as l}from"./vendor-react-DWtYaMjq.js";import{D as X,S as H,X as y,ae as J,P as _,a1 as f,y as O,a4 as v,ad as V,p as W,a7 as Y}from"./vendor-icons-Qb8swe_7.js";const S=["En attente","Commandée","Expédiée","Reçue","Annulée"];function se(){const E=U(),{user:u}=G(),P=(u==null?void 0:u.target)==="tech"?"/tech":"/accueil",[h,T]=l.useState(""),[d,R]=l.useState(""),[r,w]=l.useState(""),m=l.useRef(null),[A,p]=l.useState(!1),[x,C]=l.useState(null),[a,n]=l.useState({description:"",fournisseur:"",reference:"",prix:"",ticket_code:"",statut:"En attente",notes:""});l.useEffect(()=>(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>R(h),300),()=>clearTimeout(m.current)),[h]);const F=l.useMemo(()=>{const t=["commandes"];return d&&t.push(`s:${d}`),r&&t.push(`f:${r}`),t.join(":")},[d,r]),{data:D,loading:M}=I(F,async()=>{const t={};return d&&(t.search=d),r&&(t.statut=r),i.getParts(t)},{tags:["commandes"],ttl:6e4}),c=D??[],b=()=>{n({description:"",fournisseur:"",reference:"",prix:"",ticket_code:"",statut:"En attente",notes:""}),C(null),p(!1)},$=async()=>{try{const t={...a,prix:a.prix?parseFloat(a.prix):null};x?await i.updatePart(x.id,t):await i.createPart(t),b(),g("commandes")}catch(t){console.error(t)}},q=t=>{C(t),n({description:t.description||"",fournisseur:t.fournisseur||"",reference:t.reference||"",prix:t.prix||"",ticket_code:t.ticket_code||"",statut:t.statut||"En attente",notes:t.notes||""}),p(!0)},K=async t=>{if(confirm("Supprimer cette commande ?"))try{await i.deletePart(t),g("commandes")}catch(s){console.error(s)}},j=async(t,s)=>{try{await i.updatePart(t.id,{statut:s}),g("commandes")}catch(B){console.error(B)}},L=async t=>{try{const s=await i.getTicketByCode(t);s!=null&&s.id&&E(`${P}/ticket/${s.id}`)}catch{}},z=t=>{switch(t){case"En attente":return"bg-amber-50 text-amber-700 ring-amber-200/80";case"Commandée":return"bg-blue-50 text-blue-700 ring-blue-200/80";case"Expédiée":return"bg-purple-50 text-purple-700 ring-purple-200/80";case"Reçue":return"bg-emerald-50 text-emerald-700 ring-emerald-200/80";case"Annulée":return"bg-red-50 text-red-600 ring-red-200/80";default:return"bg-slate-100 text-slate-600 ring-slate-200/80"}},k=t=>{switch(t){case"En attente":return e.jsx(Y,{className:"w-3 h-3"});case"Commandée":return e.jsx(_,{className:"w-3 h-3"});case"Expédiée":return e.jsx(f,{className:"w-3 h-3"});case"Reçue":return e.jsx(v,{className:"w-3 h-3"});case"Annulée":return e.jsx(y,{className:"w-3 h-3"});default:return null}},o={total:c.length,attente:c.filter(t=>t.statut==="En attente").length,commandee:c.filter(t=>t.statut==="Commandée").length,recue:c.filter(t=>t.statut==="Reçue").length};return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight",children:"Commandes de pièces"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-0.5",children:[o.total," commande(s) — ",o.attente," en attente, ",o.commandee," commandée(s), ",o.recue," reçue(s)"]})]}),e.jsxs("button",{onClick:()=>{b(),p(!0)},className:"btn-primary",children:[e.jsx(X,{className:"w-4 h-4"})," Nouvelle commande"]})]}),e.jsxs("div",{className:"card overflow-hidden mb-6",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-slate-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par désignation, fournisseur, référence, ticket...",value:h,onChange:t=>T(t.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 bg-slate-50/50 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 focus:bg-white transition-all"})]})}),e.jsxs("div",{className:"px-3 sm:px-4 py-2 flex gap-1 overflow-x-auto scrollbar-none bg-slate-50/50",children:[e.jsxs("button",{onClick:()=>w(""),className:`px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap transition-all
              ${r?"text-slate-500 hover:bg-white hover:shadow-sm":"bg-brand-600 text-white shadow-sm"}`,children:["Toutes (",o.total,")"]}),S.map(t=>e.jsxs("button",{onClick:()=>w(t),className:`px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap transition-all flex items-center gap-1
                ${r===t?"bg-brand-600 text-white shadow-sm":"text-slate-500 hover:bg-white hover:shadow-sm"}`,children:[k(t)," ",t]},t))]})]}),A&&e.jsxs("div",{className:"card p-5 mb-6 border-brand-200 animate-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:x?"Modifier la commande":"Nouvelle commande"}),e.jsx("button",{onClick:b,className:"btn-ghost p-1.5",children:e.jsx(y,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("label",{className:"input-label",children:"Désignation *"}),e.jsx("input",{value:a.description,onChange:t=>n(s=>({...s,description:t.target.value})),className:"input",placeholder:"Écran iPhone 15..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Fournisseur"}),e.jsx("input",{value:a.fournisseur,onChange:t=>n(s=>({...s,fournisseur:t.target.value})),className:"input",placeholder:"Nom fournisseur"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Référence"}),e.jsx("input",{value:a.reference,onChange:t=>n(s=>({...s,reference:t.target.value})),className:"input font-mono",placeholder:"REF-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prix (€)"}),e.jsx("input",{type:"number",step:"0.01",value:a.prix,onChange:t=>n(s=>({...s,prix:t.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Ticket associé"}),e.jsx("input",{value:a.ticket_code,onChange:t=>n(s=>({...s,ticket_code:t.target.value})),className:"input font-mono",placeholder:"KP-000001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Statut"}),e.jsx("select",{value:a.statut,onChange:t=>n(s=>({...s,statut:t.target.value})),className:"input",children:S.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-3",children:[e.jsx("label",{className:"input-label",children:"Notes"}),e.jsx("input",{value:a.notes,onChange:t=>n(s=>({...s,notes:t.target.value})),className:"input",placeholder:"Notes..."})]})]}),e.jsx("div",{className:"flex justify-end mt-4 pt-3 border-t border-slate-100",children:e.jsxs("button",{onClick:$,disabled:!a.description,className:"btn-primary",children:[e.jsx(J,{className:"w-4 h-4"})," ",x?"Mettre à jour":"Créer"]})})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"hidden lg:grid grid-cols-[1fr_130px_140px_120px_90px_120px_100px_80px] gap-3 items-center px-5 py-3 bg-slate-50/80 border-b border-slate-100",children:[e.jsx("span",{className:"table-header",children:"Désignation"}),e.jsx("span",{className:"table-header",children:"Client"}),e.jsx("span",{className:"table-header",children:"Fournisseur"}),e.jsx("span",{className:"table-header",children:"Référence"}),e.jsx("span",{className:"table-header",children:"Prix"}),e.jsx("span",{className:"table-header",children:"Dates"}),e.jsx("span",{className:"table-header",children:"Statut"}),e.jsx("span",{className:"table-header text-right",children:"Actions"})]}),M?e.jsxs("div",{className:"py-16 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Chargement..."})]}):c.length===0?e.jsxs("div",{className:"py-16 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(_,{className:"w-7 h-7 text-slate-300"})}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Aucune commande"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Créez votre première commande de pièce"})]}):e.jsx("div",{className:"divide-y divide-slate-100/80",children:c.map(t=>e.jsxs("div",{className:"lg:grid lg:grid-cols-[1fr_130px_140px_120px_90px_120px_100px_80px] gap-3 items-center px-4 sm:px-5 py-3.5 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:t.description}),t.ticket_code&&e.jsxs("button",{onClick:()=>L(t.ticket_code),className:"text-xs text-brand-600 font-mono hover:text-brand-800 hover:underline flex items-center gap-1",children:[t.ticket_code," ",e.jsx(f,{className:"w-2.5 h-2.5"})]}),t.notes&&e.jsx("p",{className:"text-xs text-slate-400 mt-0.5 truncate",children:t.notes})]}),e.jsxs("div",{className:"hidden lg:block",children:[e.jsxs("p",{className:"text-sm text-slate-700 truncate",children:[t.client_prenom||""," ",t.client_nom||""]}),t.client_tel&&e.jsx("p",{className:"text-[11px] text-slate-400 font-mono",children:t.client_tel})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("p",{className:"text-sm text-slate-600",children:t.fournisseur||"—"})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("p",{className:"text-xs text-slate-500 font-mono",children:t.reference||"—"})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("p",{className:"text-sm font-medium text-slate-800",children:t.prix?Q(t.prix):"—"})}),e.jsxs("div",{className:"hidden lg:block",children:[e.jsxs("p",{className:"text-[11px] text-slate-500",children:[e.jsx(O,{className:"w-3 h-3 inline mr-0.5"}),t.date_creation?N(t.date_creation):"—"]}),t.date_commande&&e.jsxs("p",{className:"text-[10px] text-blue-500",children:["Cmd: ",N(t.date_commande)]}),t.date_reception&&e.jsxs("p",{className:"text-[10px] text-emerald-500",children:["Reçue: ",N(t.date_reception)]})]}),e.jsx("div",{className:"mt-2 lg:mt-0",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ring-1 ${z(t.statut)}`,children:[k(t.statut)," ",t.statut]})}),e.jsxs("div",{className:"hidden lg:flex justify-end gap-1",children:[t.statut==="En attente"&&e.jsx("button",{onClick:()=>j(t,"Commandée"),className:"btn-ghost p-1.5",title:"Marquer commandée",children:e.jsx(v,{className:"w-3.5 h-3.5 text-blue-500"})}),t.statut==="Commandée"&&e.jsx("button",{onClick:()=>j(t,"Expédiée"),className:"btn-ghost p-1.5",title:"Marquer expédiée",children:e.jsx(f,{className:"w-3.5 h-3.5 text-purple-500"})}),(t.statut==="Commandée"||t.statut==="Expédiée")&&e.jsx("button",{onClick:()=>j(t,"Reçue"),className:"btn-ghost p-1.5",title:"Marquer reçue",children:e.jsx(v,{className:"w-3.5 h-3.5 text-emerald-500"})}),e.jsx("button",{onClick:()=>q(t),className:"btn-ghost p-1.5",title:"Modifier",children:e.jsx(V,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>K(t.id),className:"btn-ghost p-1.5",title:"Supprimer",children:e.jsx(W,{className:"w-3.5 h-3.5 text-red-400"})})]})]},t.id))})]})]})}export{se as default};
