import{u as ae,j as e,c}from"./index-jhMOtRsP.js";import{r as t}from"./vendor-react-DWtYaMjq.js";import{Z as te,aT as le,aU as ne,W as T,c as m,S as O,q as S,P as V,T as ce,aV as re,D as ie,a as oe,E as de,ae as xe,p as me,X as ue}from"./vendor-icons-DUhoIZbQ.js";const g=f=>f==null?"0,00":Number(f).toFixed(2).replace(".",","),v={Apple:"#18181b",Samsung:"#2563eb",Xiaomi:"#ea580c",Huawei:"#dc2626",Honor:"#6d28d9",Google:"#16a34a",Oppo:"#059669",OnePlus:"#dc2626",Motorola:"#0891b2",Nothing:"#18181b"};function Ne(){const{user:f}=ae(),[r,q]=t.useState("reparations"),[i,L]=t.useState(!1),[o,I]=t.useState(""),[C,w]=t.useState([]),[_,E]=t.useState(!1),y=t.useRef(null),[M,z]=t.useState([]),[$,R]=t.useState(!1),[u,D]=t.useState(""),[h,Q]=t.useState(""),[p,G]=t.useState(""),[H,K]=t.useState([]),[d,W]=t.useState(null),[X,x]=t.useState(!1),[j,k]=t.useState(null),[l,n]=t.useState(P()),[F,A]=t.useState(!1);function P(){return{marque:"",modele:"",capacite:"",couleur:"",etat:"Occasion",prix_achat:0,prix_vente:0,imei:"",notes:""}}const Z=async s=>{if(!s||s.length<2){w([]);return}E(!0);try{const a=await c.devisFlashSearch(s);w(a||[])}catch{w([])}E(!1)};t.useEffect(()=>(clearTimeout(y.current),y.current=setTimeout(()=>Z(o),300),()=>clearTimeout(y.current)),[o]);const N=async()=>{R(!0);try{const s={};u&&(s.search=u),h&&(s.marque=h),p&&(s.etat=p);const[a,b,se]=await Promise.all([c.getTelephonesVente(s),c.getTelephonesVenteStats(),c.getTelephonesVenteMarques()]);z(a||[]),W(b),K(se||[])}catch{}R(!1)};t.useEffect(()=>{r==="telephones"&&N()},[r,u,h,p]);const B=async()=>{if(!(!l.marque||!l.modele)){A(!0);try{j?await c.updateTelephoneVente(j,l):await c.createTelephoneVente(l),x(!1),k(null),N()}catch{}A(!1)}},U=async s=>{if(confirm("Supprimer ce téléphone ?"))try{await c.deleteTelephoneVente(s),N()}catch{}},J=async(s,a)=>{try{await c.updateTelephoneVente(s,{en_stock:!a}),N()}catch{}},Y=s=>{k(s.id),n({marque:s.marque||"",modele:s.modele||"",capacite:s.capacite||"",couleur:s.couleur||"",etat:s.etat||"Occasion",prix_achat:Number(s.prix_achat)||0,prix_vente:Number(s.prix_vente)||0,imei:s.imei||"",notes:s.notes||""}),x(!0)},ee=()=>{var s,a,b;i?(b=document.exitFullscreen)==null||b.call(document):(a=(s=document.documentElement).requestFullscreen)==null||a.call(s),L(!i)};return e.jsxs("div",{className:`${i?"fixed inset-0 z-[100] bg-white overflow-auto":""} p-4 sm:p-6 lg:p-8 max-w-7xl`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight flex items-center gap-2",children:[e.jsx(te,{className:"w-6 h-6 text-amber-500"})," Devis Flash"]}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:"Consultation rapide des prix"})]}),e.jsxs("button",{onClick:ee,className:"btn-secondary text-xs",children:[i?e.jsx(le,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"}),i?"Quitter kiosque":"Mode kiosque"]})]}),e.jsxs("div",{className:"flex gap-1 mb-6",children:[e.jsxs("button",{onClick:()=>q("reparations"),className:`flex items-center gap-1.5 px-4 py-2.5 rounded-lg text-sm font-medium transition-all
            ${r==="reparations"?"bg-amber-500 text-white shadow-sm":"text-slate-500 hover:bg-slate-100"}`,children:[e.jsx(T,{className:"w-4 h-4"})," Réparations"]}),e.jsxs("button",{onClick:()=>q("telephones"),className:`flex items-center gap-1.5 px-4 py-2.5 rounded-lg text-sm font-medium transition-all
            ${r==="telephones"?"bg-amber-500 text-white shadow-sm":"text-slate-500 hover:bg-slate-100"}`,children:[e.jsx(m,{className:"w-4 h-4"})," Téléphones en vente"]})]}),r==="reparations"&&e.jsxs("div",{children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(O,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{value:o,onChange:s=>I(s.target.value),placeholder:"Rechercher un modèle, une marque, un type de pièce...",className:"w-full h-14 pl-12 pr-4 rounded-2xl border-2 border-slate-200 focus:border-amber-400 focus:ring-4 focus:ring-amber-100 text-lg outline-none transition-all",autoFocus:!0}),_&&e.jsx(S,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 animate-spin text-amber-500"})]}),o.length<2?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(T,{className:"w-16 h-16 text-slate-200 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 text-lg",children:"Tapez au moins 2 caractères pour rechercher"}),e.jsx("p",{className:"text-sm text-slate-300 mt-1",children:"Recherchez par modèle (iPhone 15), marque (Samsung) ou pièce (écran, batterie...)"})]}):C.length===0&&!_?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(V,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsxs("p",{className:"text-slate-500",children:['Aucun résultat pour "',o,'"']})]}):e.jsx("div",{className:"grid gap-2",children:C.map(s=>e.jsx("div",{className:"card p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shrink-0",style:{background:(v[s.marque]||"#6d28d9")+"15"},children:e.jsx(T,{className:"w-5 h-5",style:{color:v[s.marque]||"#6d28d9"}})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"font-semibold text-sm text-slate-900",children:[s.marque," ",s.modele]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"text-xs text-slate-500",children:s.type_piece}),s.qualite&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-slate-100 text-slate-500",children:s.qualite}),s.fournisseur&&e.jsx("span",{className:"text-[10px] text-slate-400",children:s.fournisseur})]})]})]}),e.jsxs("div",{className:"text-right shrink-0 ml-4",children:[e.jsxs("p",{className:"text-lg font-bold text-brand-600",children:[g(s.prix_client)," €"]}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full font-medium ${s.en_stock?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-600"}`,children:s.en_stock?"En stock":"Sur commande"})]})]})},s.id))})]}),r==="telephones"&&e.jsxs("div",{children:[d&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Total"})]}),e.jsx("p",{className:"text-xl font-bold",children:d.total||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-4 h-4 text-emerald-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"En stock"})]}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:d.en_stock||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Marques"})]}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:d.nb_marques||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(re,{className:"w-4 h-4 text-brand-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Valeur stock"})]}),e.jsxs("p",{className:"text-xl font-bold text-brand-600",children:[g(d.valeur_stock)," €"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{value:u,onChange:s=>D(s.target.value),placeholder:"Rechercher un téléphone...",className:"input pl-9"})]}),e.jsxs("select",{value:h,onChange:s=>Q(s.target.value),className:"input w-auto min-w-[120px]",children:[e.jsx("option",{value:"",children:"Toutes marques"}),H.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:p,onChange:s=>G(s.target.value),className:"input w-auto min-w-[120px]",children:[e.jsx("option",{value:"",children:"Tous états"}),e.jsx("option",{value:"Neuf",children:"Neuf"}),e.jsx("option",{value:"Occasion",children:"Occasion"}),e.jsx("option",{value:"Reconditionné",children:"Reconditionné"})]}),e.jsxs("button",{onClick:()=>{k(null),n(P()),x(!0)},className:"btn-primary shrink-0",children:[e.jsx(ie,{className:"w-4 h-4"})," Ajouter"]})]}),$?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{className:"w-6 h-6 animate-spin text-amber-500"})}):M.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(m,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500",children:"Aucun téléphone en vente"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Ajoutez des téléphones à votre catalogue"})]}):e.jsx("div",{className:"grid gap-2",children:M.map(s=>e.jsx("div",{className:"card p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shrink-0",style:{background:(v[s.marque]||"#6d28d9")+"15"},children:e.jsx(m,{className:"w-5 h-5",style:{color:v[s.marque]||"#6d28d9"}})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"font-semibold text-sm text-slate-900",children:[s.marque," ",s.modele]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[s.capacite&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-slate-100 text-slate-500",children:s.capacite}),s.couleur&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-slate-100 text-slate-500",children:s.couleur}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded font-medium ${s.etat==="Neuf"?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:s.etat}),s.imei&&e.jsxs("span",{className:"text-[10px] text-slate-400",children:["IMEI: ",s.imei]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0 ml-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-brand-600",children:[g(s.prix_vente)," €"]}),Number(s.prix_achat)>0&&e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Achat: ",g(s.prix_achat)," €"]})]}),e.jsx("button",{onClick:()=>J(s.id,s.en_stock),className:`p-1.5 rounded-lg ${s.en_stock?"text-emerald-500 hover:bg-emerald-50":"text-red-400 hover:bg-red-50"}`,title:s.en_stock?"En stock":"Vendu",children:s.en_stock?e.jsx(oe,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Y(s),className:"p-1.5 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(s.id),className:"p-1.5 rounded-lg hover:bg-red-50 text-slate-400 hover:text-red-500",children:e.jsx(me,{className:"w-4 h-4"})})]})]})},s.id))}),X&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-100",children:[e.jsx("h2",{className:"text-lg font-display font-bold text-slate-900",children:j?"Modifier":"Ajouter un téléphone"}),e.jsx("button",{onClick:()=>x(!1),className:"p-2 rounded-lg hover:bg-slate-100",children:e.jsx(ue,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Marque *"}),e.jsx("input",{value:l.marque,onChange:s=>n(a=>({...a,marque:s.target.value})),className:"input",placeholder:"Apple"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Modèle *"}),e.jsx("input",{value:l.modele,onChange:s=>n(a=>({...a,modele:s.target.value})),className:"input",placeholder:"iPhone 15 Pro"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Capacité"}),e.jsx("input",{value:l.capacite,onChange:s=>n(a=>({...a,capacite:s.target.value})),className:"input",placeholder:"256 Go"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Couleur"}),e.jsx("input",{value:l.couleur,onChange:s=>n(a=>({...a,couleur:s.target.value})),className:"input",placeholder:"Noir"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"État"}),e.jsxs("select",{value:l.etat,onChange:s=>n(a=>({...a,etat:s.target.value})),className:"input",children:[e.jsx("option",{children:"Neuf"}),e.jsx("option",{children:"Occasion"}),e.jsx("option",{children:"Reconditionné"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"IMEI"}),e.jsx("input",{value:l.imei,onChange:s=>n(a=>({...a,imei:s.target.value})),className:"input",placeholder:"IMEI"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prix achat (€)"}),e.jsx("input",{type:"number",value:l.prix_achat,onChange:s=>n(a=>({...a,prix_achat:parseFloat(s.target.value)||0})),className:"input",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prix vente (€)"}),e.jsx("input",{type:"number",value:l.prix_vente,onChange:s=>n(a=>({...a,prix_vente:parseFloat(s.target.value)||0})),className:"input",step:"0.01"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Notes"}),e.jsx("textarea",{value:l.notes,onChange:s=>n(a=>({...a,notes:s.target.value})),className:"input min-h-[60px]",placeholder:"Notes..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 px-6 py-4 border-t border-slate-100",children:[e.jsx("button",{onClick:()=>x(!1),className:"btn-secondary",children:"Annuler"}),e.jsxs("button",{onClick:B,disabled:F||!l.marque||!l.modele,className:"btn-primary",children:[F?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(m,{className:"w-4 h-4"}),j?"Enregistrer":"Ajouter"]})]})]})})]})]})}export{Ne as default};
