import{u as B,a as f,j as e,c,i as v}from"./index-C8sCjayU.js";import{r as l}from"./vendor-react-DWtYaMjq.js";import{c as w,G as E,P as J,T as V,aY as W,S as ee,aZ as se,X as te,r as X,ag as ae,a_ as le,H as re,a$ as ce,b0 as ne,af as ie,q as oe}from"./vendor-icons-DOkFSV4b.js";const F=["Occasion","Neuf","Reconditionné"],A=["Apple","Samsung","Xiaomi","Huawei","Google","Honor","Oppo","OnePlus","Motorola","Nothing","Realme","Sony"],M={Occasion:{bg:"#fef3c7",text:"#92400e",border:"#fcd34d"},Neuf:{bg:"#dbeafe",text:"#1e40af",border:"#93c5fd"},Reconditionné:{bg:"#ede9fe",text:"#6d28d9",border:"#c4b5fd"}},y=p=>p==null||p===0?"—":Number(p).toFixed(2).replace(".",",")+" €";function ue(){const{user:p}=B(),[b,R]=l.useState(""),[x,P]=l.useState(""),[n,O]=l.useState(""),[i,$]=l.useState(""),[o,D]=l.useState(""),N=l.useRef(null),[H,h]=l.useState(!1),[j,k]=l.useState(null),[_,S]=l.useState(!1),[m,d]=l.useState(null),[a,r]=l.useState(T());function T(){return{marque:"",modele:"",capacite:"",couleur:"",etat:"Occasion",prix_achat:"",prix_vente:"",imei:"",notes:""}}l.useEffect(()=>(clearTimeout(N.current),N.current=setTimeout(()=>P(b),300),()=>clearTimeout(N.current)),[b]),l.useEffect(()=>{if(!m)return;const s=setTimeout(()=>d(null),3e3);return()=>clearTimeout(s)},[m]);const I=l.useMemo(()=>{const s=["telVente"];return x&&s.push(`s:${x}`),n&&s.push(`m:${n}`),i&&s.push(`e:${i}`),o&&s.push(`st:${o}`),s.join(":")},[x,n,i,o]),{data:L,loading:G}=f(I,async()=>{const s={limit:200};return x&&(s.search=x),n&&(s.marque=n),i&&(s.etat=i),o==="oui"?s.en_stock=!0:o==="non"&&(s.en_stock=!1),c.getTelephonesVente(s)},{tags:["telVente"],ttl:6e4}),C=L??[],{data:z}=f("telVente:stats",()=>c.getTelephonesVenteStats(),{tags:["telVente"],ttl:6e4}),u=z??{},{data:U}=f("telVente:marques",()=>c.getTelephonesVenteMarques(),{tags:["telVente"],ttl:6e4}),q=U??[],g=()=>{r(T()),k(null),h(!1)},K=async()=>{if(!(!a.marque.trim()||!a.modele.trim())){S(!0);try{const s={...a,prix_achat:a.prix_achat?parseFloat(a.prix_achat):null,prix_vente:a.prix_vente?parseFloat(a.prix_vente):null};j?(await c.updateTelephoneVente(j.id,s),d({type:"success",msg:"Téléphone mis à jour"})):(await c.createTelephoneVente(s),d({type:"success",msg:"Téléphone ajouté au stock"})),g(),v("telVente")}catch(s){console.error(s),d({type:"error",msg:"Erreur sauvegarde"})}S(!1)}},Q=s=>{k(s),r({marque:s.marque||"",modele:s.modele||"",capacite:s.capacite||"",couleur:s.couleur||"",etat:s.etat||"Occasion",prix_achat:s.prix_achat||"",prix_vente:s.prix_vente||"",imei:s.imei||"",notes:s.notes||""}),h(!0)},Y=async s=>{if(confirm("Supprimer ce téléphone du stock ?"))try{await c.deleteTelephoneVente(s),v("telVente"),d({type:"success",msg:"Téléphone supprimé"})}catch(t){console.error(t)}},Z=async s=>{try{await c.updateTelephoneVente(s.id,{en_stock:!s.en_stock}),v("telVente"),d({type:"success",msg:s.en_stock?"Retiré du stock":"Remis en stock"})}catch(t){console.error(t)}};return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[m&&e.jsx("div",{className:`fixed top-4 right-4 z-[100] px-4 py-2.5 rounded-xl shadow-lg text-sm font-medium animate-in
          ${m.type==="success"?"bg-emerald-600 text-white":"bg-red-600 text-white"}`,children:m.msg}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-brand-600"})," Téléphones en vente"]}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:"Votre stock de téléphones à vendre en boutique"})]}),e.jsxs("button",{onClick:()=>{g(),h(!0)},className:"btn-primary",children:[e.jsx(E,{className:"w-4 h-4"})," Ajouter un téléphone"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 mb-6",children:[e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Total"})]}),e.jsx("p",{className:"text-xl font-bold text-slate-900",children:u.total||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(J,{className:"w-4 h-4 text-emerald-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"En stock"})]}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:u.en_stock||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Neufs"})]}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:u.neufs||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Occasions"})]}),e.jsx("p",{className:"text-xl font-bold text-amber-600",children:u.occasions||0})]}),e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(W,{className:"w-4 h-4 text-brand-500"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Valeur stock"})]}),e.jsx("p",{className:"text-xl font-bold text-brand-600",children:y(u.valeur_stock)})]})]}),e.jsxs("div",{className:"card overflow-hidden mb-6",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-slate-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par marque, modèle, IMEI...",value:b,onChange:s=>R(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 bg-slate-50/50 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 focus:bg-white transition-all"})]})}),e.jsxs("div",{className:"px-3 sm:px-4 py-2 flex items-center gap-2 overflow-x-auto scrollbar-none bg-slate-50/50",children:[e.jsx(se,{className:"w-3.5 h-3.5 text-slate-400 shrink-0"}),e.jsxs("select",{value:n,onChange:s=>O(s.target.value),className:"text-xs border border-slate-200 rounded-md px-2 py-1.5 bg-white text-slate-600 min-w-[100px]",children:[e.jsx("option",{value:"",children:"Toutes marques"}),(q.length>0?q:A).map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:i,onChange:s=>$(s.target.value),className:"text-xs border border-slate-200 rounded-md px-2 py-1.5 bg-white text-slate-600",children:[e.jsx("option",{value:"",children:"Tous états"}),F.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:o,onChange:s=>D(s.target.value),className:"text-xs border border-slate-200 rounded-md px-2 py-1.5 bg-white text-slate-600",children:[e.jsx("option",{value:"",children:"Stock: tous"}),e.jsx("option",{value:"oui",children:"En stock"}),e.jsx("option",{value:"non",children:"Hors stock"})]})]})]}),H&&e.jsxs("div",{className:"card p-5 mb-6 border-brand-200 animate-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:j?"Modifier le téléphone":"Ajouter un téléphone"}),e.jsx("button",{onClick:g,className:"btn-ghost p-1.5",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Marque *"}),e.jsxs("select",{value:a.marque,onChange:s=>r(t=>({...t,marque:s.target.value})),className:"input",children:[e.jsx("option",{value:"",children:"Choisir..."}),A.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"__other",children:"Autre"})]}),a.marque==="__other"&&e.jsx("input",{value:"",onChange:s=>r(t=>({...t,marque:s.target.value})),className:"input mt-1",placeholder:"Marque personnalisée",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Modèle *"}),e.jsx("input",{value:a.modele,onChange:s=>r(t=>({...t,modele:s.target.value})),className:"input",placeholder:"iPhone 15 Pro Max"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Capacité"}),e.jsx("input",{value:a.capacite,onChange:s=>r(t=>({...t,capacite:s.target.value})),className:"input",placeholder:"256 Go"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Couleur"}),e.jsx("input",{value:a.couleur,onChange:s=>r(t=>({...t,couleur:s.target.value})),className:"input",placeholder:"Noir"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"État"}),e.jsx("select",{value:a.etat,onChange:s=>r(t=>({...t,etat:s.target.value})),className:"input",children:F.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prix d'achat (€)"}),e.jsx("input",{type:"number",step:"0.01",value:a.prix_achat,onChange:s=>r(t=>({...t,prix_achat:s.target.value})),className:"input",placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prix de vente (€)"}),e.jsx("input",{type:"number",step:"0.01",value:a.prix_vente,onChange:s=>r(t=>({...t,prix_vente:s.target.value})),className:"input",placeholder:"0,00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"IMEI"}),e.jsx("input",{value:a.imei,onChange:s=>r(t=>({...t,imei:s.target.value})),className:"input font-mono",placeholder:"35XXXXXXXXXXXXXXX"})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-4",children:[e.jsx("label",{className:"input-label",children:"Notes"}),e.jsx("input",{value:a.notes,onChange:s=>r(t=>({...t,notes:s.target.value})),className:"input",placeholder:"Rayure coin droit, accessoires inclus..."})]})]}),e.jsx("div",{className:"flex justify-end mt-4 pt-3 border-t border-slate-100",children:e.jsxs("button",{onClick:K,disabled:_||!a.marque.trim()||!a.modele.trim(),className:"btn-primary",children:[_?e.jsx(X,{className:"w-4 h-4 animate-spin"}):e.jsx(ae,{className:"w-4 h-4"}),j?"Mettre à jour":"Ajouter au stock"]})})]}),G?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx(X,{className:"w-6 h-6 animate-spin text-brand-600"})}):C.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(w,{className:"w-7 h-7 text-slate-300"})}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Aucun téléphone en stock"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Ajoutez votre premier téléphone à vendre"}),e.jsxs("button",{onClick:()=>{g(),h(!0)},className:"btn-primary mt-4 mx-auto",children:[e.jsx(E,{className:"w-4 h-4"})," Ajouter un téléphone"]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:C.map(s=>{const t=M[s.etat]||M.Occasion;return e.jsxs("div",{className:`card overflow-hidden transition-all hover:shadow-md ${s.en_stock?"":"opacity-60"}`,children:[e.jsxs("div",{className:"p-4 pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-slate-400 mb-0.5",children:s.marque}),e.jsx("h3",{className:"text-sm font-bold text-slate-900 leading-tight truncate",children:s.modele})]}),e.jsx("span",{className:"text-[10px] font-semibold px-2 py-0.5 rounded-full shrink-0",style:{background:t.bg,color:t.text,border:`1px solid ${t.border}`},children:s.etat})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-2",children:[s.capacite&&e.jsx("span",{className:"text-[11px] text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded",children:s.capacite}),s.couleur&&e.jsxs("span",{className:"text-[11px] text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded flex items-center gap-1",children:[e.jsx(le,{className:"w-2.5 h-2.5"})," ",s.couleur]}),s.imei&&e.jsxs("span",{className:"text-[11px] text-slate-400 bg-slate-50 px-1.5 py-0.5 rounded font-mono flex items-center gap-1",children:[e.jsx(re,{className:"w-2.5 h-2.5"})," ",s.imei.slice(-6)]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-slate-50 border-t border-slate-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-brand-600",children:y(s.prix_vente)}),s.prix_achat>0&&e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Achat: ",y(s.prix_achat),s.prix_vente>0&&s.prix_achat>0&&e.jsxs("span",{className:"text-emerald-600 font-semibold ml-1",children:["+",((s.prix_vente-s.prix_achat)/s.prix_achat*100).toFixed(0),"%"]})]})]}),e.jsx("button",{onClick:()=>Z(s),className:"flex items-center gap-1.5 text-xs font-medium",title:s.en_stock?"Retirer du stock":"Remettre en stock",children:s.en_stock?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-5 h-5 text-emerald-500"}),e.jsx("span",{className:"text-emerald-600",children:"En stock"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-slate-400",children:"Vendu"})]})})]})}),e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between border-t border-slate-100",children:[e.jsx("p",{className:"text-[11px] text-slate-400 truncate flex-1 mr-2",children:s.notes||""}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{onClick:()=>Q(s),className:"btn-ghost p-1.5",title:"Modifier",children:e.jsx(ie,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>Y(s.id),className:"btn-ghost p-1.5",title:"Supprimer",children:e.jsx(oe,{className:"w-3.5 h-3.5 text-red-400"})})]})]})]},s.id)})})]})}export{ue as default};
