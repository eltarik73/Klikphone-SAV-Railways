import{u as Q,a as g,j as e}from"./index-CZyiutDh.js";import{u as V,r as l}from"./vendor-react-DMwujlca.js";import{a as W,U as I,J as k,K as Y,a4 as Z,X as ee,a5 as se,v as te,G as ae,z as le,b as ne,o as re,ab as ie,ac as ce,ad as oe}from"./vendor-icons-DnXwj2oL.js";function he(){var A,D;const _=V(),{user:b}=Q(),L=(b==null?void 0:b.target)==="tech"?"/tech":"/accueil",[N,R]=l.useState([]),[T,$]=l.useState(!0),[f,q]=l.useState(""),[v,G]=l.useState(""),[a,m]=l.useState(null),[w,P]=l.useState([]),[E,h]=l.useState(!1),[r,i]=l.useState({}),[c,p]=l.useState(0),[d,H]=l.useState(()=>parseInt(localStorage.getItem("kp_clients_page_size")||"50")),[U,J]=l.useState(!0),[o,K]=l.useState("date_creation"),[C,M]=l.useState("desc"),u=l.useRef(null);l.useEffect(()=>(u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{G(f),p(0)},300),()=>clearTimeout(u.current)),[f]);const j=l.useCallback(async()=>{$(!0);try{const s={limit:d,offset:c*d};v&&(s.search=v);const t=await g.getClients(s);R(t),J(t.length===d)}catch(s){console.error(s)}finally{$(!1)}},[v,c,d]);l.useEffect(()=>{j()},[j]);const z=l.useMemo(()=>[...N].sort((s,t)=>{let n=s[o],x=t[o];o==="nom"&&(n=`${s.nom||""} ${s.prenom||""}`.toLowerCase(),x=`${t.nom||""} ${t.prenom||""}`.toLowerCase()),n==null&&(n=""),x==null&&(x="");const F=n<x?-1:n>x?1:0;return C==="asc"?F:-F}),[N,o,C]),y=s=>{o===s?M(t=>t==="asc"?"desc":"asc"):(K(s),M("asc"))},S=({field:s})=>o!==s?e.jsx(ie,{className:"w-3 h-3 text-slate-300"}):C==="asc"?e.jsx(ce,{className:"w-3 h-3 text-brand-500"}):e.jsx(oe,{className:"w-3 h-3 text-brand-500"}),X=async s=>{m(s),h(!1),i({nom:s.nom||"",prenom:s.prenom||"",telephone:s.telephone||"",email:s.email||"",societe:s.societe||""});try{const t=await g.getClientTickets(s.id);P(t)}catch{P([])}},B=async()=>{try{await g.updateClient(a.id,r),h(!1),await j(),m(s=>({...s,...r}))}catch(s){console.error(s)}},O=async s=>{if(confirm("Supprimer ce client ?"))try{await g.deleteClient(s),m(null),await j()}catch(t){console.error(t)}};return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight",children:"Clients"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-0.5",children:[N.length," client(s) — page ",c+1]})]})}),e.jsx("div",{className:"card overflow-hidden mb-6",children:e.jsx("div",{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par nom, téléphone, email...",value:f,onChange:s=>q(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg border border-slate-200 bg-slate-50/50 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 focus:bg-white transition-all"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-5",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"hidden lg:grid grid-cols-[1fr_150px_180px_32px] gap-3 items-center px-5 py-3 bg-slate-50/80 border-b border-slate-100",children:[e.jsxs("button",{onClick:()=>y("nom"),className:"table-header flex items-center gap-1 hover:text-brand-600 transition-colors",children:["Client ",e.jsx(S,{field:"nom"})]}),e.jsxs("button",{onClick:()=>y("telephone"),className:"table-header flex items-center gap-1 hover:text-brand-600 transition-colors",children:["Téléphone ",e.jsx(S,{field:"telephone"})]}),e.jsxs("button",{onClick:()=>y("email"),className:"table-header flex items-center gap-1 hover:text-brand-600 transition-colors",children:["Email ",e.jsx(S,{field:"email"})]}),e.jsx("span",{})]}),T?e.jsxs("div",{className:"py-16 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Chargement..."})]}):z.length===0?e.jsxs("div",{className:"py-16 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(I,{className:"w-7 h-7 text-slate-300"})}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Aucun client trouvé"})]}):e.jsx("div",{className:"divide-y divide-slate-100/80",children:z.map(s=>{var t,n;return e.jsxs("div",{onClick:()=>X(s),className:`lg:grid lg:grid-cols-[1fr_150px_180px_32px] gap-3 items-center px-4 sm:px-5 py-3.5 cursor-pointer transition-colors group
                      ${(a==null?void 0:a.id)===s.id?"bg-brand-50/60":"hover:bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-brand-100 flex items-center justify-center shrink-0",children:e.jsxs("span",{className:"text-brand-700 font-bold text-xs",children:[(((t=s.prenom)==null?void 0:t[0])||"").toUpperCase(),(((n=s.nom)==null?void 0:n[0])||"").toUpperCase()]})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-semibold text-slate-800 truncate",children:[s.prenom||""," ",s.nom||""]}),s.societe&&e.jsx("p",{className:"text-xs text-slate-400 truncate",children:s.societe})]})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("p",{className:"text-slate-600 font-mono text-xs",children:s.telephone||"—"})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx("p",{className:"text-slate-500 truncate text-xs",children:s.email||"—"})}),e.jsx("div",{className:"hidden lg:flex justify-end",children:e.jsx(k,{className:"w-4 h-4 text-slate-300 group-hover:text-brand-500 transition-colors"})})]},s.id)})}),!T&&(c>0||U)&&e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-t border-slate-100 bg-slate-50/50",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>p(s=>Math.max(0,s-1)),disabled:c===0,className:"btn-ghost text-xs disabled:opacity-30",children:[e.jsx(Y,{className:"w-3.5 h-3.5"})," Précédent"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-slate-400",children:["Page ",c+1]}),e.jsx("select",{value:d,onChange:s=>{const t=Number(s.target.value);H(t),p(0),localStorage.setItem("kp_clients_page_size",t.toString())},className:"text-xs border border-slate-200 rounded-md px-2 py-1 bg-white text-slate-600",children:[10,20,50,100].map(s=>e.jsxs("option",{value:s,children:[s," / page"]},s))})]}),e.jsxs("button",{onClick:()=>p(s=>s+1),disabled:!U,className:"btn-ghost text-xs disabled:opacity-30",children:["Suivant ",e.jsx(k,{className:"w-3.5 h-3.5"})]})]})]})}),e.jsx("div",{className:"space-y-5",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-brand-700 font-bold text-sm",children:[(((A=a.prenom)==null?void 0:A[0])||"").toUpperCase(),(((D=a.nom)==null?void 0:D[0])||"").toUpperCase()]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-slate-900",children:[a.prenom," ",a.nom]}),a.societe&&e.jsx("p",{className:"text-xs text-slate-400",children:a.societe})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>h(!E),className:"btn-ghost p-2",title:"Modifier",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>m(null),className:"btn-ghost p-2",title:"Fermer",children:e.jsx(ee,{className:"w-4 h-4"})})]})]}),E?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom"}),e.jsx("input",{value:r.nom,onChange:s=>i(t=>({...t,nom:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Prénom"}),e.jsx("input",{value:r.prenom,onChange:s=>i(t=>({...t,prenom:s.target.value})),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Téléphone"}),e.jsx("input",{value:r.telephone,onChange:s=>i(t=>({...t,telephone:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email"}),e.jsx("input",{value:r.email,onChange:s=>i(t=>({...t,email:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Société"}),e.jsx("input",{value:r.societe,onChange:s=>i(t=>({...t,societe:s.target.value})),className:"input"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary text-xs",children:"Annuler"}),e.jsxs("button",{onClick:B,className:"btn-primary text-xs",children:[e.jsx(se,{className:"w-3.5 h-3.5"})," Enregistrer"]})]})]}):e.jsxs("div",{className:"space-y-2.5",children:[a.telephone&&e.jsxs("a",{href:`tel:${a.telephone}`,className:"flex items-center gap-2.5 text-sm text-slate-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center shrink-0",children:e.jsx(te,{className:"w-4 h-4 text-slate-500"})}),e.jsx("span",{className:"font-mono text-xs",children:a.telephone})]}),a.email&&e.jsxs("a",{href:`mailto:${a.email}`,className:"flex items-center gap-2.5 text-sm text-slate-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center shrink-0",children:e.jsx(ae,{className:"w-4 h-4 text-slate-500"})}),e.jsx("span",{className:"text-xs truncate",children:a.email})]})]})]}),e.jsxs("button",{onClick:()=>_(`/client?client_id=${a.id}&tel=${encodeURIComponent(a.telephone||"")}`),className:"btn-primary w-full justify-center text-xs mb-5",children:[e.jsx(le,{className:"w-3.5 h-3.5"})," Nouvelle réparation pour ce client"]}),e.jsxs("div",{className:"card p-5",children:[e.jsxs("h3",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3",children:["Tickets (",w.length,")"]}),w.length===0?e.jsx("p",{className:"text-sm text-slate-400 text-center py-4",children:"Aucun ticket"}):e.jsx("div",{className:"space-y-2",children:w.map(s=>e.jsxs("button",{onClick:()=>_(`${L}/ticket/${s.id}`),className:"w-full flex items-center gap-3 p-2.5 rounded-lg hover:bg-slate-50 transition-colors text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-brand-50 flex items-center justify-center shrink-0",children:e.jsx(ne,{className:"w-4 h-4 text-brand-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold text-brand-600 font-mono",children:s.ticket_code}),e.jsxs("p",{className:"text-xs text-slate-500 truncate",children:[s.marque," ",s.modele||s.modele_autre," — ",s.panne]})]}),e.jsx(k,{className:"w-4 h-4 text-slate-300 shrink-0"})]},s.id))})]}),e.jsxs("button",{onClick:()=>O(a.id),className:"btn-danger w-full text-xs",children:[e.jsx(re,{className:"w-3.5 h-3.5"})," Supprimer le client"]})]}):e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center mx-auto mb-4",children:e.jsx(I,{className:"w-7 h-7 text-slate-300"})}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Sélectionnez un client"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Cliquez sur un client pour voir ses détails"})]})})]})]})}export{he as default};
