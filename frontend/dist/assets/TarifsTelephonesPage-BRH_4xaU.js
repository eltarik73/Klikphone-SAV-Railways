import{u as X,a as M,j as e,c as w,i as Z}from"./index-jhMOtRsP.js";import{r as o}from"./vendor-react-DWtYaMjq.js";import{q as J,R as G,P as V,o as W,T as Y,S as ee,aQ as se,C as te,c as L,Q as ae,O as re,K as le}from"./vendor-icons-DUhoIZbQ.js";const ne={Apple:"#333333",Samsung:"#1428A0",Xiaomi:"#FF6900",Google:"#4285F4",Huawei:"#CF0A2C",Honor:"#00AAEE",Oppo:"#1A8A36",OnePlus:"#EB0028",Motorola:"#5C2D91",Nothing:"#FFFFFF",Realme:"#F5C518"},I={"Grade A":{bg:"bg-emerald-500/20",text:"text-emerald-400",border:"border-emerald-500/30"},"Grade A+":{bg:"bg-emerald-500/20",text:"text-emerald-400",border:"border-emerald-500/30"},"Grade B":{bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},"Grade B+":{bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},"Grade C":{bg:"bg-orange-500/20",text:"text-orange-400",border:"border-orange-500/30"},Neuf:{bg:"bg-blue-500/20",text:"text-blue-400",border:"border-blue-500/30"}},T=[{value:"prix_asc",label:"Prix croissant"},{value:"prix_desc",label:"Prix decroissant"},{value:"marque",label:"Marque A-Z"},{value:"nouveautes",label:"Nouveautes"}];function oe(l){if(!l)return null;const t=new Date(l);if(isNaN(t.getTime()))return null;const i=String(t.getDate()).padStart(2,"0"),x=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getHours()).padStart(2,"0"),f=String(t.getMinutes()).padStart(2,"0");return`${i}/${x} a ${d}:${f}`}function k(l){return l==null?"":Number(l).toFixed(2).replace(".",",")+" €"}function ie(l){return l?I[l]||I.Neuf:null}function y(){return e.jsx("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-5 animate-pulse",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-700/50"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-7 w-16 bg-slate-700/50 rounded"}),e.jsx("div",{className:"h-4 w-24 bg-slate-700/50 rounded"})]})]})})}function de(){return e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden animate-pulse",children:[e.jsx("div",{className:"h-48 bg-slate-900/80"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-3 w-16 bg-slate-700/50 rounded"}),e.jsx("div",{className:"h-5 w-3/4 bg-slate-700/50 rounded"}),e.jsx("div",{className:"h-3 w-1/2 bg-slate-700/50 rounded"}),e.jsx("div",{className:"h-7 w-24 bg-slate-700/50 rounded mt-2"}),e.jsx("div",{className:"h-3 w-32 bg-slate-700/50 rounded"})]})]})}function S({icon:l,value:t,label:i,color:x}){return e.jsx("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-5 transition-all hover:border-slate-600/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{backgroundColor:x+"20"},children:e.jsx(l,{className:"w-6 h-6",style:{color:x}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:t??"-"}),e.jsx("p",{className:"text-sm text-slate-400",children:i})]})]})})}const ce=o.memo(function({phone:t}){const i=t.grade||(t.type_produit==="Neuf"?"Neuf":null),x=ie(i),d=t.en_stock!==!1&&t.en_stock!==0;return e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden transition-shadow duration-200 hover:border-amber-500/30 hover:shadow-lg hover:shadow-amber-500/5 group",children:[e.jsxs("div",{className:"relative h-48 bg-slate-900 flex items-center justify-center overflow-hidden",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:t.modele||"Telephone",className:"h-full w-full object-contain p-4 group-hover:scale-105 transition-transform duration-200",loading:"lazy",onError:f=>{var c;f.target.style.display="none",(c=f.target.nextElementSibling)==null||c.classList.remove("hidden")}}):null,e.jsxs("div",{className:`flex flex-col items-center justify-center text-slate-600 ${t.image_url?"hidden":""}`,children:[e.jsx(L,{className:"w-16 h-16 mb-2"}),e.jsx("span",{className:"text-xs text-slate-600",children:"Pas d'image"})]}),x&&e.jsx("span",{className:`absolute top-3 left-3 text-[10px] font-bold px-2.5 py-1 rounded-lg ${x.bg} ${x.text} ${x.border} border backdrop-blur-sm`,children:i==="Neuf"?"NEUF":i.toUpperCase()}),e.jsx("div",{className:"absolute top-3 right-3",children:d?e.jsxs("span",{className:"flex items-center gap-1.5 text-[10px] font-semibold px-2.5 py-1 rounded-lg bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 backdrop-blur-sm",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"}),"En stock"]}):e.jsxs("span",{className:"flex items-center gap-1.5 text-[10px] font-semibold px-2.5 py-1 rounded-lg bg-red-500/20 text-red-400 border border-red-500/30 backdrop-blur-sm",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-400"}),"Rupture"]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-slate-500 mb-1",children:t.marque||"Marque inconnue"}),e.jsx("h3",{className:"text-sm font-bold text-white leading-tight mb-1.5 line-clamp-2",children:t.modele||"Modele inconnu"}),e.jsx("p",{className:"text-xs text-slate-400 mb-3",children:[t.stockage,t.couleur].filter(Boolean).join(" · ")||""}),e.jsx("p",{className:"text-xl font-extrabold text-amber-500 mb-2",children:t.prix_vente!=null?k(t.prix_vente):"Prix sur demande"}),t.prix_fournisseur!=null&&e.jsxs("p",{className:"text-xs text-slate-600 line-through mb-2",children:["Fournisseur : ",k(t.prix_fournisseur)]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[e.jsx(le,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-[11px]",children:"Garantie 12 mois"})]})]})]})});function xe({checked:l,onChange:t,label:i}){return e.jsxs("label",{className:"flex items-center gap-2.5 cursor-pointer select-none",children:[e.jsx("div",{onClick:()=>t(!l),className:`relative w-10 h-[22px] rounded-full transition-colors duration-200 ${l?"bg-amber-500":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-[2px] w-[18px] h-[18px] rounded-full bg-white shadow-sm transition-transform duration-200 ${l?"translate-x-[20px]":"translate-x-[2px]"}`})}),e.jsx("span",{className:"text-sm text-slate-400",children:i})]})}function be(){const{user:l}=X(),t=localStorage.getItem("klikphone_admin")==="true",[i,x]=o.useState(!1),[d,f]=o.useState(""),[c,C]=o.useState(""),[h,q]=o.useState(""),[g,F]=o.useState(!0),[m,A]=o.useState("prix_asc"),[N,_]=o.useState(!1),[u,j]=o.useState(1),{data:v,loading:z}=M("telephones:stats",async()=>{const[s,r]=await Promise.all([w.getTelephoneStats(),w.getTelephoneMarques()]);return{stats:s,marques:r||[]}},{tags:["telephones"],ttl:3e5}),a=(v==null?void 0:v.stats)??null,Q=(v==null?void 0:v.marques)??[],H=o.useMemo(()=>{const s=["telephones:list",`p:${u}`];return c&&s.push(`b:${c}`),d&&s.push(`t:${d}`),g&&s.push("stock"),h.trim()&&s.push(`q:${h.trim()}`),m&&s.push(`sort:${m}`),s.join(":")},[u,c,d,g,h,m]),{data:b,loading:E}=M(H,async()=>{const s={page:u,limit:24};c&&(s.marque=c),d&&(s.type_produit=d),g&&(s.en_stock=!0),h.trim()&&(s.search=h.trim()),m&&(s.tri=m);const r=await w.getTelephonesCatalogue(s);if(r&&r.items)return{phones:r.items,totalPages:r.total_pages||1,totalItems:r.total||0};const n=Array.isArray(r)?r:[];return{phones:n,totalPages:1,totalItems:n.length}},{tags:["telephones"],ttl:3e5}),P=(b==null?void 0:b.phones)??[],p=(b==null?void 0:b.totalPages)??1,B=(b==null?void 0:b.totalItems)??0,R=o.useRef({selectedBrand:c,typeProduit:d,enStockOnly:g,searchQuery:h,sortBy:m});o.useEffect(()=>{const s=R.current;(s.selectedBrand!==c||s.typeProduit!==d||s.enStockOnly!==g||s.searchQuery!==h||s.sortBy!==m)&&j(1),R.current={selectedBrand:c,typeProduit:d,enStockOnly:g,searchQuery:h,sortBy:m}},[c,d,g,h,m]);async function K(){if(!i){x(!0);try{await w.syncTelephones();let s=0;for(;s<120;){await new Promise(r=>setTimeout(r,5e3)),s++;try{if(!(await w.getSyncStatus()).running)break}catch{break}}j(1),Z("telephones")}catch(s){console.error("Erreur sync telephones:",s)}finally{x(!1)}}}o.useEffect(()=>{if(!N)return;function s(){_(!1)}return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[N]);const[$,O]=o.useState("");o.useEffect(()=>{const s=setTimeout(()=>{q($)},400);return()=>clearTimeout(s)},[$]);const D=[{value:"",label:"Tous"},{value:"neuf",label:"Neufs"},{value:"occasion",label:"Occasion"}],U=T.find(s=>s.value===m)||T[0];return e.jsxs("div",{className:"min-h-screen bg-slate-900 pb-12",children:[e.jsx("div",{className:"bg-slate-900 border-b border-slate-800",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Tarifs Telephones"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Telephones neufs et reconditionnes — Garantie 12 mois"})]}),e.jsxs("div",{className:"flex flex-col items-end shrink-0",children:[t&&e.jsxs("button",{onClick:K,disabled:i,className:"flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-semibold text-white transition-all disabled:opacity-60 shadow-lg",style:{background:"linear-gradient(135deg, #F59E0B, #D97706)"},children:[i?e.jsx(J,{className:"w-4 h-4 animate-spin"}):e.jsx(G,{className:"w-4 h-4"}),i?"Synchronisation...":"Synchroniser"]}),(a==null?void 0:a.derniere_sync)&&e.jsxs("p",{className:"text-[11px] text-slate-500 mt-1.5",children:["Derniere sync : ",oe(a.derniere_sync)]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mt-6",children:z?e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx(y,{}),e.jsx(y,{}),e.jsx(y,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{icon:V,value:(a==null?void 0:a.total)??0,label:"Total modeles",color:"#8B5CF6"}),e.jsx(S,{icon:W,value:(a==null?void 0:a.en_stock)??0,label:"En stock",color:"#10B981"}),e.jsx(S,{icon:Y,value:(a==null?void 0:a.neufs)??0,label:"Neufs",color:"#3B82F6"}),e.jsx(S,{icon:G,value:(a==null?void 0:a.reconditionnes)??0,label:"Reconditionnes",color:"#F97316"})]})}),e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex items-center gap-2 shrink-0",children:D.map(s=>e.jsx("button",{onClick:()=>f(s.value),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${d===s.value?"bg-amber-500 text-white shadow-lg shadow-amber-500/20":"border border-slate-600 text-slate-400 hover:border-slate-500 hover:text-slate-300"}`,children:s.label},s.value))}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-none pb-1",children:[e.jsx("button",{onClick:()=>C(""),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-all ${c===""?"bg-amber-500 text-white":"border border-slate-600 text-slate-400 hover:border-slate-500 hover:text-slate-300"}`,children:"Toutes marques"}),Q.map(s=>{const r=ne[s.marque]||"#8B5CF6",n=c===s.marque;return e.jsxs("button",{onClick:()=>C(n?"":s.marque),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-all border ${n?"text-white shadow-lg":"border-slate-600 text-slate-400 hover:border-slate-500 hover:text-slate-300"}`,style:n?{backgroundColor:r,borderColor:r}:void 0,children:[s.marque,s.nb_en_stock!=null&&e.jsxs("span",{className:`ml-1.5 text-[10px] ${n?"opacity-75":"text-slate-500"}`,children:["(",s.nb_en_stock,")"]})]},s.marque)})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",placeholder:"Rechercher un telephone...",value:$,onChange:s=>O(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-slate-800/70 border border-slate-700/50 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/30 focus:border-amber-500/50 transition-all"})]}),e.jsx(xe,{checked:g,onChange:F,label:"En stock"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:s=>{s.stopPropagation(),_(!N)},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-slate-800/70 border border-slate-700/50 text-sm text-slate-300 hover:border-slate-600 transition-all whitespace-nowrap",children:[e.jsx(se,{className:"w-4 h-4 text-slate-500"}),U.label,e.jsx(te,{className:`w-4 h-4 text-slate-500 transition-transform ${N?"rotate-180":""}`})]}),N&&e.jsx("div",{className:"absolute right-0 top-full mt-2 w-48 bg-slate-800 border border-slate-700 rounded-xl shadow-2xl shadow-black/40 z-30 overflow-hidden",children:T.map(s=>e.jsx("button",{onClick:r=>{r.stopPropagation(),A(s.value),_(!1)},className:`w-full text-left px-4 py-2.5 text-sm transition-colors ${m===s.value?"bg-amber-500/10 text-amber-400 font-medium":"text-slate-300 hover:bg-slate-700/50"}`,children:s.label},s.value))})]})]})]}),e.jsx("div",{className:"mt-8",children:E?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:8}).map((s,r)=>e.jsx(de,{},r))}):P.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-24 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-slate-800/50 border border-slate-700/50 flex items-center justify-center mb-6",children:e.jsx(L,{className:"w-10 h-10 text-slate-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-300 mb-2",children:"Aucun telephone trouve"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-md",children:"Essayez de modifier vos filtres ou lancez une synchronisation pour importer les derniers telephones disponibles."}),e.jsx("button",{onClick:()=>{f(""),C(""),O(""),q(""),F(!0),A("prix_asc"),j(1)},className:"mt-6 px-5 py-2.5 rounded-xl border border-slate-600 text-sm text-slate-400 hover:border-slate-500 hover:text-slate-300 transition-all",children:"Reinitialiser les filtres"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:P.filter(s=>s.modele&&s.modele.trim()&&s.prix_vente&&s.prix_vente>0&&s.marque&&s.marque.trim()).map((s,r)=>e.jsx(ce,{phone:s},s.id||r))})}),!E&&P.length>0&&e.jsxs("div",{className:"mt-8 flex flex-col items-center gap-4",children:[p>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(s=>Math.max(1,s-1)),disabled:u===1,className:"p-2 rounded-lg bg-slate-800/70 border border-slate-700/50 text-slate-400 hover:text-white hover:border-slate-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})}),Array.from({length:Math.min(p,7)},(s,r)=>{let n;return p<=7||u<=4?n=r+1:u>=p-3?n=p-6+r:n=u-3+r,e.jsx("button",{onClick:()=>j(n),className:`w-9 h-9 rounded-lg text-sm font-medium transition-colors ${u===n?"bg-amber-500 text-white shadow-lg shadow-amber-500/20":"bg-slate-800/70 border border-slate-700/50 text-slate-400 hover:text-white hover:border-slate-600"}`,children:n},n)}),e.jsx("button",{onClick:()=>j(s=>Math.min(p,s+1)),disabled:u===p,className:"p-2 rounded-lg bg-slate-800/70 border border-slate-700/50 text-slate-400 hover:text-white hover:border-slate-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[B," telephone",B>1?"s":"",p>1?` · Page ${u}/${p}`:"",a!=null&&a.nb_marques?` · ${a.nb_marques} marques`:"",(a==null?void 0:a.prix_min)!=null&&(a==null?void 0:a.prix_max)!=null?` · ${k(a.prix_min)} → ${k(a.prix_max)}`:""]})]})]})]})}export{be as default};
