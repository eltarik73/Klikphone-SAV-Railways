import{u as $e,c as He,h as We,a as c,j as e}from"./index-CZyiutDh.js";import{r}from"./vendor-react-DMwujlca.js";import{ag as Je,U as pe,ah as Ye,l as he,ai as Ge,c as Qe,y as ge,e as je,t as Xe,aj as be,j as Ze,p as g,a5 as N,z as $,X as Ne,a4 as es,o as ve,C as ss,J as as,ak as ts,G as ls,a8 as ns,al as rs,Z as fe,am as is}from"./vendor-icons-DnXwj2oL.js";const cs=["#3B82F6","#8B5CF6","#EC4899","#EF4444","#F97316","#EAB308","#22C55E","#06B6D4","#6366F1","#64748B"],H=[{id:1,label:"Appareil recu",message:"Bonjour {prenom}, votre {appareil} a bien ete pris en charge sous le numero {code}. Nous vous tiendrons informe de l'avancement. Klikphone 04 79 60 89 22"},{id:2,label:"Diagnostic en cours",message:"Bonjour {prenom}, le diagnostic de votre {appareil} est en cours. Nous reviendrons vers vous rapidement. Klikphone"},{id:3,label:"Devis a valider",message:"Bonjour {prenom}, le devis pour votre {appareil} est de {montant} EUR. Merci de nous confirmer votre accord. Klikphone 04 79 60 89 22"},{id:4,label:"En cours de reparation",message:"Bonjour {prenom}, la reparation de votre {appareil} est en cours. Klikphone"},{id:5,label:"Attente piece",message:"Bonjour {prenom}, nous sommes en attente d'une piece pour votre {appareil}. Nous vous previendrons des reception. Klikphone"},{id:6,label:"Appareil pret",message:"Bonjour {prenom}, votre {appareil} est pret ! Vous pouvez venir le recuperer a la boutique. Montant : {montant} EUR. Klikphone 79 Place Saint Leger, Chambery"},{id:7,label:"Commande arrivee",message:"Bonjour {prenom}, la piece commandee pour votre {appareil} est arrivee. Nous lancons la reparation. Klikphone 04 79 60 89 22"},{id:8,label:"Non reparable",message:"Bonjour {prenom}, malheureusement votre {appareil} n'est pas reparable. Vous pouvez passer recuperer votre appareil en boutique. Klikphone"},{id:9,label:"Rappel RDV",message:"Bonjour {prenom}, nous vous rappelons votre rendez-vous demain pour votre {appareil}. Klikphone 79 Place Saint Leger, Chambery"},{id:10,label:"Personnalise",message:""}];function xs(){const{user:os}=$e(),t=He(),{animations:P,setAnimations:Ce}=We(),[n,W]=r.useState({}),[J,ye]=r.useState([]),[we,Y]=r.useState(!0),[j,G]=r.useState(!1),[d,Se]=r.useState("general"),[Ee,D]=r.useState(!1),[y,Q]=r.useState(null),[b,v]=r.useState({nom:"",role:"tech",couleur:"#3B82F6",actif:!0}),[ke,w]=r.useState(!1),[_,q]=r.useState(""),[X,O]=r.useState(""),[Z,ee]=r.useState(!1),[R,S]=r.useState([]),[se,ae]=r.useState(!1),[h,A]=r.useState({target:"accueil",old_pin:"",new_pin:""}),[te,le]=r.useState(!1),[m,x]=r.useState({}),[ne,re]=r.useState(!1),[ie,ce]=r.useState(!1),[oe,de]=r.useState(!1),[M,_e]=r.useState(""),B=r.useRef({}),L=r.useCallback(()=>{const s=B.current;return Object.keys(n).some(a=>(n[a]||"")!==(s[a]||""))},[n]);r.useEffect(()=>{const s=a=>{L()&&(a.preventDefault(),a.returnValue="")};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[L]);const[E,Ae]=r.useState({marques:[],modeles:[]}),[me,Me]=r.useState({}),[f,F]=r.useState({categorie:"Smartphone",marque:""}),[u,I]=r.useState({categorie:"Smartphone",marque:"",modele:""}),K=["Smartphone","Tablette","PC Portable","Console","Autre"];r.useEffect(()=>{T()},[]);const T=async()=>{Y(!0);try{const[s,a]=await Promise.all([c.getConfig(),c.getTeam()]),l={};Array.isArray(s)?s.forEach(o=>{l[o.cle]=o.valeur}):Object.assign(l,s),W(l),B.current={...l},ye(a)}catch(s){console.error(s)}finally{Y(!1)}},k=async()=>{try{const s=await c.getAllCatalog();Ae(s)}catch(s){console.error(s)}};r.useEffect(()=>{d==="catalog"&&k(),d==="caisse"&&c.getCaisseConfig().then(x).catch(()=>{}),d==="messages"&&c.getMessageTemplates().then(s=>{s&&s.length>0?S(s):S(H)}).catch(()=>S(H))},[d]);const C=async()=>{G(!0);try{const s=Object.entries(n).map(([a,l])=>({cle:a,valeur:l||""}));await c.setParams(s),B.current={...n},t.success("Configuration enregistrée")}catch{t.error("Erreur sauvegarde")}finally{G(!1)}},i=(s,a)=>{W(l=>({...l,[s]:a}))},U=()=>{v({nom:"",role:"tech",couleur:"#3B82F6",actif:!0}),Q(null),D(!1)},z=async s=>{var l;const a=b.role==="manager";if(a&&!s){q(""),O(""),w(!0);return}try{y?await c.updateTeamMember(y.id,b,a?s:void 0):await c.createTeamMember(b,a?s:void 0),U(),w(!1),q(""),await T(),t.success(y?"Membre mis à jour":"Membre créé")}catch(o){(l=o.message)!=null&&l.includes("Code administrateur")?O("Code administrateur incorrect"):(t.error(o.message||"Erreur"),w(!1))}},Ie=s=>{Q(s),v({nom:s.nom||"",role:s.role||"tech",couleur:s.couleur||"#3B82F6",actif:s.actif!==0}),D(!0)},Te=async s=>{if(confirm("Supprimer ce membre ?"))try{await c.deleteTeamMember(s),await T(),t.success("Membre supprimé")}catch{t.error("Erreur suppression")}},Pe=async()=>{le(!0);try{await c.changePin(h.target,h.old_pin,h.new_pin),A({target:h.target,old_pin:"",new_pin:""}),t.success("PIN modifié")}catch(s){t.error(s.message||"Erreur changement PIN")}finally{le(!1)}},ue=async()=>{if(f.marque.trim())try{await c.addMarque(f.categorie,f.marque.trim()),F(s=>({...s,marque:""})),await k(),t.success("Marque ajoutée")}catch{t.error("Erreur")}},xe=async()=>{if(!(!u.modele.trim()||!u.marque))try{await c.addModele(u.categorie,u.marque,u.modele.trim()),I(s=>({...s,modele:""})),await k(),t.success("Modèle ajouté")}catch{t.error("Erreur")}},De=async(s,a)=>{if(confirm(`Supprimer ${a} et tous ses modèles ?`))try{await c.deleteMarque(s,a),await k(),t.success("Marque supprimée")}catch{t.error("Erreur")}},qe=async(s,a,l)=>{try{await c.deleteModele(s,a,l),await k(),t.success("Modèle supprimé")}catch{t.error("Erreur")}},Oe=async()=>{try{const s=await c.getBackup(),a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),o=document.createElement("a");o.href=l,o.download=`klikphone_backup_${new Date().toISOString().slice(0,10)}.json`,o.click(),URL.revokeObjectURL(l),t.success("Backup téléchargé")}catch{t.error("Erreur backup")}},Re=async()=>{try{await c.exportClientsCsv(),t.success("Export CSV téléchargé")}catch{t.error("Erreur export CSV")}},Be=async()=>{try{await c.exportClientsExcel(),t.success("Export Excel téléchargé")}catch{t.error("Erreur export Excel")}},Le=async s=>{var l,o;const a=(l=s.target.files)==null?void 0:l[0];if(a)try{const p=await a.text(),V=JSON.parse(p);if(!V.tables){t.error("Format de backup invalide");return}if(!confirm(`Restaurer le backup du ${((o=V.backup_date)==null?void 0:o.slice(0,10))||"?"} ? Cela remplacera TOUTES les données actuelles.`))return;const Ke=await c.importBackup(V),Ue=Object.values(Ke.imported).reduce((ze,Ve)=>ze+Ve,0);t.success(`Backup restauré : ${Ue} enregistrements importés`),await T()}catch(p){t.error(p.message||"Erreur import backup")}finally{s.target.value=""}},Fe=[{id:"general",label:"Boutique",icon:Je},{id:"team",label:"Équipe",icon:pe},{id:"catalog",label:"Catalogue",icon:Ye},{id:"messages",label:"Messages",icon:he},{id:"notifications",label:"Notifs",icon:Ge},{id:"fidelite",label:"Fidélité",icon:Qe},{id:"caisse",label:"Caisse",icon:ge},{id:"security",label:"Sécurité",icon:je},{id:"appearance",label:"Apparence",icon:Xe},{id:"backup",label:"Sauvegarde",icon:be}];return we?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 max-w-4xl",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-slate-900 tracking-tight",children:"Configuration"}),e.jsx("p",{className:"text-sm text-slate-500 mt-0.5",children:"Paramètres de l'application"})]})}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-6",children:Fe.map(({id:s,label:a,icon:l})=>e.jsxs("button",{onClick:()=>Se(s),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-medium transition-all
              ${d===s?"bg-brand-600 text-white shadow-sm shadow-brand-600/25":"text-slate-500 hover:bg-slate-100 hover:text-slate-700"}`,children:[e.jsx(l,{className:"w-3.5 h-3.5"})," ",a]},s))}),L()&&(d==="general"||d==="notifications"||d==="fidelite")&&e.jsxs("div",{className:"flex items-center gap-3 mb-5 px-4 py-3 bg-amber-50 border border-amber-200 rounded-xl animate-in",children:[e.jsx(Ze,{className:"w-4 h-4 text-amber-600 shrink-0"}),e.jsx("p",{className:"text-sm text-amber-800 font-medium flex-1",children:"Modifications non sauvegardées"}),e.jsxs("button",{onClick:C,disabled:j,className:"btn-primary text-xs px-3 py-1.5",children:[j?e.jsx(g,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(N,{className:"w-3.5 h-3.5"}),"Enregistrer"]})]}),d==="general"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Informations boutique"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom de la boutique"}),e.jsx("input",{value:n.nom_boutique||"",onChange:s=>i("nom_boutique",s.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Téléphone"}),e.jsx("input",{value:n.telephone||"",onChange:s=>i("telephone",s.target.value),className:"input"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"input-label",children:"Adresse"}),e.jsx("input",{value:n.adresse||"",onChange:s=>i("adresse",s.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email"}),e.jsx("input",{value:n.email||"",onChange:s=>i("email",s.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Site web"}),e.jsx("input",{value:n.site_web||"",onChange:s=>i("site_web",s.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"SIRET"}),e.jsx("input",{value:n.siret||"",onChange:s=>i("siret",s.target.value),className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"TVA"}),e.jsxs("select",{value:n.tva||"20",onChange:s=>i("tva",s.target.value),className:"input",children:[e.jsx("option",{value:"0",children:"Sans TVA"}),e.jsx("option",{value:"20",children:"20%"}),e.jsx("option",{value:"10",children:"10%"}),e.jsx("option",{value:"5.5",children:"5.5%"})]})]})]})]}),e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Impression"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Mentions légales (bas de ticket)"}),e.jsx("textarea",{value:n.mentions_legales||"",onChange:s=>i("mentions_legales",s.target.value),className:"input min-h-[80px] resize-none",placeholder:"Conditions générales, garantie..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Message personnalisé (ticket client)"}),e.jsx("input",{value:n.message_ticket||"",onChange:s=>i("message_ticket",s.target.value),className:"input",placeholder:"Merci de votre confiance !"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:C,disabled:j,className:"btn-primary",children:[j?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(N,{className:"w-4 h-4"}),"Enregistrer"]})})]}),d==="team"&&e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>{U(),D(!0)},className:"btn-primary",children:[e.jsx($,{className:"w-4 h-4"})," Ajouter un membre"]})}),Ee&&e.jsxs("div",{className:"card p-5 border-brand-200 animate-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800",children:y?"Modifier le membre":"Nouveau membre"}),e.jsx("button",{onClick:U,className:"btn-ghost p-1.5",children:e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom *"}),e.jsx("input",{value:b.nom,onChange:s=>v(a=>({...a,nom:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Rôle"}),e.jsxs("select",{value:b.role,onChange:s=>v(a=>({...a,role:s.target.value})),className:"input",children:[e.jsx("option",{value:"tech",children:"Technicien"}),e.jsx("option",{value:"accueil",children:"Accueil"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Couleur"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:cs.map(s=>e.jsx("button",{onClick:()=>v(a=>({...a,couleur:s})),className:`w-7 h-7 rounded-lg border-2 transition-all ${b.couleur===s?"border-slate-900 scale-110":"border-transparent"}`,style:{backgroundColor:s}},s))})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.actif,onChange:s=>v(a=>({...a,actif:s.target.checked})),className:"rounded border-slate-300 text-brand-600 focus:ring-brand-500"}),e.jsx("span",{className:"text-sm text-slate-700",children:"Actif"})]})})]}),e.jsx("div",{className:"flex justify-end mt-4 pt-3 border-t border-slate-100",children:e.jsxs("button",{onClick:()=>z(),disabled:!b.nom,className:"btn-primary",children:[e.jsx(N,{className:"w-4 h-4"})," ",y?"Mettre à jour":"Créer"]})})]}),e.jsx("div",{className:"card overflow-hidden",children:J.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(pe,{className:"w-8 h-8 text-slate-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Aucun membre dans l'équipe"})]}):e.jsx("div",{className:"divide-y divide-slate-100",children:J.map(s=>{var a;return e.jsxs("div",{className:"flex items-center gap-4 px-5 py-3.5",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center shrink-0",style:{backgroundColor:(s.couleur||"#3B82F6")+"20"},children:e.jsx("span",{className:"font-bold text-sm",style:{color:s.couleur||"#3B82F6"},children:(((a=s.nom)==null?void 0:a[0])||"").toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:s.nom}),e.jsx("span",{className:"w-3 h-3 rounded-full shrink-0",style:{backgroundColor:s.couleur||"#94A3B8"}}),!s.actif&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-medium bg-slate-100 text-slate-400",children:"Inactif"})]}),e.jsx("p",{className:"text-xs text-slate-400 capitalize",children:s.role})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>Ie(s),className:"btn-ghost p-1.5",children:e.jsx(es,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>Te(s.id),className:"btn-ghost p-1.5",children:e.jsx(ve,{className:"w-3.5 h-3.5 text-red-400"})})]})]},s.id)})})}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>w(!1),children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-6 w-full max-w-sm mx-4 animate-in",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(je,{className:"w-5 h-5 text-amber-500"}),e.jsx("h3",{className:"text-sm font-bold text-slate-800",children:"Code administrateur requis"})]}),e.jsx("p",{className:"text-xs text-slate-500 mb-4",children:"Le rôle Manager donne accès aux données financières. Entrez le code administrateur pour continuer."}),e.jsx("input",{type:"password",value:_,onChange:s=>{q(s.target.value),O("")},onKeyDown:s=>s.key==="Enter"&&z(_),className:"input w-full mb-2",placeholder:"Code administrateur",autoFocus:!0}),X&&e.jsx("p",{className:"text-xs text-red-500 mb-3",children:X}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsx("button",{onClick:()=>w(!1),className:"btn-ghost text-sm px-3 py-1.5",children:"Annuler"}),e.jsx("button",{onClick:()=>z(_),disabled:!_,className:"btn-primary text-sm px-3 py-1.5",children:"Valider"})]})]})})]}),d==="catalog"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-3",children:"Ajouter une marque"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("select",{value:f.categorie,onChange:s=>F(a=>({...a,categorie:s.target.value})),className:"input w-40",children:K.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("input",{value:f.marque,onChange:s=>F(a=>({...a,marque:s.target.value})),className:"input flex-1",placeholder:"Nom de la marque",onKeyDown:s=>s.key==="Enter"&&ue()}),e.jsx("button",{onClick:ue,disabled:!f.marque.trim(),className:"btn-primary px-3",children:e.jsx($,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-3",children:"Ajouter un modèle"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("select",{value:u.categorie,onChange:s=>I(a=>({...a,categorie:s.target.value,marque:""})),className:"input w-36",children:K.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs("select",{value:u.marque,onChange:s=>I(a=>({...a,marque:s.target.value})),className:"input w-40",children:[e.jsx("option",{value:"",children:"— Marque —"}),[...new Set(E.marques.filter(s=>s.categorie===u.categorie).map(s=>s.marque))].map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("input",{value:u.modele,onChange:s=>I(a=>({...a,modele:s.target.value})),className:"input flex-1",placeholder:"Nom du modèle",onKeyDown:s=>s.key==="Enter"&&xe()}),e.jsx("button",{onClick:xe,disabled:!u.modele.trim()||!u.marque,className:"btn-primary px-3",children:e.jsx($,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"px-5 py-3 bg-slate-50/80 border-b border-slate-100",children:e.jsxs("span",{className:"table-header",children:["Catalogue (",E.marques.length," marques, ",E.modeles.length," modèles)"]})}),K.map(s=>{const a=[...new Set(E.marques.filter(l=>l.categorie===s).map(l=>l.marque))];return a.length===0?null:e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>Me(l=>({...l,[s]:!l[s]})),className:"w-full flex items-center gap-2 px-5 py-2.5 text-sm font-semibold text-slate-700 hover:bg-slate-50",children:[me[s]?e.jsx(ss,{className:"w-4 h-4"}):e.jsx(as,{className:"w-4 h-4"}),s," ",e.jsxs("span",{className:"text-xs text-slate-400 font-normal",children:["(",a.length,")"]})]}),me[s]&&e.jsx("div",{className:"pl-8 pr-5 pb-2",children:a.map(l=>{const o=E.modeles.filter(p=>p.categorie===s&&p.marque===l);return e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 py-1",children:[e.jsx("span",{className:"text-xs font-semibold text-slate-600",children:l}),e.jsxs("span",{className:"text-[10px] text-slate-400",children:["(",o.length," modèles)"]}),e.jsx("button",{onClick:()=>De(s,l),className:"ml-auto btn-ghost p-1",children:e.jsx(ve,{className:"w-3 h-3 text-red-400"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1 ml-3",children:o.map(p=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-slate-100 text-xs text-slate-600",children:[p.modele,e.jsx("button",{onClick:()=>qe(s,l,p.modele),className:"hover:text-red-500",children:e.jsx(Ne,{className:"w-3 h-3"})})]},p.modele))})]},l)})})]},s)})]})]}),d==="messages"&&e.jsx("div",{className:"space-y-5",children:e.jsxs("div",{className:"card p-5",children:[e.jsxs("h2",{className:"text-sm font-semibold text-slate-800 mb-1 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"})," Messages predefinis"]}),e.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["Variables disponibles : ","{prenom}"," ","{nom}"," ","{appareil}"," ","{code}"," ","{montant}"," ","{adresse}"," ","{tel_boutique}"," ","{horaires}"]}),e.jsx("div",{className:"space-y-3",children:R.map((s,a)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600 mb-1 block",children:s.label}),e.jsx("textarea",{value:s.message,onChange:l=>{const o=[...R];o[a]={...o[a],message:l.target.value},S(o)},rows:2,className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-xs resize-none focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500",placeholder:s.id===10?"Template libre (le texte sera modifiable)":"Message..."})]},s.id))}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-3 border-t border-slate-100",children:[e.jsxs("button",{onClick:async()=>{ae(!0);try{await c.saveMessageTemplates(R),t.success("Templates sauvegardes")}catch{t.error("Erreur sauvegarde")}finally{ae(!1)}},disabled:se,className:"btn-primary",children:[e.jsx(N,{className:"w-4 h-4"})," ",se?"Sauvegarde...":"Sauvegarder"]}),e.jsx("button",{onClick:()=>{S(H),t.success("Templates reinitialises (sauvegarder pour appliquer)")},className:"btn-ghost",children:"Reinitialiser"})]})]})}),d==="notifications"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Discord Webhook"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"URL du webhook"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:n.DISCORD_WEBHOOK||"",onChange:s=>i("DISCORD_WEBHOOK",s.target.value),className:"input font-mono text-xs flex-1",placeholder:"https://discord.com/api/webhooks/..."}),e.jsx("button",{onClick:async()=>{ee(!0);try{await C(),await c.testDiscord(),t.success("Webhook Discord fonctionnel !")}catch(s){t.error(s.message||"Erreur webhook")}finally{ee(!1)}},disabled:Z||!n.DISCORD_WEBHOOK,className:"btn-primary px-3 py-2 text-xs whitespace-nowrap",children:Z?e.jsx(g,{className:"w-3.5 h-3.5 animate-spin"}):"Tester"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label mb-2",children:"Notifications activées"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[{key:"nouveau_ticket",label:"Nouveau ticket",desc:"Quand un ticket est créé"},{key:"changement_statut",label:"Changement de statut",desc:"Quand un statut change"},{key:"reparation_terminee",label:"Réparation terminée",desc:"Quand une réparation est finie"},{key:"accord_client",label:"Accord client",desc:"Acceptation ou refus du devis"},{key:"connexion",label:"Connexions",desc:"Connexions / déconnexions"}].map(s=>e.jsxs("label",{className:"flex items-start gap-2.5 p-2.5 rounded-lg border border-slate-100 hover:bg-slate-50 cursor-pointer transition",children:[e.jsx("input",{type:"checkbox",checked:(n[`discord_notif_${s.key}`]||"1")!=="0",onChange:a=>i(`discord_notif_${s.key}`,a.target.checked?"1":"0"),className:"rounded border-slate-300 text-brand-600 focus:ring-brand-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-700",children:s.label}),e.jsx("p",{className:"text-[10px] text-slate-400",children:s.desc})]})]},s.key))})]})]})]}),e.jsxs("div",{className:"card p-5",children:[e.jsxs("h2",{className:"text-sm font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4 text-brand-600"})," Email"]}),e.jsxs("div",{className:"p-3 bg-brand-50 border border-brand-100 rounded-lg mb-4",children:[e.jsx("p",{className:"text-xs font-semibold text-brand-700 mb-1",children:"Resend (recommandé)"}),e.jsx("p",{className:"text-[10px] text-brand-600",children:"Créez un compte gratuit sur resend.com, récupérez votre clé API. 100 emails/jour gratuits."})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Clé API Resend"}),e.jsx("input",{value:n.RESEND_API_KEY||"re_BxiE1NX2_9qVCBVSvEAHztuFtzc8F38kr",onChange:s=>i("RESEND_API_KEY",s.target.value),className:"input font-mono text-xs",placeholder:"re_xxxxxxxx..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email expéditeur"}),e.jsx("input",{value:n.SMTP_USER||"",onChange:s=>i("SMTP_USER",s.target.value),className:"input",placeholder:"contact@klikphone.com"}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-0.5",children:"Doit correspondre au domaine vérifié sur Resend"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom affiché"}),e.jsx("input",{value:n.SMTP_NAME||"",onChange:s=>i("SMTP_NAME",s.target.value),className:"input",placeholder:"Klikphone"})]})]})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"text-[10px] text-slate-400 cursor-pointer hover:text-slate-600 mb-3",children:"SMTP avancé (fallback si Resend non configuré)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Serveur SMTP"}),e.jsx("input",{value:n.SMTP_HOST||"",onChange:s=>i("SMTP_HOST",s.target.value),className:"input",placeholder:"ex4.mail.ovh.net"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Port"}),e.jsx("input",{value:n.SMTP_PORT||"",onChange:s=>i("SMTP_PORT",s.target.value),className:"input",placeholder:"465"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"input-label",children:"Mot de passe SMTP"}),e.jsx("input",{type:"password",value:n.SMTP_PASSWORD||"",onChange:s=>i("SMTP_PASSWORD",s.target.value),className:"input"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100",children:[e.jsx("label",{className:"input-label mb-1",children:"Envoyer un email de test"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:M,onChange:s=>_e(s.target.value),className:"input flex-1",placeholder:"destinataire@email.com",type:"email"}),e.jsxs("button",{onClick:async()=>{if(!M.trim()){t.error("Saisissez une adresse email de test");return}de(!0);try{await C();const s=await c.testSmtpEmail(M.trim());s.status==="ok"?t.success(s.message||"Email de test envoyé !"):t.error(s.message||"Erreur envoi")}catch(s){t.error(s.message||"Erreur test email")}finally{de(!1)}},disabled:oe||!M.trim(),className:"btn-primary px-4 text-xs whitespace-nowrap",children:[oe?e.jsx(g,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ls,{className:"w-3.5 h-3.5"}),"Envoyer un email de test"]})]})]})]}),e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Chat & Assistant IA"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Cle API Anthropic"}),e.jsx("input",{type:"password",value:n.ANTHROPIC_API_KEY||"",onChange:s=>i("ANTHROPIC_API_KEY",s.target.value),className:"input font-mono text-xs",placeholder:"sk-ant-..."}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"Necessaire pour l'assistant IA. Obtenir sur console.anthropic.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Modele Claude (optionnel)"}),e.jsx("input",{value:n.ANTHROPIC_MODEL||"",onChange:s=>i("ANTHROPIC_MODEL",s.target.value),className:"input text-xs",placeholder:"claude-sonnet-4-5-20250929"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:C,disabled:j,className:"btn-primary",children:[j?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(N,{className:"w-4 h-4"}),"Enregistrer"]})})]}),d==="fidelite"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Programme de fidélité"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:"Activer le programme fidélité"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Les clients cumulent des points sur chaque réparation"})]}),e.jsx("button",{onClick:()=>i("fidelite_active",(n.fidelite_active||"1")==="1"?"0":"1"),className:`relative w-11 h-6 rounded-full transition-colors ${(n.fidelite_active||"1")==="1"?"bg-brand-600":"bg-slate-300"}`,children:e.jsx("span",{className:`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform ${(n.fidelite_active||"1")==="1"?"translate-x-5":"translate-x-0"}`})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Points par euro dépensé"}),e.jsx("input",{type:"number",value:n.fidelite_points_par_euro||"10",onChange:s=>i("fidelite_points_par_euro",s.target.value),className:"input",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Palier film verre trempé (pts)"}),e.jsx("input",{type:"number",value:n.fidelite_palier_film||"1000",onChange:s=>i("fidelite_palier_film",s.target.value),className:"input",min:"100",step:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Palier réduction (pts)"}),e.jsx("input",{type:"number",value:n.fidelite_palier_reduction||"5000",onChange:s=>i("fidelite_palier_reduction",s.target.value),className:"input",min:"100",step:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Montant réduction (€)"}),e.jsx("input",{type:"number",value:n.fidelite_montant_reduction||"10",onChange:s=>i("fidelite_montant_reduction",s.target.value),className:"input",min:"1"})]})]})]})]}),e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Jeu de grattage"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:"Activer le jeu de grattage"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Un ticket grattable sur la page de suivi client"})]}),e.jsx("button",{onClick:()=>i("grattage_actif",(n.grattage_actif||"1")==="1"?"0":"1"),className:`relative w-11 h-6 rounded-full transition-colors ${(n.grattage_actif||"1")==="1"?"bg-brand-600":"bg-slate-300"}`,children:e.jsx("span",{className:`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform ${(n.grattage_actif||"1")==="1"?"translate-x-5":"translate-x-0"}`})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Fréquence de gain (1 gagnant tous les N tickets)"}),e.jsx("input",{type:"number",value:n.grattage_frequence||"10",onChange:s=>i("grattage_frequence",s.target.value),className:"input w-40",min:"2"}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"Ex: 10 = en moyenne 1 gagnant sur 10 tickets grattés"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:C,disabled:j,className:"btn-primary",children:[j?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(N,{className:"w-4 h-4"}),"Enregistrer"]})})]}),d==="caisse"&&e.jsx("div",{className:"space-y-5",children:e.jsxs("div",{className:"card p-5",children:[e.jsxs("h3",{className:"font-bold text-sm text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-brand-600"})," Caisse Enregistreuse"]}),e.jsxs("label",{className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.CAISSE_ENABLED==="1",onChange:s=>x(a=>({...a,CAISSE_ENABLED:s.target.checked?"1":"0"})),className:"rounded border-slate-300 text-brand-600 focus:ring-brand-500 w-5 h-5"}),e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"Activer l'intégration Caisse Enregistreuse"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email de connexion"}),e.jsx("input",{value:m.CAISSE_LOGIN||"",onChange:s=>x(a=>({...a,CAISSE_LOGIN:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Token API (APIKEY)"}),e.jsx("input",{value:m.CAISSE_APIKEY||"",onChange:s=>x(a=>({...a,CAISSE_APIKEY:s.target.value})),className:"input font-mono text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Mot de passe"}),e.jsx("input",{type:"password",value:m.CAISSE_PASSWORD||"",onChange:s=>x(a=>({...a,CAISSE_PASSWORD:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"ID Boutique (SHOPID)"}),e.jsx("input",{value:m.CAISSE_SHOPID||"",onChange:s=>x(a=>({...a,CAISSE_SHOPID:s.target.value})),className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"ID Carte bancaire"}),e.jsx("input",{value:m.CAISSE_CB_ID||"",onChange:s=>x(a=>({...a,CAISSE_CB_ID:s.target.value})),className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"ID Espèces"}),e.jsx("input",{value:m.CAISSE_ESP_ID||"",onChange:s=>x(a=>({...a,CAISSE_ESP_ID:s.target.value})),className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"ID Caisse (GENERALE)"}),e.jsx("input",{value:m.CAISSE_ID||"",onChange:s=>x(a=>({...a,CAISSE_ID:s.target.value})),className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"ID Utilisateur"}),e.jsx("input",{value:m.CAISSE_USER_ID||"",onChange:s=>x(a=>({...a,CAISSE_USER_ID:s.target.value})),className:"input font-mono"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-5",children:[e.jsxs("button",{onClick:async()=>{ce(!0);try{await c.saveCaisseConfig(m);const s=await c.testCaisseConnexion();s.status==="ok"?t.success(s.message||"Connexion réussie"):t.error(s.message||"Erreur connexion")}catch(s){t.error(s.message||"Erreur test connexion")}finally{ce(!1)}},disabled:ie,className:"btn-secondary",children:[ie?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(ns,{className:"w-4 h-4"}),"Tester la connexion"]}),e.jsxs("button",{onClick:async()=>{re(!0);try{await c.saveCaisseConfig(m),t.success("Configuration caisse enregistrée")}catch{t.error("Erreur sauvegarde")}finally{re(!1)}},disabled:ne,className:"btn-primary",children:[ne?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(N,{className:"w-4 h-4"}),"Enregistrer"]})]})]})}),d==="security"&&e.jsx("div",{className:"space-y-5",children:e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Changer le PIN d'accès"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Espace"}),e.jsxs("select",{value:h.target,onChange:s=>A(a=>({...a,target:s.target.value})),className:"input",children:[e.jsx("option",{value:"accueil",children:"Accueil"}),e.jsx("option",{value:"tech",children:"Technicien"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Ancien PIN"}),e.jsx("input",{type:"password",value:h.old_pin,onChange:s=>A(a=>({...a,old_pin:s.target.value})),className:"input font-mono text-center tracking-widest",maxLength:4,placeholder:"····"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nouveau PIN"}),e.jsx("input",{type:"password",value:h.new_pin,onChange:s=>A(a=>({...a,new_pin:s.target.value})),className:"input font-mono text-center tracking-widest",maxLength:4,placeholder:"····"})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{onClick:Pe,disabled:te||h.old_pin.length!==4||h.new_pin.length!==4,className:"btn-primary",children:[te?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(rs,{className:"w-4 h-4"}),"Changer le PIN"]})})]})}),d==="appearance"&&e.jsx("div",{className:"space-y-5",children:e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Apparence"}),e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-800",children:"Activer les animations"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:"Transitions, effets de survol, apparitions progressives"})]}),e.jsx("button",{onClick:()=>Ce(!P),className:`relative w-11 h-6 rounded-full transition-colors ${P?"bg-brand-600":"bg-slate-300"}`,children:e.jsx("span",{className:`absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow-sm transition-transform ${P?"translate-x-5":"translate-x-0"}`})})]}),e.jsx("p",{className:"text-[11px] text-slate-400 mt-2 pt-3 border-t border-slate-100",children:"Désactivez les animations pour améliorer la fluidité sur les appareils plus lents."})]})}),d==="backup"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Export clients"}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Téléchargez la liste de tous les clients (avec nombre de tickets)."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Re,className:"btn-primary",children:[e.jsx(fe,{className:"w-4 h-4"})," CSV"]}),e.jsxs("button",{onClick:Be,className:"btn-primary",children:[e.jsx(fe,{className:"w-4 h-4"})," Excel (.xlsx)"]})]})]}),e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Sauvegarde complète"}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Téléchargez un backup JSON complet de la base de données (clients, tickets, config, équipe, catalogue)."}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:Oe,className:"btn-primary",children:[e.jsx(be,{className:"w-4 h-4"})," Télécharger le backup (JSON)"]})})]}),e.jsxs("div",{className:"card p-5",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Restaurer un backup"}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Importez un fichier JSON de backup pour restaurer les données. Attention : cela remplacera toutes les données actuelles."}),e.jsxs("label",{className:"btn-primary cursor-pointer inline-flex",children:[e.jsx(is,{className:"w-4 h-4"})," Importer un backup (.json)",e.jsx("input",{type:"file",accept:".json",onChange:Le,className:"hidden"})]})]})]})]})}export{xs as default};
