import{a as O,j as e}from"./index-rOq63TUo.js";import{r as i}from"./vendor-react-DMwujlca.js";import{T as W,at as fe,h as ue,a as pe,C as Z,J as ee,au as P,av as $,aw as A,b as M,P as D,ax as he,r as be}from"./vendor-icons-odwehDaL.js";const ge={Apple:{bg:"#18181b",text:"#fff",logo:"apple"},Samsung:{bg:"#2563eb",text:"#fff",logo:"samsung"},Xiaomi:{bg:"#ea580c",text:"#fff",logo:"xiaomi"},Huawei:{bg:"#dc2626",text:"#fff",logo:"huawei"},Honor:{bg:"#6d28d9",text:"#fff",logo:"honor"},Google:{bg:"#16a34a",text:"#fff",logo:"google"},Oppo:{bg:"#059669",text:"#fff",logo:"oppo"},OnePlus:{bg:"#dc2626",text:"#fff",logo:"oneplus"},Motorola:{bg:"#0891b2",text:"#fff",logo:"motorola"},Nothing:{bg:"#18181b",text:"#fff",logo:"nothing"},Realme:{bg:"#d97706",text:"#fff",logo:"realme"},Vivo:{bg:"#1d4ed8",text:"#fff",logo:"vivo"}},je={bg:"#6d28d9",text:"#fff",logo:null};function Ne({slug:m,size:p=18}){const[u,j]=i.useState(!1);return!m||u?e.jsx(M,{className:"w-[18px] h-[18px] opacity-70"}):e.jsx("img",{src:`https://cdn.simpleicons.org/${m}/ffffff`,alt:"",width:p,height:p,className:"shrink-0",style:{filter:"brightness(1)",minWidth:p},onError:()=>j(!0)})}const ve={Original:{color:"#047857",bg:"#ecfdf5",border:"#a7f3d0"},"Soft OLED":{color:"#6d28d9",bg:"#f5f3ff",border:"#c4b5fd"},OLED:{color:"#1d4ed8",bg:"#eff6ff",border:"#93c5fd"},Incell:{color:"#b45309",bg:"#fffbeb",border:"#fcd34d"},LCD:{color:"#52525b",bg:"#f4f4f5",border:"#d4d4d8"},Reconditionnee:{color:"#0e7490",bg:"#ecfeff",border:"#67e8f9"},Compatible:{color:"#be123c",bg:"#fff1f2",border:"#fda4af"}},ye={color:"#52525b",bg:"#f4f4f5",border:"#d4d4d8"},I=["Apple","Samsung","Xiaomi","Huawei","Honor","Google","Oppo","OnePlus","Motorola","Nothing","Realme","Vivo"],we=["Toutes",...I],ke={ecran:M,batterie:P,connecteur:$,camera:A,vitre:D,"haut-parleur":be,ecouteur:he},T={batterie:{color:"#047857",bg:"#ecfdf5",border:"#a7f3d0"},"connecteur de charge":{color:"#1d4ed8",bg:"#eff6ff",border:"#93c5fd"},"camera arriere":{color:"#b45309",bg:"#fffbeb",border:"#fcd34d"},"vitre arriere":{color:"#7c3aed",bg:"#f5f3ff",border:"#c4b5fd"},"haut-parleur":{color:"#0f766e",bg:"#f0fdfa",border:"#99f6e4"},"ecouteur interne":{color:"#be185d",bg:"#fdf2f8",border:"#f9a8d4"},"vitre camera arriere":{color:"#4338ca",bg:"#eef2ff",border:"#a5b4fc"}},Ce={color:"#52525b",bg:"#f4f4f5",border:"#d4d4d8"};function se(m){const p=(m||"").toLowerCase();for(const[u,j]of Object.entries(ke))if(p.includes(u))return j;return D}function te(m){const p=(m||"").toLowerCase();for(const[u,j]of Object.entries(T))if(p.includes(u))return j;return Ce}function v(m){return m==null?null:`${m} €`}function Te(){const[m,p]=i.useState([]),[u,j]=i.useState(null),[F,U]=i.useState(!0),[y,re]=i.useState(""),[N,oe]=i.useState("Toutes"),[le,C]=i.useState(new Set),[ae,H]=i.useState(new Set),[_,V]=i.useState(!1),[S,G]=i.useState(!1),[f,k]=i.useState(null);i.useEffect(()=>{E()},[]);async function E(){U(!0);try{const[s,r]=await Promise.all([O.getTarifs(),O.getTarifsStats()]);p(s),j(r)}catch(s){console.error("Erreur chargement tarifs:",s)}finally{U(!1)}}async function ne(s){try{const r=await O.toggleTarifStock(s);p(t=>t.map(n=>n.id===s?{...n,en_stock:r.en_stock}:n))}catch(r){console.error("Erreur toggle stock:",r)}}async function ce(){G(!0),k(null);try{const s=await O.checkTarifStock();k(s),await E()}catch(s){console.error("Erreur check stock:",s),k({error:!0})}finally{G(!1)}}const Y=i.useMemo(()=>{let s=m;if(N!=="Toutes"&&(s=s.filter(r=>r.marque===N)),y.trim()){const r=y.toLowerCase();s=s.filter(t=>(t.marque||"").toLowerCase().includes(r)||(t.modele||"").toLowerCase().includes(r)||(t.type_piece||"").toLowerCase().includes(r)||(t.qualite||"").toLowerCase().includes(r))}return s},[m,N,y]),b=i.useMemo(()=>{const s={};for(const t of Y)s[t.marque]||(s[t.marque]={}),s[t.marque][t.modele]||(s[t.marque][t.modele]=[]),s[t.marque][t.modele].push(t);return Object.keys(s).sort((t,n)=>{const x=I.indexOf(t),h=I.indexOf(n);return x>=0&&h>=0?x-h:x>=0?-1:h>=0?1:t.localeCompare(n)}).map(t=>({brand:t,models:Object.entries(s[t]).sort(([n],[x])=>n.localeCompare(x)).map(([n,x])=>({model:n,items:x}))}))},[Y]);i.useEffect(()=>{y.trim()&&C(new Set(b.map(s=>s.brand)))},[y,b]),i.useEffect(()=>{N!=="Toutes"&&C(new Set([N]))},[N]);function ie(s){C(r=>{const t=new Set(r);return t.has(s)?t.delete(s):t.add(s),t})}function de(s){H(r=>{const t=new Set(r);return t.has(s)?t.delete(s):t.add(s),t})}function X({tarif:s}){const r=s.en_stock!==!1;return e.jsx("button",{onClick:t=>{t.stopPropagation(),ne(s.id)},className:`inline-flex items-center gap-1 text-[9px] font-bold px-1.5 py-0.5 rounded-md transition-all cursor-pointer ${r?"bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border border-emerald-200":"bg-red-50 text-red-600 hover:bg-red-100 border border-red-200"}`,title:r?"En stock — cliquer pour marquer en rupture":"Rupture — cliquer pour remettre en stock",children:r?"En stock":"Rupture"})}function xe(s){const r=s.filter(d=>{const c=(d.type_piece||"").toLowerCase();return c.includes("ecran")||c.includes("ecran")}),t=new Set(r.map(d=>d.qualite).filter(Boolean)).size,n=d=>{const c=s.filter(o=>(o.type_piece||"").toLowerCase().includes(d));if(!c.length)return null;const l=c.map(o=>o.prix_client);return Math.min(...l)},x=s.filter(d=>!(d.type_piece||"").toLowerCase().includes("ecran")),h={};for(const d of x){const c=d.type_piece;h[c]||(h[c]=[]),h[c].push(d)}const R=s.filter(d=>d.en_stock===!1).length;return{qualityCount:t,screenItems:r,batterie:n("batter"),connecteur:n("connect"),camera:n("cam"),otherByType:h,outOfStock:R}}const L=b.reduce((s,r)=>s+r.models.length,0);function q({value:s,icon:r,color:t}){return s==null?null:e.jsxs("span",{className:"hidden sm:inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-lg font-semibold border",style:{background:t.bg,color:t.color,borderColor:t.border},children:[e.jsx(r,{className:"w-3 h-3"}),v(s)]})}function z({value:s,icon:r,color:t}){return s==null?null:e.jsxs("span",{className:"inline-flex items-center gap-0.5 text-[9px] px-1.5 py-0.5 rounded-md font-bold",style:{background:t.bg,color:t.color},children:[e.jsx(r,{className:"w-2.5 h-2.5"}),v(s)]})}const Q=T.batterie,J=T["connecteur de charge"],K=T["camera arriere"];return e.jsxs("div",{className:"min-h-screen bg-zinc-50 pb-20",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 sticky top-0 z-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-100 flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-zinc-900",children:"Grille Tarifaire"}),e.jsx("p",{className:"text-xs text-zinc-500",children:u?`${u.modeles} modeles · ${u.marques} marques · ${v(u.prix_min)} → ${v(u.prix_max)}`:"Chargement..."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ce,disabled:S||_,className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-medium transition-colors disabled:opacity-50",children:[e.jsx(fe,{className:`w-4 h-4 ${S?"animate-pulse":""}`}),e.jsx("span",{className:"hidden sm:inline",children:S?"Verification...":"Verifier stock"})]}),e.jsxs("button",{onClick:async()=>{V(!0),await E(),V(!1)},disabled:_||S,className:"flex items-center gap-2 px-4 py-2 rounded-xl bg-violet-600 hover:bg-violet-700 text-white text-sm font-medium transition-colors disabled:opacity-50",children:[e.jsx(ue,{className:`w-4 h-4 ${_?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:_?"Chargement...":"Actualiser"})]})]})]}),f&&!f.error&&e.jsx("div",{className:"mt-3 p-3 rounded-xl bg-emerald-50 border border-emerald-200 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-emerald-800",children:[e.jsx("span",{className:"font-semibold",children:f.models_found})," modeles trouves sur Mobilax"," / ",e.jsx("span",{className:"font-semibold",children:f.models_checked})," verifies"," — ",e.jsx("span",{className:"font-semibold",children:f.tarifs_updated})," mises a jour",f.now_rupture>0&&e.jsxs("span",{className:"text-red-600 font-semibold ml-2",children:["(",f.now_rupture," ruptures)"]}),f.now_in_stock>0&&e.jsxs("span",{className:"text-emerald-600 font-semibold ml-2",children:["(",f.now_in_stock," retour en stock)"]})]}),e.jsx("button",{onClick:()=>k(null),className:"text-emerald-400 hover:text-emerald-600 text-xs",children:"×"})]})}),(f==null?void 0:f.error)&&e.jsxs("div",{className:"mt-3 p-3 rounded-xl bg-red-50 border border-red-200 text-sm text-red-700",children:["Erreur lors de la verification du stock.",e.jsx("button",{onClick:()=>k(null),className:"ml-2 text-red-400 hover:text-red-600 text-xs",children:"×"})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher un modele...",value:y,onChange:s=>re(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 bg-zinc-50 text-sm focus:outline-none focus:ring-2 focus:ring-violet-500/30 focus:border-violet-400 transition-all"})]}),e.jsx("div",{className:"flex gap-1.5 overflow-x-auto scrollbar-none pb-0.5",children:we.filter(s=>s==="Toutes"||b.some(r=>r.brand===s)).map(s=>e.jsx("button",{onClick:()=>{oe(s),s==="Toutes"&&(C(new Set),H(new Set))},className:`px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap transition-all ${N===s?"bg-zinc-900 text-white shadow-sm":"bg-white border border-slate-200 text-zinc-600 hover:bg-zinc-100"}`,children:s},s))})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-4",children:F?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"w-10 h-10 border-2 border-violet-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-sm text-zinc-500",children:"Chargement des tarifs..."})]}):b.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(W,{className:"w-12 h-12 text-zinc-300 mx-auto mb-4"}),e.jsx("p",{className:"text-zinc-500 text-sm",children:"Aucun tarif trouve"}),e.jsx("p",{className:"text-zinc-400 text-xs mt-1",children:"Importez des tarifs ou modifiez vos filtres"})]}):b.map(({brand:s,models:r})=>{const t=ge[s]||je,n=le.has(s);return e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[e.jsxs("button",{onClick:()=>ie(s),className:"w-full px-5 py-3.5 flex items-center justify-between cursor-pointer transition-opacity hover:opacity-90",style:{background:t.bg,color:t.text},children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[n?e.jsx(Z,{className:"w-4 h-4 opacity-70"}):e.jsx(ee,{className:"w-4 h-4 opacity-70"}),e.jsx(Ne,{slug:t.logo}),e.jsx("span",{className:"font-bold text-sm tracking-wide",children:s})]}),e.jsxs("span",{className:"text-xs opacity-75 font-medium",children:[r.length," modele",r.length>1?"s":""]})]}),n&&e.jsxs("div",{children:[e.jsxs("div",{className:"hidden sm:flex items-center px-5 py-2 bg-zinc-100/80 border-b border-slate-200 text-[10px] font-semibold text-zinc-500 uppercase tracking-wider",children:[e.jsx("div",{className:"flex-1 pl-7",children:"Modele"}),e.jsx("div",{className:"text-right pr-1",children:"Pieces disponibles"})]}),r.map(({model:x,items:h},R)=>{const d=`${s}::${x}`,c=ae.has(d),l=xe(h);return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>de(d),className:`w-full flex items-center px-5 py-3 text-left transition-colors
                              ${R%2===0?"bg-white":"bg-zinc-50/50"}
                              ${c?"!bg-violet-50/60":"hover:bg-violet-50/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[c?e.jsx(Z,{className:"w-3.5 h-3.5 text-violet-500 shrink-0"}):e.jsx(ee,{className:"w-3.5 h-3.5 text-zinc-400 shrink-0"}),e.jsx("span",{className:"font-semibold text-[13px] text-zinc-900 truncate",children:x}),l.qualityCount>0&&e.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded-md whitespace-nowrap font-medium ${c?"bg-violet-100 text-violet-700":"bg-zinc-100 text-zinc-500"}`,children:[l.qualityCount," qualite",l.qualityCount>1?"s":""," ",c?"▼":"▶"]}),l.outOfStock>0&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded-md bg-red-50 text-red-600 border border-red-200 font-bold whitespace-nowrap",children:[l.outOfStock," rupture",l.outOfStock>1?"s":""]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-1.5 shrink-0",children:[e.jsx(q,{value:l.batterie,icon:P,color:Q}),e.jsx(q,{value:l.connecteur,icon:$,color:J}),e.jsx(q,{value:l.camera,icon:A,color:K})]}),e.jsxs("div",{className:"flex sm:hidden items-center gap-1 shrink-0 ml-2",children:[e.jsx(z,{value:l.batterie,icon:P,color:Q}),e.jsx(z,{value:l.connecteur,icon:$,color:J}),e.jsx(z,{value:l.camera,icon:A,color:K})]})]}),c&&e.jsxs("div",{className:"px-5 py-4 bg-violet-50/30 border-t border-violet-100/50",children:[Object.keys(l.otherByType).length>0&&e.jsx("div",{className:"sm:hidden flex flex-wrap gap-2 mb-4",children:Object.entries(l.otherByType).map(([o,g])=>{const a=te(o),B=se(o);return e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border text-xs ${g[0].en_stock===!1?"opacity-50":""}`,style:{background:a.bg,borderColor:g[0].en_stock===!1?"#fca5a5":a.border},children:[e.jsx(B,{className:"w-3 h-3",style:{color:a.color}}),e.jsx("span",{className:"font-medium",style:{color:a.color},children:o}),e.jsx("span",{className:"font-bold",style:{color:a.color},children:v(g[0].prix_client)}),g[0].en_stock===!1&&e.jsx("span",{className:"text-[8px] text-red-500 font-bold",children:"RUPTURE"})]},o)})}),l.screenItems.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(M,{className:"w-4 h-4 text-violet-500"}),e.jsx("span",{className:"text-[11px] font-semibold text-zinc-600 uppercase tracking-wide",children:"Ecrans disponibles"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2.5",children:l.screenItems.map((o,g)=>{const a=ve[o.qualite]||ye;return e.jsxs("div",{className:`rounded-xl border-2 p-3 transition-all hover:shadow-md hover:scale-[1.02] ${o.en_stock===!1?"opacity-50":""}`,style:{background:a.bg,borderColor:o.en_stock===!1?"#fca5a5":a.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full shrink-0",style:{background:a.color}}),e.jsx("span",{className:"text-[11px] font-bold",style:{color:a.color},children:o.qualite||"Standard"})]}),e.jsx(X,{tarif:o})]}),e.jsx("div",{className:"text-2xl font-extrabold leading-none",style:{color:a.color},children:v(o.prix_client)}),o.prix_fournisseur_ht!=null&&e.jsxs("div",{className:"text-[10px] mt-1.5 opacity-50",style:{color:a.color},children:["Achat : ",Number(o.prix_fournisseur_ht).toFixed(2)," € HT"]})]},g)})})]}),Object.keys(l.otherByType).length>0&&e.jsxs("div",{className:"hidden sm:block mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(D,{className:"w-4 h-4 text-indigo-400"}),e.jsx("span",{className:"text-[11px] font-semibold text-zinc-600 uppercase tracking-wide",children:"Autres pieces"})]}),e.jsx("div",{className:"grid grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2.5",children:Object.entries(l.otherByType).map(([o,g])=>{const a=te(o),B=se(o);return g.map((w,me)=>e.jsxs("div",{className:`rounded-xl border-2 p-3 hover:shadow-md transition-all hover:scale-[1.02] ${w.en_stock===!1?"opacity-50":""}`,style:{background:a.bg,borderColor:w.en_stock===!1?"#fca5a5":a.border},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(B,{className:"w-3.5 h-3.5",style:{color:a.color}}),e.jsx("span",{className:"text-[10px] font-bold uppercase",style:{color:a.color},children:o})]}),e.jsx(X,{tarif:w})]}),e.jsx("div",{className:"text-lg font-extrabold",style:{color:a.color},children:v(w.prix_client)}),w.prix_fournisseur_ht!=null&&e.jsxs("div",{className:"text-[10px] mt-1 opacity-60",style:{color:a.color},children:["Achat : ",Number(w.prix_fournisseur_ht).toFixed(2)," € HT"]})]},`${o}-${me}`))})})]})]})]},x)})]})]},s)})}),!F&&L>0&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6",children:e.jsx("div",{className:"text-center text-xs text-zinc-400 space-y-1",children:e.jsxs("p",{children:[L," ",`modèle${L>1?"s":""}`," ","·"," ",b.length," ",`marque${b.length>1?"s":""}`," ","·"," Source : Mobilax"]})})})]})}export{Te as default};
