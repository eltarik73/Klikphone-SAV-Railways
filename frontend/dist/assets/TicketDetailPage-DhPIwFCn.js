import{c as b,j as e,w as wt,s as yt,d as _t,u as Ct,a as xs,g as X,b as F,e as ps,P as us,F as hs,S as bs,h as Re}from"./index-CciZrgyL.js";import{r as o,u as kt,c as gs}from"./vendor-react-DMwujlca.js";import{P as fs}from"./PatternGrid-C-0mF5rd.js";import{Y as pt,Z as js,_ as St,F as Et,X as K,$ as Tt,a0 as Ns,r as Ne,C as Pt,n as ve,N as we,a1 as vs,a2 as ws,a3 as ys,a4 as ce,m as ie,a5 as $t,W as ye,a6 as _s,l as fe,a7 as At,a8 as Mt,a9 as Cs,aa as _e,ab as ks,I as Ss,c as Fe,A as Le,ac as ut,ad as Es,p as ht,ae as je,P as bt,D as ae,af as ge,ag as gt,ah as Ts,ai as Ps,L as ft,a as $s,y as As,K as Ms,w as Ds}from"./vendor-icons-mT05O4Nk.js";const jt=[{type:"client",label:"Client",desc:"Re√ßu de d√©p√¥t",icon:pt},{type:"staff",label:"Atelier",desc:"Fiche technicien",icon:js},{type:"combined",label:"Double",desc:"Client + Atelier",icon:St},{type:"devis",label:"Devis",desc:"Devis d√©taill√©",icon:Et},{type:"recu",label:"Re√ßu",desc:"Re√ßu de paiement",icon:pt}],Nt=new Set(["devis","recu"]);function Rs({open:i,onClose:p,ticketId:l,ticketCode:c,clientTel:m,clientEmail:N}){const[d,j]=o.useState("client"),y=o.useRef(null),[C,k]=o.useState(!0),[f,v]=o.useState(!1),[O,T]=o.useState(!1),[U,Y]=o.useState(!1),[P,L]=o.useState(null),[A,I]=o.useState(!1),q=b.getPrintUrl(l,d),E=jt.find(g=>g.type===d),W=Nt.has(d),z=W&&A;o.useEffect(()=>(i?(j("client"),I(!1),L(null),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[i]),o.useEffect(()=>{i&&(k(!0),I(!1))},[d]),o.useEffect(()=>{i&&k(!0)},[A]),o.useEffect(()=>{if(!P)return;const g=setTimeout(()=>L(null),4e3);return()=>clearTimeout(g)},[P]);const J=async()=>{v(!0);try{const D=await(await fetch(q)).text(),V=window.open("","_blank");if(!V){window.open(q,"_blank");return}V.document.write(D),V.document.close(),V.focus(),setTimeout(()=>{V.print()},300)}catch{window.open(q,"_blank")}finally{v(!1)}},u=()=>{window.open(q,"_blank")},w=()=>{window.open(b.getPdfUrl(l,d),"_blank")},_=()=>z?b.getSharePdfUrl(l,d):b.getSharePrintUrl(l,d),B=()=>{if(!m)return;const g=_(),D=`Bonjour, voici votre ${(E==null?void 0:E.desc)||"document"} pour le ticket ${c}.

${g.trim()}`;window.open(wt(m,D),"_blank"),T(!1)},S=()=>{if(!m)return;const g=_(),D=`Klikphone - ${(E==null?void 0:E.desc)||"document"} ${c}
${g.trim()}`;window.open(yt(m,D),"_blank"),T(!1)},$=async()=>{if(N){Y(!0);try{const g=await b.sendDocument(l,d,N);g.status==="ok"?(T(!1),L({type:"success",message:`Email envoy√© avec succ√®s √† ${N}`})):L({type:"error",message:g.detail||"Erreur lors de l'envoi de l'email"})}catch{L({type:"error",message:"Erreur lors de l'envoi de l'email"})}finally{Y(!1)}}};return i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 transition-opacity",onClick:p}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full sm:w-[520px] lg:w-[600px] bg-white shadow-2xl z-50 flex flex-col animate-in",style:{animationName:"slideInRight",animationDuration:"300ms"},children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-slate-100 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-display font-bold text-slate-900",children:"Impression"}),e.jsxs("p",{className:"text-xs text-slate-400 mt-0.5",children:["Ticket ",c]})]}),e.jsx("button",{onClick:p,className:"p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex gap-1 px-5 py-3 border-b border-slate-100 overflow-x-auto scrollbar-none shrink-0 bg-slate-50/50",children:jt.map(({type:g,label:D,icon:V})=>e.jsxs("button",{onClick:()=>{j(g),k(!0)},className:`flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap transition-all ${d===g?"bg-brand-600 text-white shadow-sm shadow-brand-600/25":"text-slate-500 hover:bg-white hover:text-slate-700 hover:shadow-sm"}`,children:[e.jsx(V,{className:"w-3.5 h-3.5"}),D,e.jsx("span",{className:`text-[9px] px-1 py-0.5 rounded ${d===g?"bg-white/20":"bg-slate-200 text-slate-500"}`,children:d===g&&A&&Nt.has(g)?"A4":"80mm"})]},g))}),e.jsxs("div",{className:"flex-1 relative bg-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"absolute top-3 left-3 z-10 flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-semibold px-2 py-1 rounded-md shadow-sm bg-slate-800 text-white",children:z?"PDF A4":"THERMIQUE 80mm"}),W&&e.jsx("button",{onClick:()=>{I(!A),k(!0)},className:`text-[10px] font-semibold px-2 py-1 rounded-md shadow-sm transition-colors ${A?"bg-brand-600 text-white":"bg-white text-slate-600 border border-slate-200"}`,children:A?"Passer en 80mm":"Passer en A4"})]}),C&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-100 z-10",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Chargement de l'aper√ßu..."})]})}),e.jsx("div",{className:"h-full overflow-auto flex justify-center pt-4 pb-8",children:e.jsx("div",{className:`bg-white shadow-xl rounded-lg overflow-hidden shrink-0 ${z?"w-[480px]":"w-[320px]"}`,children:e.jsx("iframe",{ref:y,src:z?b.getPdfUrl(l,d):q,className:"w-full h-full border-0",style:{minHeight:"600px"},title:`Aper√ßu ${E==null?void 0:E.label}`,onLoad:()=>k(!1)})})})]}),e.jsxs("div",{className:"px-5 py-4 border-t border-slate-100 bg-white shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:J,disabled:f,className:`flex-1 justify-center ${z?"btn-ghost border border-slate-200":"btn-primary shadow-lg shadow-brand-600/20"}`,children:[e.jsx(Tt,{className:"w-4 h-4"}),f?"Ouverture...":"Imprimer 80mm"]}),W&&e.jsxs("button",{onClick:w,className:`${z?"btn-primary shadow-lg shadow-brand-600/20":"btn-ghost border border-slate-200"} flex-1 justify-center`,children:[e.jsx(Ns,{className:"w-4 h-4"}),"PDF A4"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>T(!O),className:"btn-ghost border border-slate-200 px-3 gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx(Pt,{className:"w-3 h-3"})]}),O&&e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-white rounded-lg shadow-xl border border-slate-200 py-1 z-50",children:[e.jsxs("button",{onClick:B,disabled:!m,className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:opacity-40",children:[e.jsx(ve,{className:"w-4 h-4 text-green-600"}),"WhatsApp"]}),e.jsxs("button",{onClick:S,disabled:!m,className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:opacity-40",children:[e.jsx(Ne,{className:"w-4 h-4 text-blue-600"}),"SMS"]}),e.jsxs("button",{onClick:$,disabled:!N||U,className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 disabled:opacity-40",children:[e.jsx(we,{className:"w-4 h-4 text-red-500"}),U?"Envoi...":z?"Email (PDF)":"Email"]})]})]}),e.jsx("button",{onClick:u,className:"btn-ghost border border-slate-200 px-3",title:"Ouvrir dans un nouvel onglet",children:e.jsx(vs,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-[10px] text-slate-400 text-center mt-2",children:z?"Document PDF format A4 professionnel":"Format optimis√© pour imprimante thermique 80mm"})]})]}),P&&e.jsx("div",{className:"fixed inset-x-0 bottom-24 z-[60] flex justify-center pointer-events-none",children:e.jsxs("div",{className:`pointer-events-auto flex items-center gap-3 px-5 py-3 rounded-xl shadow-2xl border transition-all ${P.type==="success"?"bg-emerald-600 border-emerald-700 text-white":"bg-red-600 border-red-700 text-white"}`,style:{animation:"toastIn 300ms ease-out"},children:[P.type==="success"?e.jsx(ws,{className:"w-5 h-5 shrink-0"}):e.jsx(ys,{className:"w-5 h-5 shrink-0"}),e.jsx("span",{className:"text-sm font-semibold",children:P.message}),e.jsx("button",{onClick:()=>L(null),className:"ml-2 p-0.5 rounded hover:bg-white/20",children:e.jsx(K,{className:"w-4 h-4"})})]})}),e.jsx("style",{children:`
        @keyframes slideInRight {
          from { transform: translateX(100%); }
          to { transform: translateX(0); }
        }
        @keyframes toastIn {
          from { transform: translateY(20px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
      `})]}):null}const Fs=[{id:1,label:"Appareil recu",message:"Bonjour {prenom}, votre {appareil} a bien ete pris en charge sous le numero {code}. Nous vous tiendrons informe de l'avancement. Klikphone 04 79 60 89 22"},{id:2,label:"Diagnostic en cours",message:"Bonjour {prenom}, le diagnostic de votre {appareil} est en cours. Nous reviendrons vers vous rapidement. Klikphone"},{id:3,label:"Devis a valider",message:"Bonjour {prenom}, le devis pour votre {appareil} est de {montant} EUR. Merci de nous confirmer votre accord. Klikphone 04 79 60 89 22"},{id:4,label:"En cours de reparation",message:"Bonjour {prenom}, la reparation de votre {appareil} est en cours. Klikphone"},{id:5,label:"Attente piece",message:"Bonjour {prenom}, nous sommes en attente d'une piece pour votre {appareil}. Nous vous previendrons des reception. Klikphone"},{id:6,label:"Appareil pret",message:"Bonjour {prenom}, votre {appareil} est pret ! Vous pouvez venir le recuperer a la boutique. Montant : {montant} EUR. Klikphone 79 Place Saint Leger, Chambery"},{id:7,label:"Commande arrivee",message:"Bonjour {prenom}, la piece commandee pour votre {appareil} est arrivee. Nous lancons la reparation. Klikphone 04 79 60 89 22"},{id:8,label:"Non reparable",message:"Bonjour {prenom}, malheureusement votre {appareil} n'est pas reparable. Vous pouvez passer recuperer votre appareil en boutique. Klikphone"},{id:9,label:"Rappel RDV",message:"Bonjour {prenom}, nous vous rappelons votre rendez-vous demain pour votre {appareil}. Klikphone 79 Place Saint Leger, Chambery"},{id:10,label:"Personnalise",message:""}],Ls={1:"üì±",2:"üîç",3:"üìã",4:"üîß",5:"‚è≥",6:"‚úÖ",7:"üì¶",8:"‚ùå",9:"üìÖ",10:"‚úèÔ∏è"};function Is({ticket:i,onMessageSent:p}){const l=_t(),{user:c}=Ct(),[m,N]=o.useState(Fs),[d,j]=o.useState(null),[y,C]=o.useState(""),[k,f]=o.useState(null);o.useEffect(()=>{b.getMessageTemplates().then(u=>{u&&u.length>0&&N(u)}).catch(()=>{})},[]);const v=i,O=v.modele_autre||`${v.marque||""} ${v.modele||""}`.trim()||"appareil",T=parseFloat(v.tarif_final)||parseFloat(v.devis_estime)||0,U=parseFloat(v.reduction_pourcentage)||0,Y=parseFloat(v.reduction_montant)||0,P=U>0?T*(U/100):Y,L=Math.max(0,T-P),A=u=>u.replace(/\{prenom\}/g,v.client_prenom||"").replace(/\{nom\}/g,v.client_nom||"").replace(/\{appareil\}/g,O).replace(/\{code\}/g,v.ticket_code||"").replace(/\{montant\}/g,String(L)).replace(/\{adresse\}/g,"79 Place Saint Leger, 73000 Chambery").replace(/\{horaires\}/g,"Lundi-Samedi 10h-19h").replace(/\{tel_boutique\}/g,"04 79 60 89 22"),I=m.find(u=>u.id===d),q=d===10,E=q?y:I?A(I.message):"",W=(u,w)=>{let _=u.replace(/[\s\-\.]/g,"");_.startsWith("0")&&(_="33"+_.substring(1)),!_.startsWith("+")&&!_.startsWith("33")&&(_="33"+_),_=_.replace("+",""),window.open(`https://wa.me/${_}?text=${encodeURIComponent(w)}`,"_blank")},z=(u,w)=>{window.open(`sms:${u}?body=${encodeURIComponent(w)}`,"_blank")},J=async u=>{if(!E.trim()){l.error("Message vide");return}f(u);try{const w=v.client_tel,_=v.client_email;if(u==="whatsapp"){if(!w){l.error("Pas de telephone");return}W(w,E)}else if(u==="sms"){if(!w){l.error("Pas de telephone");return}z(w,E)}else if(u==="email"){if(!_){l.error("Ce client n'a pas d'adresse email");return}const g=await b.envoyerEmail(_,`Klikphone SAV - ${v.ticket_code}`,E);if(g.status!=="ok"){l.error(g.message||"Erreur d'envoi email");return}}const B=(c==null?void 0:c.utilisateur)||"Accueil",$=`[${I?I.label:"Message"}] ${E.substring(0,120)}${E.length>120?"...":""}`;await b.logMessage(v.id,B,$,u),l.success(u==="email"?"Email envoy√© avec succ√®s":`Message ${u} envoy√©`),p&&p()}catch(w){l.error(w.message||"Erreur envoi"),console.error(w)}finally{f(null)}};return e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center",children:e.jsx(ve,{className:"w-4 h-4 text-green-600"})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Messages"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5 mb-3",children:m.map(u=>e.jsxs("button",{onClick:()=>j(u.id===d?null:u.id),className:`text-left px-2.5 py-2 rounded-lg text-xs font-medium transition-all border ${d===u.id?"bg-brand-50 border-brand-300 text-brand-700 shadow-sm":"bg-white border-slate-150 text-slate-600 hover:bg-slate-50 hover:border-slate-200"}`,children:[e.jsx("span",{className:"mr-1",children:Ls[u.id]||"üí¨"}),u.label]},u.id))}),d&&e.jsxs("div",{className:"animate-in",children:[q?e.jsx("textarea",{value:y,onChange:u=>C(u.target.value),placeholder:"Tapez votre message...",rows:3,className:"w-full px-3 py-2 rounded-lg border border-slate-200 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-brand-500/20 focus:border-brand-500 mb-3"}):e.jsx("div",{className:"p-3 bg-slate-50 rounded-lg text-sm text-slate-700 leading-relaxed mb-3 border border-slate-100",children:E}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>J("whatsapp"),disabled:!!k,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-green-500 hover:bg-green-600 text-white text-xs font-bold transition-colors disabled:opacity-50",children:[k==="whatsapp"?e.jsx(ce,{className:"w-3.5 h-3.5"}):e.jsx(ve,{className:"w-3.5 h-3.5"}),"WhatsApp"]}),e.jsxs("button",{onClick:()=>J("sms"),disabled:!!k,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold border border-slate-200 transition-colors disabled:opacity-50",children:[k==="sms"?e.jsx(ce,{className:"w-3.5 h-3.5"}):e.jsx(Ne,{className:"w-3.5 h-3.5"}),"SMS"]}),e.jsxs("button",{onClick:()=>J("email"),disabled:!!k,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold border border-slate-200 transition-colors disabled:opacity-50",children:[k==="email"?e.jsx(ce,{className:"w-3.5 h-3.5"}):e.jsx(we,{className:"w-3.5 h-3.5"}),"Email"]})]})]})]})}function zs({ticket:i,visible:p}){const[l,c]=o.useState(0),m=(i==null?void 0:i.statut)==="En cours de r√©paration"&&(i==null?void 0:i.reparation_debut)&&!(i!=null&&i.reparation_fin),N=(i==null?void 0:i.reparation_duree)||0,d=!m&&N>0;if(o.useEffect(()=>{if(!m||!i.reparation_debut)return;const v=new Date(i.reparation_debut).getTime(),O=()=>c(Math.floor((Date.now()-v)/1e3));O();const T=setInterval(O,1e3);return()=>clearInterval(T)},[m,i==null?void 0:i.reparation_debut]),!p||!m&&!d)return null;const j=m?N+l:N,y=Math.floor(j/3600),C=Math.floor(j%3600/60),k=j%60,f=y>0?`${y}h ${String(C).padStart(2,"0")}min`:`${C}min ${String(k).padStart(2,"0")}s`;return e.jsxs("div",{className:`mt-3 px-4 py-3 rounded-xl flex items-center justify-between ${d?"bg-emerald-50 border border-emerald-200":"bg-violet-50/60 border border-violet-200/60"}`,children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${d?"bg-emerald-100":"bg-violet-100"}`,children:d?e.jsx(ie,{className:"w-4 h-4 text-emerald-600"}):e.jsx($t,{className:"w-4 h-4 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-wider",children:d?"R√©par√© en":"Temps de r√©paration"}),e.jsx("div",{className:`text-lg font-extrabold font-mono tracking-wide ${d?"text-emerald-600":"text-violet-600"}`,children:f})]})]}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[11px] font-bold ${d?"bg-emerald-100 text-emerald-600":"bg-violet-100 text-violet-600"}`,children:[m&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse"}),d?"TERMIN√â":"EN COURS"]})]})}function Os(i){if(!i)return null;const p=i.trim(),l=new Date(p);if(!isNaN(l.getTime())&&p.length>=8)return l;const c=p.match(/^(\d{1,2})[/.-](\d{1,2})[/.-](\d{2,4})(?:\s+(\d{1,2})[h:](\d{2}))?/);if(c){const j=c[3].length===2?"20"+c[3]:c[3],y=new Date(`${j}-${c[2].padStart(2,"0")}-${c[1].padStart(2,"0")}T${(c[4]||"18").padStart(2,"0")}:${c[5]||"00"}:00`);if(!isNaN(y.getTime()))return y}const m=p.toLowerCase(),N=new Date;if(m==="demain"){const j=new Date(N);return j.setDate(j.getDate()+1),j.setHours(18,0,0,0),j}if(m==="aujourd'hui"||m==="aujourdhui"||m==="ce soir"){const j=new Date(N);return j.setHours(18,0,0,0),j}const d={lundi:1,mardi:2,mercredi:3,jeudi:4,vendredi:5,samedi:6,dimanche:0};for(const[j,y]of Object.entries(d))if(m.includes(j)){const C=new Date(N),k=(y-C.getDay()+7)%7||7;return C.setDate(C.getDate()+k),C.setHours(18,0,0,0),C}return null}function qs(i){const p=Math.abs(i),l=Math.floor(p/36e5),c=Math.floor(p%36e5/6e4);if(l>=24){const m=Math.floor(l/24),N=l%24;return`${m}j ${N}h`}return`${l}h${String(c).padStart(2,"0")}`}function Bs({dateStr:i,visible:p}){const[l,c]=o.useState(()=>new Date);if(o.useEffect(()=>{const y=setInterval(()=>c(new Date),6e4);return()=>clearInterval(y)},[]),!p||!i)return null;const m=Os(i);if(!m)return null;const N=m-l,d=N<0,j=N>0&&N<2*36e5;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-bold ${d?"bg-red-50 text-red-600":j?"bg-amber-50 text-amber-600":"bg-emerald-50 text-emerald-600"}`,children:[d?"D√©pass√© ":"dans ",qs(N)]})}function Us(i){if(!i)return null;const p=new Date(i);return isNaN(p.getTime())?null:p}function Ks(i){const p=Math.abs(i),l=Math.floor(p/36e5);if(l>=24)return`${Math.floor(l/24)}j ${l%24}h`;const c=Math.floor(p%36e5/6e4);return`${l}h${String(c).padStart(2,"0")}`}function Ws({open:i,onClose:p,currentTicketId:l,basePath:c,user:m}){const N=kt(),d=(m==null?void 0:m.target)==="tech",j=d?m.utilisateur:null,{data:y,loading:C}=xs(i?`queue:repair:${j||"all"}`:null,()=>b.getRepairQueue(j),{tags:["tickets"],ttl:15e3});if(o.useEffect(()=>{if(!i)return;const f=v=>v.key==="Escape"&&p();return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[i,p]),!i)return null;const k=y||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-40",onClick:p}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full sm:w-[400px] bg-white shadow-2xl z-50 flex flex-col animate-in",children:[e.jsxs("div",{className:"px-5 py-4 bg-gradient-to-r from-slate-800 to-slate-900 flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(ye,{className:"w-4.5 h-4.5 text-white/80"}),e.jsx("span",{className:"text-white text-sm font-bold",children:d?"Mes r√©parations":"File d'attente"}),k.length>0&&e.jsx("span",{className:"bg-amber-400 text-slate-900 text-[11px] font-extrabold px-2 py-0.5 rounded-full",children:k.length})]}),e.jsx("button",{onClick:p,className:"text-white/60 hover:text-white transition-colors",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-6 h-6 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"})}):k.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-400 font-medium",children:"Aucune r√©paration en attente"})]}):e.jsx("div",{className:"space-y-1.5",children:k.map((f,v)=>{const O=f.id===l,T=f.statut==="En cours de r√©paration",U=Us(f.date_recuperation),P=U?U-new Date:null,L=P!==null&&P<0,A=P!==null&&P>0&&P<6*36e5,I=X(f.statut);return e.jsx("button",{onClick:()=>{p(),N(`${c}/ticket/${f.id}`)},className:`w-full text-left p-3 rounded-xl transition-all ${O?"bg-violet-50 ring-2 ring-violet-400":T?"bg-blue-50/50 hover:bg-blue-50":"hover:bg-slate-50"}`,children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center shrink-0 text-[10px] font-extrabold ${T?"bg-violet-600 text-white":v===0?"bg-red-500 text-white":"bg-slate-200 text-slate-500"}`,children:T?e.jsx(_s,{className:"w-3 h-3 fill-current"}):v+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("span",{className:"text-[11px] font-semibold text-slate-400 font-mono",children:f.ticket_code}),e.jsxs("span",{className:"text-[13px] font-bold text-slate-800 truncate",children:[f.client_prenom," ",f.client_nom]}),A&&e.jsx("span",{className:"shrink-0 bg-red-50 text-red-500 text-[9px] font-extrabold px-1.5 py-0.5 rounded uppercase",children:"Urgent"})]}),e.jsxs("div",{className:"text-[12px] text-slate-500 truncate mb-1",children:[f.modele||f.marque," ",f.panne?`‚Ä¢ ${f.panne}`:""]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[!d&&f.technicien_assigne&&e.jsx("span",{className:"text-[10px] text-slate-400",children:f.technicien_assigne}),e.jsx("span",{className:"text-[10px] font-bold px-1.5 py-0.5 rounded-full",style:{backgroundColor:I.color+"15",color:I.color},children:f.statut}),P!==null&&e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${L?"bg-red-50 text-red-500":A?"bg-amber-50 text-amber-600":"bg-emerald-50 text-emerald-600"}`,children:L?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-2.5 h-2.5 inline"})," D√©pass√©"]}):e.jsxs(e.Fragment,{children:[e.jsx(At,{className:"w-2.5 h-2.5 inline"})," ",Ks(P)]})})]})]})]})},f.id)})})}),e.jsx("div",{className:"px-5 py-3 border-t border-slate-100 text-[11px] text-slate-400 text-center shrink-0",children:d?"Vos tickets assign√©s en cours":"Tous les tickets en attente de traitement"})]})]})}function Ie({icon:i,label:p,desc:l,value:c,onChange:m}){return e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-100 last:border-b-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-slate-800",children:[e.jsx(i,{className:"w-4 h-4 text-slate-500 shrink-0"}),p]}),e.jsx("div",{className:"text-[11px] text-slate-400 mt-0.5 ml-6",children:l})]}),e.jsx("button",{onClick:m,className:`relative w-11 h-6 rounded-full transition-colors duration-200 shrink-0 ml-3 ${c?"bg-emerald-500":"bg-slate-300"}`,children:e.jsx("div",{className:`absolute top-1 w-4 h-4 rounded-full bg-white shadow-sm transition-all duration-200 ${c?"left-6":"left-1"}`})})]})}function Vs({open:i,onClose:p,prefs:l,onPrefsChange:c,layoutEditMode:m,onToggleEditMode:N,onSaveLayout:d,onResetLayout:j}){if(!i)return null;const y=C=>{c({...l,[C]:!l[C]})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-[2px] z-40",onClick:p}),e.jsxs("div",{className:"fixed inset-y-0 right-0 w-full sm:w-[340px] bg-white shadow-2xl z-50 flex flex-col animate-in",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-200 flex items-center justify-between shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-extrabold text-slate-800",children:"Personnaliser"}),e.jsx("div",{className:"text-[11px] text-slate-400 mt-0.5",children:"Tes pr√©f√©rences d'affichage"})]}),e.jsx("button",{onClick:p,className:"w-8 h-8 rounded-lg bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors",children:e.jsx(K,{className:"w-4 h-4 text-slate-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-slate-100",children:[e.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2",children:"Widgets"}),e.jsx(Ie,{icon:$t,label:"Timer de r√©paration",desc:"Chrono du temps pass√© sur la r√©paration",value:l.timer,onChange:()=>y("timer")}),e.jsx(Ie,{icon:At,label:"Compte √† rebours",desc:"Temps restant avant r√©cup√©ration",value:l.countdown,onChange:()=>y("countdown")}),e.jsx(Ie,{icon:Mt,label:"File d'attente",desc:"Bouton pour voir les prochaines r√©parations",value:l.queue,onChange:()=>y("queue")})]}),e.jsxs("div",{className:"px-5 py-4",children:[e.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3",children:"Sections de la fiche"}),e.jsxs("button",{onClick:()=>{N(),p()},className:`w-full flex items-center gap-2.5 px-4 py-3 rounded-xl text-sm font-semibold transition-colors ${m?"bg-brand-50 text-brand-700 border border-brand-200":"bg-slate-50 text-slate-700 hover:bg-slate-100 border border-slate-200"}`,children:[e.jsx(Cs,{className:"w-4 h-4"}),m?"Mode √©dition actif":"R√©organiser les sections"]}),e.jsx("p",{className:"text-[11px] text-slate-400 mt-2 ml-1",children:"Glissez-d√©posez les blocs, changez leur taille (S/M/L) et d√©placez-les entre colonnes."}),m&&e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>{d(),p()},className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg bg-brand-600 text-white text-xs font-semibold hover:bg-brand-700 transition-colors",children:[e.jsx(_e,{className:"w-3.5 h-3.5"})," Sauver"]}),e.jsxs("button",{onClick:()=>{j(),p()},className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg bg-slate-100 text-slate-600 text-xs font-semibold hover:bg-slate-200 transition-colors",children:[e.jsx(ks,{className:"w-3.5 h-3.5"})," R√©initialiser"]})]})]})]}),e.jsx("div",{className:"px-5 py-3 border-t border-slate-100 bg-emerald-50/50 shrink-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ss,{className:"w-3.5 h-3.5 text-emerald-500 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-emerald-700",children:"Les donn√©es sont toujours enregistr√©es"}),e.jsx("div",{className:"text-[10px] text-slate-500 mt-0.5",children:"M√™me si un widget est masqu√©, les donn√©es sont sauvegard√©es pour le reporting."})]})]})})]})]})}function vt({title:i,icon:p,iconBg:l,iconColor:c,editing:m,onEdit:N,onSave:d,onCancel:j,children:y,viewContent:C}){return e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg ${l} flex items-center justify-center`,children:e.jsx(p,{className:`w-4 h-4 ${c}`})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:i})]}),m?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:j,className:"btn-ghost text-xs px-2.5 py-1.5",children:[e.jsx(K,{className:"w-3.5 h-3.5"})," Annuler"]}),e.jsxs("button",{onClick:d,className:"btn-primary text-xs px-2.5 py-1.5",children:[e.jsx(_e,{className:"w-3.5 h-3.5"})," Sauver"]})]}):e.jsx("button",{onClick:N,className:"btn-ghost p-1.5",title:"Modifier",children:e.jsx(je,{className:"w-3.5 h-3.5"})})]}),m?y:C]})}const Hs=new Set(["client","device","dates","notes","messages","reparation","status","fidelite"]),ze=[{id:"client",title:"Client",col:"left",order:0,size:"normal"},{id:"device",title:"Appareil",col:"left",order:1,size:"normal"},{id:"dates",title:"Dates",col:"left",order:2,size:"compact"},{id:"messages",title:"Messages",col:"left",order:3,size:"normal"},{id:"notes",title:"Notes internes",col:"left",order:4,size:"normal"},{id:"reparation",title:"R√©paration & Tarifs",col:"right",order:0,size:"large"},{id:"status",title:"Statut",col:"right",order:1,size:"compact"},{id:"fidelite",title:"Fid√©lit√©",col:"right",order:2,size:"compact"}];function sa(){const{id:i}=gs(),p=kt(),{user:l}=Ct(),c=_t(),m=(l==null?void 0:l.target)==="tech"?"/tech":"/accueil",N=(l==null?void 0:l.target)==="tech",[d,j]=o.useState(null),[y,C]=o.useState(!0),[k,f]=o.useState(!1),[v,O]=o.useState(""),[T,U]=o.useState(!0),[Y,P]=o.useState(!1),[L,A]=o.useState(!1),[I,q]=o.useState(!1),[E,W]=o.useState(!1),[z,J]=o.useState(!1),[u,w]=o.useState({}),[_,B]=o.useState({}),[S,$]=o.useState({}),[g,D]=o.useState([]),[V,Oe]=o.useState(!1),[Dt,oe]=o.useState(!1),[Ce,Z]=o.useState(!1),[G,qe]=o.useState(""),[de,Rt]=o.useState([]),[Ft,Be]=o.useState(!1),[ne,Lt]=o.useState(0),[me,Ue]=o.useState([]),[Js,Qs]=o.useState(""),[Ys,Gs]=o.useState(!1),[It,xe]=o.useState(!1),[zt,ee]=o.useState(!1),[ke,le]=o.useState(ze),[pe,Ke]=o.useState(null),[re,We]=o.useState(!1),[Se,Ve]=o.useState({timer:!0,countdown:!0,queue:!0}),[Ot,He]=o.useState(!1),[qt,Je]=o.useState(!1),[Qe,Ye]=o.useState([]),[Bt,Ee]=o.useState(!1),[Te,Ge]=o.useState(""),[Xe,Pe]=o.useState(""),[Ze,et]=o.useState(!1),[Ut,tt]=o.useState(!1),st=t=>{try{if(t.reparation_supp&&t.reparation_supp.startsWith("["))return JSON.parse(t.reparation_supp)}catch{}const r=[];return t.panne&&r.push({label:t.panne,prix:t.devis_estime||0}),t.reparation_supp&&r.push({label:t.reparation_supp,prix:t.prix_supp||0}),r.length>0?r:[{label:"",prix:0}]},M=o.useCallback(async()=>{C(!0);try{const t=await b.getTicket(i);j(t),w({categorie:t.categorie||"",marque:t.marque||"",modele:t.modele||"",modele_autre:t.modele_autre||"",imei:t.imei||"",panne:t.panne||"",panne_detail:t.panne_detail||"",pin:t.pin||"",pattern:t.pattern||"",notes_client:t.notes_client||""}),B({nom:t.client_nom||"",prenom:t.client_prenom||"",telephone:t.client_tel||"",email:t.client_email||"",societe:t.client_societe||""}),$({devis_estime:t.devis_estime||"",tarif_final:t.tarif_final||"",acompte:t.acompte||"",technicien_assigne:t.technicien_assigne||"",type_ecran:t.type_ecran||"",date_recuperation:t.date_recuperation||"",reduction_montant:t.reduction_montant||"",reduction_pourcentage:t.reduction_pourcentage||"",commande_piece:t.commande_piece||0}),D(st(t)),Be(!!(t.attention||(t.notes_internes||"").includes("[ATTENTION]")));try{const r=await b.getPartsByTicket(t.id);Ye(r||[])}catch{Ye([])}}catch(t){console.error(t)}finally{C(!1)}},[i]);o.useEffect(()=>{M()},[M]);const $e=o.useCallback(async()=>{try{const t=await b.getNotes(i);Ue(t||[])}catch{Ue([])}},[i]);o.useEffect(()=>{$e()},[$e]),o.useEffect(()=>{b.getActiveTeam().then(Rt).catch(()=>{}),b.getConfig().then(t=>{const x=(Array.isArray(t)?t:[]).find(s=>s.cle==="tva");x&&Lt(parseFloat(x.valeur)||0)}).catch(()=>{}),b.getCaisseConfig().then(t=>tt(t.CAISSE_ENABLED==="1")).catch(()=>tt(!1))},[]),o.useEffect(()=>{if(l!=null&&l.utilisateur){try{const t=localStorage.getItem(`kp_layout_${l.utilisateur}`);if(t){const r=JSON.parse(t).filter(n=>Hs.has(n.id)),x=new Set(r.map(n=>n.id)),s=ze.filter(n=>!x.has(n.id));r.length>0&&le([...r,...s])}}catch{}try{const t=localStorage.getItem(`kp_prefs_${l.utilisateur}`);t&&Ve(r=>({...r,...JSON.parse(t)}))}catch{}}},[l==null?void 0:l.utilisateur]);const at=()=>{l!=null&&l.utilisateur&&(localStorage.setItem(`kp_layout_${l.utilisateur}`,JSON.stringify(ke)),c.success("Layout sauvegard√©"),We(!1))},nt=()=>{l!=null&&l.utilisateur&&(localStorage.removeItem(`kp_layout_${l.utilisateur}`),le(ze),c.success("Layout r√©initialis√©"))},Kt=t=>{Ve(t),l!=null&&l.utilisateur&&localStorage.setItem(`kp_prefs_${l.utilisateur}`,JSON.stringify(t))},Wt=t=>{!pe||pe===t||(le(r=>{const x=r.map(H=>({...H})),s=x.find(H=>H.id===pe),n=x.find(H=>H.id===t);if(!s||!n)return r;const h=s.col,R=s.order;return s.col=n.col,s.order=n.order,n.col=h,n.order=R,x}),Ke(null))},Vt=t=>{le(r=>r.map(x=>x.id===t?{...x,size:x.size==="compact"?"normal":x.size==="normal"?"large":"compact"}:x))},Ht=(t,r)=>{le(x=>{const s=x.map(h=>({...h})),n=s.find(h=>h.id===t);return n?(n.col=r,n.order=s.filter(h=>h.col===r&&h.id!==t).length,s):x})},Jt=async()=>{f(!0);try{await b.updateTicket(i,u),A(!1),await M(),c.success("Appareil mis √† jour")}catch{c.error("Erreur sauvegarde appareil")}finally{f(!1)}},Qt=async()=>{f(!0);try{await b.updateClient(d.client_id,_),q(!1),await M(),c.success("Client mis √† jour")}catch{c.error("Erreur sauvegarde client")}finally{f(!1)}},Yt=async()=>{f(!0);try{const t=g.reduce((R,H)=>R+(parseFloat(H.prix)||0),0),r=JSON.stringify(g.filter(R=>R.label));let x=parseFloat(S.reduction_montant)||0;const s=parseFloat(S.reduction_pourcentage)||0;s>0&&(x=t*(s/100));const n=parseFloat(S.tarif_final)||t-x||null,h={...S,devis_estime:parseFloat(S.devis_estime)||null,tarif_final:n,acompte:parseFloat(S.acompte)||null,reduction_montant:x||null,reduction_pourcentage:s||null,reparation_supp:r,prix_supp:t};await b.updateTicket(i,h),W(!1),await M(),c.success("Tarification mise √† jour")}catch{c.error("Erreur sauvegarde tarification")}finally{f(!1)}},Gt=async t=>{if(t==="Rendu au client"){if(d.telephone_pret&&!d.telephone_pret_rendu){xe(!0);return}ee(!0);return}try{await b.changeStatus(i,t),await M(),c.success(`Statut chang√© : ${t}`)}catch{c.error("Erreur changement de statut")}},Xt=async()=>{try{await b.updateTicket(i,{telephone_pret_rendu:1}),xe(!1),ee(!0)}catch{c.error("Erreur")}},Zt=async()=>{try{await b.updateTicket(i,{paye:1}),await b.changeStatus(i,"Rendu au client"),await b.changeStatus(i,"Cl√¥tur√©"),ee(!1),await M(),c.success("Ticket cl√¥tur√©")}catch{c.error("Erreur")}},es=async()=>{try{await b.changeStatus(i,"Rendu au client"),ee(!1),await M(),c.success("Attention : ticket non pay√©")}catch{c.error("Erreur")}},lt=async()=>{if(Te!=="caramail"){Pe("Code incorrect");return}et(!0);try{await b.deleteTicket(i),c.success("Ticket supprim√©"),p(m)}catch{c.error("Erreur lors de la suppression"),et(!1)}},rt=async()=>{if(v.trim())try{const t=T?"[INTERNE]":"[CLIENT]";await b.addNote(i,`${t} ${v}`),O(""),await M(),c.success("Note ajout√©e")}catch{c.error("Erreur ajout de note")}},ts=async()=>{const t=prompt("Message de la note importante :");if(!(!t||!t.trim()))try{await b.addPrivateNote(i,(l==null?void 0:l.utilisateur)||"Accueil",t.trim(),!0),await b.updateTicket(i,{attention:t.trim()}),await M(),c.success("Note importante ajout√©e")}catch{c.error("Erreur ajout attention")}},ss=async()=>{try{const t=await b.togglePaye(i);await M(),c.success(t.paye?"Marqu√© pay√©":"Marqu√© non pay√©")}catch{c.error("Erreur toggle pay√©")}},te=(t,r)=>{$(x=>({...x,[t]:Math.max(0,(parseFloat(x[t])||0)+r).toString()}))},as=()=>{navigator.clipboard.writeText(d.ticket_code),P(!0),setTimeout(()=>P(!1),2e3)},ns=async()=>{const t=d;if(!t)return;const r=g.filter(s=>s.label),x=`R√©paration ${t.marque||""} ${t.modele||t.modele_autre||""} - ${r.map(s=>s.label).join(" + ")}`.trim();try{const s=await b.envoyerCaisse({ticket_id:t.id,ticket_code:t.ticket_code,nom:t.client_nom||"",prenom:t.client_prenom||"",telephone:t.client_tel||"",email:t.client_email||"",description:x,montant:be});s.result==="OK"?(c.success(s.message||"Vente envoy√©e en caisse"),M()):c.error(s.message||"Erreur caisse")}catch(s){c.error(s.message||"Erreur envoi en caisse")}},ls=()=>{if(!d)return"";const t=d,r=t.modele_autre||`${t.marque||""} ${t.modele||""}`.trim()||"appareil",x=g.filter(h=>h.label),s=x.reduce((h,R)=>h+(parseFloat(R.prix)||0),0),n=x.map(h=>`- ${h.label} : ${parseFloat(h.prix||0).toFixed(2)} EUR`).join(`
`);return`Bonjour ${t.client_prenom||""}, suite au diagnostic de votre ${r}, voici le d√©tail des r√©parations n√©cessaires :

${n}

Total : ${s.toFixed(2)} EUR

Merci de nous confirmer votre accord pour lancer la r√©paration.
Klikphone 04 79 60 89 22`},rs=()=>{qe(ls()),oe(!0)},Ae=async t=>{if(!G.trim()){c.error("Message vide");return}Z(!0);try{const r=d.client_tel,x=d.client_email;if(t==="whatsapp"){if(!r){c.error("Pas de t√©l√©phone"),Z(!1);return}window.open(wt(r,G),"_blank")}else if(t==="sms"){if(!r){c.error("Pas de t√©l√©phone"),Z(!1);return}window.open(yt(r,G),"_blank")}else if(t==="email"){if(!x){c.error("Ce client n'a pas d'adresse email"),Z(!1);return}const h=await b.envoyerEmail(x,`Klikphone SAV - Accord ${d.ticket_code}`,G);if(h.status!=="ok"){c.error(h.message||"Erreur d'envoi email"),Z(!1);return}}await b.changeStatus(i,"En attente d'accord client");const s=(l==null?void 0:l.utilisateur)||"Accueil",n=`[Demande accord] ${G.substring(0,120)}${G.length>120?"...":""}`;await b.logMessage(i,s,n,t),oe(!1),await M(),c.success("Demande d'accord envoy√©e")}catch{c.error("Erreur envoi de la demande")}finally{Z(!1)}},it=async t=>{try{if(t){await b.changeStatus(i,"En cours de r√©paration");const r=(l==null?void 0:l.utilisateur)||"Accueil";await b.addPrivateNote(i,r,"Accord client re√ßu ‚Äî r√©paration lanc√©e"),c.success("Ticket en cours de r√©paration")}else{await b.changeStatus(i,"R√©paration termin√©e");const r=(l==null?void 0:l.utilisateur)||"Accueil";await b.addPrivateNote(i,r,"Client a refus√© la r√©paration"),c.success("Ticket marqu√© non r√©parable")}await M()}catch{c.error("Erreur changement de statut")}},is=()=>{D(t=>[...t,{label:"",prix:0}])},cs=t=>{D(r=>r.filter((x,s)=>s!==t))},ct=(t,r,x)=>{D(s=>s.map((n,h)=>h===t?{...n,[r]:x}:n))},ot=(t,r)=>{D(x=>x.map((s,n)=>n===t?{...s,prix:Math.max(0,(parseFloat(s.prix)||0)+r)}:s))},ue=g.reduce((t,r)=>t+(parseFloat(r.prix)||0),0),os=parseFloat(S.reduction_montant)||0,he=parseFloat(S.reduction_pourcentage)||0,Me=he>0?ue*(he/100):os,De=parseFloat(S.tarif_final)||ue-Me,dt=ne>0?De*(ne/100):0,be=De+dt,se=be-(parseFloat(S.acompte)||0);if(y)return e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-brand-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Chargement..."})]})});if(!d)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center mb-4",children:e.jsx(Fe,{className:"w-7 h-7 text-slate-300"})}),e.jsx("p",{className:"text-slate-500 font-medium",children:"Ticket non trouv√©"}),e.jsxs("button",{onClick:()=>p(m),className:"btn-secondary mt-4",children:[e.jsx(Le,{className:"w-4 h-4"})," Retour au dashboard"]})]});const a=d,ds=a.modele_autre||`${a.marque||""} ${a.modele||""}`.trim(),Q=[];a.notes_internes&&a.notes_internes.split(`
`).filter(Boolean).forEach(t=>{t.includes("[INTERNE]");const r=t.includes("[CLIENT]"),x=t.includes("[ATTENTION]"),s=t.replace(/\[(INTERNE|CLIENT|ATTENTION)\]\s*/g,""),n=s.match(/^\[(\d{2}\/\d{2}\/?\d{0,4}\s?\d{2}:\d{2})\]\s*/),h=n?n[1]:"",R=n?s.replace(n[0],""):s;Q.push({type:x?"attention":r?"client":"internal",text:R,timestamp:h,raw:t})}),a.historique&&a.historique.split(`
`).filter(Boolean).forEach(t=>{const r=t.match(/^\[(\d{2}\/\d{2}\s?\d{2}:\d{2})\]\s*/),x=r?r[1]:"",s=r?t.replace(r[0],""):t;Q.push({type:"history",text:s,timestamp:x,raw:t})}),Q.reverse();const ms=t=>{var r,x;switch(t){case"client":return e.jsx(vt,{title:"Client",icon:ut,iconBg:"bg-blue-50",iconColor:"text-blue-600",editing:I,onEdit:()=>q(!0),onSave:Qt,onCancel:()=>{q(!1),B({nom:a.client_nom||"",prenom:a.client_prenom||"",telephone:a.client_tel||"",email:a.client_email||"",societe:a.client_societe||""})},viewContent:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-11 h-11 rounded-full bg-brand-100 flex items-center justify-center shrink-0",children:e.jsxs("span",{className:"text-brand-700 font-bold text-sm",children:[(((r=a.client_prenom)==null?void 0:r[0])||"").toUpperCase(),(((x=a.client_nom)==null?void 0:x[0])||"").toUpperCase()]})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-base font-bold text-slate-900 truncate",children:[a.client_prenom||""," ",a.client_nom||""]}),a.client_societe&&e.jsx("p",{className:"text-xs text-slate-500",children:a.client_societe})]})]}),e.jsxs("div",{className:"space-y-2",children:[a.client_tel&&e.jsxs("a",{href:`tel:${a.client_tel}`,className:"flex items-center gap-2.5 text-sm text-slate-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center shrink-0",children:e.jsx(Ds,{className:"w-4 h-4 text-slate-500"})}),e.jsx("span",{className:"font-mono text-xs",children:a.client_tel})]}),a.client_email&&e.jsxs("a",{href:`mailto:${a.client_email}`,className:"flex items-center gap-2.5 text-sm text-slate-600 hover:text-brand-600 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center shrink-0",children:e.jsx(we,{className:"w-4 h-4 text-slate-500"})}),e.jsx("span",{className:"text-xs truncate",children:a.client_email})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-100",children:e.jsx("p",{className:"text-[10px] text-slate-400 text-center",children:"Messages dans le bloc Messages ci-dessous"})})]}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Pr√©nom"}),e.jsx("input",{value:_.prenom,onChange:s=>B(n=>({...n,prenom:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Nom"}),e.jsx("input",{value:_.nom,onChange:s=>B(n=>({...n,nom:s.target.value})),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"T√©l√©phone"}),e.jsx("input",{value:_.telephone,onChange:s=>B(n=>({...n,telephone:s.target.value})),className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email"}),e.jsx("input",{value:_.email,onChange:s=>B(n=>({...n,email:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Soci√©t√©"}),e.jsx("input",{value:_.societe,onChange:s=>B(n=>({...n,societe:s.target.value})),className:"input"})]})]})});case"device":return e.jsx(vt,{title:"Appareil",icon:Fe,iconBg:"bg-brand-50",iconColor:"text-brand-600",editing:L,onEdit:()=>A(!0),onSave:Jt,onCancel:()=>{A(!1),w({categorie:a.categorie||"",marque:a.marque||"",modele:a.modele||"",modele_autre:a.modele_autre||"",imei:a.imei||"",panne:a.panne||"",panne_detail:a.panne_detail||"",pin:a.pin||"",pattern:a.pattern||"",notes_client:a.notes_client||""})},viewContent:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-4 text-sm",children:[{label:"Cat√©gorie",value:a.categorie},{label:"Marque",value:a.marque},{label:"Mod√®le",value:(a.modele&&a.modele!=="Autre"?a.modele:a.modele_autre)||a.modele||"‚Äî"},{label:"Panne",value:a.panne},{label:"IMEI / N¬∞ s√©rie",value:a.imei,mono:!0},{label:"D√©tail panne",value:a.panne_detail}].map(({label:s,value:n,mono:h})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-xs mb-0.5",children:s}),e.jsx("p",{className:`font-medium text-slate-800 ${h?"font-mono text-xs":""}`,children:n||"‚Äî"})]},s))}),(a.pin||a.pattern)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 flex flex-wrap gap-6",children:[a.pin&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-400 text-xs mb-1 flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3"})," Code PIN"]}),e.jsx("p",{className:"text-lg font-bold font-mono text-slate-800 tracking-widest",children:a.pin})]}),a.pattern&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-400 text-xs mb-1 flex items-center gap-1",children:[e.jsx(Ms,{className:"w-3 h-3"})," Pattern"]}),e.jsx(fs,{value:a.pattern,readOnly:!0,size:120})]})]}),a.notes_client&&e.jsxs("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-100 rounded-lg text-sm text-amber-800",children:[e.jsx("span",{className:"font-semibold",children:"Note client :"})," ",a.notes_client]})]}),children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Cat√©gorie"}),e.jsx("input",{value:u.categorie,onChange:s=>w(n=>({...n,categorie:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Marque"}),e.jsx("input",{value:u.marque,onChange:s=>w(n=>({...n,marque:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Mod√®le"}),e.jsx("input",{value:u.modele,onChange:s=>w(n=>({...n,modele:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Panne"}),e.jsx("input",{value:u.panne,onChange:s=>w(n=>({...n,panne:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"IMEI"}),e.jsx("input",{value:u.imei,onChange:s=>w(n=>({...n,imei:s.target.value})),className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"D√©tail panne"}),e.jsx("input",{value:u.panne_detail,onChange:s=>w(n=>({...n,panne_detail:s.target.value})),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Code PIN"}),e.jsx("input",{value:u.pin,onChange:s=>w(n=>({...n,pin:s.target.value})),className:"input font-mono tracking-widest",maxLength:10})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Pattern"}),e.jsx("input",{value:u.pattern,onChange:s=>w(n=>({...n,pattern:s.target.value})),className:"input font-mono",placeholder:"1-5-9-6-3"})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-3",children:[e.jsx("label",{className:"input-label",children:"Note client"}),e.jsx("textarea",{value:u.notes_client,onChange:s=>w(n=>({...n,notes_client:s.target.value})),className:"input resize-none",rows:2})]})]})});case"dates":return e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center",children:e.jsx(As,{className:"w-4 h-4 text-slate-500"})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Dates"})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-500",children:"D√©p√¥t"}),e.jsx("span",{className:"font-medium text-slate-800",children:Re(a.date_depot)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-500",children:"Mise √† jour"}),e.jsx("span",{className:"font-medium text-slate-800",children:Re(a.date_maj)})]}),a.date_cloture&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-500",children:"Cl√¥ture"}),e.jsx("span",{className:"font-medium text-slate-800",children:Re(a.date_cloture)})]}),a.date_recuperation&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-500",children:"R√©cup√©ration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-slate-800",children:a.date_recuperation}),e.jsx(Bs,{dateStr:a.date_recuperation,visible:Se.countdown})]})]})]})]});case"messages":return e.jsx(Is,{ticket:a,onMessageSent:()=>$e()});case"notes":return e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-50 flex items-center justify-center",children:e.jsx(Et,{className:"w-4 h-4 text-amber-600"})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Notes internes"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:`${[...me,...Q.filter(n=>n.type==="internal"||n.type==="client"||n.type==="attention")].length} note(s)`})]}),e.jsxs("button",{onClick:ts,className:"btn-ghost text-xs gap-1 text-red-500 hover:bg-red-50",title:"Ajouter flag attention",children:[e.jsx(Ps,{className:"w-3.5 h-3.5"})," Attention"]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("button",{onClick:()=>U(!T),className:`shrink-0 p-2.5 rounded-lg border transition-colors ${T?"bg-slate-50 border-slate-200 text-slate-500":"bg-blue-50 border-blue-200 text-blue-500"}`,title:T?"Note interne":"Note visible client",children:T?e.jsx(ft,{className:"w-4 h-4"}):e.jsx($s,{className:"w-4 h-4"})}),e.jsx("input",{type:"text",value:v,onChange:s=>O(s.target.value),onKeyDown:s=>s.key==="Enter"&&rt(),placeholder:T?"Note interne...":"Note visible par le client...",className:"input flex-1"})]}),e.jsx("button",{onClick:rt,className:"btn-primary px-3",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"max-h-80 overflow-y-auto divide-y divide-slate-100",children:[me.map(s=>{var xt;const n=s.type_note||"note",h=n==="whatsapp"?{bg:"bg-green-100 text-green-700",label:"WhatsApp"}:n==="sms"?{bg:"bg-blue-100 text-blue-700",label:"SMS"}:n==="email"?{bg:"bg-amber-100 text-amber-700",label:"Email"}:null,R=(xt=s.auteur)==null?void 0:xt.toLowerCase().includes("tech"),H=s.important?"text-red-600 font-semibold":h?"text-slate-600":R?"text-blue-600":"text-emerald-600";return e.jsxs("div",{className:"flex items-start gap-2 py-1.5",children:[h&&e.jsx("span",{className:`text-[9px] font-bold px-1.5 py-0.5 rounded uppercase tracking-wider shrink-0 mt-0.5 ${h.bg}`,children:h.label}),!h&&n==="note"&&e.jsx("span",{className:"text-[9px] font-bold px-1.5 py-0.5 rounded bg-blue-50 text-blue-600 uppercase tracking-wider shrink-0 mt-0.5",children:s.auteur||"Note"}),e.jsx("span",{className:`text-sm flex-1 min-w-0 ${H}`,children:s.contenu}),e.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap shrink-0 mt-0.5",children:s.date_creation?new Date(s.date_creation).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):""})]},`db-${s.id}`)}),Q.filter(s=>s.type!=="history").map((s,n)=>{const h=s.type==="attention"?"text-red-600 font-semibold":s.type==="internal"?"text-blue-600":"text-emerald-600";return e.jsxs("div",{className:"flex items-start gap-2 py-1.5",children:[e.jsx("span",{className:`text-sm flex-1 min-w-0 ${h}`,children:s.text}),s.timestamp&&e.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap shrink-0 mt-0.5",children:s.timestamp})]},`tl-${n}`)}),me.length===0&&Q.filter(s=>s.type!=="history").length===0&&e.jsx("p",{className:"text-xs text-slate-400 text-center py-3",children:"Aucune note"})]}),Q.filter(s=>s.type==="history").length>0&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-slate-100",children:[e.jsx("p",{className:"text-[10px] text-slate-400 uppercase tracking-wider mb-2",children:"Historique"}),e.jsxs("div",{className:"relative max-h-48 overflow-y-auto pl-4",children:[e.jsx("div",{className:"absolute left-[9px] top-2 bottom-2 w-0.5 bg-slate-200"}),e.jsx("div",{className:"space-y-0.5",children:Q.filter(s=>s.type==="history").map((s,n)=>e.jsxs("div",{className:"relative flex items-start gap-3 py-1.5 px-2 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"absolute -left-4 top-3 w-2 h-2 rounded-full bg-brand-400 z-10"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-slate-500",children:s.text}),s.timestamp&&e.jsx("span",{className:"text-[10px] text-slate-400",children:s.timestamp})]})]},n))})]})]})]});case"reparation":return e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-50 flex items-center justify-center",children:e.jsx(ye,{className:"w-4 h-4 text-emerald-600"})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"R√©paration & Tarifs"})]}),!E&&e.jsx("button",{onClick:()=>W(!0),className:"btn-ghost p-1.5",title:"Modifier",children:e.jsx(je,{className:"w-3.5 h-3.5"})}),E&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>{W(!1),$({devis_estime:a.devis_estime||"",tarif_final:a.tarif_final||"",acompte:a.acompte||"",technicien_assigne:a.technicien_assigne||"",type_ecran:a.type_ecran||"",date_recuperation:a.date_recuperation||"",reduction_montant:a.reduction_montant||"",reduction_pourcentage:a.reduction_pourcentage||"",commande_piece:a.commande_piece||0}),D(st(a))},className:"btn-ghost text-xs px-2.5 py-1.5",children:[e.jsx(K,{className:"w-3.5 h-3.5"})," Annuler"]}),e.jsxs("button",{onClick:Yt,className:"btn-primary text-xs px-2.5 py-1.5",children:[e.jsx(_e,{className:"w-3.5 h-3.5"})," Sauver"]})]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-xl border border-slate-100",children:[e.jsx("div",{className:"text-[11px] text-slate-400 uppercase tracking-wider mb-2",children:"Technicien assign√©"}),N&&!z?e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{var n,h;const s=de.find(R=>a.technicien_assigne===R.nom||(a.technicien_assigne||"").startsWith(R.nom+" "));return s?e.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:s.couleur||"#94a3b8"},children:((n=a.technicien_assigne)==null?void 0:n.charAt(0))||"?"}):e.jsx("div",{className:"w-7 h-7 rounded-lg bg-slate-300 flex items-center justify-center text-white text-xs font-bold",children:((h=a.technicien_assigne)==null?void 0:h.charAt(0))||"?"})})(),e.jsx("span",{className:"text-sm font-semibold text-slate-800",children:a.technicien_assigne||"Non assign√©"}),e.jsx("button",{onClick:()=>J(!0),className:"text-slate-400 hover:text-brand-600 ml-auto",children:e.jsx(je,{className:"w-3.5 h-3.5"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const s=de.find(n=>(a.technicien_assigne||"")===n.nom);return e.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:(s==null?void 0:s.couleur)||"#94a3b8"},children:(a.technicien_assigne||z||"?").charAt(0)})})(),de.length>0?e.jsxs("select",{value:a.technicien_assigne||"",onChange:async s=>{const n=s.target.value;if(n)try{await b.updateTicket(i,{technicien_assigne:n}),await M(),c.success(`Assign√© √† ${n}`),J(!1)}catch{c.error("Erreur assignation")}},className:"flex-1 px-3 py-1.5 rounded-lg border border-slate-200 text-sm font-semibold bg-white",children:[e.jsx("option",{value:"",children:"‚Äî Non assign√© ‚Äî"}),de.map(s=>e.jsxs("option",{value:s.nom,children:[s.nom,s.role?` (${s.role})`:""]},s.id))]}):e.jsx("input",{type:"text",value:S.technicien_assigne,onChange:s=>$(n=>({...n,technicien_assigne:s.target.value})),className:"flex-1 input text-sm",placeholder:"Nom du technicien"})]}),a.personne_charge&&e.jsxs("p",{className:"text-[10px] text-slate-400 mt-2",children:["Prise en charge : ",e.jsx("span",{className:"font-medium text-slate-600",children:a.personne_charge})]})]}),E?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"input-label mb-0",children:"Lignes de r√©paration"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!!S.commande_piece,onChange:s=>$(n=>({...n,commande_piece:s.target.checked?1:0})),className:"w-3.5 h-3.5 rounded border-slate-300 text-amber-600 focus:ring-amber-500"}),e.jsxs("span",{className:"text-xs font-medium text-amber-700",children:[e.jsx(bt,{className:"w-3 h-3 inline mr-0.5"}),"Pi√®ce √† commander"]})]}),e.jsxs("button",{onClick:is,className:"btn-ghost text-xs px-2 py-1",children:[e.jsx(ae,{className:"w-3 h-3"})," Ajouter"]})]})]}),e.jsx("div",{className:"space-y-2",children:g.map((s,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:s.label,onChange:h=>ct(n,"label",h.target.value),className:"input flex-1",placeholder:"Description r√©paration"}),e.jsxs("div",{className:"relative w-28 shrink-0",children:[e.jsx("input",{type:"number",step:"0.01",value:s.prix,onChange:h=>ct(n,"prix",h.target.value),className:"input text-right pr-7",placeholder:"0"}),e.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]}),e.jsx("button",{onClick:()=>ot(n,-5),className:"btn-ghost p-1.5 shrink-0",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>ot(n,5),className:"btn-ghost p-1.5 shrink-0",children:e.jsx(ae,{className:"w-3 h-3"})}),g.length>1&&e.jsx("button",{onClick:()=>cs(n),className:"btn-ghost p-1.5 shrink-0 text-red-400 hover:text-red-600",children:e.jsx(ht,{className:"w-3 h-3"})})]},n))}),e.jsxs("div",{className:"text-right mt-2",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Total :"}),e.jsx("span",{className:"text-sm font-bold text-slate-800 ml-2",children:F(ue)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Devis estim√©"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>te("devis_estime",-5),className:"btn-ghost p-1.5 shrink-0",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"number",step:"0.01",value:S.devis_estime,onChange:s=>$(n=>({...n,devis_estime:s.target.value})),className:"input text-center pr-7"}),e.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]}),e.jsx("button",{onClick:()=>te("devis_estime",5),className:"btn-ghost p-1.5 shrink-0",children:e.jsx(ae,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Tarif final"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>te("tarif_final",-5),className:"btn-ghost p-1.5 shrink-0",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"number",step:"0.01",value:S.tarif_final,onChange:s=>$(n=>({...n,tarif_final:s.target.value})),className:"input text-center pr-7",placeholder:ue||""}),e.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]}),e.jsx("button",{onClick:()=>te("tarif_final",5),className:"btn-ghost p-1.5 shrink-0",children:e.jsx(ae,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Acompte"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>te("acompte",-5),className:"btn-ghost p-1.5 shrink-0",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"number",step:"0.01",value:S.acompte,onChange:s=>$(n=>({...n,acompte:s.target.value})),className:"input text-center pr-7"}),e.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]}),e.jsx("button",{onClick:()=>te("acompte",5),className:"btn-ghost p-1.5 shrink-0",children:e.jsx(ae,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"input-label flex items-center gap-1",children:[e.jsx(gt,{className:"w-3 h-3"})," R√©duction (%)"]}),e.jsx("input",{type:"number",step:"1",min:"0",max:"100",value:S.reduction_pourcentage,onChange:s=>$(n=>({...n,reduction_pourcentage:s.target.value,reduction_montant:""})),className:"input",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"R√©duction (‚Ç¨)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:S.reduction_montant,onChange:s=>$(n=>({...n,reduction_montant:s.target.value,reduction_pourcentage:""})),className:"input pr-7",placeholder:"0"}),e.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-400",children:"‚Ç¨"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Qualit√© √©cran"}),e.jsxs("select",{value:S.type_ecran,onChange:s=>$(n=>({...n,type_ecran:s.target.value})),className:"input",children:[e.jsx("option",{value:"",children:"‚Äî"}),e.jsx("option",{value:"Original",children:"Original (OEM)"}),e.jsx("option",{value:"Original reconditionn√©",children:"Original reconditionn√©"}),e.jsx("option",{value:"Compatible Premium",children:"Compatible Premium"}),e.jsx("option",{value:"Compatible",children:"Compatible"}),e.jsx("option",{value:"OLED",children:"OLED"}),e.jsx("option",{value:"OLED Premium",children:"OLED Premium"}),e.jsx("option",{value:"Incell",children:"Incell"}),e.jsx("option",{value:"LCD",children:"LCD"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Date r√©cup√©ration"}),e.jsx("input",{type:"datetime-local",value:S.date_recuperation,onChange:s=>$(n=>({...n,date_recuperation:s.target.value})),className:"input"})]})]})]}):e.jsxs(e.Fragment,{children:[Qe.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:[e.jsxs("div",{className:"text-[11px] font-bold text-amber-800 uppercase tracking-wider mb-2 flex items-center gap-1",children:[e.jsx(bt,{className:"w-3 h-3"})," Pi√®ce(s) command√©e(s)"]}),Qe.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-amber-100 last:border-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:s.description}),s.notes&&e.jsx("div",{className:"text-xs text-slate-500",children:s.notes}),s.fournisseur&&e.jsxs("div",{className:"text-xs text-slate-400",children:["Fournisseur : ",s.fournisseur]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.prix>0&&e.jsx("span",{className:"text-sm font-bold",children:F(s.prix)}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-full ${s.statut==="En attente"?"bg-amber-100 text-amber-700":s.statut==="Command√©e"?"bg-blue-100 text-blue-700":s.statut==="Exp√©di√©e"?"bg-purple-100 text-purple-700":s.statut==="Re√ßue"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.statut})]})]},s.id))]}),e.jsxs("div",{className:"mb-3",children:[g.filter(s=>s.label).map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-slate-50 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:s.label}),a.type_ecran&&n===0&&e.jsx("span",{className:"text-[10px] font-semibold text-violet-600 bg-violet-50 px-2 py-0.5 rounded",children:a.type_ecran})]}),e.jsx("span",{className:"text-sm font-bold text-slate-800",children:F(s.prix)})]},n)),g.filter(s=>s.label).length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic py-2",children:"Aucune r√©paration enregistr√©e"})]}),Me>0&&e.jsxs("div",{className:"flex justify-between py-1 text-sm text-emerald-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(gt,{className:"w-3 h-3"})," R√©duction",he>0?` (${he}%)`:""]}),e.jsxs("span",{className:"font-medium",children:["- ",F(Me)]})]}),e.jsxs("div",{className:"border-t border-slate-200 mt-2 pt-2 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:ne>0?"Sous-total HT":"Tarif final"}),e.jsx("span",{className:"font-semibold text-slate-800",children:F(De)})]}),ne>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-slate-500",children:["TVA (",ne,"%)"]}),e.jsx("span",{className:"font-medium text-slate-600",children:F(dt)})]}),e.jsxs("div",{className:"flex justify-between text-sm font-bold border-t border-slate-200 pt-2",children:[e.jsx("span",{className:"text-slate-800",children:"Total TTC"}),e.jsx("span",{className:"text-slate-900",children:F(be)})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Acompte vers√©"}),e.jsxs("span",{className:"font-medium text-slate-800",children:["- ",a.acompte?F(a.acompte):"0,00 ‚Ç¨"]})]})]}),se>0&&e.jsxs("div",{className:"flex justify-between mt-3 px-4 py-3 rounded-xl bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200",children:[e.jsx("span",{className:"font-extrabold text-emerald-700 text-[15px]",children:"RESTE √Ä PAYER"}),e.jsx("span",{className:"font-extrabold text-emerald-700 text-[15px]",children:F(se)})]}),e.jsxs("div",{className:"flex gap-2 mt-3 flex-wrap",children:[e.jsxs("button",{onClick:ss,className:`px-3 py-2 rounded-lg text-xs font-semibold transition-colors ${a.paye?"bg-emerald-500 text-white":"bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-100"}`,children:[e.jsx(ie,{className:"w-3.5 h-3.5 inline mr-1"}),a.paye?"Pay√© ‚úì":"Marquer pay√©"]}),Ut&&e.jsxs("button",{onClick:ns,className:"px-3 py-2 rounded-lg bg-amber-500 text-white text-xs font-semibold hover:bg-amber-600",children:[e.jsx(Ts,{className:"w-3.5 h-3.5 inline mr-1"}),"Envoyer en caisse"]}),e.jsxs("button",{onClick:rs,className:"px-3 py-2 rounded-lg bg-orange-50 text-orange-600 text-xs font-semibold border border-orange-200 hover:bg-orange-100",children:[e.jsx(fe,{className:"w-3.5 h-3.5 inline mr-1"}),"Accord client"]})]})]})]});case"status":return e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:X(a.statut).color+"20"},children:e.jsx(Pt,{className:"w-4 h-4",style:{color:X(a.statut).color}})}),e.jsx("h2",{className:"text-sm font-semibold text-slate-800",children:"Changer le statut"})]}),e.jsx("select",{value:a.statut,onChange:s=>Gt(s.target.value),className:"w-full py-3 px-4 text-base font-semibold rounded-xl border-2 transition-colors cursor-pointer appearance-none bg-no-repeat",style:{borderColor:X(a.statut).color,color:X(a.statut).color,backgroundColor:X(a.statut).color+"10",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='${encodeURIComponent(X(a.statut).color)}' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E")`,backgroundPosition:"right 12px center",backgroundSize:"20px"},children:bs.map(s=>e.jsx("option",{value:s,children:s},s))}),a.statut==="En attente d'accord client"&&e.jsxs("div",{className:"mt-3 p-3 bg-orange-50 border border-orange-200 rounded-xl space-y-2",children:[e.jsx("p",{className:"text-[11px] font-semibold text-orange-700 uppercase tracking-wider",children:"R√©ponse du client"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>it(!0),className:"flex-1 py-2 px-3 rounded-lg bg-emerald-50 text-emerald-700 text-xs font-bold border border-emerald-200 hover:bg-emerald-100 transition-colors",children:[e.jsx(ce,{className:"w-3.5 h-3.5 inline mr-1"}),"Client a valid√©"]}),e.jsxs("button",{onClick:()=>it(!1),className:"flex-1 py-2 px-3 rounded-lg bg-red-50 text-red-600 text-xs font-bold border border-red-200 hover:bg-red-100 transition-colors",children:[e.jsx(K,{className:"w-3.5 h-3.5 inline mr-1"}),"Client a refus√©"]})]})]}),e.jsx(zs,{ticket:a,visible:Se.timer})]});case"fidelite":return a.client_id&&!N?e.jsx(hs,{clientId:a.client_id}):null;default:return null}},mt=t=>{const r=ms(t.id);if(!r)return null;if(!re)return e.jsx("div",{children:r},t.id);const x=t.size==="compact"?"S":t.size==="large"?"L":"M";return e.jsxs("div",{draggable:!0,onDragStart:()=>Ke(t.id),onDragOver:s=>s.preventDefault(),onDrop:s=>{s.preventDefault(),Wt(t.id)},className:`relative group rounded-xl transition-all ${pe===t.id?"opacity-40 scale-[0.98]":""} ${re?"ring-2 ring-dashed ring-slate-200 hover:ring-brand-400":""}`,children:[e.jsxs("div",{className:"absolute -top-3 left-3 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[e.jsxs("span",{className:"px-2 py-0.5 bg-brand-600 text-white text-[10px] rounded-full font-medium cursor-grab active:cursor-grabbing shadow-sm",children:["‚†ø ",t.title]}),e.jsx("button",{onClick:()=>Vt(t.id),className:"px-1.5 py-0.5 bg-slate-700 text-white text-[10px] rounded-full hover:bg-slate-600 shadow-sm",children:x}),e.jsx("button",{onClick:()=>Ht(t.id,t.col==="left"?"right":"left"),className:"px-1.5 py-0.5 bg-slate-700 text-white text-[10px] rounded-full hover:bg-slate-600 shadow-sm",children:t.col==="left"?"‚Üí":"‚Üê"})]}),e.jsx("div",{className:t.size==="compact"?"max-h-52 overflow-hidden":"",children:r})]},t.id)};return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 text-white px-4 sm:px-6 lg:px-8 py-8 sm:py-10 -mx-4 sm:-mx-6 lg:-mx-8 -mt-4 sm:-mt-6 lg:-mt-8 mb-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>p(-1),className:"flex items-center gap-1.5 text-slate-400 hover:text-white transition-colors mb-5 -ml-1",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Retour"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-5",children:[e.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-display font-bold text-white font-mono tracking-tight",children:a.ticket_code}),e.jsx("button",{onClick:as,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors",title:"Copier le code",children:Y?e.jsx(ce,{className:"w-4 h-4 text-emerald-400"}):e.jsx(St,{className:"w-4 h-4 text-slate-400"})}),a.paye&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full bg-emerald-500/20 text-emerald-300 text-xs font-bold flex items-center gap-1",children:[e.jsx(ie,{className:"w-3.5 h-3.5"})," Pay√©"]})]}),e.jsxs("div",{className:"text-sm text-slate-300 flex flex-wrap items-center gap-x-2 gap-y-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ut,{className:"w-3.5 h-3.5 text-slate-500"})," ",a.client_prenom||""," ",a.client_nom||""]}),e.jsx("span",{className:"text-slate-600",children:"‚Ä¢"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 text-slate-500"})," ",ds||"‚Äî"]}),e.jsx("span",{className:"text-slate-600",children:"‚Ä¢"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3.5 h-3.5 text-slate-500"}),g.filter(t=>t.label).length>0?g.filter(t=>t.label).map(t=>t.label).join(" + "):a.panne||"‚Äî"]}),e.jsx("span",{className:"text-slate-600",children:"‚Ä¢"}),e.jsx("span",{className:"font-semibold text-emerald-400",children:F(be||0)}),a.paye&&e.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-300 px-2 py-0.5 rounded-full",children:"Pay√©"}),!a.paye&&se>0&&e.jsxs("span",{className:"text-xs bg-amber-500/20 text-amber-300 px-2 py-0.5 rounded-full",children:["Reste ",F(se)]})]}),a.client_tel&&e.jsx("a",{href:`tel:${a.client_tel}`,className:"text-sm text-slate-400 hover:text-white font-mono transition-colors",children:a.client_tel})]}),e.jsxs("div",{className:"flex sm:flex-col items-center sm:items-end gap-3 shrink-0",children:[e.jsx(ps,{statut:a.statut,size:"lg"}),e.jsxs("button",{onClick:()=>Oe(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-slate-300 hover:text-white text-sm font-medium transition-colors",children:[e.jsx(Tt,{className:"w-4 h-4"})," Imprimer"]})]})]})]})}),Dt&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>oe(!1)}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 animate-in max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-100 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Demande d'accord client"}),e.jsxs("p",{className:"text-sm text-slate-500",children:[a.ticket_code," ‚Äî ",a.client_prenom," ",a.client_nom]})]}),e.jsx("button",{onClick:()=>oe(!1),className:"ml-auto btn-ghost p-1.5",children:e.jsx(K,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"p-4 bg-slate-50 border border-slate-200 rounded-xl mb-4",children:[e.jsx("div",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-2",children:"R√©capitulatif des r√©parations"}),g.filter(t=>t.label).map((t,r)=>e.jsxs("div",{className:"flex justify-between py-1.5 border-b border-slate-100 last:border-0",children:[e.jsxs("span",{className:"text-sm text-slate-700",children:[t.label,a.type_ecran&&r===0&&e.jsx("span",{className:"text-[10px] font-semibold text-violet-600 bg-violet-50 px-1.5 py-0.5 rounded ml-2",children:a.type_ecran})]}),e.jsx("span",{className:"text-sm font-bold text-slate-800",children:F(t.prix)})]},r)),e.jsxs("div",{className:"flex justify-between pt-2 mt-1 border-t border-slate-300",children:[e.jsx("span",{className:"text-sm font-bold text-slate-900",children:"Total"}),e.jsx("span",{className:"text-sm font-bold text-emerald-700",children:F(g.filter(t=>t.label).reduce((t,r)=>t+(parseFloat(r.prix)||0),0))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-semibold text-slate-600 mb-1 block",children:"Message au client"}),e.jsx("textarea",{value:G,onChange:t=>qe(t.target.value),rows:7,className:"w-full px-3 py-2.5 rounded-xl border border-slate-200 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Ae("whatsapp"),disabled:Ce,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-green-500 hover:bg-green-600 text-white text-xs font-bold transition-colors disabled:opacity-50",children:[e.jsx(ve,{className:"w-3.5 h-3.5"})," WhatsApp"]}),e.jsxs("button",{onClick:()=>Ae("sms"),disabled:Ce,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold border border-slate-200 transition-colors disabled:opacity-50",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"})," SMS"]}),e.jsxs("button",{onClick:()=>Ae("email"),disabled:Ce,className:"flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold border border-slate-200 transition-colors disabled:opacity-50",children:[e.jsx(we,{className:"w-3.5 h-3.5"})," Email"]})]})]})})]}),It&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>xe(!1)}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md p-6 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center",children:e.jsx(Es,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"T√©l√©phone de pr√™t"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Ce client a un t√©l√©phone de pr√™t !"})]})]}),e.jsxs("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl mb-4",children:[e.jsxs("p",{className:"text-sm font-semibold text-amber-800",children:["T√©l√©phone pr√™t√© : ",d.telephone_pret]}),d.telephone_pret_imei&&e.jsxs("p",{className:"text-xs text-amber-600 font-mono mt-1",children:["IMEI : ",d.telephone_pret_imei]}),e.jsx("p",{className:"text-xs text-amber-700 mt-2 font-medium",children:"Pensez √† r√©cup√©rer le t√©l√©phone de pr√™t avant de rendre l'appareil au client !"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>xe(!1),className:"btn-ghost flex-1",children:"Annuler"}),e.jsx("button",{onClick:Xt,className:"btn-primary flex-1",children:"T√©l√©phone r√©cup√©r√©, rendre au client"})]})]})})]}),zt&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>ee(!1)}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Rendu au client"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Le client a-t-il r√©gl√© ?"})]})]}),se>0&&e.jsxs("div",{className:"p-4 bg-gradient-to-br from-emerald-50 to-green-50 border border-emerald-200 rounded-xl mb-5 text-center",children:[e.jsx("p",{className:"text-xs text-emerald-600 font-medium mb-1",children:"Reste √† payer"}),e.jsx("p",{className:"text-2xl font-extrabold text-emerald-700",children:F(se)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:Zt,className:"w-full py-3 px-4 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-bold transition-colors flex items-center justify-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"})," Oui, pay√©"]}),e.jsxs("button",{onClick:es,className:"w-full py-3 px-4 rounded-xl bg-red-50 hover:bg-red-100 text-red-600 text-sm font-bold border border-red-200 transition-colors flex items-center justify-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"})," Non, pas pay√©"]}),e.jsxs("button",{onClick:()=>ee(!1),className:"w-full py-2.5 px-4 rounded-xl text-slate-400 hover:text-slate-600 text-sm font-medium transition-colors flex items-center justify-center gap-1",children:[e.jsx(Le,{className:"w-3.5 h-3.5"})," Annuler"]})]})]})})]}),Bt&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:()=>Ee(!1)}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 animate-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(ht,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-display font-bold text-slate-900",children:"Supprimer le ticket"}),e.jsx("p",{className:"text-sm text-slate-500",children:a.ticket_code})]})]}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Cette action est irr√©versible. Toutes les donn√©es li√©es (notes, commandes, historique) seront supprim√©es."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"input-label",children:"Code administrateur"}),e.jsx("input",{type:"password",value:Te,onChange:t=>{Ge(t.target.value),Pe("")},onKeyDown:t=>t.key==="Enter"&&lt(),className:"input",placeholder:"Entrez le code admin",autoFocus:!0}),Xe&&e.jsx("p",{className:"text-xs text-red-500 mt-1 font-medium",children:Xe})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Ee(!1),className:"btn-ghost flex-1",children:"Annuler"}),e.jsx("button",{onClick:lt,disabled:Ze||!Te,className:"flex-1 py-2.5 px-4 rounded-xl bg-red-600 hover:bg-red-700 text-white text-sm font-semibold transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:Ze?"Suppression...":"Supprimer"})]})]})})]}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8",children:[(()=>{const t=me.filter(r=>r.important);return!Ft&&t.length===0?null:(t.length>0&&t[0],e.jsxs("div",{className:"flex items-start gap-3 p-4 mb-5 rounded-xl bg-red-50 border border-red-200 shadow-sm animate-in",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500 flex items-center justify-center shrink-0",children:e.jsx(fe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsx("p",{className:"text-sm font-bold text-red-800",children:"Note importante"}),t.map(r=>e.jsx("p",{className:"text-sm text-red-700",children:r.contenu.replace(/^\[ATTENTION\]\s*‚ö†?\s*/i,"")},r.id)),t.length===0&&a.attention&&e.jsx("p",{className:"text-sm text-red-700",children:a.attention})]}),e.jsx("button",{onClick:()=>Be(!1),className:"shrink-0 p-1 rounded-lg text-red-300 hover:text-red-600 hover:bg-red-100 transition-colors",children:e.jsx(K,{className:"w-4 h-4"})})]}))})(),e.jsx("div",{className:"card p-5 mb-6",children:e.jsx(us,{statut:a.statut,hasPiece:a.commande_piece===1})}),e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsxs("button",{onClick:()=>Je(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors",children:[e.jsx(je,{className:"w-3.5 h-3.5"})," Personnaliser"]}),e.jsxs("button",{onClick:()=>He(!0),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition-colors",children:[e.jsx(Mt,{className:"w-3.5 h-3.5"})," File d'attente"]}),re&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:at,className:"btn-primary text-xs px-3 py-1.5",children:[e.jsx(_e,{className:"w-3.5 h-3.5"})," Sauver"]}),e.jsx("button",{onClick:nt,className:"btn-ghost text-xs px-3 py-1.5",children:"R√©initialiser"})]})]}),re&&e.jsx("div",{className:"p-3 mb-5 rounded-lg bg-brand-50 border border-brand-200 text-xs text-brand-700",children:"Glissez-d√©posez les blocs pour r√©organiser. Cliquez S/M/L pour changer la taille, les fl√®ches pour d√©placer entre colonnes."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[55fr_45fr] gap-5",children:[e.jsx("div",{className:"space-y-5",children:ke.filter(t=>t.col==="left").sort((t,r)=>t.order-r.order).map(mt)}),e.jsx("div",{className:"space-y-5",children:ke.filter(t=>t.col==="right").sort((t,r)=>t.order-r.order).map(mt)})]})]}),e.jsx("div",{className:"mt-10 mb-4 text-center",children:e.jsx("button",{onClick:()=>{Ee(!0),Ge(""),Pe("")},className:"text-xs text-slate-400 hover:text-red-500 transition-colors",children:"Supprimer ce ticket"})}),e.jsx(Rs,{open:V,onClose:()=>Oe(!1),ticketId:i,ticketCode:a.ticket_code,clientTel:a.client_tel,clientEmail:a.client_email}),e.jsx(Vs,{open:qt,onClose:()=>Je(!1),prefs:Se,onPrefsChange:Kt,layoutEditMode:re,onToggleEditMode:()=>We(t=>!t),onSaveLayout:at,onResetLayout:nt}),e.jsx(Ws,{open:Ot,onClose:()=>He(!1),currentTicketId:parseInt(i),basePath:m,user:l})]})}export{sa as default};
